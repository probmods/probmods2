(function(){function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}return e})()({1:[function(require,module,exports){"use strict";module.exports=LRUCache;var Map=require("pseudomap");var util=require("util");var Yallist=require("yallist");var hasSymbol=typeof Symbol==="function";var makeSymbol;if(hasSymbol){makeSymbol=function(key){return Symbol.for(key)}}else{makeSymbol=function(key){return"_"+key}}var MAX=makeSymbol("max");var LENGTH=makeSymbol("length");var LENGTH_CALCULATOR=makeSymbol("lengthCalculator");var ALLOW_STALE=makeSymbol("allowStale");var MAX_AGE=makeSymbol("maxAge");var DISPOSE=makeSymbol("dispose");var NO_DISPOSE_ON_SET=makeSymbol("noDisposeOnSet");var LRU_LIST=makeSymbol("lruList");var CACHE=makeSymbol("cache");function naiveLength(){return 1}function LRUCache(options){if(!(this instanceof LRUCache)){return new LRUCache(options)}if(typeof options==="number"){options={max:options}}if(!options){options={}}var max=this[MAX]=options.max;if(!max||!(typeof max==="number")||max<=0){this[MAX]=Infinity}var lc=options.length||naiveLength;if(typeof lc!=="function"){lc=naiveLength}this[LENGTH_CALCULATOR]=lc;this[ALLOW_STALE]=options.stale||false;this[MAX_AGE]=options.maxAge||0;this[DISPOSE]=options.dispose;this[NO_DISPOSE_ON_SET]=options.noDisposeOnSet||false;this.reset()}Object.defineProperty(LRUCache.prototype,"max",{set:function(mL){if(!mL||!(typeof mL==="number")||mL<=0){mL=Infinity}this[MAX]=mL;trim(this)},get:function(){return this[MAX]},enumerable:true});Object.defineProperty(LRUCache.prototype,"allowStale",{set:function(allowStale){this[ALLOW_STALE]=!!allowStale},get:function(){return this[ALLOW_STALE]},enumerable:true});Object.defineProperty(LRUCache.prototype,"maxAge",{set:function(mA){if(!mA||!(typeof mA==="number")||mA<0){mA=0}this[MAX_AGE]=mA;trim(this)},get:function(){return this[MAX_AGE]},enumerable:true});Object.defineProperty(LRUCache.prototype,"lengthCalculator",{set:function(lC){if(typeof lC!=="function"){lC=naiveLength}if(lC!==this[LENGTH_CALCULATOR]){this[LENGTH_CALCULATOR]=lC;this[LENGTH]=0;this[LRU_LIST].forEach(function(hit){hit.length=this[LENGTH_CALCULATOR](hit.value,hit.key);this[LENGTH]+=hit.length},this)}trim(this)},get:function(){return this[LENGTH_CALCULATOR]},enumerable:true});Object.defineProperty(LRUCache.prototype,"length",{get:function(){return this[LENGTH]},enumerable:true});Object.defineProperty(LRUCache.prototype,"itemCount",{get:function(){return this[LRU_LIST].length},enumerable:true});LRUCache.prototype.rforEach=function(fn,thisp){thisp=thisp||this;for(var walker=this[LRU_LIST].tail;walker!==null;){var prev=walker.prev;forEachStep(this,fn,walker,thisp);walker=prev}};function forEachStep(self,fn,node,thisp){var hit=node.value;if(isStale(self,hit)){del(self,node);if(!self[ALLOW_STALE]){hit=undefined}}if(hit){fn.call(thisp,hit.value,hit.key,self)}}LRUCache.prototype.forEach=function(fn,thisp){thisp=thisp||this;for(var walker=this[LRU_LIST].head;walker!==null;){var next=walker.next;forEachStep(this,fn,walker,thisp);walker=next}};LRUCache.prototype.keys=function(){return this[LRU_LIST].toArray().map(function(k){return k.key},this)};LRUCache.prototype.values=function(){return this[LRU_LIST].toArray().map(function(k){return k.value},this)};LRUCache.prototype.reset=function(){if(this[DISPOSE]&&this[LRU_LIST]&&this[LRU_LIST].length){this[LRU_LIST].forEach(function(hit){this[DISPOSE](hit.key,hit.value)},this)}this[CACHE]=new Map;this[LRU_LIST]=new Yallist;this[LENGTH]=0};LRUCache.prototype.dump=function(){return this[LRU_LIST].map(function(hit){if(!isStale(this,hit)){return{k:hit.key,v:hit.value,e:hit.now+(hit.maxAge||0)}}},this).toArray().filter(function(h){return h})};LRUCache.prototype.dumpLru=function(){return this[LRU_LIST]};LRUCache.prototype.inspect=function(n,opts){var str="LRUCache {";var extras=false;var as=this[ALLOW_STALE];if(as){str+="\n  allowStale: true";extras=true}var max=this[MAX];if(max&&max!==Infinity){if(extras){str+=","}str+="\n  max: "+util.inspect(max,opts);extras=true}var maxAge=this[MAX_AGE];if(maxAge){if(extras){str+=","}str+="\n  maxAge: "+util.inspect(maxAge,opts);extras=true}var lc=this[LENGTH_CALCULATOR];if(lc&&lc!==naiveLength){if(extras){str+=","}str+="\n  length: "+util.inspect(this[LENGTH],opts);extras=true}var didFirst=false;this[LRU_LIST].forEach(function(item){if(didFirst){str+=",\n  "}else{if(extras){str+=",\n"}didFirst=true;str+="\n  "}var key=util.inspect(item.key).split("\n").join("\n  ");var val={value:item.value};if(item.maxAge!==maxAge){val.maxAge=item.maxAge}if(lc!==naiveLength){val.length=item.length}if(isStale(this,item)){val.stale=true}val=util.inspect(val,opts).split("\n").join("\n  ");str+=key+" => "+val});if(didFirst||extras){str+="\n"}str+="}";return str};LRUCache.prototype.set=function(key,value,maxAge){maxAge=maxAge||this[MAX_AGE];var now=maxAge?Date.now():0;var len=this[LENGTH_CALCULATOR](value,key);if(this[CACHE].has(key)){if(len>this[MAX]){del(this,this[CACHE].get(key));return false}var node=this[CACHE].get(key);var item=node.value;if(this[DISPOSE]){if(!this[NO_DISPOSE_ON_SET]){this[DISPOSE](key,item.value)}}item.now=now;item.maxAge=maxAge;item.value=value;this[LENGTH]+=len-item.length;item.length=len;this.get(key);trim(this);return true}var hit=new Entry(key,value,len,now,maxAge);if(hit.length>this[MAX]){if(this[DISPOSE]){this[DISPOSE](key,value)}return false}this[LENGTH]+=hit.length;this[LRU_LIST].unshift(hit);this[CACHE].set(key,this[LRU_LIST].head);trim(this);return true};LRUCache.prototype.has=function(key){if(!this[CACHE].has(key))return false;var hit=this[CACHE].get(key).value;if(isStale(this,hit)){return false}return true};LRUCache.prototype.get=function(key){return get(this,key,true)};LRUCache.prototype.peek=function(key){return get(this,key,false)};LRUCache.prototype.pop=function(){var node=this[LRU_LIST].tail;if(!node)return null;del(this,node);return node.value};LRUCache.prototype.del=function(key){del(this,this[CACHE].get(key))};LRUCache.prototype.load=function(arr){this.reset();var now=Date.now();for(var l=arr.length-1;l>=0;l--){var hit=arr[l];var expiresAt=hit.e||0;if(expiresAt===0){this.set(hit.k,hit.v)}else{var maxAge=expiresAt-now;if(maxAge>0){this.set(hit.k,hit.v,maxAge)}}}};LRUCache.prototype.prune=function(){var self=this;this[CACHE].forEach(function(value,key){get(self,key,false)})};function get(self,key,doUse){var node=self[CACHE].get(key);if(node){var hit=node.value;if(isStale(self,hit)){del(self,node);if(!self[ALLOW_STALE])hit=undefined}else{if(doUse){self[LRU_LIST].unshiftNode(node)}}if(hit)hit=hit.value}return hit}function isStale(self,hit){if(!hit||!hit.maxAge&&!self[MAX_AGE]){return false}var stale=false;var diff=Date.now()-hit.now;if(hit.maxAge){stale=diff>hit.maxAge}else{stale=self[MAX_AGE]&&diff>self[MAX_AGE]}return stale}function trim(self){if(self[LENGTH]>self[MAX]){for(var walker=self[LRU_LIST].tail;self[LENGTH]>self[MAX]&&walker!==null;){var prev=walker.prev;del(self,walker);walker=prev}}}function del(self,node){if(node){var hit=node.value;if(self[DISPOSE]){self[DISPOSE](hit.key,hit.value)}self[LENGTH]-=hit.length;self[CACHE].delete(hit.key);self[LRU_LIST].removeNode(node)}}function Entry(key,value,length,now,maxAge){this.key=key;this.value=value;this.length=length;this.now=now;this.maxAge=maxAge||0}},{pseudomap:3,util:254,yallist:247}],2:[function(require,module,exports){var paper=new function(undefined){var Base=new function(){var hidden=/^(statics|enumerable|beans|preserve)$/,forEach=[].forEach||function(iter,bind){for(var i=0,l=this.length;i<l;i++)iter.call(bind,this[i],i,this)},forIn=function(iter,bind){for(var i in this)if(this.hasOwnProperty(i))iter.call(bind,this[i],i,this)},create=Object.create||function(proto){return{__proto__:proto}},describe=Object.getOwnPropertyDescriptor||function(obj,name){var get=obj.__lookupGetter__&&obj.__lookupGetter__(name);return get?{get:get,set:obj.__lookupSetter__(name),enumerable:true,configurable:true}:obj.hasOwnProperty(name)?{value:obj[name],enumerable:true,configurable:true,writable:true}:null},_define=Object.defineProperty||function(obj,name,desc){if((desc.get||desc.set)&&obj.__defineGetter__){if(desc.get)obj.__defineGetter__(name,desc.get);if(desc.set)obj.__defineSetter__(name,desc.set)}else{obj[name]=desc.value}return obj},define=function(obj,name,desc){delete obj[name];return _define(obj,name,desc)};function inject(dest,src,enumerable,beans,preserve){var beansNames={};function field(name,val){val=val||(val=describe(src,name))&&(val.get?val:val.value);if(typeof val==="string"&&val[0]==="#")val=dest[val.substring(1)]||val;var isFunc=typeof val==="function",res=val,prev=preserve||isFunc&&!val.base?val&&val.get?name in dest:dest[name]:null,bean;if(!preserve||!prev){if(isFunc&&prev)val.base=prev;if(isFunc&&beans!==false&&(bean=name.match(/^([gs]et|is)(([A-Z])(.*))$/)))beansNames[bean[3].toLowerCase()+bean[4]]=bean[2];if(!res||isFunc||!res.get||typeof res.get!=="function"||!Base.isPlainObject(res))res={value:res,writable:true};if((describe(dest,name)||{configurable:true}).configurable){res.configurable=true;res.enumerable=enumerable}define(dest,name,res)}}if(src){for(var name in src){if(src.hasOwnProperty(name)&&!hidden.test(name))field(name)}for(var name in beansNames){var part=beansNames[name],set=dest["set"+part],get=dest["get"+part]||set&&dest["is"+part];if(get&&(beans===true||get.length===0))field(name,{get:get,set:set})}}return dest}function each(obj,iter,bind){if(obj)("length"in obj&&!obj.getLength&&typeof obj.length==="number"?forEach:forIn).call(obj,iter,bind=bind||obj);return bind}function set(obj,props,exclude){for(var key in props)if(props.hasOwnProperty(key)&&!(exclude&&exclude[key]))obj[key]=props[key];return obj}return inject(function Base(){for(var i=0,l=arguments.length;i<l;i++)set(this,arguments[i])},{inject:function(src){if(src){var statics=src.statics===true?src:src.statics,beans=src.beans,preserve=src.preserve;if(statics!==src)inject(this.prototype,src,src.enumerable,beans,preserve);inject(this,statics,true,beans,preserve)}for(var i=1,l=arguments.length;i<l;i++)this.inject(arguments[i]);return this},extend:function(){var base=this,ctor,proto;for(var i=0,l=arguments.length;i<l;i++)if(ctor=arguments[i].initialize)break;ctor=ctor||function(){base.apply(this,arguments)};proto=ctor.prototype=create(this.prototype);define(proto,"constructor",{value:ctor,writable:true,configurable:true});inject(ctor,this,true);if(arguments.length)this.inject.apply(ctor,arguments);ctor.base=base;return ctor}},true).inject({inject:function(){for(var i=0,l=arguments.length;i<l;i++){var src=arguments[i];if(src)inject(this,src,src.enumerable,src.beans,src.preserve)}return this},extend:function(){var res=create(this);return res.inject.apply(res,arguments)},each:function(iter,bind){return each(this,iter,bind)},set:function(props){return set(this,props)},clone:function(){return new this.constructor(this)},statics:{each:each,create:create,define:define,describe:describe,set:set,clone:function(obj){return set(new obj.constructor,obj)},isPlainObject:function(obj){var ctor=obj!=null&&obj.constructor;return ctor&&(ctor===Object||ctor===Base||ctor.name==="Object")},pick:function(a,b){return a!==undefined?a:b}}})};if(typeof module!=="undefined")module.exports=Base;Base.inject({toString:function(){return this._id!=null?(this._class||"Object")+(this._name?" '"+this._name+"'":" @"+this._id):"{ "+Base.each(this,function(value,key){if(!/^_/.test(key)){var type=typeof value;this.push(key+": "+(type==="number"?Formatter.instance.number(value):type==="string"?"'"+value+"'":value))}},[]).join(", ")+" }"},getClassName:function(){return this._class||""},exportJSON:function(options){return Base.exportJSON(this,options)},toJSON:function(){return Base.serialize(this)},_set:function(props,exclude,dontCheck){if(props&&(dontCheck||Base.isPlainObject(props))){var keys=Object.keys(props._filtering||props);for(var i=0,l=keys.length;i<l;i++){var key=keys[i];if(!(exclude&&exclude[key])){var value=props[key];if(value!==undefined)this[key]=value}}return true}},statics:{exports:{enumerable:true},extend:function extend(){var res=extend.base.apply(this,arguments),name=res.prototype._class;if(name&&!Base.exports[name])Base.exports[name]=res;return res},equals:function(obj1,obj2){if(obj1===obj2)return true;if(obj1&&obj1.equals)return obj1.equals(obj2);if(obj2&&obj2.equals)return obj2.equals(obj1);if(obj1&&obj2&&typeof obj1==="object"&&typeof obj2==="object"){if(Array.isArray(obj1)&&Array.isArray(obj2)){var length=obj1.length;if(length!==obj2.length)return false;while(length--){if(!Base.equals(obj1[length],obj2[length]))return false}}else{var keys=Object.keys(obj1),length=keys.length;if(length!==Object.keys(obj2).length)return false;while(length--){var key=keys[length];if(!(obj2.hasOwnProperty(key)&&Base.equals(obj1[key],obj2[key])))return false}}return true}return false},read:function(list,start,options,length){if(this===Base){var value=this.peek(list,start);list.__index++;return value}var proto=this.prototype,readIndex=proto._readIndex,index=start||readIndex&&list.__index||0;if(!length)length=list.length-index;var obj=list[index];if(obj instanceof this||options&&options.readNull&&obj==null&&length<=1){if(readIndex)list.__index=index+1;return obj&&options&&options.clone?obj.clone():obj}obj=Base.create(this.prototype);if(readIndex)obj.__read=true;obj=obj.initialize.apply(obj,index>0||length<list.length?Array.prototype.slice.call(list,index,index+length):list)||obj;if(readIndex){list.__index=index+obj.__read;obj.__read=undefined}return obj},peek:function(list,start){return list[list.__index=start||list.__index||0]},remain:function(list){return list.length-(list.__index||0)},readAll:function(list,start,options){var res=[],entry;for(var i=start||0,l=list.length;i<l;i++){res.push(Array.isArray(entry=list[i])?this.read(entry,0,options):this.read(list,i,options,1))}return res},readNamed:function(list,name,start,options,length){var value=this.getNamed(list,name),hasObject=value!==undefined;if(hasObject){var filtered=list._filtered;if(!filtered){filtered=list._filtered=Base.create(list[0]);filtered._filtering=list[0]}filtered[name]=undefined}return this.read(hasObject?[value]:list,start,options,length)},getNamed:function(list,name){var arg=list[0];if(list._hasObject===undefined)list._hasObject=list.length===1&&Base.isPlainObject(arg);if(list._hasObject)return name?arg[name]:list._filtered||arg},hasNamed:function(list,name){return!!this.getNamed(list,name)},isPlainValue:function(obj,asString){return this.isPlainObject(obj)||Array.isArray(obj)||asString&&typeof obj==="string"},serialize:function(obj,options,compact,dictionary){options=options||{};var root=!dictionary,res;if(root){options.formatter=new Formatter(options.precision);dictionary={length:0,definitions:{},references:{},add:function(item,create){var id="#"+item._id,ref=this.references[id];if(!ref){this.length++;var res=create.call(item),name=item._class;if(name&&res[0]!==name)res.unshift(name);this.definitions[id]=res;ref=this.references[id]=[id]}return ref}}}if(obj&&obj._serialize){res=obj._serialize(options,dictionary);var name=obj._class;if(name&&!compact&&!res._compact&&res[0]!==name)res.unshift(name)}else if(Array.isArray(obj)){res=[];for(var i=0,l=obj.length;i<l;i++)res[i]=Base.serialize(obj[i],options,compact,dictionary);if(compact)res._compact=true}else if(Base.isPlainObject(obj)){res={};var keys=Object.keys(obj);for(var i=0,l=keys.length;i<l;i++){var key=keys[i];res[key]=Base.serialize(obj[key],options,compact,dictionary)}}else if(typeof obj==="number"){res=options.formatter.number(obj,options.precision)}else{res=obj}return root&&dictionary.length>0?[["dictionary",dictionary.definitions],res]:res},deserialize:function(json,create,_data,_isDictionary){var res=json,isRoot=!_data;_data=_data||{};if(Array.isArray(json)){var type=json[0],isDictionary=type==="dictionary";if(json.length==1&&/^#/.test(type))return _data.dictionary[type];type=Base.exports[type];res=[];if(_isDictionary)_data.dictionary=res;for(var i=type?1:0,l=json.length;i<l;i++)res.push(Base.deserialize(json[i],create,_data,isDictionary));if(type){var args=res;if(create){res=create(type,args)}else{res=Base.create(type.prototype);type.apply(res,args)}}}else if(Base.isPlainObject(json)){res={};if(_isDictionary)_data.dictionary=res;for(var key in json)res[key]=Base.deserialize(json[key],create,_data)}return isRoot&&json&&json.length&&json[0][0]==="dictionary"?res[1]:res},exportJSON:function(obj,options){var json=Base.serialize(obj,options);return options&&options.asString===false?json:JSON.stringify(json)},importJSON:function(json,target){return Base.deserialize(typeof json==="string"?JSON.parse(json):json,function(type,args){var obj=target&&target.constructor===type?target:Base.create(type.prototype),isTarget=obj===target;if(args.length===1&&obj instanceof Item&&(isTarget||!(obj instanceof Layer))){var arg=args[0];if(Base.isPlainObject(arg))arg.insert=false}type.apply(obj,args);if(isTarget)target=null;return obj})},splice:function(list,items,index,remove){var amount=items&&items.length,append=index===undefined;index=append?list.length:index;if(index>list.length)index=list.length;for(var i=0;i<amount;i++)items[i]._index=index+i;if(append){list.push.apply(list,items);return[]}else{var args=[index,remove];if(items)args.push.apply(args,items);var removed=list.splice.apply(list,args);for(var i=0,l=removed.length;i<l;i++)removed[i]._index=undefined;for(var i=index+amount,l=list.length;i<l;i++)list[i]._index=i;return removed}},capitalize:function(str){return str.replace(/\b[a-z]/g,function(match){return match.toUpperCase()})},camelize:function(str){return str.replace(/-(.)/g,function(all,chr){return chr.toUpperCase()})},hyphenate:function(str){return str.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}}});var Emitter={on:function(type,func){if(typeof type!=="string"){Base.each(type,function(value,key){this.on(key,value)},this)}else{var types=this._eventTypes,entry=types&&types[type],handlers=this._callbacks=this._callbacks||{};handlers=handlers[type]=handlers[type]||[];if(handlers.indexOf(func)===-1){handlers.push(func);if(entry&&entry.install&&handlers.length===1)entry.install.call(this,type)}}return this},off:function(type,func){if(typeof type!=="string"){Base.each(type,function(value,key){this.off(key,value)},this);return}var types=this._eventTypes,entry=types&&types[type],handlers=this._callbacks&&this._callbacks[type],index;if(handlers){if(!func||(index=handlers.indexOf(func))!==-1&&handlers.length===1){if(entry&&entry.uninstall)entry.uninstall.call(this,type);delete this._callbacks[type]}else if(index!==-1){handlers.splice(index,1)}}return this},once:function(type,func){return this.on(type,function(){func.apply(this,arguments);this.off(type,func)})},emit:function(type,event){var handlers=this._callbacks&&this._callbacks[type];if(!handlers)return false;var args=[].slice.call(arguments,1);handlers=handlers.slice();for(var i=0,l=handlers.length;i<l;i++){if(handlers[i].apply(this,args)===false){if(event&&event.stop)event.stop();break}}return true},responds:function(type){return!!(this._callbacks&&this._callbacks[type])},attach:"#on",detach:"#off",fire:"#emit",_installEvents:function(install){var handlers=this._callbacks,key=install?"install":"uninstall";for(var type in handlers){if(handlers[type].length>0){var types=this._eventTypes,entry=types&&types[type],func=entry&&entry[key];if(func)func.call(this,type)}}},statics:{inject:function inject(src){var events=src._events;if(events){var types={};Base.each(events,function(entry,key){var isString=typeof entry==="string",name=isString?entry:key,part=Base.capitalize(name),type=name.substring(2).toLowerCase();types[type]=isString?{}:entry;name="_"+name;src["get"+part]=function(){return this[name]};src["set"+part]=function(func){var prev=this[name];if(prev)this.off(type,prev);if(func)this.on(type,func);this[name]=func}});src._eventTypes=types}return inject.base.apply(this,arguments)}}};var PaperScope=Base.extend({_class:"PaperScope",initialize:function PaperScope(){paper=this;this.settings=new Base({applyMatrix:true,handleSize:4,hitTolerance:0});this.project=null;this.projects=[];this.tools=[];this.palettes=[];this._id=PaperScope._id++;PaperScope._scopes[this._id]=this;var proto=PaperScope.prototype;if(!this.support){var ctx=CanvasProvider.getContext(1,1);proto.support={nativeDash:"setLineDash"in ctx||"mozDash"in ctx,nativeBlendModes:BlendMode.nativeModes};CanvasProvider.release(ctx)}if(!this.browser){var agent=navigator.userAgent.toLowerCase(),platform=(/(win)/.exec(agent)||/(mac)/.exec(agent)||/(linux)/.exec(agent)||[])[0],browser=proto.browser={platform:platform};if(platform)browser[platform]=true;agent.replace(/(opera|chrome|safari|webkit|firefox|msie|trident|atom)\/?\s*([.\d]+)(?:.*version\/([.\d]+))?(?:.*rv\:([.\d]+))?/g,function(all,n,v1,v2,rv){if(!browser.chrome){var v=n==="opera"?v2:v1;if(n==="trident"){v=rv;n="msie"}browser.version=v;browser.versionNumber=parseFloat(v);browser.name=n;browser[n]=true}});if(browser.chrome)delete browser.webkit;if(browser.atom)delete browser.chrome}},version:"0.9.25",getView:function(){return this.project&&this.project.getView()},getPaper:function(){return this},execute:function(code,url,options){paper.PaperScript.execute(code,this,url,options);View.updateFocus()},install:function(scope){var that=this;Base.each(["project","view","tool"],function(key){Base.define(scope,key,{configurable:true,get:function(){return that[key]}})});for(var key in this)if(!/^_/.test(key)&&this[key])scope[key]=this[key]},setup:function(element){paper=this;this.project=new Project(element);return this},activate:function(){paper=this},clear:function(){for(var i=this.projects.length-1;i>=0;i--)this.projects[i].remove();for(var i=this.tools.length-1;i>=0;i--)this.tools[i].remove();for(var i=this.palettes.length-1;i>=0;i--)this.palettes[i].remove()},remove:function(){this.clear();delete PaperScope._scopes[this._id]},statics:new function(){function handleAttribute(name){name+="Attribute";return function(el,attr){return el[name](attr)||el[name]("data-paper-"+attr)}}return{_scopes:{},_id:0,get:function(id){return this._scopes[id]||null},getAttribute:handleAttribute("get"),hasAttribute:handleAttribute("has")}}});var PaperScopeItem=Base.extend(Emitter,{initialize:function(activate){this._scope=paper;this._index=this._scope[this._list].push(this)-1;if(activate||!this._scope[this._reference])this.activate()},activate:function(){if(!this._scope)return false;var prev=this._scope[this._reference];if(prev&&prev!==this)prev.emit("deactivate");this._scope[this._reference]=this;this.emit("activate",prev);return true},isActive:function(){return this._scope[this._reference]===this},remove:function(){if(this._index==null)return false;Base.splice(this._scope[this._list],null,this._index,1);if(this._scope[this._reference]==this)this._scope[this._reference]=null;this._scope=null;return true}});var Formatter=Base.extend({initialize:function(precision){this.precision=precision||5;this.multiplier=Math.pow(10,this.precision)},number:function(val){return Math.round(val*this.multiplier)/this.multiplier},pair:function(val1,val2,separator){return this.number(val1)+(separator||",")+this.number(val2)},point:function(val,separator){return this.number(val.x)+(separator||",")+this.number(val.y)},size:function(val,separator){return this.number(val.width)+(separator||",")+this.number(val.height)},rectangle:function(val,separator){return this.point(val,separator)+(separator||",")+this.size(val,separator)}});Formatter.instance=new Formatter;var Numerical=new function(){var abscissas=[[.5773502691896257],[0,.7745966692414834],[.33998104358485626,.8611363115940526],[0,.5384693101056831,.906179845938664],[.2386191860831969,.6612093864662645,.932469514203152],[0,.4058451513773972,.7415311855993945,.9491079123427585],[.1834346424956498,.525532409916329,.7966664774136267,.9602898564975363],[0,.3242534234038089,.6133714327005904,.8360311073266358,.9681602395076261],[.14887433898163122,.4333953941292472,.6794095682990244,.8650633666889845,.9739065285171717],[0,.26954315595234496,.5190961292068118,.7301520055740494,.8870625997680953,.978228658146057],[.1252334085114689,.3678314989981802,.5873179542866175,.7699026741943047,.9041172563704749,.9815606342467192],[0,.2304583159551348,.44849275103644687,.6423493394403402,.8015780907333099,.9175983992229779,.9841830547185881],[.10805494870734367,.31911236892788974,.5152486363581541,.6872929048116855,.827201315069765,.9284348836635735,.9862838086968123],[0,.20119409399743451,.3941513470775634,.5709721726085388,.7244177313601701,.8482065834104272,.937273392400706,.9879925180204854],[.09501250983763744,.2816035507792589,.45801677765722737,.6178762444026438,.755404408355003,.8656312023878318,.9445750230732326,.9894009349916499]];var weights=[[1],[.8888888888888888,.5555555555555556],[.6521451548625461,.34785484513745385],[.5688888888888889,.47862867049936647,.23692688505618908],[.46791393457269104,.3607615730481386,.17132449237917036],[.4179591836734694,.3818300505051189,.27970539148927664,.1294849661688697],[.362683783378362,.31370664587788727,.22238103445337448,.10122853629037626],[.3302393550012598,.31234707704000286,.26061069640293544,.1806481606948574,.08127438836157441],[.29552422471475287,.26926671930999635,.21908636251598204,.1494513491505806,.06667134430868814],[.2729250867779006,.26280454451024665,.23319376459199048,.18629021092773426,.1255803694649046,.05566856711617366],[.24914704581340277,.2334925365383548,.20316742672306592,.16007832854334622,.10693932599531843,.04717533638651183],[.2325515532308739,.22628318026289723,.2078160475368885,.17814598076194574,.13887351021978725,.09212149983772845,.04048400476531588],[.2152638534631578,.2051984637212956,.18553839747793782,.15720316715819355,.12151857068790319,.08015808715976021,.03511946033175186],[.2025782419255613,.19843148532711158,.1861610000155622,.16626920581699392,.13957067792615432,.10715922046717194,.07036604748810812,.03075324199611727],[.1894506104550685,.18260341504492358,.16915651939500254,.14959598881657674,.12462897125553388,.09515851168249279,.062253523938647894,.027152459411754096]];var abs=Math.abs,sqrt=Math.sqrt,pow=Math.pow,EPSILON=1e-12,MACHINE_EPSILON=1.12e-16;function clip(value,min,max){return value<min?min:value>max?max:value}return{TOLERANCE:1e-6,EPSILON:EPSILON,MACHINE_EPSILON:MACHINE_EPSILON,CURVETIME_EPSILON:4e-7,GEOMETRIC_EPSILON:2e-7,WINDING_EPSILON:2e-7,TRIGONOMETRIC_EPSILON:1e-7,CLIPPING_EPSILON:1e-7,KAPPA:4*(sqrt(2)-1)/3,isZero:function(val){return val>=-EPSILON&&val<=EPSILON},integrate:function(f,a,b,n){var x=abscissas[n-2],w=weights[n-2],A=(b-a)*.5,B=A+a,i=0,m=n+1>>1,sum=n&1?w[i++]*f(B):0;while(i<m){var Ax=A*x[i];sum+=w[i++]*(f(B+Ax)+f(B-Ax))}return A*sum},findRoot:function(f,df,x,a,b,n,tolerance){for(var i=0;i<n;i++){var fx=f(x),dx=fx/df(x),nx=x-dx;if(abs(dx)<tolerance)return nx;if(fx>0){b=x;x=nx<=a?(a+b)*.5:nx}else{a=x;x=nx>=b?(a+b)*.5:nx}}return x},solveQuadratic:function(a,b,c,roots,min,max){var count=0,eMin=min-EPSILON,eMax=max+EPSILON,x1,x2=Infinity,B=b,D;b/=-2;D=b*b-a*c;if(D!==0&&abs(D)<MACHINE_EPSILON){var gmC=pow(abs(a*b*c),1/3);if(gmC<1e-8){var mult=pow(10,abs(Math.floor(Math.log(gmC)*Math.LOG10E)));if(!isFinite(mult))mult=0;a*=mult;b*=mult;c*=mult;D=b*b-a*c}}if(abs(a)<EPSILON){if(abs(B)<EPSILON)return abs(c)<EPSILON?-1:0;x1=-c/B}else if(D>=-MACHINE_EPSILON){var Q=D<0?0:sqrt(D),R=b+(b<0?-Q:Q);if(R===0){x1=c/a;x2=-x1}else{x1=R/a;x2=c/R}}if(isFinite(x1)&&(min==null||x1>eMin&&x1<eMax))roots[count++]=min==null?x1:clip(x1,min,max);if(x2!==x1&&isFinite(x2)&&(min==null||x2>eMin&&x2<eMax))roots[count++]=min==null?x2:clip(x2,min,max);return count},solveCubic:function(a,b,c,d,roots,min,max){var count=0,x,b1,c2;if(abs(a)<EPSILON){a=b;b1=c;c2=d;x=Infinity}else if(abs(d)<EPSILON){b1=b;c2=c;x=0}else{var ec=1+MACHINE_EPSILON,x0,q,qd,t,r,s,tmp;x=-(b/a)/3;tmp=a*x,b1=tmp+b,c2=b1*x+c,qd=(tmp+b1)*x+c2,q=c2*x+d;t=q/a;r=pow(abs(t),1/3);s=t<0?-1:1;t=-qd/a;r=t>0?1.3247179572*Math.max(r,sqrt(t)):r;x0=x-s*r;if(x0!==x){do{x=x0;tmp=a*x,b1=tmp+b,c2=b1*x+c,qd=(tmp+b1)*x+c2,q=c2*x+d;x0=qd===0?x:x-q/qd/ec;if(x0===x){x=x0;break}}while(s*x0>s*x);if(abs(a)*x*x>abs(d/x)){c2=-d/x;b1=(c2-c)/x}}}var count=Numerical.solveQuadratic(a,b1,c2,roots,min,max);if(isFinite(x)&&(count===0||x!==roots[count-1])&&(min==null||x>min-EPSILON&&x<max+EPSILON))roots[count++]=min==null?x:clip(x,min,max);return count}}};var UID={_id:1,_pools:{},get:function(ctor){if(ctor){var name=ctor._class,pool=this._pools[name];if(!pool)pool=this._pools[name]={_id:1};return pool._id++}else{return this._id++}}};var Point=Base.extend({_class:"Point",_readIndex:true,initialize:function Point(arg0,arg1){var type=typeof arg0;if(type==="number"){var hasY=typeof arg1==="number";this.x=arg0;this.y=hasY?arg1:arg0;if(this.__read)this.__read=hasY?2:1}else if(type==="undefined"||arg0===null){this.x=this.y=0;if(this.__read)this.__read=arg0===null?1:0}else{if(Array.isArray(arg0)){this.x=arg0[0];this.y=arg0.length>1?arg0[1]:arg0[0]}else if(arg0.x!=null){this.x=arg0.x;this.y=arg0.y}else if(arg0.width!=null){this.x=arg0.width;this.y=arg0.height}else if(arg0.angle!=null){this.x=arg0.length;this.y=0;this.setAngle(arg0.angle)}else{this.x=this.y=0;if(this.__read)this.__read=0}if(this.__read)this.__read=1}},set:function(x,y){this.x=x;this.y=y;return this},equals:function(point){return this===point||point&&(this.x===point.x&&this.y===point.y||Array.isArray(point)&&this.x===point[0]&&this.y===point[1])||false},clone:function(){return new Point(this.x,this.y)},toString:function(){var f=Formatter.instance;return"{ x: "+f.number(this.x)+", y: "+f.number(this.y)+" }"},_serialize:function(options){var f=options.formatter;return[f.number(this.x),f.number(this.y)]},getLength:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},setLength:function(length){if(this.isZero()){var angle=this._angle||0;this.set(Math.cos(angle)*length,Math.sin(angle)*length)}else{var scale=length/this.getLength();if(Numerical.isZero(scale))this.getAngle();this.set(this.x*scale,this.y*scale)}},getAngle:function(){return this.getAngleInRadians.apply(this,arguments)*180/Math.PI},setAngle:function(angle){this.setAngleInRadians.call(this,angle*Math.PI/180)},getAngleInDegrees:"#getAngle",setAngleInDegrees:"#setAngle",getAngleInRadians:function(){if(!arguments.length){return this.isZero()?this._angle||0:this._angle=Math.atan2(this.y,this.x)}else{var point=Point.read(arguments),div=this.getLength()*point.getLength();if(Numerical.isZero(div)){return NaN}else{var a=this.dot(point)/div;return Math.acos(a<-1?-1:a>1?1:a)}}},setAngleInRadians:function(angle){this._angle=angle;if(!this.isZero()){var length=this.getLength();this.set(Math.cos(angle)*length,Math.sin(angle)*length)}},getQuadrant:function(){return this.x>=0?this.y>=0?1:4:this.y>=0?2:3}},{beans:false,getDirectedAngle:function(){var point=Point.read(arguments);return Math.atan2(this.cross(point),this.dot(point))*180/Math.PI},getDistance:function(){var point=Point.read(arguments),x=point.x-this.x,y=point.y-this.y,d=x*x+y*y,squared=Base.read(arguments);return squared?d:Math.sqrt(d)},normalize:function(length){if(length===undefined)length=1;var current=this.getLength(),scale=current!==0?length/current:0,point=new Point(this.x*scale,this.y*scale);if(scale>=0)point._angle=this._angle;return point},rotate:function(angle,center){if(angle===0)return this.clone();angle=angle*Math.PI/180;var point=center?this.subtract(center):this,sin=Math.sin(angle),cos=Math.cos(angle);point=new Point(point.x*cos-point.y*sin,point.x*sin+point.y*cos);return center?point.add(center):point},transform:function(matrix){return matrix?matrix._transformPoint(this):this},add:function(){var point=Point.read(arguments);return new Point(this.x+point.x,this.y+point.y)},subtract:function(){var point=Point.read(arguments);return new Point(this.x-point.x,this.y-point.y)},multiply:function(){var point=Point.read(arguments);return new Point(this.x*point.x,this.y*point.y)},divide:function(){var point=Point.read(arguments);return new Point(this.x/point.x,this.y/point.y)},modulo:function(){var point=Point.read(arguments);return new Point(this.x%point.x,this.y%point.y)},negate:function(){return new Point(-this.x,-this.y)},isInside:function(){return Rectangle.read(arguments).contains(this)},isClose:function(){var point=Point.read(arguments),tolerance=Base.read(arguments);return this.getDistance(point)<tolerance},isCollinear:function(){var point=Point.read(arguments);return Point.isCollinear(this.x,this.y,point.x,point.y)},isColinear:"#isCollinear",isOrthogonal:function(){var point=Point.read(arguments);return Point.isOrthogonal(this.x,this.y,point.x,point.y)},isZero:function(){return Numerical.isZero(this.x)&&Numerical.isZero(this.y)},isNaN:function(){return isNaN(this.x)||isNaN(this.y)},dot:function(){var point=Point.read(arguments);return this.x*point.x+this.y*point.y},cross:function(){var point=Point.read(arguments);return this.x*point.y-this.y*point.x},project:function(){var point=Point.read(arguments),scale=point.isZero()?0:this.dot(point)/point.dot(point);return new Point(point.x*scale,point.y*scale)},statics:{min:function(){var point1=Point.read(arguments),point2=Point.read(arguments);return new Point(Math.min(point1.x,point2.x),Math.min(point1.y,point2.y))},max:function(){var point1=Point.read(arguments),point2=Point.read(arguments);return new Point(Math.max(point1.x,point2.x),Math.max(point1.y,point2.y))},random:function(){return new Point(Math.random(),Math.random())},isCollinear:function(x1,y1,x2,y2){return Math.abs(x1*y2-y1*x2)<=Math.sqrt((x1*x1+y1*y1)*(x2*x2+y2*y2))*1e-7},isOrthogonal:function(x1,y1,x2,y2){return Math.abs(x1*x2+y1*y2)<=Math.sqrt((x1*x1+y1*y1)*(x2*x2+y2*y2))*1e-7}}},Base.each(["round","ceil","floor","abs"],function(name){var op=Math[name];this[name]=function(){return new Point(op(this.x),op(this.y))}},{}));var LinkedPoint=Point.extend({initialize:function Point(x,y,owner,setter){this._x=x;this._y=y;this._owner=owner;this._setter=setter},set:function(x,y,_dontNotify){this._x=x;this._y=y;if(!_dontNotify)this._owner[this._setter](this);return this},getX:function(){return this._x},setX:function(x){this._x=x;this._owner[this._setter](this)},getY:function(){return this._y},setY:function(y){this._y=y;this._owner[this._setter](this)}});var Size=Base.extend({_class:"Size",_readIndex:true,initialize:function Size(arg0,arg1){var type=typeof arg0;if(type==="number"){var hasHeight=typeof arg1==="number";this.width=arg0;this.height=hasHeight?arg1:arg0;if(this.__read)this.__read=hasHeight?2:1}else if(type==="undefined"||arg0===null){this.width=this.height=0;if(this.__read)this.__read=arg0===null?1:0}else{if(Array.isArray(arg0)){this.width=arg0[0];this.height=arg0.length>1?arg0[1]:arg0[0]}else if(arg0.width!=null){this.width=arg0.width;this.height=arg0.height}else if(arg0.x!=null){this.width=arg0.x;this.height=arg0.y}else{this.width=this.height=0;if(this.__read)this.__read=0}if(this.__read)this.__read=1}},set:function(width,height){this.width=width;this.height=height;return this},equals:function(size){return size===this||size&&(this.width===size.width&&this.height===size.height||Array.isArray(size)&&this.width===size[0]&&this.height===size[1])||false},clone:function(){return new Size(this.width,this.height)},toString:function(){var f=Formatter.instance;return"{ width: "+f.number(this.width)+", height: "+f.number(this.height)+" }"},_serialize:function(options){var f=options.formatter;return[f.number(this.width),f.number(this.height)]},add:function(){var size=Size.read(arguments);return new Size(this.width+size.width,this.height+size.height)},subtract:function(){var size=Size.read(arguments);return new Size(this.width-size.width,this.height-size.height)},multiply:function(){var size=Size.read(arguments);return new Size(this.width*size.width,this.height*size.height)},divide:function(){var size=Size.read(arguments);return new Size(this.width/size.width,this.height/size.height)},modulo:function(){var size=Size.read(arguments);return new Size(this.width%size.width,this.height%size.height)},negate:function(){return new Size(-this.width,-this.height)},isZero:function(){return Numerical.isZero(this.width)&&Numerical.isZero(this.height)},isNaN:function(){return isNaN(this.width)||isNaN(this.height)},statics:{min:function(size1,size2){return new Size(Math.min(size1.width,size2.width),Math.min(size1.height,size2.height))},max:function(size1,size2){return new Size(Math.max(size1.width,size2.width),Math.max(size1.height,size2.height))},random:function(){return new Size(Math.random(),Math.random())}}},Base.each(["round","ceil","floor","abs"],function(name){var op=Math[name];this[name]=function(){return new Size(op(this.width),op(this.height))}},{}));var LinkedSize=Size.extend({initialize:function Size(width,height,owner,setter){this._width=width;this._height=height;this._owner=owner;this._setter=setter},set:function(width,height,_dontNotify){this._width=width;this._height=height;if(!_dontNotify)this._owner[this._setter](this);return this},getWidth:function(){return this._width},setWidth:function(width){this._width=width;this._owner[this._setter](this)},getHeight:function(){return this._height},setHeight:function(height){this._height=height;this._owner[this._setter](this)}});var Rectangle=Base.extend({_class:"Rectangle",_readIndex:true,beans:true,initialize:function Rectangle(arg0,arg1,arg2,arg3){var type=typeof arg0,read=0;if(type==="number"){this.x=arg0;this.y=arg1;this.width=arg2;this.height=arg3;read=4}else if(type==="undefined"||arg0===null){this.x=this.y=this.width=this.height=0;read=arg0===null?1:0}else if(arguments.length===1){if(Array.isArray(arg0)){this.x=arg0[0];this.y=arg0[1];this.width=arg0[2];this.height=arg0[3];read=1}else if(arg0.x!==undefined||arg0.width!==undefined){this.x=arg0.x||0;this.y=arg0.y||0;this.width=arg0.width||0;this.height=arg0.height||0;read=1}else if(arg0.from===undefined&&arg0.to===undefined){this.x=this.y=this.width=this.height=0;this._set(arg0);read=1}}if(!read){var point=Point.readNamed(arguments,"from"),next=Base.peek(arguments);this.x=point.x;this.y=point.y;if(next&&next.x!==undefined||Base.hasNamed(arguments,"to")){var to=Point.readNamed(arguments,"to");this.width=to.x-point.x;this.height=to.y-point.y;if(this.width<0){this.x=to.x;this.width=-this.width}if(this.height<0){this.y=to.y;this.height=-this.height}}else{var size=Size.read(arguments);this.width=size.width;this.height=size.height}read=arguments.__index}if(this.__read)this.__read=read},set:function(x,y,width,height){this.x=x;this.y=y;this.width=width;this.height=height;return this},clone:function(){return new Rectangle(this.x,this.y,this.width,this.height)},equals:function(rect){var rt=Base.isPlainValue(rect)?Rectangle.read(arguments):rect;return rt===this||rt&&this.x===rt.x&&this.y===rt.y&&this.width===rt.width&&this.height===rt.height||false},toString:function(){var f=Formatter.instance;return"{ x: "+f.number(this.x)+", y: "+f.number(this.y)+", width: "+f.number(this.width)+", height: "+f.number(this.height)+" }"},_serialize:function(options){var f=options.formatter;return[f.number(this.x),f.number(this.y),f.number(this.width),f.number(this.height)]},getPoint:function(_dontLink){var ctor=_dontLink?Point:LinkedPoint;return new ctor(this.x,this.y,this,"setPoint")},setPoint:function(){var point=Point.read(arguments);this.x=point.x;this.y=point.y},getSize:function(_dontLink){var ctor=_dontLink?Size:LinkedSize;return new ctor(this.width,this.height,this,"setSize")},setSize:function(){var size=Size.read(arguments);if(this._fixX)this.x+=(this.width-size.width)*this._fixX;if(this._fixY)this.y+=(this.height-size.height)*this._fixY;this.width=size.width;this.height=size.height;this._fixW=1;this._fixH=1},getLeft:function(){return this.x},setLeft:function(left){if(!this._fixW)this.width-=left-this.x;this.x=left;this._fixX=0},getTop:function(){return this.y},setTop:function(top){if(!this._fixH)this.height-=top-this.y;this.y=top;this._fixY=0},getRight:function(){return this.x+this.width},setRight:function(right){if(this._fixX!==undefined&&this._fixX!==1)this._fixW=0;if(this._fixW)this.x=right-this.width;else this.width=right-this.x;this._fixX=1},getBottom:function(){return this.y+this.height},setBottom:function(bottom){if(this._fixY!==undefined&&this._fixY!==1)this._fixH=0;if(this._fixH)this.y=bottom-this.height;else this.height=bottom-this.y;this._fixY=1},getCenterX:function(){return this.x+this.width*.5},setCenterX:function(x){this.x=x-this.width*.5;this._fixX=.5},getCenterY:function(){return this.y+this.height*.5},setCenterY:function(y){this.y=y-this.height*.5;this._fixY=.5},getCenter:function(_dontLink){var ctor=_dontLink?Point:LinkedPoint;return new ctor(this.getCenterX(),this.getCenterY(),this,"setCenter")},setCenter:function(){var point=Point.read(arguments);this.setCenterX(point.x);this.setCenterY(point.y);return this},getArea:function(){return this.width*this.height},isEmpty:function(){return this.width===0||this.height===0},contains:function(arg){return arg&&arg.width!==undefined||(Array.isArray(arg)?arg:arguments).length==4?this._containsRectangle(Rectangle.read(arguments)):this._containsPoint(Point.read(arguments))},_containsPoint:function(point){var x=point.x,y=point.y;return x>=this.x&&y>=this.y&&x<=this.x+this.width&&y<=this.y+this.height},_containsRectangle:function(rect){var x=rect.x,y=rect.y;return x>=this.x&&y>=this.y&&x+rect.width<=this.x+this.width&&y+rect.height<=this.y+this.height},intersects:function(){var rect=Rectangle.read(arguments);return rect.x+rect.width>this.x&&rect.y+rect.height>this.y&&rect.x<this.x+this.width&&rect.y<this.y+this.height},touches:function(){var rect=Rectangle.read(arguments);return rect.x+rect.width>=this.x&&rect.y+rect.height>=this.y&&rect.x<=this.x+this.width&&rect.y<=this.y+this.height},intersect:function(){var rect=Rectangle.read(arguments),x1=Math.max(this.x,rect.x),y1=Math.max(this.y,rect.y),x2=Math.min(this.x+this.width,rect.x+rect.width),y2=Math.min(this.y+this.height,rect.y+rect.height);return new Rectangle(x1,y1,x2-x1,y2-y1)},unite:function(){var rect=Rectangle.read(arguments),x1=Math.min(this.x,rect.x),y1=Math.min(this.y,rect.y),x2=Math.max(this.x+this.width,rect.x+rect.width),y2=Math.max(this.y+this.height,rect.y+rect.height);return new Rectangle(x1,y1,x2-x1,y2-y1)},include:function(){var point=Point.read(arguments);var x1=Math.min(this.x,point.x),y1=Math.min(this.y,point.y),x2=Math.max(this.x+this.width,point.x),y2=Math.max(this.y+this.height,point.y);return new Rectangle(x1,y1,x2-x1,y2-y1)},expand:function(){var amount=Size.read(arguments),hor=amount.width,ver=amount.height;return new Rectangle(this.x-hor/2,this.y-ver/2,this.width+hor,this.height+ver)},scale:function(hor,ver){return this.expand(this.width*hor-this.width,this.height*(ver===undefined?hor:ver)-this.height)}},Base.each([["Top","Left"],["Top","Right"],["Bottom","Left"],["Bottom","Right"],["Left","Center"],["Top","Center"],["Right","Center"],["Bottom","Center"]],function(parts,index){var part=parts.join("");var xFirst=/^[RL]/.test(part);if(index>=4)parts[1]+=xFirst?"Y":"X";var x=parts[xFirst?0:1],y=parts[xFirst?1:0],getX="get"+x,getY="get"+y,setX="set"+x,setY="set"+y,get="get"+part,set="set"+part;this[get]=function(_dontLink){var ctor=_dontLink?Point:LinkedPoint;return new ctor(this[getX](),this[getY](),this,set)};this[set]=function(){var point=Point.read(arguments);this[setX](point.x);this[setY](point.y)}},{beans:true}));var LinkedRectangle=Rectangle.extend({initialize:function Rectangle(x,y,width,height,owner,setter){this.set(x,y,width,height,true);this._owner=owner;this._setter=setter},set:function(x,y,width,height,_dontNotify){this._x=x;this._y=y;this._width=width;this._height=height;if(!_dontNotify)this._owner[this._setter](this);return this}},new function(){var proto=Rectangle.prototype;return Base.each(["x","y","width","height"],function(key){var part=Base.capitalize(key);var internal="_"+key;this["get"+part]=function(){return this[internal]};this["set"+part]=function(value){this[internal]=value;if(!this._dontNotify)this._owner[this._setter](this)}},Base.each(["Point","Size","Center","Left","Top","Right","Bottom","CenterX","CenterY","TopLeft","TopRight","BottomLeft","BottomRight","LeftCenter","TopCenter","RightCenter","BottomCenter"],function(key){var name="set"+key;this[name]=function(){this._dontNotify=true;proto[name].apply(this,arguments);this._dontNotify=false;this._owner[this._setter](this)}},{isSelected:function(){return this._owner._boundsSelected},setSelected:function(selected){var owner=this._owner;if(owner.setSelected){owner._boundsSelected=selected;owner.setSelected(selected||owner._selectedSegmentState>0)}}}))});var Matrix=Base.extend({_class:"Matrix",initialize:function Matrix(arg){var count=arguments.length,ok=true;if(count===6){this.set.apply(this,arguments)}else if(count===1){if(arg instanceof Matrix){this.set(arg._a,arg._c,arg._b,arg._d,arg._tx,arg._ty)}else if(Array.isArray(arg)){this.set.apply(this,arg)}else{ok=false}}else if(count===0){this.reset()}else{ok=false}if(!ok)throw new Error("Unsupported matrix parameters")},set:function(a,c,b,d,tx,ty,_dontNotify){this._a=a;this._c=c;this._b=b;this._d=d;this._tx=tx;this._ty=ty;if(!_dontNotify)this._changed();return this},_serialize:function(options){return Base.serialize(this.getValues(),options)},_changed:function(){var owner=this._owner;if(owner){if(owner._applyMatrix){owner.transform(null,true)}else{owner._changed(9)}}},clone:function(){return new Matrix(this._a,this._c,this._b,this._d,this._tx,this._ty)},equals:function(mx){return mx===this||mx&&this._a===mx._a&&this._b===mx._b&&this._c===mx._c&&this._d===mx._d&&this._tx===mx._tx&&this._ty===mx._ty||false},toString:function(){var f=Formatter.instance;return"[["+[f.number(this._a),f.number(this._b),f.number(this._tx)].join(", ")+"], ["+[f.number(this._c),f.number(this._d),f.number(this._ty)].join(", ")+"]]"},reset:function(_dontNotify){this._a=this._d=1;this._c=this._b=this._tx=this._ty=0;if(!_dontNotify)this._changed();return this},apply:function(recursively,_setApplyMatrix){var owner=this._owner;if(owner){owner.transform(null,true,Base.pick(recursively,true),_setApplyMatrix);return this.isIdentity()}return false},translate:function(){var point=Point.read(arguments),x=point.x,y=point.y;this._tx+=x*this._a+y*this._b;this._ty+=x*this._c+y*this._d;this._changed();return this},scale:function(){var scale=Point.read(arguments),center=Point.read(arguments,0,{readNull:true});if(center)this.translate(center);this._a*=scale.x;this._c*=scale.x;this._b*=scale.y;this._d*=scale.y;if(center)this.translate(center.negate());this._changed();return this},rotate:function(angle){angle*=Math.PI/180;var center=Point.read(arguments,1),x=center.x,y=center.y,cos=Math.cos(angle),sin=Math.sin(angle),tx=x-x*cos+y*sin,ty=y-x*sin-y*cos,a=this._a,b=this._b,c=this._c,d=this._d;this._a=cos*a+sin*b;this._b=-sin*a+cos*b;this._c=cos*c+sin*d;this._d=-sin*c+cos*d;this._tx+=tx*a+ty*b;this._ty+=tx*c+ty*d;this._changed();return this},shear:function(){var shear=Point.read(arguments),center=Point.read(arguments,0,{readNull:true});if(center)this.translate(center);var a=this._a,c=this._c;this._a+=shear.y*this._b;this._c+=shear.y*this._d;this._b+=shear.x*a;this._d+=shear.x*c;if(center)this.translate(center.negate());this._changed();return this},skew:function(){var skew=Point.read(arguments),center=Point.read(arguments,0,{readNull:true}),toRadians=Math.PI/180,shear=new Point(Math.tan(skew.x*toRadians),Math.tan(skew.y*toRadians));return this.shear(shear,center)},concatenate:function(mx){var a1=this._a,b1=this._b,c1=this._c,d1=this._d,a2=mx._a,b2=mx._b,c2=mx._c,d2=mx._d,tx2=mx._tx,ty2=mx._ty;this._a=a2*a1+c2*b1;this._b=b2*a1+d2*b1;this._c=a2*c1+c2*d1;this._d=b2*c1+d2*d1;this._tx+=tx2*a1+ty2*b1;this._ty+=tx2*c1+ty2*d1;this._changed();return this},preConcatenate:function(mx){var a1=this._a,b1=this._b,c1=this._c,d1=this._d,tx1=this._tx,ty1=this._ty,a2=mx._a,b2=mx._b,c2=mx._c,d2=mx._d,tx2=mx._tx,ty2=mx._ty;this._a=a2*a1+b2*c1;this._b=a2*b1+b2*d1;this._c=c2*a1+d2*c1;this._d=c2*b1+d2*d1;this._tx=a2*tx1+b2*ty1+tx2;this._ty=c2*tx1+d2*ty1+ty2;this._changed();return this},chain:function(mx){var a1=this._a,b1=this._b,c1=this._c,d1=this._d,tx1=this._tx,ty1=this._ty,a2=mx._a,b2=mx._b,c2=mx._c,d2=mx._d,tx2=mx._tx,ty2=mx._ty;return new Matrix(a2*a1+c2*b1,a2*c1+c2*d1,b2*a1+d2*b1,b2*c1+d2*d1,tx1+tx2*a1+ty2*b1,ty1+tx2*c1+ty2*d1)},isIdentity:function(){return this._a===1&&this._c===0&&this._b===0&&this._d===1&&this._tx===0&&this._ty===0},orNullIfIdentity:function(){return this.isIdentity()?null:this},isInvertible:function(){return!!this._getDeterminant()},isSingular:function(){return!this._getDeterminant()},transform:function(src,dst,count){return arguments.length<3?this._transformPoint(Point.read(arguments)):this._transformCoordinates(src,dst,count)},_transformPoint:function(point,dest,_dontNotify){var x=point.x,y=point.y;if(!dest)dest=new Point;return dest.set(x*this._a+y*this._b+this._tx,x*this._c+y*this._d+this._ty,_dontNotify)},_transformCoordinates:function(src,dst,count){var i=0,j=0,max=2*count;while(i<max){var x=src[i++],y=src[i++];dst[j++]=x*this._a+y*this._b+this._tx;dst[j++]=x*this._c+y*this._d+this._ty}return dst},_transformCorners:function(rect){var x1=rect.x,y1=rect.y,x2=x1+rect.width,y2=y1+rect.height,coords=[x1,y1,x2,y1,x2,y2,x1,y2];return this._transformCoordinates(coords,coords,4)},_transformBounds:function(bounds,dest,_dontNotify){var coords=this._transformCorners(bounds),min=coords.slice(0,2),max=min.slice();for(var i=2;i<8;i++){var val=coords[i],j=i&1;if(val<min[j])min[j]=val;else if(val>max[j])max[j]=val}if(!dest)dest=new Rectangle;return dest.set(min[0],min[1],max[0]-min[0],max[1]-min[1],_dontNotify)},inverseTransform:function(){return this._inverseTransform(Point.read(arguments))},_getDeterminant:function(){var det=this._a*this._d-this._b*this._c;return isFinite(det)&&!Numerical.isZero(det)&&isFinite(this._tx)&&isFinite(this._ty)?det:null},_inverseTransform:function(point,dest,_dontNotify){var det=this._getDeterminant();if(!det)return null;var x=point.x-this._tx,y=point.y-this._ty;if(!dest)dest=new Point;return dest.set((x*this._d-y*this._b)/det,(y*this._a-x*this._c)/det,_dontNotify)},decompose:function(){var a=this._a,b=this._b,c=this._c,d=this._d;if(Numerical.isZero(a*d-b*c))return null;var scaleX=Math.sqrt(a*a+b*b);a/=scaleX;b/=scaleX;var shear=a*c+b*d;c-=a*shear;d-=b*shear;var scaleY=Math.sqrt(c*c+d*d);c/=scaleY;d/=scaleY;shear/=scaleY;if(a*d<b*c){a=-a;b=-b;shear=-shear;scaleX=-scaleX}return{scaling:new Point(scaleX,scaleY),rotation:-Math.atan2(b,a)*180/Math.PI,shearing:shear}},getValues:function(){return[this._a,this._c,this._b,this._d,this._tx,this._ty]},getTranslation:function(){return new Point(this._tx,this._ty)},getScaling:function(){return(this.decompose()||{}).scaling},getRotation:function(){return(this.decompose()||{}).rotation},inverted:function(){var det=this._getDeterminant();return det&&new Matrix(this._d/det,-this._c/det,-this._b/det,this._a/det,(this._b*this._ty-this._d*this._tx)/det,(this._c*this._tx-this._a*this._ty)/det)},shiftless:function(){return new Matrix(this._a,this._c,this._b,this._d,0,0)},applyToContext:function(ctx){ctx.transform(this._a,this._c,this._b,this._d,this._tx,this._ty)}},Base.each(["a","c","b","d","tx","ty"],function(name){var part=Base.capitalize(name),prop="_"+name;this["get"+part]=function(){return this[prop]};this["set"+part]=function(value){this[prop]=value;this._changed()}},{}));var Line=Base.extend({_class:"Line",initialize:function Line(arg0,arg1,arg2,arg3,arg4){var asVector=false;if(arguments.length>=4){this._px=arg0;this._py=arg1;this._vx=arg2;this._vy=arg3;asVector=arg4}else{this._px=arg0.x;this._py=arg0.y;this._vx=arg1.x;this._vy=arg1.y;asVector=arg2}if(!asVector){this._vx-=this._px;this._vy-=this._py}},getPoint:function(){return new Point(this._px,this._py)},getVector:function(){return new Point(this._vx,this._vy)},getLength:function(){return this.getVector().getLength()},intersect:function(line,isInfinite){return Line.intersect(this._px,this._py,this._vx,this._vy,line._px,line._py,line._vx,line._vy,true,isInfinite)},getSide:function(point,isInfinite){return Line.getSide(this._px,this._py,this._vx,this._vy,point.x,point.y,true,isInfinite)},getDistance:function(point){return Math.abs(Line.getSignedDistance(this._px,this._py,this._vx,this._vy,point.x,point.y,true))},isCollinear:function(line){return Point.isCollinear(this._vx,this._vy,line._vx,line._vy)},isOrthogonal:function(line){return Point.isOrthogonal(this._vx,this._vy,line._vx,line._vy)},statics:{intersect:function(p1x,p1y,v1x,v1y,p2x,p2y,v2x,v2y,asVector,isInfinite){if(!asVector){v1x-=p1x;v1y-=p1y;v2x-=p2x;v2y-=p2y}var cross=v1x*v2y-v1y*v2x;if(!Numerical.isZero(cross)){var dx=p1x-p2x,dy=p1y-p2y,u1=(v2x*dy-v2y*dx)/cross,u2=(v1x*dy-v1y*dx)/cross,epsilon=1e-12,uMin=-epsilon,uMax=1+epsilon;if(isInfinite||uMin<u1&&u1<uMax&&uMin<u2&&u2<uMax){if(!isInfinite){u1=u1<=0?0:u1>=1?1:u1}return new Point(p1x+u1*v1x,p1y+u1*v1y)}}},getSide:function(px,py,vx,vy,x,y,asVector,isInfinite){if(!asVector){vx-=px;vy-=py}var v2x=x-px,v2y=y-py,ccw=v2x*vy-v2y*vx;if(ccw===0&&!isInfinite){ccw=(v2x*vx+v2x*vx)/(vx*vx+vy*vy);if(ccw>=0&&ccw<=1)ccw=0}return ccw<0?-1:ccw>0?1:0},getSignedDistance:function(px,py,vx,vy,x,y,asVector){if(!asVector){vx-=px;vy-=py}return vx===0?vy>0?x-px:px-x:vy===0?vx<0?y-py:py-y:((x-px)*vy-(y-py)*vx)/Math.sqrt(vx*vx+vy*vy)}}});var Project=PaperScopeItem.extend({_class:"Project",_list:"projects",_reference:"project",initialize:function Project(element){PaperScopeItem.call(this,true);this.layers=[];this._activeLayer=null;this.symbols=[];this._currentStyle=new Style(null,null,this);this._view=View.create(this,element||CanvasProvider.getCanvas(1,1));this._selectedItems={};this._selectedItemCount=0;this._updateVersion=0},_serialize:function(options,dictionary){return Base.serialize(this.layers,options,true,dictionary)},clear:function(){for(var i=this.layers.length-1;i>=0;i--)this.layers[i].remove();this.symbols=[]},isEmpty:function(){return this.layers.length===0},remove:function remove(){if(!remove.base.call(this))return false;if(this._view)this._view.remove();return true},getView:function(){return this._view},getCurrentStyle:function(){return this._currentStyle},setCurrentStyle:function(style){this._currentStyle.initialize(style)},getIndex:function(){return this._index},getOptions:function(){return this._scope.settings},getActiveLayer:function(){return this._activeLayer||new Layer({project:this})},getSelectedItems:function(){var items=[];for(var id in this._selectedItems){var item=this._selectedItems[id];if(item.isInserted())items.push(item)}return items},insertChild:function(index,item,_preserve){if(item instanceof Layer){item._remove(false,true);Base.splice(this.layers,[item],index,0);item._setProject(this,true);if(this._changes)item._changed(5);if(!this._activeLayer)this._activeLayer=item}else if(item instanceof Item){(this._activeLayer||this.insertChild(index,new Layer(Item.NO_INSERT))).insertChild(index,item,_preserve)}else{item=null}return item},addChild:function(item,_preserve){return this.insertChild(undefined,item,_preserve)},_updateSelection:function(item){var id=item._id,selectedItems=this._selectedItems;if(item._selected){if(selectedItems[id]!==item){this._selectedItemCount++;selectedItems[id]=item}}else if(selectedItems[id]===item){this._selectedItemCount--;delete selectedItems[id]}},selectAll:function(){var layers=this.layers;for(var i=0,l=layers.length;i<l;i++)layers[i].setFullySelected(true)},deselectAll:function(){var selectedItems=this._selectedItems;for(var i in selectedItems)selectedItems[i].setFullySelected(false)},hitTest:function(){var point=Point.read(arguments),options=HitResult.getOptions(Base.read(arguments));for(var i=this.layers.length-1;i>=0;i--){var res=this.layers[i]._hitTest(point,options);if(res)return res}return null},getItems:function(match){return Item._getItems(this.layers,match)},getItem:function(match){return Item._getItems(this.layers,match,null,null,true)[0]||null},importJSON:function(json){this.activate();var layer=this._activeLayer;return Base.importJSON(json,layer&&layer.isEmpty()&&layer)},draw:function(ctx,matrix,pixelRatio){this._updateVersion++;ctx.save();matrix.applyToContext(ctx);var param=new Base({offset:new Point(0,0),pixelRatio:pixelRatio,viewMatrix:matrix.isIdentity()?null:matrix,matrices:[new Matrix],updateMatrix:true});for(var i=0,layers=this.layers,l=layers.length;i<l;i++)layers[i].draw(ctx,param);ctx.restore();if(this._selectedItemCount>0){ctx.save();ctx.strokeWidth=1;var items=this._selectedItems,size=this._scope.settings.handleSize,version=this._updateVersion;for(var id in items)items[id]._drawSelection(ctx,matrix,size,items,version);ctx.restore()}}});var Symbol=Base.extend({_class:"Symbol",initialize:function Symbol(item,dontCenter){this._id=UID.get();this.project=paper.project;this.project.symbols.push(this);if(item)this.setDefinition(item,dontCenter)},_serialize:function(options,dictionary){return dictionary.add(this,function(){return Base.serialize([this._class,this._definition],options,false,dictionary)})},_changed:function(flags){if(flags&8){Item._clearBoundsCache(this)}if(flags&1){this.project._needsUpdate=true}},getDefinition:function(){return this._definition},setDefinition:function(item,_dontCenter){if(item._parentSymbol)item=item.clone();if(this._definition)this._definition._parentSymbol=null;this._definition=item;item.remove();item.setSelected(false);if(!_dontCenter)item.setPosition(new Point);item._parentSymbol=this;this._changed(9)},place:function(position){return new PlacedSymbol(this,position)},clone:function(){return new Symbol(this._definition.clone(false))},equals:function(symbol){return symbol===this||symbol&&this.definition.equals(symbol.definition)||false}});var Item=Base.extend(Emitter,{statics:{extend:function extend(src){if(src._serializeFields)src._serializeFields=new Base(this.prototype._serializeFields,src._serializeFields);return extend.base.apply(this,arguments)},NO_INSERT:{insert:false}},_class:"Item",_applyMatrix:true,_canApplyMatrix:true,_boundsSelected:false,_selectChildren:false,_serializeFields:{name:null,applyMatrix:null,matrix:new Matrix,pivot:null,locked:false,visible:true,blendMode:"normal",opacity:1,guide:false,selected:false,clipMask:false,data:{}},initialize:function Item(){},_initialize:function(props,point){var hasProps=props&&Base.isPlainObject(props),internal=hasProps&&props.internal===true,matrix=this._matrix=new Matrix,project=hasProps&&props.project||paper.project;if(!internal)this._id=UID.get();this._applyMatrix=this._canApplyMatrix&&paper.settings.applyMatrix;if(point)matrix.translate(point);matrix._owner=this;this._style=new Style(project._currentStyle,this,project);if(!this._project){if(internal||hasProps&&props.insert===false){this._setProject(project)}else if(hasProps&&props.parent){this.setParent(props.parent)}else{(project._activeLayer||new Layer).addChild(this)}}if(hasProps&&props!==Item.NO_INSERT)this._set(props,{insert:true,project:true,parent:true},true);return hasProps},_events:Base.each(["onMouseDown","onMouseUp","onMouseDrag","onClick","onDoubleClick","onMouseMove","onMouseEnter","onMouseLeave"],function(name){this[name]={install:function(type){this.getView()._installEvent(type)},uninstall:function(type){this.getView()._uninstallEvent(type)}}},{onFrame:{install:function(){this.getView()._animateItem(this,true)},uninstall:function(){this.getView()._animateItem(this,false)}},onLoad:{}}),_serialize:function(options,dictionary){var props={},that=this;function serialize(fields){for(var key in fields){var value=that[key];if(!Base.equals(value,key==="leading"?fields.fontSize*1.2:fields[key])){props[key]=Base.serialize(value,options,key!=="data",dictionary)}}}serialize(this._serializeFields);if(!(this instanceof Group))serialize(this._style._defaults);return[this._class,props]},_changed:function(flags){var symbol=this._parentSymbol,cacheParent=this._parent||symbol,project=this._project;if(flags&8){this._bounds=this._position=this._decomposed=this._globalMatrix=this._currentPath=undefined}if(cacheParent&&flags&40){Item._clearBoundsCache(cacheParent)}if(flags&2){Item._clearBoundsCache(this)}if(project){if(flags&1){project._needsUpdate=true}if(project._changes){var entry=project._changesById[this._id];if(entry){entry.flags|=flags}else{entry={item:this,flags:flags};project._changesById[this._id]=entry;project._changes.push(entry)}}}if(symbol)symbol._changed(flags)},set:function(props){if(props)this._set(props);return this},getId:function(){return this._id},getName:function(){return this._name},setName:function(name,unique){if(this._name)this._removeNamed();if(name===+name+"")throw new Error("Names consisting only of numbers are not supported.");var parent=this._parent;if(name&&parent){var children=parent._children,namedChildren=parent._namedChildren,orig=name,i=1;while(unique&&children[name])name=orig+" "+i++;(namedChildren[name]=namedChildren[name]||[]).push(this);children[name]=this}this._name=name||undefined;this._changed(128)},getStyle:function(){return this._style},setStyle:function(style){this.getStyle().set(style)}},Base.each(["locked","visible","blendMode","opacity","guide"],function(name){var part=Base.capitalize(name),name="_"+name;this["get"+part]=function(){return this[name]};this["set"+part]=function(value){if(value!=this[name]){this[name]=value;this._changed(name==="_locked"?128:129)}}},{}),{beans:true,_locked:false,_visible:true,_blendMode:"normal",_opacity:1,_guide:false,isSelected:function(){if(this._selectChildren){var children=this._children;for(var i=0,l=children.length;i<l;i++)if(children[i].isSelected())return true}return this._selected},setSelected:function(selected,noChildren){if(!noChildren&&this._selectChildren){var children=this._children;for(var i=0,l=children.length;i<l;i++)children[i].setSelected(selected)}if((selected=!!selected)^this._selected){this._selected=selected;this._project._updateSelection(this);this._changed(129)}},_selected:false,isFullySelected:function(){var children=this._children;if(children&&this._selected){for(var i=0,l=children.length;i<l;i++)if(!children[i].isFullySelected())return false;return true}return this._selected},setFullySelected:function(selected){var children=this._children;if(children){for(var i=0,l=children.length;i<l;i++)children[i].setFullySelected(selected)}this.setSelected(selected,true)},isClipMask:function(){return this._clipMask},setClipMask:function(clipMask){if(this._clipMask!=(clipMask=!!clipMask)){this._clipMask=clipMask;if(clipMask){this.setFillColor(null);this.setStrokeColor(null)}this._changed(129);if(this._parent)this._parent._changed(1024)}},_clipMask:false,getData:function(){if(!this._data)this._data={};return this._data},setData:function(data){this._data=data},getPosition:function(_dontLink){var position=this._position,ctor=_dontLink?Point:LinkedPoint;if(!position){var pivot=this._pivot;position=this._position=pivot?this._matrix._transformPoint(pivot):this.getBounds().getCenter(true)}return new ctor(position.x,position.y,this,"setPosition")},setPosition:function(){this.translate(Point.read(arguments).subtract(this.getPosition(true)))},getPivot:function(_dontLink){var pivot=this._pivot;if(pivot){var ctor=_dontLink?Point:LinkedPoint;pivot=new ctor(pivot.x,pivot.y,this,"setPivot")}return pivot},setPivot:function(){this._pivot=Point.read(arguments,0,{clone:true,readNull:true});this._position=undefined},_pivot:null},Base.each(["bounds","strokeBounds","handleBounds","roughBounds","internalBounds","internalRoughBounds"],function(key){var getter="get"+Base.capitalize(key),match=key.match(/^internal(.*)$/),internalGetter=match?"get"+match[1]:null;this[getter]=function(_matrix){var boundsGetter=this._boundsGetter,name=!internalGetter&&(typeof boundsGetter==="string"?boundsGetter:boundsGetter&&boundsGetter[getter])||getter,bounds=this._getCachedBounds(name,_matrix,this,internalGetter);return key==="bounds"?new LinkedRectangle(bounds.x,bounds.y,bounds.width,bounds.height,this,"setBounds"):bounds}},{beans:true,_getBounds:function(getter,matrix,cacheItem){var children=this._children;if(!children||children.length==0)return new Rectangle;Item._updateBoundsCache(this,cacheItem);var x1=Infinity,x2=-x1,y1=x1,y2=x2;for(var i=0,l=children.length;i<l;i++){var child=children[i];if(child._visible&&!child.isEmpty()){var rect=child._getCachedBounds(getter,matrix&&matrix.chain(child._matrix),cacheItem);x1=Math.min(rect.x,x1);y1=Math.min(rect.y,y1);x2=Math.max(rect.x+rect.width,x2);y2=Math.max(rect.y+rect.height,y2)}}return isFinite(x1)?new Rectangle(x1,y1,x2-x1,y2-y1):new Rectangle},setBounds:function(){var rect=Rectangle.read(arguments),bounds=this.getBounds(),matrix=new Matrix,center=rect.getCenter();matrix.translate(center);if(rect.width!=bounds.width||rect.height!=bounds.height){matrix.scale(bounds.width!=0?rect.width/bounds.width:1,bounds.height!=0?rect.height/bounds.height:1)}center=bounds.getCenter();matrix.translate(-center.x,-center.y);this.transform(matrix)},_getCachedBounds:function(getter,matrix,cacheItem,internalGetter){matrix=matrix&&matrix.orNullIfIdentity();var _matrix=internalGetter?null:this._matrix.orNullIfIdentity(),cache=(!matrix||matrix.equals(_matrix))&&getter;Item._updateBoundsCache(this._parent||this._parentSymbol,cacheItem);if(cache&&this._bounds&&this._bounds[cache])return this._bounds[cache].clone();var bounds=this._getBounds(internalGetter||getter,matrix||_matrix,cacheItem);if(cache){if(!this._bounds)this._bounds={};var cached=this._bounds[cache]=bounds.clone();cached._internal=!!internalGetter}return bounds},statics:{_updateBoundsCache:function(parent,item){if(parent){var id=item._id,ref=parent._boundsCache=parent._boundsCache||{ids:{},list:[]};if(!ref.ids[id]){ref.list.push(item);ref.ids[id]=item}}},_clearBoundsCache:function(item){var cache=item._boundsCache;if(cache){item._bounds=item._position=item._boundsCache=undefined;for(var i=0,list=cache.list,l=list.length;i<l;i++){var other=list[i];if(other!==item){other._bounds=other._position=undefined;if(other._boundsCache)Item._clearBoundsCache(other)}}}}}}),{beans:true,_decompose:function(){return this._decomposed=this._matrix.decompose()},getRotation:function(){var decomposed=this._decomposed||this._decompose();return decomposed&&decomposed.rotation},setRotation:function(rotation){var current=this.getRotation();if(current!=null&&rotation!=null){var decomposed=this._decomposed;this.rotate(rotation-current);decomposed.rotation=rotation;this._decomposed=decomposed}},getScaling:function(_dontLink){var decomposed=this._decomposed||this._decompose(),scaling=decomposed&&decomposed.scaling,ctor=_dontLink?Point:LinkedPoint;return scaling&&new ctor(scaling.x,scaling.y,this,"setScaling")},setScaling:function(){var current=this.getScaling();if(current){var scaling=Point.read(arguments,0,{clone:true}),decomposed=this._decomposed;this.scale(scaling.x/current.x,scaling.y/current.y);decomposed.scaling=scaling;this._decomposed=decomposed}},getMatrix:function(){return this._matrix},setMatrix:function(){var matrix=this._matrix;matrix.initialize.apply(matrix,arguments);if(this._applyMatrix){this.transform(null,true)}else{this._changed(9)}},getGlobalMatrix:function(_dontClone){var matrix=this._globalMatrix,updateVersion=this._project._updateVersion;if(matrix&&matrix._updateVersion!==updateVersion)matrix=null;if(!matrix){matrix=this._globalMatrix=this._matrix.clone();var parent=this._parent;if(parent)matrix.preConcatenate(parent.getGlobalMatrix(true));matrix._updateVersion=updateVersion}return _dontClone?matrix:matrix.clone()},getApplyMatrix:function(){return this._applyMatrix},setApplyMatrix:function(apply){if(this._applyMatrix=this._canApplyMatrix&&!!apply)this.transform(null,true)},getTransformContent:"#getApplyMatrix",setTransformContent:"#setApplyMatrix"},{getProject:function(){return this._project},_setProject:function(project,installEvents){if(this._project!==project){if(this._project)this._installEvents(false);this._project=project;var children=this._children;for(var i=0,l=children&&children.length;i<l;i++)children[i]._setProject(project);installEvents=true}if(installEvents)this._installEvents(true)},getView:function(){return this._project.getView()},_installEvents:function _installEvents(install){_installEvents.base.call(this,install);var children=this._children;for(var i=0,l=children&&children.length;i<l;i++)children[i]._installEvents(install)},getLayer:function(){var parent=this;while(parent=parent._parent){if(parent instanceof Layer)return parent}return null},getParent:function(){return this._parent},setParent:function(item){return item.addChild(this)},getChildren:function(){return this._children},setChildren:function(items){this.removeChildren();this.addChildren(items)},getFirstChild:function(){return this._children&&this._children[0]||null},getLastChild:function(){return this._children&&this._children[this._children.length-1]||null},getNextSibling:function(){return this._parent&&this._parent._children[this._index+1]||null},getPreviousSibling:function(){return this._parent&&this._parent._children[this._index-1]||null},getIndex:function(){return this._index},equals:function(item){return item===this||item&&this._class===item._class&&this._style.equals(item._style)&&this._matrix.equals(item._matrix)&&this._locked===item._locked&&this._visible===item._visible&&this._blendMode===item._blendMode&&this._opacity===item._opacity&&this._clipMask===item._clipMask&&this._guide===item._guide&&this._equals(item)||false},_equals:function(item){return Base.equals(this._children,item._children)},clone:function(insert){return this._clone(new this.constructor(Item.NO_INSERT),insert)},_clone:function(copy,insert,includeMatrix){var keys=["_locked","_visible","_blendMode","_opacity","_clipMask","_guide"],children=this._children;copy.setStyle(this._style);for(var i=0,l=children&&children.length;i<l;i++){copy.addChild(children[i].clone(false),true)}for(var i=0,l=keys.length;i<l;i++){var key=keys[i];if(this.hasOwnProperty(key))copy[key]=this[key]}if(includeMatrix!==false)copy._matrix.initialize(this._matrix);copy.setApplyMatrix(this._applyMatrix);copy.setPivot(this._pivot);copy.setSelected(this._selected);copy._data=this._data?Base.clone(this._data):null;if(insert||insert===undefined)copy.insertAbove(this);if(this._name)copy.setName(this._name,true);return copy},copyTo:function(itemOrProject){return itemOrProject.addChild(this.clone(false))},rasterize:function(resolution){var bounds=this.getStrokeBounds(),scale=(resolution||this.getView().getResolution())/72,topLeft=bounds.getTopLeft().floor(),bottomRight=bounds.getBottomRight().ceil(),size=new Size(bottomRight.subtract(topLeft)),canvas=CanvasProvider.getCanvas(size.multiply(scale)),ctx=canvas.getContext("2d"),matrix=(new Matrix).scale(scale).translate(topLeft.negate());ctx.save();matrix.applyToContext(ctx);this.draw(ctx,new Base({matrices:[matrix]}));ctx.restore();var raster=new Raster(Item.NO_INSERT);raster.setCanvas(canvas);raster.transform((new Matrix).translate(topLeft.add(size.divide(2))).scale(1/scale));raster.insertAbove(this);return raster},contains:function(){return!!this._contains(this._matrix._inverseTransform(Point.read(arguments)))},_contains:function(point){if(this._children){for(var i=this._children.length-1;i>=0;i--){if(this._children[i].contains(point))return true}return false}return point.isInside(this.getInternalBounds())},isInside:function(){return Rectangle.read(arguments).contains(this.getBounds())},_asPathItem:function(){return new Path.Rectangle({rectangle:this.getInternalBounds(),matrix:this._matrix,insert:false})},intersects:function(item,_matrix){if(!(item instanceof Item))return false;return this._asPathItem().getIntersections(item._asPathItem(),null,_matrix||item._matrix,true).length>0},hitTest:function(){return this._hitTest(Point.read(arguments),HitResult.getOptions(Base.read(arguments)))},_hitTest:function(point,options){if(this._locked||!this._visible||this._guide&&!options.guides||this.isEmpty())return null;var matrix=this._matrix,parentTotalMatrix=options._totalMatrix,view=this.getView(),totalMatrix=options._totalMatrix=parentTotalMatrix?parentTotalMatrix.chain(matrix):this.getGlobalMatrix().preConcatenate(view._matrix),tolerancePadding=options._tolerancePadding=new Size(Path._getPenPadding(1,totalMatrix.inverted())).multiply(Math.max(options.tolerance,1e-6));point=matrix._inverseTransform(point);if(!this._children&&!this.getInternalRoughBounds().expand(tolerancePadding.multiply(2))._containsPoint(point))return null;var checkSelf=!(options.guides&&!this._guide||options.selected&&!this._selected||options.type&&options.type!==Base.hyphenate(this._class)||options.class&&!(this instanceof options.class)),that=this,res;function checkBounds(type,part){var pt=bounds["get"+part]();if(point.subtract(pt).divide(tolerancePadding).length<=1)return new HitResult(type,that,{name:Base.hyphenate(part),point:pt})}if(checkSelf&&(options.center||options.bounds)&&this._parent){var bounds=this.getInternalBounds();if(options.center)res=checkBounds("center","Center");if(!res&&options.bounds){var points=["TopLeft","TopRight","BottomLeft","BottomRight","LeftCenter","TopCenter","RightCenter","BottomCenter"];for(var i=0;i<8&&!res;i++)res=checkBounds("bounds",points[i])}}var children=!res&&this._children;if(children){var opts=this._getChildHitTestOptions(options);for(var i=children.length-1;i>=0&&!res;i--)res=children[i]._hitTest(point,opts)}if(!res&&checkSelf)res=this._hitTestSelf(point,options);if(res&&res.point)res.point=matrix.transform(res.point);options._totalMatrix=parentTotalMatrix;return res},_getChildHitTestOptions:function(options){return options},_hitTestSelf:function(point,options){if(options.fill&&this.hasFill()&&this._contains(point))return new HitResult("fill",this)},matches:function(name,compare){function matchObject(obj1,obj2){for(var i in obj1){if(obj1.hasOwnProperty(i)){var val1=obj1[i],val2=obj2[i];if(Base.isPlainObject(val1)&&Base.isPlainObject(val2)){if(!matchObject(val1,val2))return false}else if(!Base.equals(val1,val2)){return false}}}return true}var type=typeof name;if(type==="object"){for(var key in name){if(name.hasOwnProperty(key)&&!this.matches(key,name[key]))return false}}else if(type==="function"){return name(this)}else{var value=/^(empty|editable)$/.test(name)?this["is"+Base.capitalize(name)]():name==="type"?Base.hyphenate(this._class):this[name];if(/^(constructor|class)$/.test(name)){if(!(this instanceof compare))return false}else if(compare instanceof RegExp){if(!compare.test(value))return false}else if(typeof compare==="function"){if(!compare(value))return false}else if(Base.isPlainObject(compare)){if(!matchObject(compare,value))return false}else if(!Base.equals(value,compare)){return false}}return true},getItems:function(match){return Item._getItems(this._children,match,this._matrix)},getItem:function(match){return Item._getItems(this._children,match,this._matrix,null,true)[0]||null},statics:{_getItems:function _getItems(children,match,matrix,param,firstOnly){if(!param&&typeof match==="object"){var overlapping=match.overlapping,inside=match.inside,bounds=overlapping||inside,rect=bounds&&Rectangle.read([bounds]);param={items:[],inside:!!inside,overlapping:!!overlapping,rect:rect,path:overlapping&&new Path.Rectangle({rectangle:rect,insert:false})};if(bounds)match=Base.set({},match,{inside:true,overlapping:true})}var items=param&&param.items,rect=param&&param.rect;matrix=rect&&(matrix||new Matrix);for(var i=0,l=children&&children.length;i<l;i++){var child=children[i],childMatrix=matrix&&matrix.chain(child._matrix),add=true;if(rect){var bounds=child.getBounds(childMatrix);if(!rect.intersects(bounds))continue;if(!(param.inside&&rect.contains(bounds))&&!(param.overlapping&&(bounds.contains(rect)||param.path.intersects(child,childMatrix))))add=false}if(add&&child.matches(match)){items.push(child);if(firstOnly)break}_getItems(child._children,match,childMatrix,param,firstOnly);if(firstOnly&&items.length>0)break}return items}}},{importJSON:function(json){var res=Base.importJSON(json,this);return res!==this?this.addChild(res):res},addChild:function(item,_preserve){return this.insertChild(undefined,item,_preserve)},insertChild:function(index,item,_preserve){var res=item?this.insertChildren(index,[item],_preserve):null;return res&&res[0]},addChildren:function(items,_preserve){return this.insertChildren(this._children.length,items,_preserve)},insertChildren:function(index,items,_preserve,_proto){var children=this._children;if(children&&items&&items.length>0){items=Array.prototype.slice.apply(items);for(var i=items.length-1;i>=0;i--){var item=items[i];if(_proto&&!(item instanceof _proto)){items.splice(i,1)}else{var shift=item._parent===this&&item._index<index;if(item._remove(false,true)&&shift)index--}}Base.splice(children,items,index,0);var project=this._project,notifySelf=project&&project._changes;for(var i=0,l=items.length;i<l;i++){var item=items[i];item._parent=this;item._setProject(this._project,true);if(item._name)item.setName(item._name);if(notifySelf)this._changed(5)}this._changed(11)}else{items=null}return items},_insertSibling:function(index,item,_preserve){return this._parent?this._parent.insertChild(index,item,_preserve):null},insertAbove:function(item,_preserve){return item._insertSibling(item._index+1,this,_preserve)},insertBelow:function(item,_preserve){return item._insertSibling(item._index,this,_preserve)},sendToBack:function(){return(this._parent||this instanceof Layer&&this._project).insertChild(0,this)},bringToFront:function(){return(this._parent||this instanceof Layer&&this._project).addChild(this)},appendTop:"#addChild",appendBottom:function(item){return this.insertChild(0,item)},moveAbove:"#insertAbove",moveBelow:"#insertBelow",reduce:function(){if(this._children&&this._children.length===1){var child=this._children[0].reduce();child.insertAbove(this);child.setStyle(this._style);this.remove();return child}return this},_removeNamed:function(){var parent=this._parent;if(parent){var children=parent._children,namedChildren=parent._namedChildren,name=this._name,namedArray=namedChildren[name],index=namedArray?namedArray.indexOf(this):-1;if(index!==-1){if(children[name]==this)delete children[name];namedArray.splice(index,1);if(namedArray.length){children[name]=namedArray[namedArray.length-1]}else{delete namedChildren[name]}}}},_remove:function(notifySelf,notifyParent){var parent=this._parent;if(parent){if(this._name)this._removeNamed();if(this._index!=null)Base.splice(parent._children,null,this._index,1);this._installEvents(false);if(notifySelf){var project=this._project;if(project&&project._changes)this._changed(5)}if(notifyParent)parent._changed(11);this._parent=null;return true}return false},remove:function(){return this._remove(true,true)},replaceWith:function(item){var ok=item&&item.insertBelow(this);if(ok)this.remove();return ok},removeChildren:function(from,to){if(!this._children)return null;from=from||0;to=Base.pick(to,this._children.length);var removed=Base.splice(this._children,null,from,to-from);for(var i=removed.length-1;i>=0;i--){removed[i]._remove(true,false)}if(removed.length>0)this._changed(11);return removed},clear:"#removeChildren",reverseChildren:function(){if(this._children){this._children.reverse();for(var i=0,l=this._children.length;i<l;i++)this._children[i]._index=i;this._changed(11)}},isEmpty:function(){return!this._children||this._children.length===0},isEditable:function(){var item=this;while(item){if(!item._visible||item._locked)return false;item=item._parent}return true},hasFill:function(){return this.getStyle().hasFill()},hasStroke:function(){return this.getStyle().hasStroke()},hasShadow:function(){return this.getStyle().hasShadow()},_getOrder:function(item){function getList(item){var list=[];do{list.unshift(item)}while(item=item._parent);return list}var list1=getList(this),list2=getList(item);for(var i=0,l=Math.min(list1.length,list2.length);i<l;i++){if(list1[i]!=list2[i]){return list1[i]._index<list2[i]._index?1:-1}}return 0},hasChildren:function(){return this._children&&this._children.length>0},isInserted:function(){return this._parent?this._parent.isInserted():false},isAbove:function(item){return this._getOrder(item)===-1},isBelow:function(item){return this._getOrder(item)===1},isParent:function(item){return this._parent===item},isChild:function(item){return item&&item._parent===this},isDescendant:function(item){var parent=this;while(parent=parent._parent){if(parent==item)return true}return false},isAncestor:function(item){return item?item.isDescendant(this):false},isSibling:function(item){return this._parent===item._parent},isGroupedWith:function(item){var parent=this._parent;while(parent){if(parent._parent&&/^(Group|Layer|CompoundPath)$/.test(parent._class)&&item.isDescendant(parent))return true;parent=parent._parent}return false},translate:function(){var mx=new Matrix;return this.transform(mx.translate.apply(mx,arguments))},rotate:function(angle){return this.transform((new Matrix).rotate(angle,Point.read(arguments,1,{readNull:true})||this.getPosition(true)))}},Base.each(["scale","shear","skew"],function(name){this[name]=function(){var point=Point.read(arguments),center=Point.read(arguments,0,{readNull:true});return this.transform((new Matrix)[name](point,center||this.getPosition(true)))}},{}),{transform:function(matrix,_applyMatrix,_applyRecursively,_setApplyMatrix){if(matrix&&matrix.isIdentity())matrix=null;var _matrix=this._matrix,applyMatrix=(_applyMatrix||this._applyMatrix)&&(!_matrix.isIdentity()||matrix||_applyMatrix&&_applyRecursively&&this._children);if(!matrix&&!applyMatrix)return this;if(matrix)_matrix.preConcatenate(matrix);if(applyMatrix=applyMatrix&&this._transformContent(_matrix,_applyRecursively,_setApplyMatrix)){var pivot=this._pivot,style=this._style,fillColor=style.getFillColor(true),strokeColor=style.getStrokeColor(true);if(pivot)_matrix._transformPoint(pivot,pivot,true);if(fillColor)fillColor.transform(_matrix);if(strokeColor)strokeColor.transform(_matrix);_matrix.reset(true);if(_setApplyMatrix&&this._canApplyMatrix)this._applyMatrix=true}var bounds=this._bounds,position=this._position;this._changed(9);var decomp=bounds&&matrix&&matrix.decompose();if(decomp&&!decomp.shearing&&decomp.rotation%90===0){for(var key in bounds){var rect=bounds[key];if(applyMatrix||!rect._internal)matrix._transformBounds(rect,rect)}var getter=this._boundsGetter,rect=bounds[getter&&getter.getBounds||getter||"getBounds"];if(rect)this._position=rect.getCenter(true);this._bounds=bounds}else if(matrix&&position){this._position=matrix._transformPoint(position,position)}return this},_transformContent:function(matrix,applyRecursively,setApplyMatrix){var children=this._children;if(children){for(var i=0,l=children.length;i<l;i++)children[i].transform(matrix,true,applyRecursively,setApplyMatrix);return true}},globalToLocal:function(){return this.getGlobalMatrix(true)._inverseTransform(Point.read(arguments))},localToGlobal:function(){return this.getGlobalMatrix(true)._transformPoint(Point.read(arguments))},parentToLocal:function(){return this._matrix._inverseTransform(Point.read(arguments))},localToParent:function(){return this._matrix._transformPoint(Point.read(arguments))},fitBounds:function(rectangle,fill){rectangle=Rectangle.read(arguments);var bounds=this.getBounds(),itemRatio=bounds.height/bounds.width,rectRatio=rectangle.height/rectangle.width,scale=(fill?itemRatio>rectRatio:itemRatio<rectRatio)?rectangle.width/bounds.width:rectangle.height/bounds.height,newBounds=new Rectangle(new Point,new Size(bounds.width*scale,bounds.height*scale));newBounds.setCenter(rectangle.getCenter());this.setBounds(newBounds)},_setStyles:function(ctx){var style=this._style,fillColor=style.getFillColor(),strokeColor=style.getStrokeColor(),shadowColor=style.getShadowColor();if(fillColor)ctx.fillStyle=fillColor.toCanvasStyle(ctx);if(strokeColor){var strokeWidth=style.getStrokeWidth();if(strokeWidth>0){ctx.strokeStyle=strokeColor.toCanvasStyle(ctx);ctx.lineWidth=strokeWidth;var strokeJoin=style.getStrokeJoin(),strokeCap=style.getStrokeCap(),miterLimit=style.getMiterLimit();if(strokeJoin)ctx.lineJoin=strokeJoin;if(strokeCap)ctx.lineCap=strokeCap;if(miterLimit)ctx.miterLimit=miterLimit;if(paper.support.nativeDash){var dashArray=style.getDashArray(),dashOffset=style.getDashOffset();if(dashArray&&dashArray.length){if("setLineDash"in ctx){ctx.setLineDash(dashArray);ctx.lineDashOffset=dashOffset}else{ctx.mozDash=dashArray;ctx.mozDashOffset=dashOffset}}}}}if(shadowColor){var shadowBlur=style.getShadowBlur();if(shadowBlur>0){ctx.shadowColor=shadowColor.toCanvasStyle(ctx);ctx.shadowBlur=shadowBlur;var offset=this.getShadowOffset();ctx.shadowOffsetX=offset.x;ctx.shadowOffsetY=offset.y}}},draw:function(ctx,param,parentStrokeMatrix){var updateVersion=this._updateVersion=this._project._updateVersion;if(!this._visible||this._opacity===0)return;var matrices=param.matrices,viewMatrix=param.viewMatrix,matrix=this._matrix,globalMatrix=matrices[matrices.length-1].chain(matrix);if(!globalMatrix.isInvertible())return;function getViewMatrix(matrix){return viewMatrix?viewMatrix.chain(matrix):matrix}matrices.push(globalMatrix);if(param.updateMatrix){globalMatrix._updateVersion=updateVersion;this._globalMatrix=globalMatrix}var blendMode=this._blendMode,opacity=this._opacity,normalBlend=blendMode==="normal",nativeBlend=BlendMode.nativeModes[blendMode],direct=normalBlend&&opacity===1||param.dontStart||param.clip||(nativeBlend||normalBlend&&opacity<1)&&this._canComposite(),pixelRatio=param.pixelRatio||1,mainCtx,itemOffset,prevOffset;if(!direct){var bounds=this.getStrokeBounds(getViewMatrix(globalMatrix));if(!bounds.width||!bounds.height)return;prevOffset=param.offset;itemOffset=param.offset=bounds.getTopLeft().floor();mainCtx=ctx;ctx=CanvasProvider.getContext(bounds.getSize().ceil().add(1).multiply(pixelRatio));if(pixelRatio!==1)ctx.scale(pixelRatio,pixelRatio)}ctx.save();var strokeMatrix=parentStrokeMatrix?parentStrokeMatrix.chain(matrix):!this.getStrokeScaling(true)&&getViewMatrix(globalMatrix),clip=!direct&&param.clipItem,transform=!strokeMatrix||clip;if(direct){ctx.globalAlpha=opacity;if(nativeBlend)ctx.globalCompositeOperation=blendMode}else if(transform){ctx.translate(-itemOffset.x,-itemOffset.y)}if(transform)(direct?matrix:getViewMatrix(globalMatrix)).applyToContext(ctx);if(clip)param.clipItem.draw(ctx,param.extend({clip:true}));if(strokeMatrix){ctx.setTransform(pixelRatio,0,0,pixelRatio,0,0);var offset=param.offset;if(offset)ctx.translate(-offset.x,-offset.y)}this._draw(ctx,param,strokeMatrix);ctx.restore();matrices.pop();if(param.clip&&!param.dontFinish)ctx.clip();if(!direct){BlendMode.process(blendMode,ctx,mainCtx,opacity,itemOffset.subtract(prevOffset).multiply(pixelRatio));CanvasProvider.release(ctx);param.offset=prevOffset}},_isUpdated:function(updateVersion){var parent=this._parent;if(parent instanceof CompoundPath)return parent._isUpdated(updateVersion);var updated=this._updateVersion===updateVersion;if(!updated&&parent&&parent._visible&&parent._isUpdated(updateVersion)){this._updateVersion=updateVersion;updated=true}return updated},_drawSelection:function(ctx,matrix,size,selectedItems,updateVersion){if((this._drawSelected||this._boundsSelected)&&this._isUpdated(updateVersion)){var color=this.getSelectedColor(true)||this.getLayer().getSelectedColor(true),mx=matrix.chain(this.getGlobalMatrix(true));ctx.strokeStyle=ctx.fillStyle=color?color.toCanvasStyle(ctx):"#009dec";if(this._drawSelected)this._drawSelected(ctx,mx,selectedItems);if(this._boundsSelected){var half=size/2,coords=mx._transformCorners(this.getInternalBounds());ctx.beginPath();for(var i=0;i<8;i++)ctx[i===0?"moveTo":"lineTo"](coords[i],coords[++i]);ctx.closePath();ctx.stroke();for(var i=0;i<8;i++)ctx.fillRect(coords[i]-half,coords[++i]-half,size,size)}}},_canComposite:function(){return false}},Base.each(["down","drag","up","move"],function(name){this["removeOn"+Base.capitalize(name)]=function(){var hash={};hash[name]=true;return this.removeOn(hash)}},{removeOn:function(obj){for(var name in obj){if(obj[name]){var key="mouse"+name,project=this._project,sets=project._removeSets=project._removeSets||{};sets[key]=sets[key]||{};sets[key][this._id]=this}}return this}}));var Group=Item.extend({_class:"Group",_selectChildren:true,_serializeFields:{children:[]},initialize:function Group(arg){this._children=[];this._namedChildren={};if(!this._initialize(arg))this.addChildren(Array.isArray(arg)?arg:arguments)},_changed:function _changed(flags){_changed.base.call(this,flags);if(flags&1026){this._clipItem=undefined}},_getClipItem:function(){var clipItem=this._clipItem;if(clipItem===undefined){clipItem=null;for(var i=0,l=this._children.length;i<l;i++){var child=this._children[i];if(child._clipMask){clipItem=child;break}}this._clipItem=clipItem}return clipItem},isClipped:function(){return!!this._getClipItem()},setClipped:function(clipped){var child=this.getFirstChild();if(child)child.setClipMask(clipped)},_draw:function(ctx,param){var clip=param.clip,clipItem=!clip&&this._getClipItem(),draw=true;param=param.extend({clipItem:clipItem,clip:false});if(clip){if(this._currentPath){ctx.currentPath=this._currentPath;draw=false}else{ctx.beginPath();param.dontStart=param.dontFinish=true}}else if(clipItem){clipItem.draw(ctx,param.extend({clip:true}))}if(draw){for(var i=0,l=this._children.length;i<l;i++){var item=this._children[i];if(item!==clipItem)item.draw(ctx,param)}}if(clip){this._currentPath=ctx.currentPath}}});var Layer=Group.extend({_class:"Layer",initialize:function Layer(arg){var props=Base.isPlainObject(arg)?new Base(arg):{children:Array.isArray(arg)?arg:arguments},insert=props.insert;props.insert=false;Group.call(this,props);if(insert||insert===undefined){this._project.addChild(this);this.activate()}},_remove:function _remove(notifySelf,notifyParent){if(this._parent)return _remove.base.call(this,notifySelf,notifyParent);if(this._index!=null){var project=this._project;if(project._activeLayer===this)project._activeLayer=this.getNextSibling()||this.getPreviousSibling();Base.splice(project.layers,null,this._index,1);this._installEvents(false);if(notifySelf&&project._changes)this._changed(5);if(notifyParent){project._needsUpdate=true}return true}return false},getNextSibling:function getNextSibling(){return this._parent?getNextSibling.base.call(this):this._project.layers[this._index+1]||null},getPreviousSibling:function getPreviousSibling(){return this._parent?getPreviousSibling.base.call(this):this._project.layers[this._index-1]||null},isInserted:function isInserted(){return this._parent?isInserted.base.call(this):this._index!=null},activate:function(){this._project._activeLayer=this},_insertSibling:function _insertSibling(index,item,_preserve){return!this._parent?this._project.insertChild(index,item,_preserve):_insertSibling.base.call(this,index,item,_preserve)}});var Shape=Item.extend({_class:"Shape",_applyMatrix:false,_canApplyMatrix:false,_boundsSelected:true,_serializeFields:{type:null,size:null,radius:null},initialize:function Shape(props){this._initialize(props)},_equals:function(item){return this._type===item._type&&this._size.equals(item._size)&&Base.equals(this._radius,item._radius)},clone:function(insert){var copy=new Shape(Item.NO_INSERT);copy.setType(this._type);copy.setSize(this._size);copy.setRadius(this._radius);return this._clone(copy,insert)},getType:function(){return this._type},setType:function(type){this._type=type},getShape:"#getType",setShape:"#setType",getSize:function(){var size=this._size;return new LinkedSize(size.width,size.height,this,"setSize")},setSize:function(){var size=Size.read(arguments);if(!this._size){this._size=size.clone()}else if(!this._size.equals(size)){var type=this._type,width=size.width,height=size.height;if(type==="rectangle"){var radius=Size.min(this._radius,size.divide(2));this._radius.set(radius.width,radius.height)}else if(type==="circle"){width=height=(width+height)/2;this._radius=width/2}else if(type==="ellipse"){this._radius.set(width/2,height/2)}this._size.set(width,height);this._changed(9)}},getRadius:function(){var rad=this._radius;return this._type==="circle"?rad:new LinkedSize(rad.width,rad.height,this,"setRadius")},setRadius:function(radius){var type=this._type;if(type==="circle"){if(radius===this._radius)return;var size=radius*2;this._radius=radius;this._size.set(size,size)}else{radius=Size.read(arguments);if(!this._radius){this._radius=radius.clone()}else{if(this._radius.equals(radius))return;this._radius.set(radius.width,radius.height);if(type==="rectangle"){var size=Size.max(this._size,radius.multiply(2));this._size.set(size.width,size.height)}else if(type==="ellipse"){this._size.set(radius.width*2,radius.height*2)}}}this._changed(9)},isEmpty:function(){return false},toPath:function(insert){var path=this._clone(new(Path[Base.capitalize(this._type)])({center:new Point,size:this._size,radius:this._radius,insert:false}),insert);if(paper.settings.applyMatrix)path.setApplyMatrix(true);return path},_draw:function(ctx,param,strokeMatrix){var style=this._style,hasFill=style.hasFill(),hasStroke=style.hasStroke(),dontPaint=param.dontFinish||param.clip,untransformed=!strokeMatrix;if(hasFill||hasStroke||dontPaint){var type=this._type,radius=this._radius,isCircle=type==="circle";if(!param.dontStart)ctx.beginPath();if(untransformed&&isCircle){ctx.arc(0,0,radius,0,Math.PI*2,true)}else{var rx=isCircle?radius:radius.width,ry=isCircle?radius:radius.height,size=this._size,width=size.width,height=size.height;if(untransformed&&type==="rectangle"&&rx===0&&ry===0){ctx.rect(-width/2,-height/2,width,height)}else{var x=width/2,y=height/2,kappa=1-.5522847498307936,cx=rx*kappa,cy=ry*kappa,c=[-x,-y+ry,-x,-y+cy,-x+cx,-y,-x+rx,-y,x-rx,-y,x-cx,-y,x,-y+cy,x,-y+ry,x,y-ry,x,y-cy,x-cx,y,x-rx,y,-x+rx,y,-x+cx,y,-x,y-cy,-x,y-ry];if(strokeMatrix)strokeMatrix.transform(c,c,32);ctx.moveTo(c[0],c[1]);ctx.bezierCurveTo(c[2],c[3],c[4],c[5],c[6],c[7]);if(x!==rx)ctx.lineTo(c[8],c[9]);ctx.bezierCurveTo(c[10],c[11],c[12],c[13],c[14],c[15]);if(y!==ry)ctx.lineTo(c[16],c[17]);ctx.bezierCurveTo(c[18],c[19],c[20],c[21],c[22],c[23]);if(x!==rx)ctx.lineTo(c[24],c[25]);ctx.bezierCurveTo(c[26],c[27],c[28],c[29],c[30],c[31])}}ctx.closePath()}if(!dontPaint&&(hasFill||hasStroke)){this._setStyles(ctx);if(hasFill){ctx.fill(style.getWindingRule());ctx.shadowColor="rgba(0,0,0,0)"}if(hasStroke)ctx.stroke()}},_canComposite:function(){return!(this.hasFill()&&this.hasStroke())},_getBounds:function(getter,matrix){var rect=new Rectangle(this._size).setCenter(0,0);if(getter!=="getBounds"&&this.hasStroke())rect=rect.expand(this.getStrokeWidth());return matrix?matrix._transformBounds(rect):rect}},new function(){function getCornerCenter(that,point,expand){var radius=that._radius;if(!radius.isZero()){var halfSize=that._size.divide(2);for(var i=0;i<4;i++){var dir=new Point(i&1?1:-1,i>1?1:-1),corner=dir.multiply(halfSize),center=corner.subtract(dir.multiply(radius)),rect=new Rectangle(corner,center);if((expand?rect.expand(expand):rect).contains(point))return center}}}function getEllipseRadius(point,radius){var angle=point.getAngleInRadians(),width=radius.width*2,height=radius.height*2,x=width*Math.sin(angle),y=height*Math.cos(angle);return width*height/(2*Math.sqrt(x*x+y*y))}return{_contains:function _contains(point){if(this._type==="rectangle"){var center=getCornerCenter(this,point);return center?point.subtract(center).divide(this._radius).getLength()<=1:_contains.base.call(this,point)}else{return point.divide(this.size).getLength()<=.5}},_hitTestSelf:function _hitTestSelf(point,options){var hit=false;if(this.hasStroke()){var type=this._type,radius=this._radius,strokeWidth=this.getStrokeWidth()+2*options.tolerance;if(type==="rectangle"){var center=getCornerCenter(this,point,strokeWidth);if(center){var pt=point.subtract(center);hit=2*Math.abs(pt.getLength()-getEllipseRadius(pt,radius))<=strokeWidth}else{var rect=new Rectangle(this._size).setCenter(0,0),outer=rect.expand(strokeWidth),inner=rect.expand(-strokeWidth);hit=outer._containsPoint(point)&&!inner._containsPoint(point)}}else{if(type==="ellipse")radius=getEllipseRadius(point,radius);hit=2*Math.abs(point.getLength()-radius)<=strokeWidth}}return hit?new HitResult("stroke",this):_hitTestSelf.base.apply(this,arguments)}}},{statics:new function(){function createShape(type,point,size,radius,args){var item=new Shape(Base.getNamed(args));item._type=type;item._size=size;item._radius=radius;return item.translate(point)}return{Circle:function(){var center=Point.readNamed(arguments,"center"),radius=Base.readNamed(arguments,"radius");return createShape("circle",center,new Size(radius*2),radius,arguments)},Rectangle:function(){var rect=Rectangle.readNamed(arguments,"rectangle"),radius=Size.min(Size.readNamed(arguments,"radius"),rect.getSize(true).divide(2));return createShape("rectangle",rect.getCenter(true),rect.getSize(true),radius,arguments)},Ellipse:function(){var ellipse=Shape._readEllipse(arguments),radius=ellipse.radius;return createShape("ellipse",ellipse.center,radius.multiply(2),radius,arguments)},_readEllipse:function(args){var center,radius;if(Base.hasNamed(args,"radius")){center=Point.readNamed(args,"center");radius=Size.readNamed(args,"radius")}else{var rect=Rectangle.readNamed(args,"rectangle");center=rect.getCenter(true);radius=rect.getSize(true).divide(2)}return{center:center,radius:radius}}}}});var Raster=Item.extend({_class:"Raster",_applyMatrix:false,_canApplyMatrix:false,_boundsGetter:"getBounds",_boundsSelected:true,_serializeFields:{crossOrigin:null,source:null},initialize:function Raster(object,position){if(!this._initialize(object,position!==undefined&&Point.read(arguments,1))){if(typeof object==="string"){this.setSource(object)}else{this.setImage(object)}}if(!this._size){this._size=new Size;this._loaded=false}},_equals:function(item){return this.getSource()===item.getSource()},clone:function(insert){var copy=new Raster(Item.NO_INSERT),image=this._image,canvas=this._canvas;if(image){copy.setImage(image)}else if(canvas){var copyCanvas=CanvasProvider.getCanvas(this._size);copyCanvas.getContext("2d").drawImage(canvas,0,0);copy.setImage(copyCanvas)}copy._crossOrigin=this._crossOrigin;return this._clone(copy,insert)},getSize:function(){var size=this._size;return new LinkedSize(size?size.width:0,size?size.height:0,this,"setSize")},setSize:function(){var size=Size.read(arguments);if(!size.equals(this._size)){if(size.width>0&&size.height>0){var element=this.getElement();this.setImage(CanvasProvider.getCanvas(size));if(element)this.getContext(true).drawImage(element,0,0,size.width,size.height)}else{if(this._canvas)CanvasProvider.release(this._canvas);this._size=size.clone()}}},getWidth:function(){return this._size?this._size.width:0},setWidth:function(width){this.setSize(width,this.getHeight())},getHeight:function(){return this._size?this._size.height:0},setHeight:function(height){this.setSize(this.getWidth(),height)},isEmpty:function(){var size=this._size;return!size||size.width===0&&size.height===0},getResolution:function(){var matrix=this._matrix,orig=new Point(0,0).transform(matrix),u=new Point(1,0).transform(matrix).subtract(orig),v=new Point(0,1).transform(matrix).subtract(orig);return new Size(72/u.getLength(),72/v.getLength())},getPpi:"#getResolution",getImage:function(){return this._image},setImage:function(image){if(this._canvas)CanvasProvider.release(this._canvas);if(image&&image.getContext){this._image=null;this._canvas=image;this._loaded=true}else{this._image=image;this._canvas=null;this._loaded=image&&image.complete}this._size=new Size(image?image.naturalWidth||image.width:0,image?image.naturalHeight||image.height:0);this._context=null;this._changed(521)},getCanvas:function(){if(!this._canvas){var ctx=CanvasProvider.getContext(this._size);try{if(this._image)ctx.drawImage(this._image,0,0);this._canvas=ctx.canvas}catch(e){CanvasProvider.release(ctx)}}return this._canvas},setCanvas:"#setImage",getContext:function(modify){if(!this._context)this._context=this.getCanvas().getContext("2d");if(modify){this._image=null;this._changed(513)}return this._context},setContext:function(context){this._context=context},getSource:function(){return this._image&&this._image.src||this.toDataURL()},setSource:function(src){var that=this,crossOrigin=this._crossOrigin,image;function loaded(){var view=that.getView();if(view){paper=view._scope;that.setImage(image);that.emit("load");view.update()}}image=document.getElementById(src)||new Image;if(crossOrigin)image.crossOrigin=crossOrigin;if(image.naturalWidth&&image.naturalHeight){setTimeout(loaded,0)}else{DomEvent.add(image,{load:loaded});if(!image.src)image.src=src}this.setImage(image)},getCrossOrigin:function(){return this._image&&this._image.crossOrigin||this._crossOrigin||""},setCrossOrigin:function(crossOrigin){this._crossOrigin=crossOrigin;if(this._image)this._image.crossOrigin=crossOrigin},getElement:function(){return this._canvas||this._loaded&&this._image}},{beans:false,getSubCanvas:function(){var rect=Rectangle.read(arguments),ctx=CanvasProvider.getContext(rect.getSize());ctx.drawImage(this.getCanvas(),rect.x,rect.y,rect.width,rect.height,0,0,rect.width,rect.height);return ctx.canvas},getSubRaster:function(){var rect=Rectangle.read(arguments),raster=new Raster(Item.NO_INSERT);raster.setImage(this.getSubCanvas(rect));raster.translate(rect.getCenter().subtract(this.getSize().divide(2)));raster._matrix.preConcatenate(this._matrix);raster.insertAbove(this);return raster},toDataURL:function(){var src=this._image&&this._image.src;if(/^data:/.test(src))return src;var canvas=this.getCanvas();return canvas?canvas.toDataURL.apply(canvas,arguments):null},drawImage:function(image){var point=Point.read(arguments,1);this.getContext(true).drawImage(image,point.x,point.y)},getAverageColor:function(object){var bounds,path;if(!object){bounds=this.getBounds()}else if(object instanceof PathItem){path=object;bounds=object.getBounds()}else if(object.width){bounds=new Rectangle(object)}else if(object.x){bounds=new Rectangle(object.x-.5,object.y-.5,1,1)}var sampleSize=32,width=Math.min(bounds.width,sampleSize),height=Math.min(bounds.height,sampleSize);var ctx=Raster._sampleContext;if(!ctx){ctx=Raster._sampleContext=CanvasProvider.getContext(new Size(sampleSize))}else{ctx.clearRect(0,0,sampleSize+1,sampleSize+1)}ctx.save();var matrix=(new Matrix).scale(width/bounds.width,height/bounds.height).translate(-bounds.x,-bounds.y);matrix.applyToContext(ctx);if(path)path.draw(ctx,new Base({clip:true,matrices:[matrix]}));this._matrix.applyToContext(ctx);var element=this.getElement(),size=this._size;if(element)ctx.drawImage(element,-size.width/2,-size.height/2);ctx.restore();var pixels=ctx.getImageData(.5,.5,Math.ceil(width),Math.ceil(height)).data,channels=[0,0,0],total=0;for(var i=0,l=pixels.length;i<l;i+=4){var alpha=pixels[i+3];total+=alpha;alpha/=255;channels[0]+=pixels[i]*alpha;channels[1]+=pixels[i+1]*alpha;channels[2]+=pixels[i+2]*alpha}for(var i=0;i<3;i++)channels[i]/=total;return total?Color.read(channels):null},getPixel:function(){var point=Point.read(arguments);var data=this.getContext().getImageData(point.x,point.y,1,1).data;return new Color("rgb",[data[0]/255,data[1]/255,data[2]/255],data[3]/255)},setPixel:function(){var point=Point.read(arguments),color=Color.read(arguments),components=color._convert("rgb"),alpha=color._alpha,ctx=this.getContext(true),imageData=ctx.createImageData(1,1),data=imageData.data;data[0]=components[0]*255;data[1]=components[1]*255;data[2]=components[2]*255;data[3]=alpha!=null?alpha*255:255;ctx.putImageData(imageData,point.x,point.y)},createImageData:function(){var size=Size.read(arguments);return this.getContext().createImageData(size.width,size.height)},getImageData:function(){var rect=Rectangle.read(arguments);if(rect.isEmpty())rect=new Rectangle(this._size);return this.getContext().getImageData(rect.x,rect.y,rect.width,rect.height)},setImageData:function(data){var point=Point.read(arguments,1);this.getContext(true).putImageData(data,point.x,point.y)},_getBounds:function(getter,matrix){var rect=new Rectangle(this._size).setCenter(0,0);return matrix?matrix._transformBounds(rect):rect},_hitTestSelf:function(point){if(this._contains(point)){var that=this;return new HitResult("pixel",that,{offset:point.add(that._size.divide(2)).round(),color:{get:function(){return that.getPixel(this.offset)}}})}},_draw:function(ctx){var element=this.getElement();if(element){ctx.globalAlpha=this._opacity;ctx.drawImage(element,-this._size.width/2,-this._size.height/2)}},_canComposite:function(){return true}});var PlacedSymbol=Item.extend({_class:"PlacedSymbol",_applyMatrix:false,_canApplyMatrix:false,_boundsGetter:{getBounds:"getStrokeBounds"},_boundsSelected:true,_serializeFields:{symbol:null},initialize:function PlacedSymbol(arg0,arg1){if(!this._initialize(arg0,arg1!==undefined&&Point.read(arguments,1)))this.setSymbol(arg0 instanceof Symbol?arg0:new Symbol(arg0))},_equals:function(item){return this._symbol===item._symbol},getSymbol:function(){return this._symbol},setSymbol:function(symbol){this._symbol=symbol;this._changed(9)},clone:function(insert){var copy=new PlacedSymbol(Item.NO_INSERT);copy.setSymbol(this._symbol);return this._clone(copy,insert)},isEmpty:function(){return this._symbol._definition.isEmpty()},_getBounds:function(getter,matrix,cacheItem){var definition=this.symbol._definition;return definition._getCachedBounds(getter,matrix&&matrix.chain(definition._matrix),cacheItem)},_hitTestSelf:function(point,options){var res=this._symbol._definition._hitTest(point,options);if(res)res.item=this;return res},_draw:function(ctx,param){this.symbol._definition.draw(ctx,param)}});var HitResult=Base.extend({_class:"HitResult",initialize:function HitResult(type,item,values){this.type=type;this.item=item;if(values){values.enumerable=true;this.inject(values)}},statics:{getOptions:function(options){return new Base({type:null,tolerance:paper.settings.hitTolerance,fill:!options,stroke:!options,segments:!options,handles:false,ends:false,center:false,bounds:false,guides:false,selected:false},options)}}});var Segment=Base.extend({_class:"Segment",beans:true,initialize:function Segment(arg0,arg1,arg2,arg3,arg4,arg5){var count=arguments.length,point,handleIn,handleOut;if(count===0){}else if(count===1){if("point"in arg0){point=arg0.point;handleIn=arg0.handleIn;handleOut=arg0.handleOut}else{point=arg0}}else if(count===2&&typeof arg0==="number"){point=arguments}else if(count<=3){point=arg0;handleIn=arg1;handleOut=arg2}else{point=arg0!==undefined?[arg0,arg1]:null;handleIn=arg2!==undefined?[arg2,arg3]:null;handleOut=arg4!==undefined?[arg4,arg5]:null}new SegmentPoint(point,this,"_point");new SegmentPoint(handleIn,this,"_handleIn");new SegmentPoint(handleOut,this,"_handleOut")},_serialize:function(options){return Base.serialize(this.hasHandles()?[this._point,this._handleIn,this._handleOut]:this._point,options,true)},_changed:function(point){var path=this._path;if(!path)return;var curves=path._curves,index=this._index,curve;if(curves){if((!point||point===this._point||point===this._handleIn)&&(curve=index>0?curves[index-1]:path._closed?curves[curves.length-1]:null))curve._changed();if((!point||point===this._point||point===this._handleOut)&&(curve=curves[index]))curve._changed()}path._changed(25)},getPoint:function(){return this._point},setPoint:function(){var point=Point.read(arguments);this._point.set(point.x,point.y)},getHandleIn:function(){return this._handleIn},setHandleIn:function(){var point=Point.read(arguments);this._handleIn.set(point.x,point.y)},getHandleOut:function(){return this._handleOut},setHandleOut:function(){var point=Point.read(arguments);this._handleOut.set(point.x,point.y)},hasHandles:function(){return!this._handleIn.isZero()||!this._handleOut.isZero()},clearHandles:function(){this._handleIn.set(0,0);this._handleOut.set(0,0)},_selectionState:0,isSelected:function(_point){var state=this._selectionState;return!_point?!!(state&7):_point===this._point?!!(state&4):_point===this._handleIn?!!(state&1):_point===this._handleOut?!!(state&2):false},setSelected:function(selected,_point){var path=this._path,selected=!!selected,state=this._selectionState,oldState=state,flag=!_point?7:_point===this._point?4:_point===this._handleIn?1:_point===this._handleOut?2:0;if(selected){state|=flag}else{state&=~flag}this._selectionState=state;if(path&&state!==oldState){path._updateSelection(this,oldState,state);path._changed(129)}},getIndex:function(){return this._index!==undefined?this._index:null},getPath:function(){return this._path||null},getCurve:function(){var path=this._path,index=this._index;if(path){if(index>0&&!path._closed&&index===path._segments.length-1)index--;return path.getCurves()[index]||null}return null},getLocation:function(){var curve=this.getCurve();return curve?new CurveLocation(curve,this===curve._segment1?0:1):null},getNext:function(){var segments=this._path&&this._path._segments;return segments&&(segments[this._index+1]||this._path._closed&&segments[0])||null},getPrevious:function(){var segments=this._path&&this._path._segments;return segments&&(segments[this._index-1]||this._path._closed&&segments[segments.length-1])||null},isFirst:function(){return this._index===0},isLast:function(){var path=this._path;return path&&this._index===path._segments.length-1||false},reverse:function(){var handleIn=this._handleIn,handleOut=this._handleOut,inX=handleIn._x,inY=handleIn._y;handleIn.set(handleOut._x,handleOut._y);handleOut.set(inX,inY)},reversed:function(){return new Segment(this._point,this._handleOut,this._handleIn)},remove:function(){return this._path?!!this._path.removeSegment(this._index):false},clone:function(){return new Segment(this._point,this._handleIn,this._handleOut)},equals:function(segment){return segment===this||segment&&this._class===segment._class&&this._point.equals(segment._point)&&this._handleIn.equals(segment._handleIn)&&this._handleOut.equals(segment._handleOut)||false},toString:function(){var parts=["point: "+this._point];if(!this._handleIn.isZero())parts.push("handleIn: "+this._handleIn);if(!this._handleOut.isZero())parts.push("handleOut: "+this._handleOut);return"{ "+parts.join(", ")+" }"},transform:function(matrix){this._transformCoordinates(matrix,new Array(6),true);this._changed()},_transformCoordinates:function(matrix,coords,change){var point=this._point,handleIn=!change||!this._handleIn.isZero()?this._handleIn:null,handleOut=!change||!this._handleOut.isZero()?this._handleOut:null,x=point._x,y=point._y,i=2;coords[0]=x;coords[1]=y;if(handleIn){coords[i++]=handleIn._x+x;coords[i++]=handleIn._y+y}if(handleOut){coords[i++]=handleOut._x+x;coords[i++]=handleOut._y+y}if(matrix){matrix._transformCoordinates(coords,coords,i/2);x=coords[0];y=coords[1];if(change){point._x=x;point._y=y;i=2;if(handleIn){handleIn._x=coords[i++]-x;handleIn._y=coords[i++]-y}if(handleOut){handleOut._x=coords[i++]-x;handleOut._y=coords[i++]-y}}else{if(!handleIn){coords[i++]=x;coords[i++]=y}if(!handleOut){coords[i++]=x;coords[i++]=y}}}return coords}});var SegmentPoint=Point.extend({initialize:function SegmentPoint(point,owner,key){var x,y,selected;if(!point){x=y=0}else if((x=point[0])!==undefined){y=point[1]}else{var pt=point;if((x=pt.x)===undefined){pt=Point.read(arguments);x=pt.x}y=pt.y;selected=pt.selected}this._x=x;this._y=y;this._owner=owner;owner[key]=this;if(selected)this.setSelected(true)},set:function(x,y){this._x=x;this._y=y;this._owner._changed(this);return this},_serialize:function(options){var f=options.formatter,x=f.number(this._x),y=f.number(this._y);return this.isSelected()?{x:x,y:y,selected:true}:[x,y]},getX:function(){return this._x},setX:function(x){this._x=x;this._owner._changed(this)},getY:function(){return this._y},setY:function(y){this._y=y;this._owner._changed(this)},isZero:function(){return Numerical.isZero(this._x)&&Numerical.isZero(this._y)},setSelected:function(selected){this._owner.setSelected(selected,this)},isSelected:function(){return this._owner.isSelected(this)}});var Curve=Base.extend({_class:"Curve",initialize:function Curve(arg0,arg1,arg2,arg3,arg4,arg5,arg6,arg7){var count=arguments.length,seg1,seg2,point1,point2,handle1,handle2;if(count===3){this._path=arg0;seg1=arg1;seg2=arg2}else if(count===0){seg1=new Segment;seg2=new Segment}else if(count===1){if("segment1"in arg0){seg1=new Segment(arg0.segment1);seg2=new Segment(arg0.segment2)}else if("point1"in arg0){point1=arg0.point1;handle1=arg0.handle1;handle2=arg0.handle2;point2=arg0.point2}else if(Array.isArray(arg0)){point1=[arg0[0],arg0[1]];point2=[arg0[6],arg0[7]];handle1=[arg0[2]-arg0[0],arg0[3]-arg0[1]];handle2=[arg0[4]-arg0[6],arg0[5]-arg0[7]]}}else if(count===2){seg1=new Segment(arg0);seg2=new Segment(arg1)}else if(count===4){point1=arg0;handle1=arg1;handle2=arg2;point2=arg3}else if(count===8){point1=[arg0,arg1];point2=[arg6,arg7];handle1=[arg2-arg0,arg3-arg1];handle2=[arg4-arg6,arg5-arg7]}this._segment1=seg1||new Segment(point1,null,handle1);this._segment2=seg2||new Segment(point2,handle2,null)},_serialize:function(options){return Base.serialize(this.hasHandles()?[this.getPoint1(),this.getHandle1(),this.getHandle2(),this.getPoint2()]:[this.getPoint1(),this.getPoint2()],options,true)},_changed:function(){this._length=this._bounds=undefined},clone:function(){return new Curve(this._segment1,this._segment2)},toString:function(){var parts=["point1: "+this._segment1._point];if(!this._segment1._handleOut.isZero())parts.push("handle1: "+this._segment1._handleOut);if(!this._segment2._handleIn.isZero())parts.push("handle2: "+this._segment2._handleIn);parts.push("point2: "+this._segment2._point);return"{ "+parts.join(", ")+" }"},remove:function(){var removed=false;if(this._path){var segment2=this._segment2,handleOut=segment2._handleOut;removed=segment2.remove();if(removed)this._segment1._handleOut.set(handleOut.x,handleOut.y)}return removed},getPoint1:function(){return this._segment1._point},setPoint1:function(){var point=Point.read(arguments);this._segment1._point.set(point.x,point.y)},getPoint2:function(){return this._segment2._point},setPoint2:function(){var point=Point.read(arguments);this._segment2._point.set(point.x,point.y)},getHandle1:function(){return this._segment1._handleOut},setHandle1:function(){var point=Point.read(arguments);this._segment1._handleOut.set(point.x,point.y)},getHandle2:function(){return this._segment2._handleIn},setHandle2:function(){var point=Point.read(arguments);this._segment2._handleIn.set(point.x,point.y)},getSegment1:function(){return this._segment1},getSegment2:function(){return this._segment2},getPath:function(){return this._path},getIndex:function(){return this._segment1._index},getNext:function(){var curves=this._path&&this._path._curves;return curves&&(curves[this._segment1._index+1]||this._path._closed&&curves[0])||null},getPrevious:function(){var curves=this._path&&this._path._curves;return curves&&(curves[this._segment1._index-1]||this._path._closed&&curves[curves.length-1])||null},isFirst:function(){return this._segment1._index===0},isLast:function(){var path=this._path;return path&&this._segment1._index===path._curves.length-1||false},isSelected:function(){return this.getPoint1().isSelected()&&this.getHandle2().isSelected()&&this.getHandle2().isSelected()&&this.getPoint2().isSelected()},setSelected:function(selected){this.getPoint1().setSelected(selected);this.getHandle1().setSelected(selected);this.getHandle2().setSelected(selected);this.getPoint2().setSelected(selected)},getValues:function(matrix){return Curve.getValues(this._segment1,this._segment2,matrix)},getPoints:function(){var coords=this.getValues(),points=[];for(var i=0;i<8;i+=2)points.push(new Point(coords[i],coords[i+1]));return points},getLength:function(){if(this._length==null)this._length=Curve.getLength(this.getValues(),0,1);return this._length},getArea:function(){return Curve.getArea(this.getValues())},getLine:function(){return new Line(this._segment1._point,this._segment2._point)},getPart:function(from,to){return new Curve(Curve.getPart(this.getValues(),from,to))},getPartLength:function(from,to){return Curve.getLength(this.getValues(),from,to)},getIntersections:function(curve){return Curve._getIntersections(this.getValues(),curve&&curve!==this?curve.getValues():null,this,curve,[],{})},_getParameter:function(offset,isParameter){return isParameter?offset:offset&&offset.curve===this?offset.parameter:offset===undefined&&isParameter===undefined?.5:this.getParameterAt(offset,0)},divide:function(offset,isParameter,_setHandles){var parameter=this._getParameter(offset,isParameter),tMin=4e-7,tMax=1-tMin,res=null;if(parameter>=tMin&&parameter<=tMax){var parts=Curve.subdivide(this.getValues(),parameter),left=parts[0],right=parts[1],setHandles=_setHandles||this.hasHandles(),segment1=this._segment1,segment2=this._segment2,path=this._path;if(setHandles){segment1._handleOut.set(left[2]-left[0],left[3]-left[1]);segment2._handleIn.set(right[4]-right[6],right[5]-right[7])}var x=left[6],y=left[7],segment=new Segment(new Point(x,y),setHandles&&new Point(left[4]-x,left[5]-y),setHandles&&new Point(right[2]-x,right[3]-y));if(path){path.insert(segment1._index+1,segment);res=this.getNext()}else{this._segment2=segment;res=new Curve(segment,segment2)}}return res},split:function(offset,isParameter){return this._path?this._path.split(this._segment1._index,this._getParameter(offset,isParameter)):null},reversed:function(){return new Curve(this._segment2.reversed(),this._segment1.reversed())},clearHandles:function(){this._segment1._handleOut.set(0,0);this._segment2._handleIn.set(0,0)},statics:{getValues:function(segment1,segment2,matrix){var p1=segment1._point,h1=segment1._handleOut,h2=segment2._handleIn,p2=segment2._point,values=[p1._x,p1._y,p1._x+h1._x,p1._y+h1._y,p2._x+h2._x,p2._y+h2._y,p2._x,p2._y];if(matrix)matrix._transformCoordinates(values,values,4);return values},subdivide:function(v,t){var p1x=v[0],p1y=v[1],c1x=v[2],c1y=v[3],c2x=v[4],c2y=v[5],p2x=v[6],p2y=v[7];if(t===undefined)t=.5;var u=1-t,p3x=u*p1x+t*c1x,p3y=u*p1y+t*c1y,p4x=u*c1x+t*c2x,p4y=u*c1y+t*c2y,p5x=u*c2x+t*p2x,p5y=u*c2y+t*p2y,p6x=u*p3x+t*p4x,p6y=u*p3y+t*p4y,p7x=u*p4x+t*p5x,p7y=u*p4y+t*p5y,p8x=u*p6x+t*p7x,p8y=u*p6y+t*p7y;return[[p1x,p1y,p3x,p3y,p6x,p6y,p8x,p8y],[p8x,p8y,p7x,p7y,p5x,p5y,p2x,p2y]]},solveCubic:function(v,coord,val,roots,min,max){var p1=v[coord],c1=v[coord+2],c2=v[coord+4],p2=v[coord+6],c=3*(c1-p1),b=3*(c2-c1)-c,a=p2-p1-c-b;return Numerical.solveCubic(a,b,c,p1-val,roots,min,max)},getParameterOf:function(v,point){var p1=new Point(v[0],v[1]),p2=new Point(v[6],v[7]),epsilon=1e-12,t=point.isClose(p1,epsilon)?0:point.isClose(p2,epsilon)?1:null;if(t!==null)return t;var coords=[point.x,point.y],roots=[],geomEpsilon=2e-7;for(var c=0;c<2;c++){var count=Curve.solveCubic(v,c,coords[c],roots,0,1);for(var i=0;i<count;i++){t=roots[i];if(point.isClose(Curve.getPoint(v,t),geomEpsilon))return t}}return point.isClose(p1,geomEpsilon)?0:point.isClose(p2,geomEpsilon)?1:null},getNearestParameter:function(v,point){if(Curve.isStraight(v)){var p1x=v[0],p1y=v[1],p2x=v[6],p2y=v[7],vx=p2x-p1x,vy=p2y-p1y,det=vx*vx+vy*vy;if(det===0)return 0;var u=((point.x-p1x)*vx+(point.y-p1y)*vy)/det;return u<1e-12?0:u>.999999999999?1:Curve.getParameterOf(v,new Point(p1x+u*vx,p1y+u*vy))}var count=100,minDist=Infinity,minT=0;function refine(t){if(t>=0&&t<=1){var dist=point.getDistance(Curve.getPoint(v,t),true);if(dist<minDist){minDist=dist;minT=t;return true}}}for(var i=0;i<=count;i++)refine(i/count);var step=1/(count*2);while(step>4e-7){if(!refine(minT-step)&&!refine(minT+step))step/=2}return minT},getPart:function(v,from,to){var flip=from>to;if(flip){var tmp=from;from=to;to=tmp}if(from>0)v=Curve.subdivide(v,from)[1];if(to<1)v=Curve.subdivide(v,(to-from)/(1-from))[0];return flip?[v[6],v[7],v[4],v[5],v[2],v[3],v[0],v[1]]:v},hasHandles:function(v){var isZero=Numerical.isZero;return!(isZero(v[0]-v[2])&&isZero(v[1]-v[3])&&isZero(v[4]-v[6])&&isZero(v[5]-v[7]))},isFlatEnough:function(v,tolerance){var p1x=v[0],p1y=v[1],c1x=v[2],c1y=v[3],c2x=v[4],c2y=v[5],p2x=v[6],p2y=v[7],ux=3*c1x-2*p1x-p2x,uy=3*c1y-2*p1y-p2y,vx=3*c2x-2*p2x-p1x,vy=3*c2y-2*p2y-p1y;return Math.max(ux*ux,vx*vx)+Math.max(uy*uy,vy*vy)<10*tolerance*tolerance},getArea:function(v){var p1x=v[0],p1y=v[1],p2x=v[6],p2y=v[7],h1x=(v[2]+p1x)/2,h1y=(v[3]+p1y)/2,h2x=(v[4]+v[6])/2,h2y=(v[5]+v[7])/2;return 6*((p1x-h1x)*(h1y+p1y)+(h1x-h2x)*(h2y+h1y)+(h2x-p2x)*(p2y+h2y))/10},getBounds:function(v){var min=v.slice(0,2),max=min.slice(),roots=[0,0];for(var i=0;i<2;i++)Curve._addBounds(v[i],v[i+2],v[i+4],v[i+6],i,0,min,max,roots);return new Rectangle(min[0],min[1],max[0]-min[0],max[1]-min[1])},_addBounds:function(v0,v1,v2,v3,coord,padding,min,max,roots){function add(value,padding){var left=value-padding,right=value+padding;if(left<min[coord])min[coord]=left;if(right>max[coord])max[coord]=right}var a=3*(v1-v2)-v0+v3,b=2*(v0+v2)-4*v1,c=v1-v0,count=Numerical.solveQuadratic(a,b,c,roots),tMin=4e-7,tMax=1-tMin;add(v3,0);for(var i=0;i<count;i++){var t=roots[i],u=1-t;if(tMin<t&&t<tMax)add(u*u*u*v0+3*u*u*t*v1+3*u*t*t*v2+t*t*t*v3,padding)}}}},Base.each(["getBounds","getStrokeBounds","getHandleBounds","getRoughBounds"],function(name){this[name]=function(){if(!this._bounds)this._bounds={};var bounds=this._bounds[name];if(!bounds){var path=this._path;bounds=this._bounds[name]=Path[name]([this._segment1,this._segment2],false,path&&path.getStyle())}return bounds.clone()}},{}),Base.each({isStraight:function(l,h1,h2){if(h1.isZero()&&h2.isZero()){return true}else if(l.isZero()){return false}else if(h1.isCollinear(l)&&h2.isCollinear(l)){var div=l.dot(l),p1=l.dot(h1)/div,p2=l.dot(h2)/div;return p1>=0&&p1<=1&&p2<=0&&p2>=-1}return false},isLinear:function(l,h1,h2){var third=l.divide(3);return h1.equals(third)&&h2.negate().equals(third)}},function(test,name){this[name]=function(){var seg1=this._segment1,seg2=this._segment2;return test(seg2._point.subtract(seg1._point),seg1._handleOut,seg2._handleIn)};this.statics[name]=function(v){var p1x=v[0],p1y=v[1],p2x=v[6],p2y=v[7];return test(new Point(p2x-p1x,p2y-p1y),new Point(v[2]-p1x,v[3]-p1y),new Point(v[4]-p2x,v[5]-p2y))}},{statics:{},hasHandles:function(){return!this._segment1._handleOut.isZero()||!this._segment2._handleIn.isZero()},isCollinear:function(curve){return curve&&this.isStraight()&&curve.isStraight()&&this.getLine().isCollinear(curve.getLine())},isHorizontal:function(){return this.isStraight()&&Math.abs(this.getTangentAt(.5,true).y)<1e-7},isVertical:function(){return this.isStraight()&&Math.abs(this.getTangentAt(.5,true).x)<1e-7}}),{beans:false,getParameterAt:function(offset,start){return Curve.getParameterAt(this.getValues(),offset,start)},getParameterOf:function(){return Curve.getParameterOf(this.getValues(),Point.read(arguments))},getLocationAt:function(offset,isParameter){var t=isParameter?offset:this.getParameterAt(offset);return t!=null&&t>=0&&t<=1?new CurveLocation(this,t):null},getLocationOf:function(){return this.getLocationAt(this.getParameterOf(Point.read(arguments)),true)},getOffsetOf:function(){var loc=this.getLocationOf.apply(this,arguments);return loc?loc.getOffset():null},getNearestLocation:function(){var point=Point.read(arguments),values=this.getValues(),t=Curve.getNearestParameter(values,point),pt=Curve.getPoint(values,t);return new CurveLocation(this,t,pt,null,point.getDistance(pt))},getNearestPoint:function(){return this.getNearestLocation.apply(this,arguments).getPoint()}},new function(){var methods=["getPoint","getTangent","getNormal","getWeightedTangent","getWeightedNormal","getCurvature"];return Base.each(methods,function(name){this[name+"At"]=function(offset,isParameter){var values=this.getValues();return Curve[name](values,isParameter?offset:Curve.getParameterAt(values,offset,0))}},{statics:{evaluateMethods:methods}})},new function(){function getLengthIntegrand(v){var p1x=v[0],p1y=v[1],c1x=v[2],c1y=v[3],c2x=v[4],c2y=v[5],p2x=v[6],p2y=v[7],ax=9*(c1x-c2x)+3*(p2x-p1x),bx=6*(p1x+c2x)-12*c1x,cx=3*(c1x-p1x),ay=9*(c1y-c2y)+3*(p2y-p1y),by=6*(p1y+c2y)-12*c1y,cy=3*(c1y-p1y);return function(t){var dx=(ax*t+bx)*t+cx,dy=(ay*t+by)*t+cy;return Math.sqrt(dx*dx+dy*dy)}}function getIterations(a,b){return Math.max(2,Math.min(16,Math.ceil(Math.abs(b-a)*32)))}function evaluate(v,t,type,normalized){if(t==null||t<0||t>1)return null;var p1x=v[0],p1y=v[1],c1x=v[2],c1y=v[3],c2x=v[4],c2y=v[5],p2x=v[6],p2y=v[7],tMin=4e-7,tMax=1-tMin,x,y;if(type===0&&(t<tMin||t>tMax)){var isZero=t<tMin;x=isZero?p1x:p2x;y=isZero?p1y:p2y}else{var cx=3*(c1x-p1x),bx=3*(c2x-c1x)-cx,ax=p2x-p1x-cx-bx,cy=3*(c1y-p1y),by=3*(c2y-c1y)-cy,ay=p2y-p1y-cy-by;if(type===0){x=((ax*t+bx)*t+cx)*t+p1x;y=((ay*t+by)*t+cy)*t+p1y}else{if(t<tMin){x=cx;y=cy}else if(t>tMax){x=3*(p2x-c2x);y=3*(p2y-c2y)}else{x=(3*ax*t+2*bx)*t+cx;y=(3*ay*t+2*by)*t+cy}if(normalized){if(x===0&&y===0&&(t<tMin||t>tMax)){x=c2x-c1x;y=c2y-c1y}var len=Math.sqrt(x*x+y*y);if(len){x/=len;y/=len}}if(type===3){var x2=6*ax*t+2*bx,y2=6*ay*t+2*by,d=Math.pow(x*x+y*y,3/2);x=d!==0?(x*y2-y*x2)/d:0;y=0}}}return type===2?new Point(y,-x):new Point(x,y)}return{statics:{getLength:function(v,a,b){if(a===undefined)a=0;if(b===undefined)b=1;if(a===0&&b===1&&Curve.isStraight(v)){var dx=v[6]-v[0],dy=v[7]-v[1];return Math.sqrt(dx*dx+dy*dy)}var ds=getLengthIntegrand(v);return Numerical.integrate(ds,a,b,getIterations(a,b))},getParameterAt:function(v,offset,start){if(start===undefined)start=offset<0?1:0;if(offset===0)return start;var abs=Math.abs,forward=offset>0,a=forward?start:0,b=forward?1:start,ds=getLengthIntegrand(v),rangeLength=Numerical.integrate(ds,a,b,getIterations(a,b));if(abs(offset-rangeLength)<1e-12){return forward?b:a}else if(abs(offset)>rangeLength){return null}var guess=offset/rangeLength,length=0;function f(t){length+=Numerical.integrate(ds,start,t,getIterations(start,t));start=t;return length-offset}return Numerical.findRoot(f,ds,start+guess,a,b,32,1e-12)},getPoint:function(v,t){return evaluate(v,t,0,false)},getTangent:function(v,t){return evaluate(v,t,1,true)},getWeightedTangent:function(v,t){return evaluate(v,t,1,false)},getNormal:function(v,t){return evaluate(v,t,2,true)},getWeightedNormal:function(v,t){return evaluate(v,t,2,false)},getCurvature:function(v,t){return evaluate(v,t,3,false).x}}}},new function(){function addLocation(locations,param,v1,c1,t1,p1,v2,c2,t2,p2,overlap){var startConnected=param.startConnected,endConnected=param.endConnected,tMin=4e-7,tMax=1-tMin;if(t1==null)t1=Curve.getParameterOf(v1,p1);if(t1!==null&&t1>=(startConnected?tMin:0)&&t1<=(endConnected?tMax:1)){if(t2==null)t2=Curve.getParameterOf(v2,p2);if(t2!==null&&t2>=(endConnected?tMin:0)&&t2<=(startConnected?tMax:1)){var renormalize=param.renormalize;if(renormalize){var res=renormalize(t1,t2);t1=res[0];t2=res[1]}var loc1=new CurveLocation(c1,t1,p1||Curve.getPoint(v1,t1),overlap),loc2=new CurveLocation(c2,t2,p2||Curve.getPoint(v2,t2),overlap),flip=loc1.getPath()===loc2.getPath()&&loc1.getIndex()>loc2.getIndex(),loc=flip?loc2:loc1,include=param.include;loc1._intersection=loc2;loc2._intersection=loc1;if(!include||include(loc)){CurveLocation.insert(locations,loc,true)}}}}function addCurveIntersections(v1,v2,c1,c2,locations,param,tMin,tMax,uMin,uMax,oldTDiff,reverse,recursion){if(++recursion>=24)return;var q0x=v2[0],q0y=v2[1],q3x=v2[6],q3y=v2[7],getSignedDistance=Line.getSignedDistance,d1=getSignedDistance(q0x,q0y,q3x,q3y,v2[2],v2[3]),d2=getSignedDistance(q0x,q0y,q3x,q3y,v2[4],v2[5]),factor=d1*d2>0?3/4:4/9,dMin=factor*Math.min(0,d1,d2),dMax=factor*Math.max(0,d1,d2),dp0=getSignedDistance(q0x,q0y,q3x,q3y,v1[0],v1[1]),dp1=getSignedDistance(q0x,q0y,q3x,q3y,v1[2],v1[3]),dp2=getSignedDistance(q0x,q0y,q3x,q3y,v1[4],v1[5]),dp3=getSignedDistance(q0x,q0y,q3x,q3y,v1[6],v1[7]),hull=getConvexHull(dp0,dp1,dp2,dp3),top=hull[0],bottom=hull[1],tMinClip,tMaxClip;if((tMinClip=clipConvexHull(top,bottom,dMin,dMax))==null||(tMaxClip=clipConvexHull(top.reverse(),bottom.reverse(),dMin,dMax))==null)return;v1=Curve.getPart(v1,tMinClip,tMaxClip);var tDiff=tMaxClip-tMinClip,tMinNew=tMin+(tMax-tMin)*tMinClip,tMaxNew=tMin+(tMax-tMin)*tMaxClip;if(oldTDiff>.5&&tDiff>.5){if(tMaxNew-tMinNew>uMax-uMin){var parts=Curve.subdivide(v1,.5),t=tMinNew+(tMaxNew-tMinNew)/2;addCurveIntersections(v2,parts[0],c2,c1,locations,param,uMin,uMax,tMinNew,t,tDiff,!reverse,recursion);addCurveIntersections(v2,parts[1],c2,c1,locations,param,uMin,uMax,t,tMaxNew,tDiff,!reverse,recursion)}else{var parts=Curve.subdivide(v2,.5),t=uMin+(uMax-uMin)/2;addCurveIntersections(parts[0],v1,c2,c1,locations,param,uMin,t,tMinNew,tMaxNew,tDiff,!reverse,recursion);addCurveIntersections(parts[1],v1,c2,c1,locations,param,t,uMax,tMinNew,tMaxNew,tDiff,!reverse,recursion)}}else if(Math.max(uMax-uMin,tMaxNew-tMinNew)<1e-7){var t1=tMinNew+(tMaxNew-tMinNew)/2,t2=uMin+(uMax-uMin)/2;v1=c1.getValues();v2=c2.getValues();addLocation(locations,param,reverse?v2:v1,reverse?c2:c1,reverse?t2:t1,null,reverse?v1:v2,reverse?c1:c2,reverse?t1:t2,null)}else if(tDiff>1e-12){addCurveIntersections(v2,v1,c2,c1,locations,param,uMin,uMax,tMinNew,tMaxNew,tDiff,!reverse,recursion)}}function getConvexHull(dq0,dq1,dq2,dq3){var p0=[0,dq0],p1=[1/3,dq1],p2=[2/3,dq2],p3=[1,dq3],dist1=dq1-(2*dq0+dq3)/3,dist2=dq2-(dq0+2*dq3)/3,hull;if(dist1*dist2<0){hull=[[p0,p1,p3],[p0,p2,p3]]}else{var distRatio=dist1/dist2;hull=[distRatio>=2?[p0,p1,p3]:distRatio<=.5?[p0,p2,p3]:[p0,p1,p2,p3],[p0,p3]]}return(dist1||dist2)<0?hull.reverse():hull}function clipConvexHull(hullTop,hullBottom,dMin,dMax){if(hullTop[0][1]<dMin){return clipConvexHullPart(hullTop,true,dMin)}else if(hullBottom[0][1]>dMax){return clipConvexHullPart(hullBottom,false,dMax)}else{return hullTop[0][0]}}function clipConvexHullPart(part,top,threshold){var px=part[0][0],py=part[0][1];for(var i=1,l=part.length;i<l;i++){var qx=part[i][0],qy=part[i][1];if(top?qy>=threshold:qy<=threshold){return qy===threshold?qx:px+(threshold-py)*(qx-px)/(qy-py)}px=qx;py=qy}return null}function addCurveLineIntersections(v1,v2,c1,c2,locations,param){var flip=Curve.isStraight(v1),vc=flip?v2:v1,vl=flip?v1:v2,lx1=vl[0],ly1=vl[1],lx2=vl[6],ly2=vl[7],ldx=lx2-lx1,ldy=ly2-ly1,angle=Math.atan2(-ldy,ldx),sin=Math.sin(angle),cos=Math.cos(angle),rvc=[];for(var i=0;i<8;i+=2){var x=vc[i]-lx1,y=vc[i+1]-ly1;rvc.push(x*cos-y*sin,x*sin+y*cos)}var roots=[],count=Curve.solveCubic(rvc,1,0,roots,0,1);for(var i=0;i<count;i++){var tc=roots[i],pc=Curve.getPoint(vc,tc),tl=Curve.getParameterOf(vl,pc);if(tl!==null){var pl=Curve.getPoint(vl,tl),t1=flip?tl:tc,t2=flip?tc:tl;if(!param.endConnected||t2>Numerical.CURVETIME_EPSILON){addLocation(locations,param,v1,c1,t1,flip?pl:pc,v2,c2,t2,flip?pc:pl)}}}}function addLineIntersection(v1,v2,c1,c2,locations,param){var pt=Line.intersect(v1[0],v1[1],v1[6],v1[7],v2[0],v2[1],v2[6],v2[7]);if(pt){addLocation(locations,param,v1,c1,null,pt,v2,c2,null,pt)}}return{statics:{_getIntersections:function(v1,v2,c1,c2,locations,param){if(!v2){return Curve._getSelfIntersection(v1,c1,locations,param)}var c1p1x=v1[0],c1p1y=v1[1],c1p2x=v1[6],c1p2y=v1[7],c2p1x=v2[0],c2p1y=v2[1],c2p2x=v2[6],c2p2y=v2[7],c1s1x=(3*v1[2]+c1p1x)/4,c1s1y=(3*v1[3]+c1p1y)/4,c1s2x=(3*v1[4]+c1p2x)/4,c1s2y=(3*v1[5]+c1p2y)/4,c2s1x=(3*v2[2]+c2p1x)/4,c2s1y=(3*v2[3]+c2p1y)/4,c2s2x=(3*v2[4]+c2p2x)/4,c2s2y=(3*v2[5]+c2p2y)/4,min=Math.min,max=Math.max;if(!(max(c1p1x,c1s1x,c1s2x,c1p2x)>=min(c2p1x,c2s1x,c2s2x,c2p2x)&&min(c1p1x,c1s1x,c1s2x,c1p2x)<=max(c2p1x,c2s1x,c2s2x,c2p2x)&&max(c1p1y,c1s1y,c1s2y,c1p2y)>=min(c2p1y,c2s1y,c2s2y,c2p2y)&&min(c1p1y,c1s1y,c1s2y,c1p2y)<=max(c2p1y,c2s1y,c2s2y,c2p2y)))return locations;if(!param.startConnected&&!param.endConnected){var overlaps=Curve.getOverlaps(v1,v2);if(overlaps){for(var i=0;i<2;i++){var overlap=overlaps[i];addLocation(locations,param,v1,c1,overlap[0],null,v2,c2,overlap[1],null,true)}return locations}}var straight1=Curve.isStraight(v1),straight2=Curve.isStraight(v2),straight=straight1&&straight2,epsilon=1e-12,before=locations.length;(straight?addLineIntersection:straight1||straight2?addCurveLineIntersections:addCurveIntersections)(v1,v2,c1,c2,locations,param,0,1,0,1,0,false,0);if(straight&&locations.length>before)return locations;var c1p1=new Point(c1p1x,c1p1y),c1p2=new Point(c1p2x,c1p2y),c2p1=new Point(c2p1x,c2p1y),c2p2=new Point(c2p2x,c2p2y);if(c1p1.isClose(c2p1,epsilon))addLocation(locations,param,v1,c1,0,c1p1,v2,c2,0,c2p1);if(!param.startConnected&&c1p1.isClose(c2p2,epsilon))addLocation(locations,param,v1,c1,0,c1p1,v2,c2,1,c2p2);if(!param.endConnected&&c1p2.isClose(c2p1,epsilon))addLocation(locations,param,v1,c1,1,c1p2,v2,c2,0,c2p1);if(c1p2.isClose(c2p2,epsilon))addLocation(locations,param,v1,c1,1,c1p2,v2,c2,1,c2p2);return locations},_getSelfIntersection:function(v1,c1,locations,param){var p1x=v1[0],p1y=v1[1],h1x=v1[2],h1y=v1[3],h2x=v1[4],h2y=v1[5],p2x=v1[6],p2y=v1[7];var line=new Line(p1x,p1y,p2x,p2y,false),side1=line.getSide(new Point(h1x,h1y),true),side2=line.getSide(new Point(h2x,h2y),true);if(side1===side2){var edgeSum=(p1x-h2x)*(h1y-p2y)+(h1x-p2x)*(h2y-p1y);if(edgeSum*side1>0)return locations}var ax=p2x-3*h2x+3*h1x-p1x,bx=h2x-2*h1x+p1x,cx=h1x-p1x,ay=p2y-3*h2y+3*h1y-p1y,by=h2y-2*h1y+p1y,cy=h1y-p1y,ac=ay*cx-ax*cy,ab=ay*bx-ax*by,bc=by*cx-bx*cy;if(ac*ac-4*ab*bc<0){var roots=[],tSplit,count=Numerical.solveCubic(ax*ax+ay*ay,3*(ax*bx+ay*by),2*(bx*bx+by*by)+ax*cx+ay*cy,bx*cx+by*cy,roots,0,1);if(count>0){for(var i=0,maxCurvature=0;i<count;i++){var curvature=Math.abs(c1.getCurvatureAt(roots[i],true));if(curvature>maxCurvature){maxCurvature=curvature;tSplit=roots[i]}}var parts=Curve.subdivide(v1,tSplit);param.endConnected=true;param.renormalize=function(t1,t2){return[t1*tSplit,t2*(1-tSplit)+tSplit]};Curve._getIntersections(parts[0],parts[1],c1,c1,locations,param)}}return locations},getOverlaps:function(v1,v2){var abs=Math.abs,timeEpsilon=4e-7,geomEpsilon=2e-7,straight1=Curve.isStraight(v1),straight2=Curve.isStraight(v2),straight=straight1&&straight2;function getLineLengthSquared(v){var x=v[6]-v[0],y=v[7]-v[1];return x*x+y*y}if(straight){var flip=getLineLengthSquared(v1)<getLineLengthSquared(v2),l1=flip?v2:v1,l2=flip?v1:v2,line=new Line(l1[0],l1[1],l1[6],l1[7]);if(line.getDistance(new Point(l2[0],l2[1]))>geomEpsilon||line.getDistance(new Point(l2[6],l2[7]))>geomEpsilon)return null}else if(straight1^straight2){return null}var v=[v1,v2],pairs=[];for(var i=0,t1=0;i<2&&pairs.length<2;i+=t1===0?0:1,t1=t1^1){var t2=Curve.getParameterOf(v[i^1],new Point(v[i][t1===0?0:6],v[i][t1===0?1:7]));if(t2!=null){var pair=i===0?[t1,t2]:[t2,t1];if(pairs.length===0||abs(pair[0]-pairs[0][0])>timeEpsilon&&abs(pair[1]-pairs[0][1])>timeEpsilon)pairs.push(pair)}if(i===1&&pairs.length===0)break}if(pairs.length!==2){pairs=null}else if(!straight){var o1=Curve.getPart(v1,pairs[0][0],pairs[1][0]),o2=Curve.getPart(v2,pairs[0][1],pairs[1][1]);if(abs(o2[2]-o1[2])>geomEpsilon||abs(o2[3]-o1[3])>geomEpsilon||abs(o2[4]-o1[4])>geomEpsilon||abs(o2[5]-o1[5])>geomEpsilon)pairs=null}return pairs}}}});var CurveLocation=Base.extend({_class:"CurveLocation",beans:true,initialize:function CurveLocation(curve,parameter,point,_overlap,_distance){if(parameter>.9999996){var next=curve.getNext();if(next){parameter=0;curve=next}}this._id=UID.get(CurveLocation);this._setCurve(curve);this._parameter=parameter;this._point=point||curve.getPointAt(parameter,true);this._overlap=_overlap;this._distance=_distance;this._intersection=this._next=this._prev=null},_setCurve:function(curve){var path=curve._path;this._version=path?path._version:0;this._curve=curve;this._segment=null;this._segment1=curve._segment1;this._segment2=curve._segment2},_setSegment:function(segment){this._setCurve(segment.getCurve());this._segment=segment;this._parameter=segment===this._segment1?0:1;this._point=segment._point.clone()},getSegment:function(){var curve=this.getCurve(),segment=this._segment;if(!segment){var parameter=this.getParameter();if(parameter===0){segment=curve._segment1}else if(parameter===1){segment=curve._segment2}else if(parameter!=null){segment=curve.getPartLength(0,parameter)<curve.getPartLength(parameter,1)?curve._segment1:curve._segment2}this._segment=segment}return segment},getCurve:function(){var curve=this._curve,path=curve&&curve._path,that=this;if(path&&path._version!==this._version){curve=this._parameter=this._curve=this._offset=null}function trySegment(segment){var curve=segment&&segment.getCurve();if(curve&&(that._parameter=curve.getParameterOf(that._point))!=null){that._setCurve(curve);that._segment=segment;return curve}}return curve||trySegment(this._segment)||trySegment(this._segment1)||trySegment(this._segment2.getPrevious())},getPath:function(){var curve=this.getCurve();return curve&&curve._path},getIndex:function(){var curve=this.getCurve();return curve&&curve.getIndex()},getParameter:function(){var curve=this.getCurve(),parameter=this._parameter;return curve&&parameter==null?this._parameter=curve.getParameterOf(this._point):parameter},getPoint:function(){return this._point},getOffset:function(){var offset=this._offset;if(offset==null){offset=0;var path=this.getPath(),index=this.getIndex();if(path&&index!=null){var curves=path.getCurves();for(var i=0;i<index;i++)offset+=curves[i].getLength()}this._offset=offset+=this.getCurveOffset()}return offset},getCurveOffset:function(){var curve=this.getCurve(),parameter=this.getParameter();return parameter!=null&&curve&&curve.getPartLength(0,parameter)},getIntersection:function(){return this._intersection},getDistance:function(){return this._distance},divide:function(){var curve=this.getCurve(),res=null;if(curve){res=curve.divide(this.getParameter(),true);if(res)this._setSegment(res._segment1)}return res},split:function(){var curve=this.getCurve();return curve?curve.split(this.getParameter(),true):null},equals:function(loc,_ignoreOther){var res=this===loc,epsilon=2e-7;if(!res&&loc instanceof CurveLocation&&this.getPath()===loc.getPath()&&this.getPoint().isClose(loc.getPoint(),epsilon)){var c1=this.getCurve(),c2=loc.getCurve(),abs=Math.abs,diff=abs((c1.isLast()&&c2.isFirst()?-1:c1.getIndex())+this.getParameter()-((c2.isLast()&&c1.isFirst()?-1:c2.getIndex())+loc.getParameter()));res=(diff<4e-7||((diff=abs(this.getOffset()-loc.getOffset()))<epsilon||abs(this.getPath().getLength()-diff)<epsilon))&&(_ignoreOther||(!this._intersection&&!loc._intersection||this._intersection&&this._intersection.equals(loc._intersection,true)))}return res},toString:function(){var parts=[],point=this.getPoint(),f=Formatter.instance;if(point)parts.push("point: "+point);var index=this.getIndex();if(index!=null)parts.push("index: "+index);var parameter=this.getParameter();if(parameter!=null)parts.push("parameter: "+f.number(parameter));if(this._distance!=null)parts.push("distance: "+f.number(this._distance));return"{ "+parts.join(", ")+" }"},isTouching:function(){var inter=this._intersection;if(inter&&this.getTangent().isCollinear(inter.getTangent())){var curve1=this.getCurve(),curve2=inter.getCurve();return!(curve1.isStraight()&&curve2.isStraight()&&curve1.getLine().intersect(curve2.getLine()))}return false},isCrossing:function(){var inter=this._intersection;if(!inter)return false;var t1=this.getParameter(),t2=inter.getParameter(),tMin=4e-7,tMax=1-tMin;if(t1>=tMin&&t1<=tMax||t2>=tMin&&t2<=tMax)return!this.isTouching();var c2=this.getCurve(),c1=c2.getPrevious(),c4=inter.getCurve(),c3=c4.getPrevious(),PI=Math.PI;if(!c1||!c3)return false;function isInRange(angle,min,max){return min<max?angle>min&&angle<max:angle>min&&angle<=PI||angle>=-PI&&angle<max}var a1=c1.getTangentAt(tMax,true).negate().getAngleInRadians(),a2=c2.getTangentAt(tMin,true).getAngleInRadians(),a3=c3.getTangentAt(tMax,true).negate().getAngleInRadians(),a4=c4.getTangentAt(tMin,true).getAngleInRadians();return isInRange(a3,a1,a2)^isInRange(a4,a1,a2)&&isInRange(a3,a2,a1)^isInRange(a4,a2,a1)},isOverlap:function(){return!!this._overlap}},Base.each(Curve.evaluateMethods,function(name){var get=name+"At";this[name]=function(){var parameter=this.getParameter(),curve=this.getCurve();return parameter!=null&&curve&&curve[get](parameter,true)}},{preserve:true}),new function(){function insert(locations,loc,merge){var length=locations.length,l=0,r=length-1;function search(index,dir){for(var i=index+dir;i>=-1&&i<=length;i+=dir){var loc2=locations[(i%length+length)%length];if(!loc.getPoint().isClose(loc2.getPoint(),2e-7))break;if(loc.equals(loc2))return loc2}return null}while(l<=r){var m=l+r>>>1,loc2=locations[m],found;if(merge&&(found=loc.equals(loc2)?loc2:search(m,-1)||search(m,1))){if(loc._overlap){found._overlap=found._intersection._overlap=true}return found}var path1=loc.getPath(),path2=loc2.getPath(),diff=path1===path2?loc.getIndex()+loc.getParameter()-(loc2.getIndex()+loc2.getParameter()):path1._id-path2._id;if(diff<0){r=m-1}else{l=m+1}}locations.splice(l,0,loc);return loc}return{statics:{insert:insert,expand:function(locations){var expanded=locations.slice();for(var i=0,l=locations.length;i<l;i++){insert(expanded,locations[i]._intersection,false)}return expanded}}}});var PathItem=Item.extend({_class:"PathItem",initialize:function PathItem(){},getIntersections:function(path,include,_matrix,_returnFirst){var self=this===path||!path,matrix1=this._matrix.orNullIfIdentity(),matrix2=self?matrix1:(_matrix||path._matrix).orNullIfIdentity();if(!self&&!this.getBounds(matrix1).touches(path.getBounds(matrix2)))return[];var curves1=this.getCurves(),curves2=self?curves1:path.getCurves(),length1=curves1.length,length2=self?length1:curves2.length,values2=[],arrays=[],locations,path;for(var i=0;i<length2;i++)values2[i]=curves2[i].getValues(matrix2);for(var i=0;i<length1;i++){var curve1=curves1[i],values1=self?values2[i]:curve1.getValues(matrix1),path1=curve1.getPath();if(path1!==path){path=path1;locations=[];arrays.push(locations)}if(self){Curve._getSelfIntersection(values1,curve1,locations,{include:include,startConnected:length1===1&&curve1.getPoint1().equals(curve1.getPoint2())})}for(var j=self?i+1:0;j<length2;j++){if(_returnFirst&&locations.length)return locations;var curve2=curves2[j];Curve._getIntersections(values1,values2[j],curve1,curve2,locations,{include:include,startConnected:self&&curve1.getPrevious()===curve2,endConnected:self&&curve1.getNext()===curve2})}}locations=[];for(var i=0,l=arrays.length;i<l;i++){locations.push.apply(locations,arrays[i])}return locations},getCrossings:function(path){return this.getIntersections(path,function(inter){return inter.isCrossing()})},_asPathItem:function(){return this},setPathData:function(data){var parts=data.match(/[mlhvcsqtaz][^mlhvcsqtaz]*/gi),coords,relative=false,previous,control,current=new Point,start=new Point;function getCoord(index,coord){var val=+coords[index];if(relative)val+=current[coord];return val}function getPoint(index){return new Point(getCoord(index,"x"),getCoord(index+1,"y"))}this.clear();for(var i=0,l=parts&&parts.length;i<l;i++){var part=parts[i],command=part[0],lower=command.toLowerCase();coords=part.match(/[+-]?(?:\d*\.\d+|\d+\.?)(?:[eE][+-]?\d+)?/g);var length=coords&&coords.length;relative=command===lower;if(previous==="z"&&!/[mz]/.test(lower))this.moveTo(current=start);switch(lower){case"m":case"l":var move=lower==="m";for(var j=0;j<length;j+=2)this[j===0&&move?"moveTo":"lineTo"](current=getPoint(j));control=current;if(move)start=current;break;case"h":case"v":var coord=lower==="h"?"x":"y";for(var j=0;j<length;j++){current[coord]=getCoord(j,coord);this.lineTo(current)}control=current;break;case"c":for(var j=0;j<length;j+=6){this.cubicCurveTo(getPoint(j),control=getPoint(j+2),current=getPoint(j+4))}break;case"s":for(var j=0;j<length;j+=4){this.cubicCurveTo(/[cs]/.test(previous)?current.multiply(2).subtract(control):current,control=getPoint(j),current=getPoint(j+2));previous=lower}break;case"q":for(var j=0;j<length;j+=4){this.quadraticCurveTo(control=getPoint(j),current=getPoint(j+2))}break;case"t":for(var j=0;j<length;j+=2){this.quadraticCurveTo(control=/[qt]/.test(previous)?current.multiply(2).subtract(control):current,current=getPoint(j));previous=lower}break;case"a":for(var j=0;j<length;j+=7){this.arcTo(current=getPoint(j+5),new Size(+coords[j],+coords[j+1]),+coords[j+2],+coords[j+4],+coords[j+3])}break;case"z":this.closePath(true);break}previous=lower}},_canComposite:function(){return!(this.hasFill()&&this.hasStroke())},_contains:function(point){var winding=this._getWinding(point,false,true);return!!(this.getWindingRule()==="evenodd"?winding&1:winding)}});var Path=PathItem.extend({_class:"Path",_serializeFields:{segments:[],closed:false},initialize:function Path(arg){this._closed=false;this._segments=[];this._version=0;var segments=Array.isArray(arg)?typeof arg[0]==="object"?arg:arguments:arg&&(arg.size===undefined&&(arg.x!==undefined||arg.point!==undefined))?arguments:null;if(segments&&segments.length>0){this.setSegments(segments)}else{this._curves=undefined;this._selectedSegmentState=0;if(!segments&&typeof arg==="string"){this.setPathData(arg);arg=null}}this._initialize(!segments&&arg)},_equals:function(item){return this._closed===item._closed&&Base.equals(this._segments,item._segments)},clone:function(insert){var copy=new Path(Item.NO_INSERT);copy.setSegments(this._segments);copy._closed=this._closed;if(this._clockwise!==undefined)copy._clockwise=this._clockwise;return this._clone(copy,insert)},_changed:function _changed(flags){_changed.base.call(this,flags);if(flags&8){var parent=this._parent;if(parent)parent._currentPath=undefined;this._length=this._area=this._clockwise=this._monoCurves=undefined;if(flags&16){this._version++}else if(this._curves){for(var i=0,l=this._curves.length;i<l;i++)this._curves[i]._changed()}}else if(flags&32){this._bounds=undefined}},getStyle:function(){var parent=this._parent;return(parent instanceof CompoundPath?parent:this)._style},getSegments:function(){return this._segments},setSegments:function(segments){var fullySelected=this.isFullySelected();this._segments.length=0;this._selectedSegmentState=0;this._curves=undefined;if(segments&&segments.length>0)this._add(Segment.readAll(segments));if(fullySelected)this.setFullySelected(true)},getFirstSegment:function(){return this._segments[0]},getLastSegment:function(){return this._segments[this._segments.length-1]},getCurves:function(){var curves=this._curves,segments=this._segments;if(!curves){var length=this._countCurves();curves=this._curves=new Array(length);for(var i=0;i<length;i++)curves[i]=new Curve(this,segments[i],segments[i+1]||segments[0])}return curves},getFirstCurve:function(){return this.getCurves()[0]},getLastCurve:function(){var curves=this.getCurves();return curves[curves.length-1]},isClosed:function(){return this._closed},setClosed:function(closed){if(this._closed!=(closed=!!closed)){this._closed=closed;if(this._curves){var length=this._curves.length=this._countCurves();if(closed)this._curves[length-1]=new Curve(this,this._segments[length-1],this._segments[0])}this._changed(25)}}},{beans:true,getPathData:function(_matrix,_precision){var segments=this._segments,length=segments.length,f=new Formatter(_precision),coords=new Array(6),first=true,curX,curY,prevX,prevY,inX,inY,outX,outY,parts=[];function addSegment(segment,skipLine){segment._transformCoordinates(_matrix,coords,false);curX=coords[0];curY=coords[1];if(first){parts.push("M"+f.pair(curX,curY));first=false}else{inX=coords[2];inY=coords[3];if(inX===curX&&inY===curY&&outX===prevX&&outY===prevY){if(!skipLine)parts.push("l"+f.pair(curX-prevX,curY-prevY))}else{parts.push("c"+f.pair(outX-prevX,outY-prevY)+" "+f.pair(inX-prevX,inY-prevY)+" "+f.pair(curX-prevX,curY-prevY))}}prevX=curX;prevY=curY;outX=coords[4];outY=coords[5]}if(length===0)return"";for(var i=0;i<length;i++)addSegment(segments[i]);if(this._closed&&length>0){addSegment(segments[0],true);parts.push("z")}return parts.join("")}},{isEmpty:function(){return this._segments.length===0},_transformContent:function(matrix){var coords=new Array(6);for(var i=0,l=this._segments.length;i<l;i++)this._segments[i]._transformCoordinates(matrix,coords,true);return true},_add:function(segs,index){var segments=this._segments,curves=this._curves,amount=segs.length,append=index==null,index=append?segments.length:index;for(var i=0;i<amount;i++){var segment=segs[i];if(segment._path)segment=segs[i]=segment.clone();segment._path=this;segment._index=index+i;if(segment._selectionState)this._updateSelection(segment,0,segment._selectionState)}if(append){segments.push.apply(segments,segs)}else{segments.splice.apply(segments,[index,0].concat(segs));for(var i=index+amount,l=segments.length;i<l;i++)segments[i]._index=i}if(curves){var total=this._countCurves(),from=index+amount-1===total?index-1:index,start=from,to=Math.min(from+amount,total);if(segs._curves){curves.splice.apply(curves,[from,0].concat(segs._curves));start+=segs._curves.length}for(var i=start;i<to;i++)curves.splice(i,0,new Curve(this,null,null));this._adjustCurves(from,to)}this._changed(25);return segs},_adjustCurves:function(from,to){var segments=this._segments,curves=this._curves,curve;for(var i=from;i<to;i++){curve=curves[i];curve._path=this;curve._segment1=segments[i];curve._segment2=segments[i+1]||segments[0];curve._changed()}if(curve=curves[this._closed&&from===0?segments.length-1:from-1]){curve._segment2=segments[from]||segments[0];curve._changed()}if(curve=curves[to]){curve._segment1=segments[to];curve._changed()}},_countCurves:function(){var length=this._segments.length;return!this._closed&&length>0?length-1:length},add:function(segment1){return arguments.length>1&&typeof segment1!=="number"?this._add(Segment.readAll(arguments)):this._add([Segment.read(arguments)])[0]},insert:function(index,segment1){return arguments.length>2&&typeof segment1!=="number"?this._add(Segment.readAll(arguments,1),index):this._add([Segment.read(arguments,1)],index)[0]},addSegment:function(){return this._add([Segment.read(arguments)])[0]},insertSegment:function(index){return this._add([Segment.read(arguments,1)],index)[0]},addSegments:function(segments){return this._add(Segment.readAll(segments))},insertSegments:function(index,segments){return this._add(Segment.readAll(segments),index)},removeSegment:function(index){return this.removeSegments(index,index+1)[0]||null},removeSegments:function(from,to,_includeCurves){from=from||0;to=Base.pick(to,this._segments.length);var segments=this._segments,curves=this._curves,count=segments.length,removed=segments.splice(from,to-from),amount=removed.length;if(!amount)return removed;for(var i=0;i<amount;i++){var segment=removed[i];if(segment._selectionState)this._updateSelection(segment,segment._selectionState,0);segment._index=segment._path=null}for(var i=from,l=segments.length;i<l;i++)segments[i]._index=i;if(curves){var index=from>0&&to===count+(this._closed?1:0)?from-1:from,curves=curves.splice(index,amount);if(_includeCurves)removed._curves=curves.slice(1);this._adjustCurves(index,index)}this._changed(25);return removed},clear:"#removeSegments",hasHandles:function(){var segments=this._segments;for(var i=0,l=segments.length;i<l;i++){if(segments[i].hasHandles())return true}return false},clearHandles:function(){var segments=this._segments;for(var i=0,l=segments.length;i<l;i++)segments[i].clearHandles()},getLength:function(){if(this._length==null){var curves=this.getCurves(),length=0;for(var i=0,l=curves.length;i<l;i++)length+=curves[i].getLength();this._length=length}return this._length},getArea:function(){if(this._area==null){var segments=this._segments,count=segments.length,last=count-1,area=0;for(var i=0,l=this._closed?count:last;i<l;i++){area+=Curve.getArea(Curve.getValues(segments[i],segments[i<last?i+1:0]))}this._area=area}return this._area},isClockwise:function(){if(this._clockwise!==undefined)return this._clockwise;return this.getArea()>=0},setClockwise:function(clockwise){if(this.isClockwise()!=(clockwise=!!clockwise))this.reverse();this._clockwise=clockwise},isFullySelected:function(){var length=this._segments.length;return this._selected&&length>0&&this._selectedSegmentState===length*7},setFullySelected:function(selected){if(selected)this._selectSegments(true);this.setSelected(selected)},setSelected:function setSelected(selected){if(!selected)this._selectSegments(false);setSelected.base.call(this,selected)},_selectSegments:function(selected){var length=this._segments.length;this._selectedSegmentState=selected?length*7:0;for(var i=0;i<length;i++)this._segments[i]._selectionState=selected?7:0},_updateSelection:function(segment,oldState,newState){segment._selectionState=newState;var total=this._selectedSegmentState+=newState-oldState;if(total>0)this.setSelected(true)},flatten:function(maxDistance){var iterator=new PathIterator(this,64,.1),pos=0,step=iterator.length/Math.ceil(iterator.length/maxDistance),end=iterator.length+(this._closed?-step:step)/2;var segments=[];while(pos<=end){segments.push(new Segment(iterator.getPointAt(pos)));pos+=step}this.setSegments(segments)},reduce:function(){var curves=this.getCurves();for(var i=curves.length-1;i>=0;i--){var curve=curves[i];if(!curve.hasHandles()&&(curve.getLength()===0||curve.isCollinear(curve.getNext())))curve.remove()}return this},simplify:function(tolerance){if(this._segments.length>2){var fitter=new PathFitter(this,tolerance||2.5);this.setSegments(fitter.fit())}},split:function(index,parameter){if(parameter===null)return null;if(arguments.length===1){var arg=index;if(typeof arg==="number")arg=this.getLocationAt(arg);if(!arg)return null;index=arg.index;parameter=arg.parameter}var tMin=4e-7,tMax=1-tMin;if(parameter>=tMax){index++;parameter--}var curves=this.getCurves();if(index>=0&&index<curves.length){if(parameter>=tMin){curves[index++].divide(parameter,true)}var segs=this.removeSegments(index,this._segments.length,true),path;if(this._closed){this.setClosed(false);path=this}else{path=new Path(Item.NO_INSERT);path.insertAbove(this,true);this._clone(path)}path._add(segs,0);this.addSegment(segs[0]);return path}return null},reverse:function(){this._segments.reverse();for(var i=0,l=this._segments.length;i<l;i++){var segment=this._segments[i];var handleIn=segment._handleIn;segment._handleIn=segment._handleOut;segment._handleOut=handleIn;segment._index=i}this._curves=null;if(this._clockwise!==undefined)this._clockwise=!this._clockwise;this._changed(9)},join:function(path){if(path){var segments=path._segments,last1=this.getLastSegment(),last2=path.getLastSegment();if(!last2)return this;if(last1&&last1._point.equals(last2._point))path.reverse();var first2=path.getFirstSegment();if(last1&&last1._point.equals(first2._point)){last1.setHandleOut(first2._handleOut);this._add(segments.slice(1))}else{var first1=this.getFirstSegment();if(first1&&first1._point.equals(first2._point))path.reverse();last2=path.getLastSegment();if(first1&&first1._point.equals(last2._point)){first1.setHandleIn(last2._handleIn);this._add(segments.slice(0,segments.length-1),0)}else{this._add(segments.slice())}}if(path._closed)this._add([segments[0]]);path.remove()}var first=this.getFirstSegment(),last=this.getLastSegment();if(first!==last&&first._point.equals(last._point)){first.setHandleIn(last._handleIn);last.remove();this.setClosed(true)}return this},toShape:function(insert){if(!this._closed)return null;var segments=this._segments,type,size,radius,topCenter;function isCollinear(i,j){var seg1=segments[i],seg2=seg1.getNext(),seg3=segments[j],seg4=seg3.getNext();return seg1._handleOut.isZero()&&seg2._handleIn.isZero()&&seg3._handleOut.isZero()&&seg4._handleIn.isZero()&&seg2._point.subtract(seg1._point).isCollinear(seg4._point.subtract(seg3._point))}function isOrthogonal(i){var seg2=segments[i],seg1=seg2.getPrevious(),seg3=seg2.getNext();return seg1._handleOut.isZero()&&seg2._handleIn.isZero()&&seg2._handleOut.isZero()&&seg3._handleIn.isZero()&&seg2._point.subtract(seg1._point).isOrthogonal(seg3._point.subtract(seg2._point))}function isArc(i){var seg1=segments[i],seg2=seg1.getNext(),handle1=seg1._handleOut,handle2=seg2._handleIn,kappa=.5522847498307936;if(handle1.isOrthogonal(handle2)){var pt1=seg1._point,pt2=seg2._point,corner=new Line(pt1,handle1,true).intersect(new Line(pt2,handle2,true),true);return corner&&Numerical.isZero(handle1.getLength()/corner.subtract(pt1).getLength()-kappa)&&Numerical.isZero(handle2.getLength()/corner.subtract(pt2).getLength()-kappa)}return false}function getDistance(i,j){return segments[i]._point.getDistance(segments[j]._point)}if(!this.hasHandles()&&segments.length===4&&isCollinear(0,2)&&isCollinear(1,3)&&isOrthogonal(1)){type=Shape.Rectangle;size=new Size(getDistance(0,3),getDistance(0,1));topCenter=segments[1]._point.add(segments[2]._point).divide(2)}else if(segments.length===8&&isArc(0)&&isArc(2)&&isArc(4)&&isArc(6)&&isCollinear(1,5)&&isCollinear(3,7)){type=Shape.Rectangle;size=new Size(getDistance(1,6),getDistance(0,3));radius=size.subtract(new Size(getDistance(0,7),getDistance(1,2))).divide(2);topCenter=segments[3]._point.add(segments[4]._point).divide(2)}else if(segments.length===4&&isArc(0)&&isArc(1)&&isArc(2)&&isArc(3)){if(Numerical.isZero(getDistance(0,2)-getDistance(1,3))){type=Shape.Circle;radius=getDistance(0,2)/2}else{type=Shape.Ellipse;radius=new Size(getDistance(2,0)/2,getDistance(3,1)/2)}topCenter=segments[1]._point}if(type){var center=this.getPosition(true),shape=this._clone(new type({center:center,size:size,radius:radius,insert:false}),insert,false);shape.rotate(topCenter.subtract(center).getAngle()+90);return shape}return null},_hitTestSelf:function(point,options){var that=this,style=this.getStyle(),segments=this._segments,numSegments=segments.length,closed=this._closed,tolerancePadding=options._tolerancePadding,strokePadding=tolerancePadding,join,cap,miterLimit,area,loc,res,hitStroke=options.stroke&&style.hasStroke(),hitFill=options.fill&&style.hasFill(),hitCurves=options.curves,radius=hitStroke?style.getStrokeWidth()/2:hitFill&&options.tolerance>0||hitCurves?0:null;if(radius!==null){if(radius>0){join=style.getStrokeJoin();cap=style.getStrokeCap();miterLimit=radius*style.getMiterLimit();strokePadding=tolerancePadding.add(new Point(radius,radius))}else{join=cap="round"}}function isCloseEnough(pt,padding){return point.subtract(pt).divide(padding).length<=1}function checkSegmentPoint(seg,pt,name){if(!options.selected||pt.isSelected()){var anchor=seg._point;if(pt!==anchor)pt=pt.add(anchor);if(isCloseEnough(pt,strokePadding)){return new HitResult(name,that,{segment:seg,point:pt})}}}function checkSegmentPoints(seg,ends){return(ends||options.segments)&&checkSegmentPoint(seg,seg._point,"segment")||!ends&&options.handles&&(checkSegmentPoint(seg,seg._handleIn,"handle-in")||checkSegmentPoint(seg,seg._handleOut,"handle-out"))}function addToArea(point){area.add(point)}function checkSegmentStroke(segment){if(join!=="round"||cap!=="round"){area=new Path({internal:true,closed:true});if(closed||segment._index>0&&segment._index<numSegments-1){if(join!=="round"&&(segment._handleIn.isZero()||segment._handleOut.isZero()))Path._addBevelJoin(segment,join,radius,miterLimit,addToArea,true)}else if(cap!=="round"){Path._addSquareCap(segment,cap,radius,addToArea,true)}if(!area.isEmpty()){var loc;return area.contains(point)||(loc=area.getNearestLocation(point))&&isCloseEnough(loc.getPoint(),tolerancePadding)}}return isCloseEnough(segment._point,strokePadding)}if(options.ends&&!options.segments&&!closed){if(res=checkSegmentPoints(segments[0],true)||checkSegmentPoints(segments[numSegments-1],true))return res}else if(options.segments||options.handles){for(var i=0;i<numSegments;i++)if(res=checkSegmentPoints(segments[i]))return res}if(radius!==null){loc=this.getNearestLocation(point);if(loc){var parameter=loc.getParameter();if(parameter===0||parameter===1&&numSegments>1){if(!checkSegmentStroke(loc.getSegment()))loc=null}else if(!isCloseEnough(loc.getPoint(),strokePadding)){loc=null}}if(!loc&&join==="miter"&&numSegments>1){for(var i=0;i<numSegments;i++){var segment=segments[i];if(point.getDistance(segment._point)<=miterLimit&&checkSegmentStroke(segment)){loc=segment.getLocation();break}}}}return!loc&&hitFill&&this._contains(point)||loc&&!hitStroke&&!hitCurves?new HitResult("fill",this):loc?new HitResult(hitStroke?"stroke":"curve",this,{location:loc,point:loc.getPoint()}):null}},Base.each(Curve.evaluateMethods,function(name){this[name+"At"]=function(offset,isParameter){var loc=this.getLocationAt(offset,isParameter);return loc&&loc[name]()}},{beans:false,getLocationOf:function(){var point=Point.read(arguments),curves=this.getCurves();for(var i=0,l=curves.length;i<l;i++){var loc=curves[i].getLocationOf(point);if(loc)return loc}return null},getOffsetOf:function(){var loc=this.getLocationOf.apply(this,arguments);return loc?loc.getOffset():null},getLocationAt:function(offset,isParameter){var curves=this.getCurves(),length=0;if(isParameter){var index=~~offset,curve=curves[index];return curve?curve.getLocationAt(offset-index,true):null}for(var i=0,l=curves.length;i<l;i++){var start=length,curve=curves[i];length+=curve.getLength();if(length>offset){return curve.getLocationAt(offset-start)}}if(curves.length>0&&offset<=this.getLength())return new CurveLocation(curves[curves.length-1],1);return null},getNearestLocation:function(){var point=Point.read(arguments),curves=this.getCurves(),minDist=Infinity,minLoc=null;for(var i=0,l=curves.length;i<l;i++){var loc=curves[i].getNearestLocation(point);if(loc._distance<minDist){minDist=loc._distance;minLoc=loc}}return minLoc},getNearestPoint:function(){return this.getNearestLocation.apply(this,arguments).getPoint()}}),new function(){function drawHandles(ctx,segments,matrix,size){var half=size/2;function drawHandle(index){var hX=coords[index],hY=coords[index+1];if(pX!=hX||pY!=hY){ctx.beginPath();ctx.moveTo(pX,pY);ctx.lineTo(hX,hY);ctx.stroke();ctx.beginPath();ctx.arc(hX,hY,half,0,Math.PI*2,true);ctx.fill()}}var coords=new Array(6);for(var i=0,l=segments.length;i<l;i++){var segment=segments[i];segment._transformCoordinates(matrix,coords,false);var state=segment._selectionState,pX=coords[0],pY=coords[1];if(state&1)drawHandle(2);if(state&2)drawHandle(4);ctx.fillRect(pX-half,pY-half,size,size);if(!(state&4)){var fillStyle=ctx.fillStyle;ctx.fillStyle="#ffffff";ctx.fillRect(pX-half+1,pY-half+1,size-2,size-2);ctx.fillStyle=fillStyle}}}function drawSegments(ctx,path,matrix){var segments=path._segments,length=segments.length,coords=new Array(6),first=true,curX,curY,prevX,prevY,inX,inY,outX,outY;function drawSegment(segment){if(matrix){segment._transformCoordinates(matrix,coords,false);curX=coords[0];curY=coords[1]}else{var point=segment._point;curX=point._x;curY=point._y}if(first){ctx.moveTo(curX,curY);first=false}else{if(matrix){inX=coords[2];inY=coords[3]}else{var handle=segment._handleIn;inX=curX+handle._x;inY=curY+handle._y}if(inX===curX&&inY===curY&&outX===prevX&&outY===prevY){ctx.lineTo(curX,curY)}else{ctx.bezierCurveTo(outX,outY,inX,inY,curX,curY)}}prevX=curX;prevY=curY;if(matrix){outX=coords[4];outY=coords[5]}else{var handle=segment._handleOut;outX=prevX+handle._x;outY=prevY+handle._y}}for(var i=0;i<length;i++)drawSegment(segments[i]);if(path._closed&&length>0)drawSegment(segments[0])}return{_draw:function(ctx,param,strokeMatrix){var dontStart=param.dontStart,dontPaint=param.dontFinish||param.clip,style=this.getStyle(),hasFill=style.hasFill(),hasStroke=style.hasStroke(),dashArray=style.getDashArray(),dashLength=!paper.support.nativeDash&&hasStroke&&dashArray&&dashArray.length;if(!dontStart)ctx.beginPath();if(!dontStart&&this._currentPath){ctx.currentPath=this._currentPath}else if(hasFill||hasStroke&&!dashLength||dontPaint){drawSegments(ctx,this,strokeMatrix);if(this._closed)ctx.closePath();if(!dontStart)this._currentPath=ctx.currentPath}function getOffset(i){return dashArray[(i%dashLength+dashLength)%dashLength]}if(!dontPaint&&(hasFill||hasStroke)){this._setStyles(ctx);if(hasFill){ctx.fill(style.getWindingRule());ctx.shadowColor="rgba(0,0,0,0)"}if(hasStroke){if(dashLength){if(!dontStart)ctx.beginPath();var iterator=new PathIterator(this,32,.25,strokeMatrix),length=iterator.length,from=-style.getDashOffset(),to,i=0;from=from%length;while(from>0){from-=getOffset(i--)+getOffset(i--)}while(from<length){to=from+getOffset(i++);if(from>0||to>0)iterator.drawPart(ctx,Math.max(from,0),Math.max(to,0));from=to+getOffset(i++)}}ctx.stroke()}}},_drawSelected:function(ctx,matrix){ctx.beginPath();drawSegments(ctx,this,matrix);ctx.stroke();drawHandles(ctx,this._segments,matrix,paper.settings.handleSize)}}},new function(){function getFirstControlPoints(rhs){var n=rhs.length,x=[],tmp=[],b=2;x[0]=rhs[0]/b;for(var i=1;i<n;i++){tmp[i]=1/b;b=(i<n-1?4:2)-tmp[i];x[i]=(rhs[i]-x[i-1])/b}for(var i=1;i<n;i++){x[n-i-1]-=tmp[n-i]*x[n-i]}return x}return{smooth:function(){var segments=this._segments,size=segments.length,closed=this._closed,n=size,overlap=0;if(size<=2)return;if(closed){overlap=Math.min(size,4);n+=Math.min(size,overlap)*2}var knots=[];for(var i=0;i<size;i++)knots[i+overlap]=segments[i]._point;if(closed){for(var i=0;i<overlap;i++){knots[i]=segments[i+size-overlap]._point;knots[i+size+overlap]=segments[i]._point}}else{n--}var rhs=[];for(var i=1;i<n-1;i++)rhs[i]=4*knots[i]._x+2*knots[i+1]._x;rhs[0]=knots[0]._x+2*knots[1]._x;rhs[n-1]=3*knots[n-1]._x;var x=getFirstControlPoints(rhs);for(var i=1;i<n-1;i++)rhs[i]=4*knots[i]._y+2*knots[i+1]._y;rhs[0]=knots[0]._y+2*knots[1]._y;rhs[n-1]=3*knots[n-1]._y;var y=getFirstControlPoints(rhs);if(closed){for(var i=0,j=size;i<overlap;i++,j++){var f1=i/overlap,f2=1-f1,ie=i+overlap,je=j+overlap;x[j]=x[i]*f1+x[j]*f2;y[j]=y[i]*f1+y[j]*f2;x[je]=x[ie]*f2+x[je]*f1;y[je]=y[ie]*f2+y[je]*f1}n--}var handleIn=null;for(var i=overlap;i<=n-overlap;i++){var segment=segments[i-overlap];if(handleIn)segment.setHandleIn(handleIn.subtract(segment._point));if(i<n){segment.setHandleOut(new Point(x[i],y[i]).subtract(segment._point));handleIn=i<n-1?new Point(2*knots[i+1]._x-x[i+1],2*knots[i+1]._y-y[i+1]):new Point((knots[n]._x+x[n-1])/2,(knots[n]._y+y[n-1])/2)}}if(closed&&handleIn){var segment=this._segments[0];segment.setHandleIn(handleIn.subtract(segment._point))}}}},new function(){function getCurrentSegment(that){var segments=that._segments;if(segments.length===0)throw new Error("Use a moveTo() command first");return segments[segments.length-1]}return{moveTo:function(){var segments=this._segments;if(segments.length===1)this.removeSegment(0);if(!segments.length)this._add([new Segment(Point.read(arguments))])},moveBy:function(){throw new Error("moveBy() is unsupported on Path items.")},lineTo:function(){this._add([new Segment(Point.read(arguments))])},cubicCurveTo:function(){var handle1=Point.read(arguments),handle2=Point.read(arguments),to=Point.read(arguments),current=getCurrentSegment(this);current.setHandleOut(handle1.subtract(current._point));this._add([new Segment(to,handle2.subtract(to))])},quadraticCurveTo:function(){var handle=Point.read(arguments),to=Point.read(arguments),current=getCurrentSegment(this)._point;this.cubicCurveTo(handle.add(current.subtract(handle).multiply(1/3)),handle.add(to.subtract(handle).multiply(1/3)),to)},curveTo:function(){var through=Point.read(arguments),to=Point.read(arguments),t=Base.pick(Base.read(arguments),.5),t1=1-t,current=getCurrentSegment(this)._point,handle=through.subtract(current.multiply(t1*t1)).subtract(to.multiply(t*t)).divide(2*t*t1);if(handle.isNaN())throw new Error("Cannot put a curve through points with parameter = "+t);this.quadraticCurveTo(handle,to)},arcTo:function(){var current=getCurrentSegment(this),from=current._point,to=Point.read(arguments),through,peek=Base.peek(arguments),clockwise=Base.pick(peek,true),center,extent,vector,matrix;if(typeof clockwise==="boolean"){var middle=from.add(to).divide(2),through=middle.add(middle.subtract(from).rotate(clockwise?-90:90))}else if(Base.remain(arguments)<=2){through=to;to=Point.read(arguments)}else{var radius=Size.read(arguments);if(radius.isZero())return this.lineTo(to);var rotation=Base.read(arguments),clockwise=!!Base.read(arguments),large=!!Base.read(arguments),middle=from.add(to).divide(2),pt=from.subtract(middle).rotate(-rotation),x=pt.x,y=pt.y,abs=Math.abs,rx=abs(radius.width),ry=abs(radius.height),rxSq=rx*rx,rySq=ry*ry,xSq=x*x,ySq=y*y;var factor=Math.sqrt(xSq/rxSq+ySq/rySq);if(factor>1){rx*=factor;ry*=factor;rxSq=rx*rx;rySq=ry*ry}factor=(rxSq*rySq-rxSq*ySq-rySq*xSq)/(rxSq*ySq+rySq*xSq);if(abs(factor)<1e-12)factor=0;if(factor<0)throw new Error("Cannot create an arc with the given arguments");center=new Point(rx*y/ry,-ry*x/rx).multiply((large===clockwise?-1:1)*Math.sqrt(factor)).rotate(rotation).add(middle);matrix=(new Matrix).translate(center).rotate(rotation).scale(rx,ry);vector=matrix._inverseTransform(from);extent=vector.getDirectedAngle(matrix._inverseTransform(to));if(!clockwise&&extent>0)extent-=360;else if(clockwise&&extent<0)extent+=360}if(through){var l1=new Line(from.add(through).divide(2),through.subtract(from).rotate(90),true),l2=new Line(through.add(to).divide(2),to.subtract(through).rotate(90),true),line=new Line(from,to),throughSide=line.getSide(through);center=l1.intersect(l2,true);if(!center){if(!throughSide)return this.lineTo(to);throw new Error("Cannot create an arc with the given arguments")}vector=from.subtract(center);extent=vector.getDirectedAngle(to.subtract(center));var centerSide=line.getSide(center);if(centerSide===0){extent=throughSide*Math.abs(extent)}else if(throughSide===centerSide){extent+=extent<0?360:-360}}var ext=Math.abs(extent),count=ext>=360?4:Math.ceil(ext/90),inc=extent/count,half=inc*Math.PI/360,z=4/3*Math.sin(half)/(1+Math.cos(half)),segments=[];for(var i=0;i<=count;i++){var pt=to,out=null;if(i<count){out=vector.rotate(90).multiply(z);if(matrix){pt=matrix._transformPoint(vector);out=matrix._transformPoint(vector.add(out)).subtract(pt)}else{pt=center.add(vector)}}if(i===0){current.setHandleOut(out)}else{var _in=vector.rotate(-90).multiply(z);if(matrix){_in=matrix._transformPoint(vector.add(_in)).subtract(pt)}segments.push(new Segment(pt,_in,out))}vector=vector.rotate(inc)}this._add(segments)},lineBy:function(){var to=Point.read(arguments),current=getCurrentSegment(this)._point;this.lineTo(current.add(to))},curveBy:function(){var through=Point.read(arguments),to=Point.read(arguments),parameter=Base.read(arguments),current=getCurrentSegment(this)._point;this.curveTo(current.add(through),current.add(to),parameter)},cubicCurveBy:function(){var handle1=Point.read(arguments),handle2=Point.read(arguments),to=Point.read(arguments),current=getCurrentSegment(this)._point;this.cubicCurveTo(current.add(handle1),current.add(handle2),current.add(to))},quadraticCurveBy:function(){var handle=Point.read(arguments),to=Point.read(arguments),current=getCurrentSegment(this)._point;this.quadraticCurveTo(current.add(handle),current.add(to))},arcBy:function(){var current=getCurrentSegment(this)._point,point=current.add(Point.read(arguments)),clockwise=Base.pick(Base.peek(arguments),true);if(typeof clockwise==="boolean"){this.arcTo(point,clockwise)}else{this.arcTo(point,current.add(Point.read(arguments)))}},closePath:function(join){this.setClosed(true);if(join)this.join()}}},{_getBounds:function(getter,matrix){return Path[getter](this._segments,this._closed,this.getStyle(),matrix)},statics:{getBounds:function(segments,closed,style,matrix,strokePadding){var first=segments[0];if(!first)return new Rectangle;var coords=new Array(6),prevCoords=first._transformCoordinates(matrix,new Array(6),false),min=prevCoords.slice(0,2),max=min.slice(),roots=new Array(2);function processSegment(segment){segment._transformCoordinates(matrix,coords,false);for(var i=0;i<2;i++){Curve._addBounds(prevCoords[i],prevCoords[i+4],coords[i+2],coords[i],i,strokePadding?strokePadding[i]:0,min,max,roots)}var tmp=prevCoords;prevCoords=coords;coords=tmp}for(var i=1,l=segments.length;i<l;i++)processSegment(segments[i]);if(closed)processSegment(first);return new Rectangle(min[0],min[1],max[0]-min[0],max[1]-min[1])},getStrokeBounds:function(segments,closed,style,matrix){if(!style.hasStroke())return Path.getBounds(segments,closed,style,matrix);var length=segments.length-(closed?0:1),radius=style.getStrokeWidth()/2,padding=Path._getPenPadding(radius,matrix),bounds=Path.getBounds(segments,closed,style,matrix,padding),join=style.getStrokeJoin(),cap=style.getStrokeCap(),miterLimit=radius*style.getMiterLimit();var joinBounds=new Rectangle(new Size(padding).multiply(2));function add(point){bounds=bounds.include(matrix?matrix._transformPoint(point,point):point)}function addRound(segment){bounds=bounds.unite(joinBounds.setCenter(matrix?matrix._transformPoint(segment._point):segment._point))}function addJoin(segment,join){var handleIn=segment._handleIn,handleOut=segment._handleOut;if(join==="round"||!handleIn.isZero()&&!handleOut.isZero()&&handleIn.isCollinear(handleOut)){addRound(segment)}else{Path._addBevelJoin(segment,join,radius,miterLimit,add)}}function addCap(segment,cap){if(cap==="round"){addRound(segment)}else{Path._addSquareCap(segment,cap,radius,add)}}for(var i=1;i<length;i++)addJoin(segments[i],join);if(closed){addJoin(segments[0],join)}else if(length>0){addCap(segments[0],cap);addCap(segments[segments.length-1],cap)}return bounds},_getPenPadding:function(radius,matrix){if(!matrix)return[radius,radius];var mx=matrix.shiftless(),hor=mx.transform(new Point(radius,0)),ver=mx.transform(new Point(0,radius)),phi=hor.getAngleInRadians(),a=hor.getLength(),b=ver.getLength();var sin=Math.sin(phi),cos=Math.cos(phi),tan=Math.tan(phi),tx=-Math.atan(b*tan/a),ty=Math.atan(b/(tan*a));return[Math.abs(a*Math.cos(tx)*cos-b*Math.sin(tx)*sin),Math.abs(b*Math.sin(ty)*cos+a*Math.cos(ty)*sin)]},_addBevelJoin:function(segment,join,radius,miterLimit,addPoint,area){var curve2=segment.getCurve(),curve1=curve2.getPrevious(),point=curve2.getPointAt(0,true),normal1=curve1.getNormalAt(1,true),normal2=curve2.getNormalAt(0,true),step=normal1.getDirectedAngle(normal2)<0?-radius:radius;normal1.setLength(step);normal2.setLength(step);if(area){addPoint(point);addPoint(point.add(normal1))}if(join==="miter"){var corner=new Line(point.add(normal1),new Point(-normal1.y,normal1.x),true).intersect(new Line(point.add(normal2),new Point(-normal2.y,normal2.x),true),true);if(corner&&point.getDistance(corner)<=miterLimit){addPoint(corner);if(!area)return}}if(!area)addPoint(point.add(normal1));addPoint(point.add(normal2))},_addSquareCap:function(segment,cap,radius,addPoint,area){var point=segment._point,loc=segment.getLocation(),normal=loc.getNormal().multiply(radius);if(area){addPoint(point.subtract(normal));addPoint(point.add(normal))}if(cap==="square")point=point.add(normal.rotate(loc.getParameter()===0?-90:90));addPoint(point.add(normal));addPoint(point.subtract(normal))},getHandleBounds:function(segments,closed,style,matrix,strokePadding,joinPadding){var coords=new Array(6),x1=Infinity,x2=-x1,y1=x1,y2=x2;for(var i=0,l=segments.length;i<l;i++){var segment=segments[i];segment._transformCoordinates(matrix,coords,false);for(var j=0;j<6;j+=2){var padding=j===0?joinPadding:strokePadding,paddingX=padding?padding[0]:0,paddingY=padding?padding[1]:0,x=coords[j],y=coords[j+1],xn=x-paddingX,xx=x+paddingX,yn=y-paddingY,yx=y+paddingY;if(xn<x1)x1=xn;if(xx>x2)x2=xx;if(yn<y1)y1=yn;if(yx>y2)y2=yx}}return new Rectangle(x1,y1,x2-x1,y2-y1)},getRoughBounds:function(segments,closed,style,matrix){var strokeRadius=style.hasStroke()?style.getStrokeWidth()/2:0,joinRadius=strokeRadius;if(strokeRadius>0){if(style.getStrokeJoin()==="miter")joinRadius=strokeRadius*style.getMiterLimit();if(style.getStrokeCap()==="square")joinRadius=Math.max(joinRadius,strokeRadius*Math.sqrt(2))}return Path.getHandleBounds(segments,closed,style,matrix,Path._getPenPadding(strokeRadius,matrix),Path._getPenPadding(joinRadius,matrix))}}});Path.inject({statics:new function(){var kappa=.5522847498307936,ellipseSegments=[new Segment([-1,0],[0,kappa],[0,-kappa]),new Segment([0,-1],[-kappa,0],[kappa,0]),new Segment([1,0],[0,-kappa],[0,kappa]),new Segment([0,1],[kappa,0],[-kappa,0])];function createPath(segments,closed,args){var props=Base.getNamed(args),path=new Path(props&&props.insert===false&&Item.NO_INSERT);path._add(segments);path._closed=closed;return path.set(props)}function createEllipse(center,radius,args){var segments=new Array(4);for(var i=0;i<4;i++){var segment=ellipseSegments[i];segments[i]=new Segment(segment._point.multiply(radius).add(center),segment._handleIn.multiply(radius),segment._handleOut.multiply(radius))}return createPath(segments,true,args)}return{Line:function(){return createPath([new Segment(Point.readNamed(arguments,"from")),new Segment(Point.readNamed(arguments,"to"))],false,arguments)},Circle:function(){var center=Point.readNamed(arguments,"center"),radius=Base.readNamed(arguments,"radius");return createEllipse(center,new Size(radius),arguments)},Rectangle:function(){var rect=Rectangle.readNamed(arguments,"rectangle"),radius=Size.readNamed(arguments,"radius",0,{readNull:true}),bl=rect.getBottomLeft(true),tl=rect.getTopLeft(true),tr=rect.getTopRight(true),br=rect.getBottomRight(true),segments;if(!radius||radius.isZero()){segments=[new Segment(bl),new Segment(tl),new Segment(tr),new Segment(br)]}else{radius=Size.min(radius,rect.getSize(true).divide(2));var rx=radius.width,ry=radius.height,hx=rx*kappa,hy=ry*kappa;segments=[new Segment(bl.add(rx,0),null,[-hx,0]),new Segment(bl.subtract(0,ry),[0,hy]),new Segment(tl.add(0,ry),null,[0,-hy]),new Segment(tl.add(rx,0),[-hx,0],null),new Segment(tr.subtract(rx,0),null,[hx,0]),new Segment(tr.add(0,ry),[0,-hy],null),new Segment(br.subtract(0,ry),null,[0,hy]),new Segment(br.subtract(rx,0),[hx,0])]}return createPath(segments,true,arguments)},RoundRectangle:"#Rectangle",Ellipse:function(){var ellipse=Shape._readEllipse(arguments);return createEllipse(ellipse.center,ellipse.radius,arguments)},Oval:"#Ellipse",Arc:function(){var from=Point.readNamed(arguments,"from"),through=Point.readNamed(arguments,"through"),to=Point.readNamed(arguments,"to"),props=Base.getNamed(arguments),path=new Path(props&&props.insert===false&&Item.NO_INSERT);path.moveTo(from);path.arcTo(through,to);return path.set(props)},RegularPolygon:function(){var center=Point.readNamed(arguments,"center"),sides=Base.readNamed(arguments,"sides"),radius=Base.readNamed(arguments,"radius"),step=360/sides,three=!(sides%3),vector=new Point(0,three?-radius:radius),offset=three?-1:.5,segments=new Array(sides);for(var i=0;i<sides;i++)segments[i]=new Segment(center.add(vector.rotate((i+offset)*step)));return createPath(segments,true,arguments)},Star:function(){var center=Point.readNamed(arguments,"center"),points=Base.readNamed(arguments,"points")*2,radius1=Base.readNamed(arguments,"radius1"),radius2=Base.readNamed(arguments,"radius2"),step=360/points,vector=new Point(0,-1),segments=new Array(points);for(var i=0;i<points;i++)segments[i]=new Segment(center.add(vector.rotate(step*i).multiply(i%2?radius2:radius1)));return createPath(segments,true,arguments)}}}});var CompoundPath=PathItem.extend({_class:"CompoundPath",_serializeFields:{children:[]},initialize:function CompoundPath(arg){this._children=[];this._namedChildren={};if(!this._initialize(arg)){if(typeof arg==="string"){this.setPathData(arg)}else{this.addChildren(Array.isArray(arg)?arg:arguments)}}},insertChildren:function insertChildren(index,items,_preserve){for(var i=items.length-1;i>=0;i--){var item=items[i];if(item instanceof CompoundPath){items.splice.apply(items,[i,1].concat(item.removeChildren()));item.remove()}}items=insertChildren.base.call(this,index,items,_preserve,Path);for(var i=0,l=!_preserve&&items&&items.length;i<l;i++){var item=items[i];if(item._clockwise===undefined)item.setClockwise(item._index===0)}return items},reverse:function(){var children=this._children;for(var i=0,l=children.length;i<l;i++)children[i].reverse()},smooth:function(){for(var i=0,l=this._children.length;i<l;i++)this._children[i].smooth()},reduce:function reduce(){var children=this._children;for(var i=children.length-1;i>=0;i--){var path=children[i].reduce();if(path.isEmpty())children.splice(i,1)}if(children.length===0){var path=new Path(Item.NO_INSERT);path.insertAbove(this);path.setStyle(this._style);this.remove();return path}return reduce.base.call(this)},isClockwise:function(){var child=this.getFirstChild();return child&&child.isClockwise()},setClockwise:function(clockwise){if(this.isClockwise()!==!!clockwise)this.reverse()},getFirstSegment:function(){var first=this.getFirstChild();return first&&first.getFirstSegment()},getLastSegment:function(){var last=this.getLastChild();return last&&last.getLastSegment()},getCurves:function(){var children=this._children,curves=[];for(var i=0,l=children.length;i<l;i++)curves.push.apply(curves,children[i].getCurves());return curves},getFirstCurve:function(){var first=this.getFirstChild();return first&&first.getFirstCurve()},getLastCurve:function(){var last=this.getLastChild();return last&&last.getFirstCurve()},getArea:function(){var children=this._children,area=0;for(var i=0,l=children.length;i<l;i++)area+=children[i].getArea();return area}},{beans:true,getPathData:function(_matrix,_precision){var children=this._children,paths=[];for(var i=0,l=children.length;i<l;i++){var child=children[i],mx=child._matrix;paths.push(child.getPathData(_matrix&&!mx.isIdentity()?_matrix.chain(mx):_matrix,_precision))}return paths.join(" ")}},{_getChildHitTestOptions:function(options){return options.class===Path||options.type==="path"?options:new Base(options,{fill:false})},_draw:function(ctx,param,strokeMatrix){var children=this._children;if(children.length===0)return;if(this._currentPath){ctx.currentPath=this._currentPath}else{param=param.extend({dontStart:true,dontFinish:true});ctx.beginPath();for(var i=0,l=children.length;i<l;i++)children[i].draw(ctx,param,strokeMatrix);this._currentPath=ctx.currentPath}if(!param.clip){this._setStyles(ctx);var style=this._style;if(style.hasFill()){ctx.fill(style.getWindingRule());ctx.shadowColor="rgba(0,0,0,0)"}if(style.hasStroke())ctx.stroke()}},_drawSelected:function(ctx,matrix,selectedItems){var children=this._children;for(var i=0,l=children.length;i<l;i++){var child=children[i],mx=child._matrix;if(!selectedItems[child._id])child._drawSelected(ctx,mx.isIdentity()?matrix:matrix.chain(mx))}}},new function(){function getCurrentPath(that,check){var children=that._children;if(check&&children.length===0)throw new Error("Use a moveTo() command first");return children[children.length-1]}var fields={moveTo:function(){var current=getCurrentPath(this),path=current&&current.isEmpty()?current:new Path(Item.NO_INSERT);if(path!==current)this.addChild(path);path.moveTo.apply(path,arguments)},moveBy:function(){var current=getCurrentPath(this,true),last=current&&current.getLastSegment(),point=Point.read(arguments);this.moveTo(last?point.add(last._point):point)},closePath:function(join){getCurrentPath(this,true).closePath(join)}};Base.each(["lineTo","cubicCurveTo","quadraticCurveTo","curveTo","arcTo","lineBy","cubicCurveBy","quadraticCurveBy","curveBy","arcBy"],function(key){fields[key]=function(){var path=getCurrentPath(this,true);path[key].apply(path,arguments)}});return fields});PathItem.inject(new function(){var operators={unite:function(w){return w===1||w===0},intersect:function(w){return w===2},subtract:function(w){return w===1},exclude:function(w){return w===1}};function preparePath(path,resolve){var res=path.clone(false).reduce().transform(null,true,true);return resolve?res.resolveCrossings().reorient():res}function finishBoolean(ctor,paths,path1,path2,reduce){var result=new ctor(Item.NO_INSERT);result.addChildren(paths,true);if(reduce)result=result.reduce();result.insertAbove(path2&&path1.isSibling(path2)&&path1.getIndex()<path2.getIndex()?path2:path1);result.setStyle(path1._style);return result}function computeBoolean(path1,path2,operation){if(!path1._children&&!path1._closed)return computeOpenBoolean(path1,path2,operation);var _path1=preparePath(path1,true),_path2=path2&&path1!==path2&&preparePath(path2,true);if(_path2&&/^(subtract|exclude)$/.test(operation)^_path2.isClockwise()!==_path1.isClockwise())_path2.reverse();var intersections=CurveLocation.expand(_path1.getIntersections(_path2,function(inter){return _path2&&inter.isOverlap()||inter.isCrossing()}));divideLocations(intersections);var segments=[],monoCurves=[];function collect(paths){for(var i=0,l=paths.length;i<l;i++){var path=paths[i];segments.push.apply(segments,path._segments);monoCurves.push.apply(monoCurves,path._getMonoCurves())}}collect(_path1._children||[_path1]);if(_path2)collect(_path2._children||[_path2]);for(var i=0,l=intersections.length;i<l;i++){propagateWinding(intersections[i]._segment,_path1,_path2,monoCurves,operation)}for(var i=0,l=segments.length;i<l;i++){var segment=segments[i];if(segment._winding==null){propagateWinding(segment,_path1,_path2,monoCurves,operation)}}return finishBoolean(CompoundPath,tracePaths(segments,operation),path1,path2,true)}function computeOpenBoolean(path1,path2,operation){if(!path2||!path2._children&&!path2._closed||!/^(subtract|intersect)$/.test(operation))return null;var _path1=preparePath(path1,false),_path2=preparePath(path2,false),intersections=_path1.getIntersections(_path2,function(inter){return inter.isOverlap()||inter.isCrossing()}),sub=operation==="subtract",paths=[];function addPath(path){if(_path2.contains(path.getPointAt(path.getLength()/2))^sub){paths.unshift(path);return true}}for(var i=intersections.length-1;i>=0;i--){var path=intersections[i].split();if(path){if(addPath(path))path.getFirstSegment().setHandleIn(0,0);_path1.getLastSegment().setHandleOut(0,0)}}addPath(_path1);return finishBoolean(Group,paths,path1,path2)}function linkIntersections(from,to){var prev=from;while(prev){if(prev===to)return;prev=prev._prev}while(from._next&&from._next!==to)from=from._next;if(!from._next){while(to._prev)to=to._prev;from._next=to;to._prev=from}}function divideLocations(locations){var tMin=4e-7,tMax=1-tMin,noHandles=false,clearSegments=[],prevCurve,prevT;for(var i=locations.length-1;i>=0;i--){var loc=locations[i],curve=loc._curve,t=loc._parameter,origT=t;if(curve!==prevCurve){noHandles=!curve.hasHandles()}else if(prevT>0){t/=prevT}var segment;if(t<tMin){segment=curve._segment1}else if(t>tMax){segment=curve._segment2}else{segment=curve.divide(t,true,true)._segment1;if(noHandles)clearSegments.push(segment)}loc._setSegment(segment);var inter=segment._intersection,dest=loc._intersection;if(inter){linkIntersections(inter,dest);var other=inter;while(other){linkIntersections(other._intersection,inter);other=other._next}}else{segment._intersection=dest}prevCurve=curve;prevT=origT}for(var i=0,l=clearSegments.length;i<l;i++){clearSegments[i].clearHandles()}}function getWinding(point,curves,horizontal,testContains){var epsilon=2e-7,tMin=4e-7,tMax=1-tMin,px=point.x,py=point.y,windLeft=0,windRight=0,roots=[],abs=Math.abs;if(horizontal){var yTop=-Infinity,yBottom=Infinity,yBefore=py-epsilon,yAfter=py+epsilon;for(var i=0,l=curves.length;i<l;i++){var values=curves[i].values;if(Curve.solveCubic(values,0,px,roots,0,1)>0){for(var j=roots.length-1;j>=0;j--){var y=Curve.getPoint(values,roots[j]).y;if(y<yBefore&&y>yTop){yTop=y}else if(y>yAfter&&y<yBottom){yBottom=y}}}}yTop=(yTop+py)/2;yBottom=(yBottom+py)/2;if(yTop>-Infinity)windLeft=getWinding(new Point(px,yTop),curves,false,testContains);if(yBottom<Infinity)windRight=getWinding(new Point(px,yBottom),curves,false,testContains)}else{var xBefore=px-epsilon,xAfter=px+epsilon;var startCounted=false,prevCurve,prevT;for(var i=0,l=curves.length;i<l;i++){var curve=curves[i],values=curve.values,winding=curve.winding;if(winding&&(winding===1&&py>=values[1]&&py<=values[7]||py>=values[7]&&py<=values[1])&&Curve.solveCubic(values,1,py,roots,0,1)===1){var t=roots[0];if(!(t>tMax&&startCounted&&curve.next!==curves[i+1]||t<tMin&&prevT>tMax&&curve.previous===prevCurve)){var x=Curve.getPoint(values,t).x,slope=Curve.getTangent(values,t).y,counted=false;if(Numerical.isZero(slope)&&!Curve.isStraight(values)||t<tMin&&slope*Curve.getTangent(curve.previous.values,1).y<0||t>tMax&&slope*Curve.getTangent(curve.next.values,0).y<0){if(testContains&&x>=xBefore&&x<=xAfter){++windLeft;++windRight;counted=true}}else if(x<=xBefore){windLeft+=winding;counted=true}else if(x>=xAfter){windRight+=winding;counted=true}if(curve.previous!==curves[i-1])startCounted=t<tMin&&counted}prevCurve=curve;prevT=t}}}return Math.max(abs(windLeft),abs(windRight))}function propagateWinding(segment,path1,path2,monoCurves,operation){var epsilon=2e-7,chain=[],start=segment,totalLength=0,windingSum=0;do{var curve=segment.getCurve(),length=curve.getLength();chain.push({segment:segment,curve:curve,length:length});totalLength+=length;segment=segment.getNext()}while(segment&&!segment._intersection&&segment!==start);for(var i=0;i<3;i++){var length=totalLength*(i+1)/4;for(var k=0,m=chain.length;k<m;k++){var node=chain[k],curveLength=node.length;if(length<=curveLength){if(length<epsilon||curveLength-length<epsilon)length=curveLength/2;var curve=node.curve,path=curve._path,parent=path._parent,pt=curve.getPointAt(length),hor=curve.isHorizontal();if(parent instanceof CompoundPath)path=parent;windingSum+=operation==="subtract"&&path2&&(path===path1&&path2._getWinding(pt,hor)||path===path2&&!path1._getWinding(pt,hor))?0:getWinding(pt,monoCurves,hor);break}length-=curveLength}}var winding=Math.round(windingSum/3);for(var j=chain.length-1;j>=0;j--)chain[j].segment._winding=winding}function tracePaths(segments,operation){var paths=[],start,otherStart,operator=operators[operation],overlapWinding={unite:{1:2},intersect:{2:1}}[operation];function isValid(seg,adjusted){if(seg._visited)return false;if(!operator)return true;var winding=seg._winding,inter=seg._intersection;if(inter&&adjusted&&overlapWinding&&inter.isOverlap())winding=overlapWinding[winding]||winding;return operator(winding)}function isStart(seg){return seg===start||seg===otherStart}function findBestIntersection(inter,strict){if(!inter._next)return inter;while(inter){var seg=inter._segment,nextSeg=seg.getNext(),nextInter=nextSeg._intersection;if(isStart(nextSeg)||!seg._visited&&!nextSeg._visited&&(!operator||(!strict||isValid(seg))&&(!(strict&&nextInter&&nextInter.isOverlap())&&isValid(nextSeg)||!strict&&nextInter&&isValid(nextInter._segment))))return inter;inter=inter._next}return null}function findStartSegment(inter,next){while(inter){var seg=inter._segment;if(isStart(seg))return seg;inter=inter[next?"_next":"_prev"]}}for(var i=0,l=segments.length;i<l;i++){var seg=segments[i],path=null,finished=false;if(!isValid(seg,true))continue;start=otherStart=null;while(!finished){var inter=seg._intersection,handleIn=path&&seg._handleIn;inter=inter&&(findBestIntersection(inter,true)||findBestIntersection(inter,false))||inter;var other=inter&&inter._segment;if(other&&isValid(other))seg=other;if(seg._visited){finished=isStart(seg);if(!finished&&inter){var found=findStartSegment(inter,true)||findStartSegment(inter,false);if(found){seg=found;finished=true}}break}if(!path){path=new Path(Item.NO_INSERT);start=seg;otherStart=other}path.add(new Segment(seg._point,handleIn,seg._handleOut));seg._visited=true;seg=seg.getNext();finished=isStart(seg)}if(finished){path.firstSegment.setHandleIn(seg._handleIn);path.setClosed(true)}else if(path){console.error("Boolean operation resulted in open path","segments =",path._segments.length,"length =",path.getLength());path=null}if(path&&(path._segments.length>8||!Numerical.isZero(path.getArea()))){paths.push(path);path=null}}return paths}return{_getWinding:function(point,horizontal,testContains){return getWinding(point,this._getMonoCurves(),horizontal,testContains)},unite:function(path){return computeBoolean(this,path,"unite")},intersect:function(path){return computeBoolean(this,path,"intersect")},subtract:function(path){return computeBoolean(this,path,"subtract")},exclude:function(path){return computeBoolean(this,path,"exclude")},divide:function(path){return finishBoolean(Group,[this.subtract(path),this.intersect(path)],this,path,true)},resolveCrossings:function(){var crossings=this.getCrossings();if(!crossings.length)return this;divideLocations(CurveLocation.expand(crossings));var paths=this._children||[this],segments=[];for(var i=0,l=paths.length;i<l;i++){segments.push.apply(segments,paths[i]._segments)}return finishBoolean(CompoundPath,tracePaths(segments),this,null,false)}}});Path.inject({_getMonoCurves:function(){var monoCurves=this._monoCurves,prevCurve;function insertCurve(v){var y0=v[1],y1=v[7],curve={values:v,winding:y0===y1?0:y0>y1?-1:1,previous:prevCurve,next:null};if(prevCurve)prevCurve.next=curve;monoCurves.push(curve);prevCurve=curve}function handleCurve(v){if(Curve.getLength(v)===0)return;var y0=v[1],y1=v[3],y2=v[5],y3=v[7];if(Curve.isStraight(v)){insertCurve(v)}else{var a=3*(y1-y2)-y0+y3,b=2*(y0+y2)-4*y1,c=y1-y0,tMin=4e-7,tMax=1-tMin,roots=[],n=Numerical.solveQuadratic(a,b,c,roots,tMin,tMax);if(n===0){insertCurve(v)}else{roots.sort();var t=roots[0],parts=Curve.subdivide(v,t);insertCurve(parts[0]);if(n>1){t=(roots[1]-t)/(1-t);parts=Curve.subdivide(parts[1],t);insertCurve(parts[0])}insertCurve(parts[1])}}}if(!monoCurves){monoCurves=this._monoCurves=[];var curves=this.getCurves(),segments=this._segments;for(var i=0,l=curves.length;i<l;i++)handleCurve(curves[i].getValues());if(!this._closed&&segments.length>1){var p1=segments[segments.length-1]._point,p2=segments[0]._point,p1x=p1._x,p1y=p1._y,p2x=p2._x,p2y=p2._y;handleCurve([p1x,p1y,p1x,p1y,p2x,p2y,p2x,p2y])}if(monoCurves.length>0){var first=monoCurves[0],last=monoCurves[monoCurves.length-1];first.previous=last;last.next=first}}return monoCurves},getInteriorPoint:function(){var bounds=this.getBounds(),point=bounds.getCenter(true);if(!this.contains(point)){var curves=this._getMonoCurves(),roots=[],y=point.y,xIntercepts=[];for(var i=0,l=curves.length;i<l;i++){var values=curves[i].values;if((curves[i].winding===1&&y>=values[1]&&y<=values[7]||y>=values[7]&&y<=values[1])&&Curve.solveCubic(values,1,y,roots,0,1)>0){for(var j=roots.length-1;j>=0;j--)xIntercepts.push(Curve.getPoint(values,roots[j]).x)}if(xIntercepts.length>1)break}point.x=(xIntercepts[0]+xIntercepts[1])/2}return point},reorient:function(){this.setClockwise(true);return this}});CompoundPath.inject({_getMonoCurves:function(){var children=this._children,monoCurves=[];for(var i=0,l=children.length;i<l;i++)monoCurves.push.apply(monoCurves,children[i]._getMonoCurves());return monoCurves},reorient:function(){var children=this.removeChildren().sort(function(a,b){return b.getBounds().getArea()-a.getBounds().getArea()});if(children.length>0){this.addChildren(children);var clockwise=children[0].isClockwise();for(var i=1,l=children.length;i<l;i++){var point=children[i].getInteriorPoint(),counters=0;for(var j=i-1;j>=0;j--){if(children[j].contains(point))counters++}children[i].setClockwise(counters%2===0&&clockwise)}}return this}});var PathIterator=Base.extend({_class:"PathIterator",initialize:function(path,maxRecursion,tolerance,matrix){var curves=[],parts=[],length=0,minDifference=1/(maxRecursion||32),segments=path._segments,segment1=segments[0],segment2;function addCurve(segment1,segment2){var curve=Curve.getValues(segment1,segment2,matrix);curves.push(curve);computeParts(curve,segment1._index,0,1)}function computeParts(curve,index,minT,maxT){if(maxT-minT>minDifference&&!Curve.isFlatEnough(curve,tolerance||.25)){var split=Curve.subdivide(curve,.5),halfT=(minT+maxT)/2;computeParts(split[0],index,minT,halfT);computeParts(split[1],index,halfT,maxT)}else{var x=curve[6]-curve[0],y=curve[7]-curve[1],dist=Math.sqrt(x*x+y*y);if(dist>1e-6){length+=dist;parts.push({offset:length,value:maxT,index:index})}}}for(var i=1,l=segments.length;i<l;i++){segment2=segments[i];addCurve(segment1,segment2);segment1=segment2}if(path._closed)addCurve(segment2,segments[0]);this.curves=curves;this.parts=parts;this.length=length;this.index=0},getParameterAt:function(offset){var i,j=this.index;for(;;){i=j;if(j==0||this.parts[--j].offset<offset)break}for(var l=this.parts.length;i<l;i++){var part=this.parts[i];if(part.offset>=offset){this.index=i;var prev=this.parts[i-1];var prevVal=prev&&prev.index==part.index?prev.value:0,prevLen=prev?prev.offset:0;return{value:prevVal+(part.value-prevVal)*(offset-prevLen)/(part.offset-prevLen),index:part.index}}}var part=this.parts[this.parts.length-1];return{value:1,index:part.index}},drawPart:function(ctx,from,to){from=this.getParameterAt(from);to=this.getParameterAt(to);for(var i=from.index;i<=to.index;i++){var curve=Curve.getPart(this.curves[i],i==from.index?from.value:0,i==to.index?to.value:1);if(i==from.index)ctx.moveTo(curve[0],curve[1]);ctx.bezierCurveTo.apply(ctx,curve.slice(2))}}},Base.each(Curve.evaluateMethods,function(name){this[name+"At"]=function(offset,weighted){var param=this.getParameterAt(offset);return Curve[name](this.curves[param.index],param.value,weighted)}},{}));var PathFitter=Base.extend({initialize:function(path,error){var points=this.points=[],segments=path._segments,prev;for(var i=0,l=segments.length;i<l;i++){var point=segments[i].point.clone();if(!prev||!prev.equals(point)){points.push(point);prev=point}}if(path._closed){this.closed=true;points.unshift(points[points.length-1]);points.push(points[1])}this.error=error},fit:function(){var points=this.points,length=points.length,segments=this.segments=length>0?[new Segment(points[0])]:[];if(length>1)this.fitCubic(0,length-1,points[1].subtract(points[0]).normalize(),points[length-2].subtract(points[length-1]).normalize());if(this.closed){segments.shift();segments.pop()}return segments},fitCubic:function(first,last,tan1,tan2){if(last-first==1){var pt1=this.points[first],pt2=this.points[last],dist=pt1.getDistance(pt2)/3;this.addCurve([pt1,pt1.add(tan1.normalize(dist)),pt2.add(tan2.normalize(dist)),pt2]);return}var uPrime=this.chordLengthParameterize(first,last),maxError=Math.max(this.error,this.error*this.error),split,parametersInOrder=true;for(var i=0;i<=4;i++){var curve=this.generateBezier(first,last,uPrime,tan1,tan2);var max=this.findMaxError(first,last,curve,uPrime);if(max.error<this.error&&parametersInOrder){this.addCurve(curve);return}split=max.index;if(max.error>=maxError)break;parametersInOrder=this.reparameterize(first,last,uPrime,curve);maxError=max.error}var V1=this.points[split-1].subtract(this.points[split]),V2=this.points[split].subtract(this.points[split+1]),tanCenter=V1.add(V2).divide(2).normalize();this.fitCubic(first,split,tan1,tanCenter);this.fitCubic(split,last,tanCenter.negate(),tan2)},addCurve:function(curve){var prev=this.segments[this.segments.length-1];prev.setHandleOut(curve[1].subtract(curve[0]));this.segments.push(new Segment(curve[3],curve[2].subtract(curve[3])))},generateBezier:function(first,last,uPrime,tan1,tan2){var epsilon=1e-12,pt1=this.points[first],pt2=this.points[last],C=[[0,0],[0,0]],X=[0,0];for(var i=0,l=last-first+1;i<l;i++){var u=uPrime[i],t=1-u,b=3*u*t,b0=t*t*t,b1=b*t,b2=b*u,b3=u*u*u,a1=tan1.normalize(b1),a2=tan2.normalize(b2),tmp=this.points[first+i].subtract(pt1.multiply(b0+b1)).subtract(pt2.multiply(b2+b3));C[0][0]+=a1.dot(a1);C[0][1]+=a1.dot(a2);C[1][0]=C[0][1];C[1][1]+=a2.dot(a2);X[0]+=a1.dot(tmp);X[1]+=a2.dot(tmp)}var detC0C1=C[0][0]*C[1][1]-C[1][0]*C[0][1],alpha1,alpha2;if(Math.abs(detC0C1)>epsilon){var detC0X=C[0][0]*X[1]-C[1][0]*X[0],detXC1=X[0]*C[1][1]-X[1]*C[0][1];alpha1=detXC1/detC0C1;alpha2=detC0X/detC0C1}else{var c0=C[0][0]+C[0][1],c1=C[1][0]+C[1][1];if(Math.abs(c0)>epsilon){alpha1=alpha2=X[0]/c0}else if(Math.abs(c1)>epsilon){alpha1=alpha2=X[1]/c1}else{alpha1=alpha2=0}}var segLength=pt2.getDistance(pt1),eps=epsilon*segLength,handle1,handle2;if(alpha1<eps||alpha2<eps){alpha1=alpha2=segLength/3}else{var line=pt2.subtract(pt1);handle1=tan1.normalize(alpha1);handle2=tan2.normalize(alpha2);if(handle1.dot(line)-handle2.dot(line)>segLength*segLength){alpha1=alpha2=segLength/3;handle1=handle2=null}}return[pt1,pt1.add(handle1||tan1.normalize(alpha1)),pt2.add(handle2||tan2.normalize(alpha2)),pt2]},reparameterize:function(first,last,u,curve){for(var i=first;i<=last;i++){u[i-first]=this.findRoot(curve,this.points[i],u[i-first])}for(var i=1,l=u.length;i<l;i++){if(u[i]<=u[i-1])return false}return true},findRoot:function(curve,point,u){var curve1=[],curve2=[];for(var i=0;i<=2;i++){curve1[i]=curve[i+1].subtract(curve[i]).multiply(3)}for(var i=0;i<=1;i++){curve2[i]=curve1[i+1].subtract(curve1[i]).multiply(2)}var pt=this.evaluate(3,curve,u),pt1=this.evaluate(2,curve1,u),pt2=this.evaluate(1,curve2,u),diff=pt.subtract(point),df=pt1.dot(pt1)+diff.dot(pt2);if(Math.abs(df)<1e-6)return u;return u-diff.dot(pt1)/df},evaluate:function(degree,curve,t){var tmp=curve.slice();for(var i=1;i<=degree;i++){for(var j=0;j<=degree-i;j++){tmp[j]=tmp[j].multiply(1-t).add(tmp[j+1].multiply(t))}}return tmp[0]},chordLengthParameterize:function(first,last){var u=[0];for(var i=first+1;i<=last;i++){u[i-first]=u[i-first-1]+this.points[i].getDistance(this.points[i-1])}for(var i=1,m=last-first;i<=m;i++){u[i]/=u[m]}return u},findMaxError:function(first,last,curve,u){var index=Math.floor((last-first+1)/2),maxDist=0;for(var i=first+1;i<last;i++){var P=this.evaluate(3,curve,u[i-first]);var v=P.subtract(this.points[i]);var dist=v.x*v.x+v.y*v.y;if(dist>=maxDist){maxDist=dist;index=i}}return{error:maxDist,index:index}}});var TextItem=Item.extend({_class:"TextItem",_boundsSelected:true,_applyMatrix:false,_canApplyMatrix:false,_serializeFields:{content:null},_boundsGetter:"getBounds",initialize:function TextItem(arg){this._content="";this._lines=[];var hasProps=arg&&Base.isPlainObject(arg)&&arg.x===undefined&&arg.y===undefined;this._initialize(hasProps&&arg,!hasProps&&Point.read(arguments))},_equals:function(item){return this._content===item._content},_clone:function _clone(copy,insert,includeMatrix){copy.setContent(this._content);return _clone.base.call(this,copy,insert,includeMatrix)},getContent:function(){return this._content},setContent:function(content){this._content=""+content;this._lines=this._content.split(/\r\n|\n|\r/gm);this._changed(265)},isEmpty:function(){return!this._content},getCharacterStyle:"#getStyle",setCharacterStyle:"#setStyle",getParagraphStyle:"#getStyle",setParagraphStyle:"#setStyle"});var PointText=TextItem.extend({_class:"PointText",initialize:function PointText(){TextItem.apply(this,arguments)},clone:function(insert){return this._clone(new PointText(Item.NO_INSERT),insert)},getPoint:function(){var point=this._matrix.getTranslation();return new LinkedPoint(point.x,point.y,this,"setPoint")},setPoint:function(){var point=Point.read(arguments);this.translate(point.subtract(this._matrix.getTranslation()))},_draw:function(ctx){if(!this._content)return;this._setStyles(ctx);var style=this._style,lines=this._lines,leading=style.getLeading(),shadowColor=ctx.shadowColor;ctx.font=style.getFontStyle();ctx.textAlign=style.getJustification();for(var i=0,l=lines.length;i<l;i++){ctx.shadowColor=shadowColor;var line=lines[i];if(style.hasFill()){ctx.fillText(line,0,0);ctx.shadowColor="rgba(0,0,0,0)"}if(style.hasStroke())ctx.strokeText(line,0,0);ctx.translate(0,leading)}},_getBounds:function(getter,matrix){var style=this._style,lines=this._lines,numLines=lines.length,justification=style.getJustification(),leading=style.getLeading(),width=this.getView().getTextWidth(style.getFontStyle(),lines),x=0;if(justification!=="left")x-=width/(justification==="center"?2:1);var bounds=new Rectangle(x,numLines?-.75*leading:0,width,numLines*leading);return matrix?matrix._transformBounds(bounds,bounds):bounds}});var Color=Base.extend(new function(){var types={gray:["gray"],rgb:["red","green","blue"],hsb:["hue","saturation","brightness"],hsl:["hue","saturation","lightness"],gradient:["gradient","origin","destination","highlight"]};var componentParsers={},colorCache={},colorCtx;function fromCSS(string){var match=string.match(/^#(\w{1,2})(\w{1,2})(\w{1,2})$/),components;if(match){components=[0,0,0];for(var i=0;i<3;i++){var value=match[i+1];components[i]=parseInt(value.length==1?value+value:value,16)/255}}else if(match=string.match(/^rgba?\((.*)\)$/)){components=match[1].split(",");for(var i=0,l=components.length;i<l;i++){var value=+components[i];components[i]=i<3?value/255:value}}else{var cached=colorCache[string];if(!cached){if(!colorCtx){colorCtx=CanvasProvider.getContext(1,1);colorCtx.globalCompositeOperation="copy"}colorCtx.fillStyle="rgba(0,0,0,0)";colorCtx.fillStyle=string;colorCtx.fillRect(0,0,1,1);var data=colorCtx.getImageData(0,0,1,1).data;cached=colorCache[string]=[data[0]/255,data[1]/255,data[2]/255]}components=cached.slice()}return components}var hsbIndices=[[0,3,1],[2,0,1],[1,0,3],[1,2,0],[3,1,0],[0,1,2]];var converters={"rgb-hsb":function(r,g,b){var max=Math.max(r,g,b),min=Math.min(r,g,b),delta=max-min,h=delta===0?0:(max==r?(g-b)/delta+(g<b?6:0):max==g?(b-r)/delta+2:(r-g)/delta+4)*60;return[h,max===0?0:delta/max,max]},"hsb-rgb":function(h,s,b){h=(h/60%6+6)%6;var i=Math.floor(h),f=h-i,i=hsbIndices[i],v=[b,b*(1-s),b*(1-s*f),b*(1-s*(1-f))];return[v[i[0]],v[i[1]],v[i[2]]]},"rgb-hsl":function(r,g,b){var max=Math.max(r,g,b),min=Math.min(r,g,b),delta=max-min,achromatic=delta===0,h=achromatic?0:(max==r?(g-b)/delta+(g<b?6:0):max==g?(b-r)/delta+2:(r-g)/delta+4)*60,l=(max+min)/2,s=achromatic?0:l<.5?delta/(max+min):delta/(2-max-min);return[h,s,l]},"hsl-rgb":function(h,s,l){h=(h/360%1+1)%1;if(s===0)return[l,l,l];var t3s=[h+1/3,h,h-1/3],t2=l<.5?l*(1+s):l+s-l*s,t1=2*l-t2,c=[];for(var i=0;i<3;i++){var t3=t3s[i];if(t3<0)t3+=1;if(t3>1)t3-=1;c[i]=6*t3<1?t1+(t2-t1)*6*t3:2*t3<1?t2:3*t3<2?t1+(t2-t1)*(2/3-t3)*6:t1}return c},"rgb-gray":function(r,g,b){return[r*.2989+g*.587+b*.114]},"gray-rgb":function(g){return[g,g,g]},"gray-hsb":function(g){return[0,0,g]},"gray-hsl":function(g){return[0,0,g]},"gradient-rgb":function(){return[]},"rgb-gradient":function(){return[]}};return Base.each(types,function(properties,type){componentParsers[type]=[];Base.each(properties,function(name,index){var part=Base.capitalize(name),hasOverlap=/^(hue|saturation)$/.test(name),parser=componentParsers[type][index]=name==="gradient"?function(value){var current=this._components[0];value=Gradient.read(Array.isArray(value)?value:arguments,0,{readNull:true});if(current!==value){if(current)current._removeOwner(this);if(value)value._addOwner(this)}return value}:type==="gradient"?function(){return Point.read(arguments,0,{readNull:name==="highlight",clone:true})}:function(value){return value==null||isNaN(value)?0:value};this["get"+part]=function(){return this._type===type||hasOverlap&&/^hs[bl]$/.test(this._type)?this._components[index]:this._convert(type)[index]};this["set"+part]=function(value){if(this._type!==type&&!(hasOverlap&&/^hs[bl]$/.test(this._type))){this._components=this._convert(type);this._properties=types[type];this._type=type}this._components[index]=parser.call(this,value);this._changed()}},this)},{_class:"Color",_readIndex:true,initialize:function Color(arg){var slice=Array.prototype.slice,args=arguments,read=0,type,components,alpha,values;if(Array.isArray(arg)){args=arg;arg=args[0]}var argType=arg!=null&&typeof arg;if(argType==="string"&&arg in types){type=arg;arg=args[1];if(Array.isArray(arg)){components=arg;alpha=args[2]}else{if(this.__read)read=1;args=slice.call(args,1);argType=typeof arg}}if(!components){values=argType==="number"?args:argType==="object"&&arg.length!=null?arg:null;if(values){if(!type)type=values.length>=3?"rgb":"gray";var length=types[type].length;alpha=values[length];if(this.__read)read+=values===arguments?length+(alpha!=null?1:0):1;if(values.length>length)values=slice.call(values,0,length)}else if(argType==="string"){type="rgb";components=fromCSS(arg);if(components.length===4){alpha=components[3];components.length--}}else if(argType==="object"){if(arg.constructor===Color){type=arg._type;components=arg._components.slice();alpha=arg._alpha;if(type==="gradient"){for(var i=1,l=components.length;i<l;i++){var point=components[i];if(point)components[i]=point.clone()}}}else if(arg.constructor===Gradient){type="gradient";values=args}else{type="hue"in arg?"lightness"in arg?"hsl":"hsb":"gradient"in arg||"stops"in arg||"radial"in arg?"gradient":"gray"in arg?"gray":"rgb";var properties=types[type],parsers=componentParsers[type];this._components=components=[];for(var i=0,l=properties.length;i<l;i++){var value=arg[properties[i]];if(value==null&&i===0&&type==="gradient"&&"stops"in arg){value={stops:arg.stops,radial:arg.radial}}value=parsers[i].call(this,value);if(value!=null)components[i]=value}alpha=arg.alpha}}if(this.__read&&type)read=1}this._type=type||"rgb";this._id=UID.get(Color);if(!components){this._components=components=[];var parsers=componentParsers[this._type];for(var i=0,l=parsers.length;i<l;i++){var value=parsers[i].call(this,values&&values[i]);if(value!=null)components[i]=value}}this._components=components;this._properties=types[this._type];this._alpha=alpha;if(this.__read)this.__read=read},_serialize:function(options,dictionary){var components=this.getComponents();return Base.serialize(/^(gray|rgb)$/.test(this._type)?components:[this._type].concat(components),options,true,dictionary)},_changed:function(){this._canvasStyle=null;if(this._owner)this._owner._changed(65)},_convert:function(type){var converter;return this._type===type?this._components.slice():(converter=converters[this._type+"-"+type])?converter.apply(this,this._components):converters["rgb-"+type].apply(this,converters[this._type+"-rgb"].apply(this,this._components))},convert:function(type){return new Color(type,this._convert(type),this._alpha)},getType:function(){return this._type},setType:function(type){this._components=this._convert(type);this._properties=types[type];this._type=type},getComponents:function(){var components=this._components.slice();if(this._alpha!=null)components.push(this._alpha);return components},getAlpha:function(){return this._alpha!=null?this._alpha:1},setAlpha:function(alpha){this._alpha=alpha==null?null:Math.min(Math.max(alpha,0),1);this._changed()},hasAlpha:function(){return this._alpha!=null},equals:function(color){var col=Base.isPlainValue(color,true)?Color.read(arguments):color;return col===this||col&&this._class===col._class&&this._type===col._type&&this._alpha===col._alpha&&Base.equals(this._components,col._components)||false},toString:function(){var properties=this._properties,parts=[],isGradient=this._type==="gradient",f=Formatter.instance;for(var i=0,l=properties.length;i<l;i++){var value=this._components[i];if(value!=null)parts.push(properties[i]+": "+(isGradient?value:f.number(value)))}if(this._alpha!=null)parts.push("alpha: "+f.number(this._alpha));return"{ "+parts.join(", ")+" }"},toCSS:function(hex){var components=this._convert("rgb"),alpha=hex||this._alpha==null?1:this._alpha;function convert(val){return Math.round((val<0?0:val>1?1:val)*255)}components=[convert(components[0]),convert(components[1]),convert(components[2])];if(alpha<1)components.push(alpha<0?0:alpha);return hex?"#"+((1<<24)+(components[0]<<16)+(components[1]<<8)+components[2]).toString(16).slice(1):(components.length==4?"rgba(":"rgb(")+components.join(",")+")"},toCanvasStyle:function(ctx){if(this._canvasStyle)return this._canvasStyle;if(this._type!=="gradient")return this._canvasStyle=this.toCSS();var components=this._components,gradient=components[0],stops=gradient._stops,origin=components[1],destination=components[2],canvasGradient;if(gradient._radial){var radius=destination.getDistance(origin),highlight=components[3];if(highlight){var vector=highlight.subtract(origin);if(vector.getLength()>radius)highlight=origin.add(vector.normalize(radius-.1))}var start=highlight||origin;canvasGradient=ctx.createRadialGradient(start.x,start.y,0,origin.x,origin.y,radius)}else{canvasGradient=ctx.createLinearGradient(origin.x,origin.y,destination.x,destination.y)}for(var i=0,l=stops.length;i<l;i++){var stop=stops[i];canvasGradient.addColorStop(stop._rampPoint,stop._color.toCanvasStyle())}return this._canvasStyle=canvasGradient},transform:function(matrix){if(this._type==="gradient"){var components=this._components;for(var i=1,l=components.length;i<l;i++){var point=components[i];matrix._transformPoint(point,point,true)}this._changed()}},statics:{_types:types,random:function(){var random=Math.random;return new Color(random(),random(),random())}}})},new function(){var operators={add:function(a,b){return a+b},subtract:function(a,b){return a-b},multiply:function(a,b){return a*b},divide:function(a,b){return a/b}};return Base.each(operators,function(operator,name){this[name]=function(color){color=Color.read(arguments);var type=this._type,components1=this._components,components2=color._convert(type);for(var i=0,l=components1.length;i<l;i++)components2[i]=operator(components1[i],components2[i]);return new Color(type,components2,this._alpha!=null?operator(this._alpha,color.getAlpha()):null)}},{})});var Gradient=Base.extend({_class:"Gradient",initialize:function Gradient(stops,radial){this._id=UID.get();if(stops&&this._set(stops))stops=radial=null;if(!this._stops)this.setStops(stops||["white","black"]);if(this._radial==null)this.setRadial(typeof radial==="string"&&radial==="radial"||radial||false)},_serialize:function(options,dictionary){return dictionary.add(this,function(){return Base.serialize([this._stops,this._radial],options,true,dictionary)})},_changed:function(){for(var i=0,l=this._owners&&this._owners.length;i<l;i++)this._owners[i]._changed()},_addOwner:function(color){if(!this._owners)this._owners=[];this._owners.push(color)},_removeOwner:function(color){var index=this._owners?this._owners.indexOf(color):-1;if(index!=-1){this._owners.splice(index,1);if(this._owners.length===0)this._owners=undefined}},clone:function(){var stops=[];for(var i=0,l=this._stops.length;i<l;i++)stops[i]=this._stops[i].clone();return new Gradient(stops,this._radial)},getStops:function(){return this._stops},setStops:function(stops){if(this.stops){for(var i=0,l=this._stops.length;i<l;i++)this._stops[i]._owner=undefined}if(stops.length<2)throw new Error("Gradient stop list needs to contain at least two stops.");this._stops=GradientStop.readAll(stops,0,{clone:true});for(var i=0,l=this._stops.length;i<l;i++){var stop=this._stops[i];stop._owner=this;if(stop._defaultRamp)stop.setRampPoint(i/(l-1))}this._changed()},getRadial:function(){return this._radial},setRadial:function(radial){this._radial=radial;this._changed()},equals:function(gradient){if(gradient===this)return true;if(gradient&&this._class===gradient._class&&this._stops.length===gradient._stops.length){for(var i=0,l=this._stops.length;i<l;i++){if(!this._stops[i].equals(gradient._stops[i]))return false}return true}return false}});var GradientStop=Base.extend({_class:"GradientStop",initialize:function GradientStop(arg0,arg1){if(arg0){var color,rampPoint;if(arg1===undefined&&Array.isArray(arg0)){color=arg0[0];rampPoint=arg0[1]}else if(arg0.color){color=arg0.color;rampPoint=arg0.rampPoint}else{color=arg0;rampPoint=arg1}this.setColor(color);this.setRampPoint(rampPoint)}},clone:function(){return new GradientStop(this._color.clone(),this._rampPoint)},_serialize:function(options,dictionary){return Base.serialize([this._color,this._rampPoint],options,true,dictionary)},_changed:function(){if(this._owner)this._owner._changed(65)},getRampPoint:function(){return this._rampPoint},setRampPoint:function(rampPoint){this._defaultRamp=rampPoint==null;this._rampPoint=rampPoint||0;this._changed()},getColor:function(){return this._color},setColor:function(color){this._color=Color.read(arguments);if(this._color===color)this._color=color.clone();this._color._owner=this;this._changed()},equals:function(stop){return stop===this||stop&&this._class===stop._class&&this._color.equals(stop._color)&&this._rampPoint==stop._rampPoint||false}});var Style=Base.extend(new function(){var defaults={fillColor:undefined,strokeColor:undefined,strokeWidth:1,strokeCap:"butt",strokeJoin:"miter",strokeScaling:true,miterLimit:10,dashOffset:0,dashArray:[],windingRule:"nonzero",shadowColor:undefined,shadowBlur:0,shadowOffset:new Point,selectedColor:undefined,fontFamily:"sans-serif",fontWeight:"normal",fontSize:12,font:"sans-serif",leading:null,justification:"left"};var flags={strokeWidth:97,strokeCap:97,strokeJoin:97,strokeScaling:105,miterLimit:97,fontFamily:9,fontWeight:9,fontSize:9,font:9,leading:9,justification:9};var item={beans:true},fields={_defaults:defaults,_textDefaults:new Base(defaults,{fillColor:new Color}),beans:true};Base.each(defaults,function(value,key){var isColor=/Color$/.test(key),isPoint=key==="shadowOffset",part=Base.capitalize(key),flag=flags[key],set="set"+part,get="get"+part;fields[set]=function(value){var owner=this._owner,children=owner&&owner._children;if(children&&children.length>0&&!(owner instanceof CompoundPath)){for(var i=0,l=children.length;i<l;i++)children[i]._style[set](value)}else{var old=this._values[key];if(old!==value){if(isColor){if(old)old._owner=undefined;if(value&&value.constructor===Color){if(value._owner)value=value.clone();value._owner=owner}}this._values[key]=value;if(owner)owner._changed(flag||65)}}};fields[get]=function(_dontMerge){var owner=this._owner,children=owner&&owner._children,value;if(!children||children.length===0||_dontMerge||owner instanceof CompoundPath){var value=this._values[key];if(value===undefined){value=this._defaults[key];if(value&&value.clone)value=value.clone()}else{var ctor=isColor?Color:isPoint?Point:null;if(ctor&&!(value&&value.constructor===ctor)){this._values[key]=value=ctor.read([value],0,{readNull:true,clone:true});if(value&&isColor)value._owner=owner}}return value}for(var i=0,l=children.length;i<l;i++){var childValue=children[i]._style[get]();if(i===0){value=childValue}else if(!Base.equals(value,childValue)){return undefined}}return value};item[get]=function(_dontMerge){return this._style[get](_dontMerge)};item[set]=function(value){this._style[set](value)}});Item.inject(item);return fields},{_class:"Style",initialize:function Style(style,_owner,_project){this._values={};this._owner=_owner;this._project=_owner&&_owner._project||_project||paper.project;if(_owner instanceof TextItem)this._defaults=this._textDefaults;if(style)this.set(style)},set:function(style){var isStyle=style instanceof Style,values=isStyle?style._values:style;if(values){for(var key in values){if(key in this._defaults){var value=values[key];this[key]=value&&isStyle&&value.clone?value.clone():value}}}},equals:function(style){return style===this||style&&this._class===style._class&&Base.equals(this._values,style._values)||false},hasFill:function(){return!!this.getFillColor()},hasStroke:function(){return!!this.getStrokeColor()&&this.getStrokeWidth()>0},hasShadow:function(){return!!this.getShadowColor()&&this.getShadowBlur()>0},getView:function(){return this._project.getView()},getFontStyle:function(){var fontSize=this.getFontSize();return this.getFontWeight()+" "+fontSize+(/[a-z]/i.test(fontSize+"")?" ":"px ")+this.getFontFamily()},getFont:"#getFontFamily",setFont:"#setFontFamily",getLeading:function getLeading(){var leading=getLeading.base.call(this),fontSize=this.getFontSize();if(/pt|em|%|px/.test(fontSize))fontSize=this.getView().getPixelSize(fontSize);return leading!=null?leading:fontSize*1.2}});var DomElement=new function(){function handlePrefix(el,name,set,value){var prefixes=["","webkit","moz","Moz","ms","o"],suffix=name[0].toUpperCase()+name.substring(1);for(var i=0;i<6;i++){var prefix=prefixes[i],key=prefix?prefix+suffix:name;if(key in el){if(set){el[key]=value}else{return el[key]}break}}}return{getStyles:function(el){var doc=el&&el.nodeType!==9?el.ownerDocument:el,view=doc&&doc.defaultView;return view&&view.getComputedStyle(el,"")},getBounds:function(el,viewport){var doc=el.ownerDocument,body=doc.body,html=doc.documentElement,rect;try{rect=el.getBoundingClientRect()}catch(e){rect={left:0,top:0,width:0,height:0}}var x=rect.left-(html.clientLeft||body.clientLeft||0),y=rect.top-(html.clientTop||body.clientTop||0);if(!viewport){var view=doc.defaultView;x+=view.pageXOffset||html.scrollLeft||body.scrollLeft;y+=view.pageYOffset||html.scrollTop||body.scrollTop}return new Rectangle(x,y,rect.width,rect.height)},getViewportBounds:function(el){var doc=el.ownerDocument,view=doc.defaultView,html=doc.documentElement;return new Rectangle(0,0,view.innerWidth||html.clientWidth,view.innerHeight||html.clientHeight)},getOffset:function(el,viewport){return DomElement.getBounds(el,viewport).getPoint()},getSize:function(el){return DomElement.getBounds(el,true).getSize()},isInvisible:function(el){return DomElement.getSize(el).equals(new Size(0,0))},isInView:function(el){return!DomElement.isInvisible(el)&&DomElement.getViewportBounds(el).intersects(DomElement.getBounds(el,true))},getPrefixed:function(el,name){return handlePrefix(el,name)},setPrefixed:function(el,name,value){if(typeof name==="object"){for(var key in name)handlePrefix(el,key,true,name[key])}else{handlePrefix(el,name,true,value)}}}};var DomEvent={add:function(el,events){for(var type in events){var func=events[type],parts=type.split(/[\s,]+/g);for(var i=0,l=parts.length;i<l;i++)el.addEventListener(parts[i],func,false)}},remove:function(el,events){for(var type in events){var func=events[type],parts=type.split(/[\s,]+/g);for(var i=0,l=parts.length;i<l;i++)el.removeEventListener(parts[i],func,false)}},getPoint:function(event){var pos=event.targetTouches?event.targetTouches.length?event.targetTouches[0]:event.changedTouches[0]:event;return new Point(pos.pageX||pos.clientX+document.documentElement.scrollLeft,pos.pageY||pos.clientY+document.documentElement.scrollTop)},getTarget:function(event){return event.target||event.srcElement},getRelatedTarget:function(event){return event.relatedTarget||event.toElement},getOffset:function(event,target){return DomEvent.getPoint(event).subtract(DomElement.getOffset(target||DomEvent.getTarget(event)))},stop:function(event){event.stopPropagation();event.preventDefault()}};DomEvent.requestAnimationFrame=new function(){var nativeRequest=DomElement.getPrefixed(window,"requestAnimationFrame"),requested=false,callbacks=[],focused=true,timer;DomEvent.add(window,{focus:function(){focused=true},blur:function(){focused=false}});function handleCallbacks(){for(var i=callbacks.length-1;i>=0;i--){var entry=callbacks[i],func=entry[0],el=entry[1];if(!el||(PaperScope.getAttribute(el,"keepalive")=="true"||focused)&&DomElement.isInView(el)){callbacks.splice(i,1);func()}}if(nativeRequest){if(callbacks.length){nativeRequest(handleCallbacks)}else{requested=false}}}return function(callback,element){callbacks.push([callback,element]);if(nativeRequest){if(!requested){nativeRequest(handleCallbacks);requested=true}}else if(!timer){timer=setInterval(handleCallbacks,1e3/60)}}};var View=Base.extend(Emitter,{_class:"View",initialize:function View(project,element){this._project=project;this._scope=project._scope;this._element=element;var size;if(!this._pixelRatio)this._pixelRatio=window.devicePixelRatio||1;this._id=element.getAttribute("id");if(this._id==null)element.setAttribute("id",this._id="view-"+View._id++);DomEvent.add(element,this._viewEvents);var none="none";DomElement.setPrefixed(element.style,{userSelect:none,touchAction:none,touchCallout:none,contentZooming:none,userDrag:none,tapHighlightColor:"rgba(0,0,0,0)"});function getSize(name){return element[name]||parseInt(element.getAttribute(name),10)}function getCanvasSize(){var size=DomElement.getSize(element);return size.isNaN()||size.isZero()?new Size(getSize("width"),getSize("height")):size}if(PaperScope.hasAttribute(element,"resize")){var that=this;DomEvent.add(window,this._windowEvents={resize:function(){that.setViewSize(getCanvasSize())}})}this._setViewSize(size=getCanvasSize());if(PaperScope.hasAttribute(element,"stats")&&typeof Stats!=="undefined"){this._stats=new Stats;var stats=this._stats.domElement,style=stats.style,offset=DomElement.getOffset(element);style.position="absolute";style.left=offset.x+"px";style.top=offset.y+"px";document.body.appendChild(stats)}View._views.push(this);View._viewsById[this._id]=this;this._viewSize=size;(this._matrix=new Matrix)._owner=this;this._zoom=1;if(!View._focused)View._focused=this;this._frameItems={};this._frameItemCount=0},remove:function(){if(!this._project)return false;if(View._focused===this)View._focused=null;View._views.splice(View._views.indexOf(this),1);delete View._viewsById[this._id];if(this._project._view===this)this._project._view=null;DomEvent.remove(this._element,this._viewEvents);DomEvent.remove(window,this._windowEvents);this._element=this._project=null;this.off("frame");this._animate=false;this._frameItems={};return true},_events:Base.each(["onResize","onMouseDown","onMouseUp","onMouseMove"],function(name){this[name]={install:function(type){this._installEvent(type)},uninstall:function(type){this._uninstallEvent(type)}}},{onFrame:{install:function(){this.play()},uninstall:function(){this.pause()}}}),_animate:false,_time:0,_count:0,_requestFrame:function(){var that=this;DomEvent.requestAnimationFrame(function(){that._requested=false;if(!that._animate)return;that._requestFrame();that._handleFrame()},this._element);this._requested=true},_handleFrame:function(){paper=this._scope;var now=Date.now()/1e3,delta=this._before?now-this._before:0;this._before=now;this._handlingFrame=true;this.emit("frame",new Base({delta:delta,time:this._time+=delta,count:this._count++}));if(this._stats)this._stats.update();this._handlingFrame=false;this.update()},_animateItem:function(item,animate){var items=this._frameItems;if(animate){items[item._id]={item:item,time:0,count:0};if(++this._frameItemCount===1)this.on("frame",this._handleFrameItems)}else{delete items[item._id];if(--this._frameItemCount===0){this.off("frame",this._handleFrameItems)}}},_handleFrameItems:function(event){for(var i in this._frameItems){var entry=this._frameItems[i];entry.item.emit("frame",new Base(event,{time:entry.time+=event.delta,count:entry.count++}))}},_update:function(){this._project._needsUpdate=true;if(this._handlingFrame)return;if(this._animate){this._handleFrame()}else{this.update()}},_changed:function(flags){if(flags&1)this._project._needsUpdate=true},_transform:function(matrix){this._matrix.concatenate(matrix);this._bounds=null;this._update()},getElement:function(){return this._element},getPixelRatio:function(){return this._pixelRatio},getResolution:function(){return this._pixelRatio*72},getViewSize:function(){var size=this._viewSize;return new LinkedSize(size.width,size.height,this,"setViewSize")},setViewSize:function(){var size=Size.read(arguments),delta=size.subtract(this._viewSize);if(delta.isZero())return;this._viewSize.set(size.width,size.height);this._setViewSize(size);this._bounds=null;this.emit("resize",{size:size,delta:delta});this._update()},_setViewSize:function(size){var element=this._element;element.width=size.width;element.height=size.height},getBounds:function(){if(!this._bounds)this._bounds=this._matrix.inverted()._transformBounds(new Rectangle(new Point,this._viewSize));return this._bounds},getSize:function(){return this.getBounds().getSize()},getCenter:function(){return this.getBounds().getCenter()},setCenter:function(){var center=Point.read(arguments);this.scrollBy(center.subtract(this.getCenter()))},getZoom:function(){return this._zoom},setZoom:function(zoom){this._transform((new Matrix).scale(zoom/this._zoom,this.getCenter()));this._zoom=zoom},isVisible:function(){return DomElement.isInView(this._element)},scrollBy:function(){this._transform((new Matrix).translate(Point.read(arguments).negate()))},play:function(){this._animate=true;if(!this._requested)this._requestFrame()},pause:function(){this._animate=false},draw:function(){this.update()},projectToView:function(){return this._matrix._transformPoint(Point.read(arguments))},viewToProject:function(){return this._matrix._inverseTransform(Point.read(arguments))}},{statics:{_views:[],_viewsById:{},_id:0,create:function(project,element){if(typeof element==="string")element=document.getElementById(element);return new CanvasView(project,element)}}},new function(){var tool,prevFocus,tempFocus,dragging=false;function getView(event){var target=DomEvent.getTarget(event);return target.getAttribute&&View._viewsById[target.getAttribute("id")]}function viewToProject(view,event){return view.viewToProject(DomEvent.getOffset(event,view._element))}function updateFocus(){if(!View._focused||!View._focused.isVisible()){for(var i=0,l=View._views.length;i<l;i++){var view=View._views[i];if(view&&view.isVisible()){View._focused=tempFocus=view;break}}}}function handleMouseMove(view,point,event){view._handleEvent("mousemove",point,event);var tool=view._scope.tool;if(tool){tool._handleEvent(dragging&&tool.responds("mousedrag")?"mousedrag":"mousemove",point,event)}view.update();return tool}var navigator=window.navigator,mousedown,mousemove,mouseup;if(navigator.pointerEnabled||navigator.msPointerEnabled){mousedown="pointerdown MSPointerDown";mousemove="pointermove MSPointerMove";mouseup="pointerup pointercancel MSPointerUp MSPointerCancel"}else{mousedown="touchstart";mousemove="touchmove";mouseup="touchend touchcancel";if(!("ontouchstart"in window&&navigator.userAgent.match(/mobile|tablet|ip(ad|hone|od)|android|silk/i))){mousedown+=" mousedown";mousemove+=" mousemove";mouseup+=" mouseup"}}var viewEvents={"selectstart dragstart":function(event){if(dragging)event.preventDefault()}};var docEvents={mouseout:function(event){var view=View._focused,target=DomEvent.getRelatedTarget(event);if(view&&(!target||target.nodeName==="HTML"))handleMouseMove(view,viewToProject(view,event),event)},scroll:updateFocus};viewEvents[mousedown]=function(event){var view=View._focused=getView(event),point=viewToProject(view,event);dragging=true;view._handleEvent("mousedown",point,event);if(tool=view._scope.tool)tool._handleEvent("mousedown",point,event);view.update()};docEvents[mousemove]=function(event){var view=View._focused;if(!dragging){var target=getView(event);if(target){if(view!==target)handleMouseMove(view,viewToProject(view,event),event);prevFocus=view;view=View._focused=tempFocus=target}else if(tempFocus&&tempFocus===view){view=View._focused=prevFocus;updateFocus()}}if(view){var point=viewToProject(view,event);if(dragging||view.getBounds().contains(point))tool=handleMouseMove(view,point,event)}};docEvents[mouseup]=function(event){var view=View._focused;if(!view||!dragging)return;var point=viewToProject(view,event);dragging=false;view._handleEvent("mouseup",point,event);if(tool)tool._handleEvent("mouseup",point,event);view.update()};DomEvent.add(document,docEvents);DomEvent.add(window,{load:updateFocus});var mouseFlags={mousedown:{mousedown:1,mousedrag:1,click:1,doubleclick:1},mouseup:{mouseup:1,mousedrag:1,click:1,doubleclick:1},mousemove:{mousedrag:1,mousemove:1,mouseenter:1,mouseleave:1}};return{_viewEvents:viewEvents,_handleEvent:function(){},_installEvent:function(type){var counters=this._eventCounters;if(counters){for(var key in mouseFlags){counters[key]=(counters[key]||0)+(mouseFlags[key][type]||0)}}},_uninstallEvent:function(type){var counters=this._eventCounters;if(counters){for(var key in mouseFlags)counters[key]-=mouseFlags[key][type]||0}},statics:{updateFocus:updateFocus}}});var CanvasView=View.extend({_class:"CanvasView",initialize:function CanvasView(project,canvas){if(!(canvas instanceof HTMLCanvasElement)){var size=Size.read(arguments,1);if(size.isZero())throw new Error("Cannot create CanvasView with the provided argument: "+[].slice.call(arguments,1));canvas=CanvasProvider.getCanvas(size)}this._context=canvas.getContext("2d");this._eventCounters={};this._pixelRatio=1;if(!/^off|false$/.test(PaperScope.getAttribute(canvas,"hidpi"))){var deviceRatio=window.devicePixelRatio||1,backingStoreRatio=DomElement.getPrefixed(this._context,"backingStorePixelRatio")||1;this._pixelRatio=deviceRatio/backingStoreRatio}View.call(this,project,canvas)},_setViewSize:function(size){var element=this._element,pixelRatio=this._pixelRatio,width=size.width,height=size.height;element.width=width*pixelRatio;element.height=height*pixelRatio;if(pixelRatio!==1){if(!PaperScope.hasAttribute(element,"resize")){var style=element.style;style.width=width+"px";style.height=height+"px"}this._context.scale(pixelRatio,pixelRatio)}},getPixelSize:function(size){var browser=paper.browser,pixels;if(browser&&browser.firefox){var parent=this._element.parentNode,temp=document.createElement("div");temp.style.fontSize=size;parent.appendChild(temp);pixels=parseFloat(DomElement.getStyles(temp).fontSize);parent.removeChild(temp)}else{var ctx=this._context,prevFont=ctx.font;ctx.font=size+" serif";pixels=parseFloat(ctx.font);ctx.font=prevFont}return pixels},getTextWidth:function(font,lines){var ctx=this._context,prevFont=ctx.font,width=0;ctx.font=font;for(var i=0,l=lines.length;i<l;i++)width=Math.max(width,ctx.measureText(lines[i]).width);ctx.font=prevFont;return width},update:function(force){var project=this._project;if(!project||!force&&!project._needsUpdate)return false;var ctx=this._context,size=this._viewSize;ctx.clearRect(0,0,size.width+1,size.height+1);project.draw(ctx,this._matrix,this._pixelRatio);project._needsUpdate=false;return true}},new function(){var downPoint,lastPoint,overPoint,downItem,lastItem,overItem,dragItem,dblClick,clickTime;function callEvent(view,type,event,point,target,lastPoint){var item=target,mouseEvent;function call(obj){if(obj.responds(type)){if(!mouseEvent){mouseEvent=new MouseEvent(type,event,point,target,lastPoint?point.subtract(lastPoint):null)}if(obj.emit(type,mouseEvent)&&mouseEvent.isStopped){event.preventDefault();return true}}}while(item){if(call(item))return true;item=item.getParent()}if(call(view))return true;return false}return{_handleEvent:function(type,point,event){if(!this._eventCounters[type])return;var project=this._project,hit=project.hitTest(point,{tolerance:0,fill:true,stroke:true}),item=hit&&hit.item,stopped=false;switch(type){case"mousedown":stopped=callEvent(this,type,event,point,item);dblClick=lastItem==item&&Date.now()-clickTime<300;downItem=lastItem=item;downPoint=lastPoint=overPoint=point;dragItem=!stopped&&item;while(dragItem&&!dragItem.responds("mousedrag"))dragItem=dragItem._parent;break;case"mouseup":stopped=callEvent(this,type,event,point,item,downPoint);if(dragItem){if(lastPoint&&!lastPoint.equals(point))callEvent(this,"mousedrag",event,point,dragItem,lastPoint);if(item!==dragItem){overPoint=point;callEvent(this,"mousemove",event,point,item,overPoint)}}if(!stopped&&item&&item===downItem){clickTime=Date.now();callEvent(this,dblClick&&downItem.responds("doubleclick")?"doubleclick":"click",event,downPoint,item);dblClick=false}downItem=dragItem=null;break;case"mousemove":if(dragItem)stopped=callEvent(this,"mousedrag",event,point,dragItem,lastPoint);if(!stopped){if(item!==overItem)overPoint=point;stopped=callEvent(this,type,event,point,item,overPoint)}lastPoint=overPoint=point;if(item!==overItem){callEvent(this,"mouseleave",event,point,overItem);overItem=item;callEvent(this,"mouseenter",event,point,item)}break}return stopped}}});var Event=Base.extend({_class:"Event",initialize:function Event(event){this.event=event},isPrevented:false,isStopped:false,preventDefault:function(){this.isPrevented=true;this.event.preventDefault()},stopPropagation:function(){this.isStopped=true;this.event.stopPropagation()},stop:function(){this.stopPropagation();this.preventDefault()},getModifiers:function(){return Key.modifiers}});var KeyEvent=Event.extend({_class:"KeyEvent",initialize:function KeyEvent(down,key,character,event){Event.call(this,event);this.type=down?"keydown":"keyup";this.key=key;this.character=character},toString:function(){return"{ type: '"+this.type+"', key: '"+this.key+"', character: '"+this.character+"', modifiers: "+this.getModifiers()+" }"}});var Key=new function(){var specialKeys={8:"backspace",9:"tab",13:"enter",16:"shift",17:"control",18:"option",19:"pause",20:"caps-lock",27:"escape",32:"space",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",46:"delete",91:"command",93:"command",224:"command"},specialChars={9:true,13:true,32:true},modifiers=new Base({shift:false,control:false,option:false,command:false,capsLock:false,space:false}),charCodeMap={},keyMap={},commandFixMap,downCode;function handleKey(down,keyCode,charCode,event){var character=charCode?String.fromCharCode(charCode):"",specialKey=specialKeys[keyCode],key=specialKey||character.toLowerCase(),type=down?"keydown":"keyup",view=View._focused,scope=view&&view.isVisible()&&view._scope,tool=scope&&scope.tool,name;keyMap[key]=down;if(down){charCodeMap[keyCode]=charCode}else{delete charCodeMap[keyCode]}if(specialKey&&(name=Base.camelize(specialKey))in modifiers){modifiers[name]=down;var browser=paper.browser;if(name==="command"&&browser&&browser.mac){if(down){commandFixMap={}}else{for(var code in commandFixMap){if(code in charCodeMap)handleKey(false,code,commandFixMap[code],event)}commandFixMap=null}}}else if(down&&commandFixMap){commandFixMap[keyCode]=charCode}if(tool&&tool.responds(type)){paper=scope;tool.emit(type,new KeyEvent(down,key,character,event));if(view)view.update()}}DomEvent.add(document,{keydown:function(event){var code=event.which||event.keyCode;if(code in specialKeys||modifiers.command){handleKey(true,code,code in specialChars||modifiers.command?code:0,event)}else{downCode=code}},keypress:function(event){if(downCode!=null){handleKey(true,downCode,event.which||event.keyCode,event);downCode=null}},keyup:function(event){var code=event.which||event.keyCode;if(code in charCodeMap)handleKey(false,code,charCodeMap[code],event)}});DomEvent.add(window,{blur:function(event){for(var code in charCodeMap)handleKey(false,code,charCodeMap[code],event)}});return{modifiers:modifiers,isDown:function(key){return!!keyMap[key]}}};var MouseEvent=Event.extend({_class:"MouseEvent",initialize:function MouseEvent(type,event,point,target,delta){Event.call(this,event);this.type=type;this.point=point;this.target=target;this.delta=delta},toString:function(){return"{ type: '"+this.type+"', point: "+this.point+", target: "+this.target+(this.delta?", delta: "+this.delta:"")+", modifiers: "+this.getModifiers()+" }"}});var ToolEvent=Event.extend({_class:"ToolEvent",_item:null,initialize:function ToolEvent(tool,type,event){this.tool=tool;this.type=type;this.event=event},_choosePoint:function(point,toolPoint){return point?point:toolPoint?toolPoint.clone():null},getPoint:function(){return this._choosePoint(this._point,this.tool._point)},setPoint:function(point){this._point=point},getLastPoint:function(){return this._choosePoint(this._lastPoint,this.tool._lastPoint)},setLastPoint:function(lastPoint){this._lastPoint=lastPoint},getDownPoint:function(){return this._choosePoint(this._downPoint,this.tool._downPoint)},setDownPoint:function(downPoint){this._downPoint=downPoint},getMiddlePoint:function(){if(!this._middlePoint&&this.tool._lastPoint){return this.tool._point.add(this.tool._lastPoint).divide(2)}return this._middlePoint},setMiddlePoint:function(middlePoint){this._middlePoint=middlePoint},getDelta:function(){return!this._delta&&this.tool._lastPoint?this.tool._point.subtract(this.tool._lastPoint):this._delta},setDelta:function(delta){this._delta=delta},getCount:function(){return/^mouse(down|up)$/.test(this.type)?this.tool._downCount:this.tool._count},setCount:function(count){this.tool[/^mouse(down|up)$/.test(this.type)?"downCount":"count"]=count},getItem:function(){if(!this._item){var result=this.tool._scope.project.hitTest(this.getPoint());if(result){var item=result.item,parent=item._parent;while(/^(Group|CompoundPath)$/.test(parent._class)){item=parent;parent=parent._parent}this._item=item}}return this._item},setItem:function(item){this._item=item},toString:function(){return"{ type: "+this.type+", point: "+this.getPoint()+", count: "+this.getCount()+", modifiers: "+this.getModifiers()+" }"}});var Tool=PaperScopeItem.extend({_class:"Tool",_list:"tools",_reference:"tool",_events:["onActivate","onDeactivate","onEditOptions","onMouseDown","onMouseUp","onMouseDrag","onMouseMove","onKeyDown","onKeyUp"],initialize:function Tool(props){PaperScopeItem.call(this);this._firstMove=true;this._count=0;this._downCount=0;this._set(props)},getMinDistance:function(){return this._minDistance},setMinDistance:function(minDistance){this._minDistance=minDistance;if(minDistance!=null&&this._maxDistance!=null&&minDistance>this._maxDistance){this._maxDistance=minDistance}},getMaxDistance:function(){return this._maxDistance},setMaxDistance:function(maxDistance){this._maxDistance=maxDistance;if(this._minDistance!=null&&maxDistance!=null&&maxDistance<this._minDistance){this._minDistance=maxDistance}},getFixedDistance:function(){return this._minDistance==this._maxDistance?this._minDistance:null},setFixedDistance:function(distance){this._minDistance=this._maxDistance=distance},_updateEvent:function(type,point,minDistance,maxDistance,start,needsChange,matchMaxDistance){if(!start){if(minDistance!=null||maxDistance!=null){var minDist=minDistance!=null?minDistance:0,vector=point.subtract(this._point),distance=vector.getLength();if(distance<minDist)return false;if(maxDistance!=null&&maxDistance!=0){if(distance>maxDistance){point=this._point.add(vector.normalize(maxDistance))}else if(matchMaxDistance){return false}}}if(needsChange&&point.equals(this._point))return false}this._lastPoint=start&&type=="mousemove"?point:this._point;this._point=point;switch(type){case"mousedown":this._lastPoint=this._downPoint;this._downPoint=this._point;this._downCount++;break;case"mouseup":this._lastPoint=this._downPoint;break}this._count=start?0:this._count+1;return true},_fireEvent:function(type,event){var sets=paper.project._removeSets;if(sets){if(type==="mouseup")sets.mousedrag=null;var set=sets[type];if(set){for(var id in set){var item=set[id];for(var key in sets){var other=sets[key];if(other&&other!=set)delete other[item._id]}item.remove()}sets[type]=null}}return this.responds(type)&&this.emit(type,new ToolEvent(this,type,event))},_handleEvent:function(type,point,event){paper=this._scope;var called=false;switch(type){case"mousedown":this._updateEvent(type,point,null,null,true,false,false);called=this._fireEvent(type,event);break;case"mousedrag":var needsChange=false,matchMaxDistance=false;while(this._updateEvent(type,point,this.minDistance,this.maxDistance,false,needsChange,matchMaxDistance)){called=this._fireEvent(type,event)||called;needsChange=true;matchMaxDistance=true}break;case"mouseup":if(!point.equals(this._point)&&this._updateEvent("mousedrag",point,this.minDistance,this.maxDistance,false,false,false)){called=this._fireEvent("mousedrag",event)}this._updateEvent(type,point,null,this.maxDistance,false,false,false);called=this._fireEvent(type,event)||called;this._updateEvent(type,point,null,null,true,false,false);this._firstMove=true;break;case"mousemove":while(this._updateEvent(type,point,this.minDistance,this.maxDistance,this._firstMove,true,false)){called=this._fireEvent(type,event)||called;this._firstMove=false}break}if(called)event.preventDefault();return called}});var Http={request:function(method,url,callback,async){async=async===undefined?true:async;var xhr=new(window.ActiveXObject||XMLHttpRequest)("Microsoft.XMLHTTP");xhr.open(method.toUpperCase(),url,async);if("overrideMimeType"in xhr)xhr.overrideMimeType("text/plain");xhr.onreadystatechange=function(){if(xhr.readyState===4){var status=xhr.status;if(status===0||status===200){callback.call(xhr,xhr.responseText)}else{throw new Error("Could not load "+url+" (Error "+status+")")}}};return xhr.send(null)}};var CanvasProvider={canvases:[],getCanvas:function(width,height){var canvas,clear=true;if(typeof width==="object"){height=width.height;width=width.width}if(this.canvases.length){canvas=this.canvases.pop()}else{canvas=document.createElement("canvas")}var ctx=canvas.getContext("2d");if(canvas.width===width&&canvas.height===height){if(clear)ctx.clearRect(0,0,width+1,height+1)}else{canvas.width=width;canvas.height=height}ctx.save();return canvas},getContext:function(width,height){return this.getCanvas(width,height).getContext("2d")},release:function(obj){var canvas=obj.canvas?obj.canvas:obj;canvas.getContext("2d").restore();this.canvases.push(canvas)}};var BlendMode=new function(){var min=Math.min,max=Math.max,abs=Math.abs,sr,sg,sb,sa,br,bg,bb,ba,dr,dg,db;function getLum(r,g,b){return.2989*r+.587*g+.114*b}function setLum(r,g,b,l){var d=l-getLum(r,g,b);dr=r+d;dg=g+d;db=b+d;var l=getLum(dr,dg,db),mn=min(dr,dg,db),mx=max(dr,dg,db);if(mn<0){var lmn=l-mn;dr=l+(dr-l)*l/lmn;dg=l+(dg-l)*l/lmn;db=l+(db-l)*l/lmn}if(mx>255){var ln=255-l,mxl=mx-l;dr=l+(dr-l)*ln/mxl;dg=l+(dg-l)*ln/mxl;db=l+(db-l)*ln/mxl}}function getSat(r,g,b){return max(r,g,b)-min(r,g,b)}function setSat(r,g,b,s){var col=[r,g,b],mx=max(r,g,b),mn=min(r,g,b),md;mn=mn===r?0:mn===g?1:2;mx=mx===r?0:mx===g?1:2;md=min(mn,mx)===0?max(mn,mx)===1?2:1:0;if(col[mx]>col[mn]){col[md]=(col[md]-col[mn])*s/(col[mx]-col[mn]);col[mx]=s}else{col[md]=col[mx]=0}col[mn]=0;dr=col[0];dg=col[1];db=col[2]}var modes={multiply:function(){dr=br*sr/255;dg=bg*sg/255;db=bb*sb/255},screen:function(){dr=br+sr-br*sr/255;dg=bg+sg-bg*sg/255;db=bb+sb-bb*sb/255},overlay:function(){dr=br<128?2*br*sr/255:255-2*(255-br)*(255-sr)/255;dg=bg<128?2*bg*sg/255:255-2*(255-bg)*(255-sg)/255;db=bb<128?2*bb*sb/255:255-2*(255-bb)*(255-sb)/255},"soft-light":function(){var t=sr*br/255;dr=t+br*(255-(255-br)*(255-sr)/255-t)/255;t=sg*bg/255;dg=t+bg*(255-(255-bg)*(255-sg)/255-t)/255;t=sb*bb/255;db=t+bb*(255-(255-bb)*(255-sb)/255-t)/255},"hard-light":function(){dr=sr<128?2*sr*br/255:255-2*(255-sr)*(255-br)/255;dg=sg<128?2*sg*bg/255:255-2*(255-sg)*(255-bg)/255;db=sb<128?2*sb*bb/255:255-2*(255-sb)*(255-bb)/255},"color-dodge":function(){dr=br===0?0:sr===255?255:min(255,255*br/(255-sr));dg=bg===0?0:sg===255?255:min(255,255*bg/(255-sg));db=bb===0?0:sb===255?255:min(255,255*bb/(255-sb))},"color-burn":function(){dr=br===255?255:sr===0?0:max(0,255-(255-br)*255/sr);dg=bg===255?255:sg===0?0:max(0,255-(255-bg)*255/sg);db=bb===255?255:sb===0?0:max(0,255-(255-bb)*255/sb)},darken:function(){dr=br<sr?br:sr;dg=bg<sg?bg:sg;db=bb<sb?bb:sb},lighten:function(){dr=br>sr?br:sr;dg=bg>sg?bg:sg;db=bb>sb?bb:sb},difference:function(){dr=br-sr;if(dr<0)dr=-dr;dg=bg-sg;if(dg<0)dg=-dg;db=bb-sb;if(db<0)db=-db},exclusion:function(){dr=br+sr*(255-br-br)/255;dg=bg+sg*(255-bg-bg)/255;db=bb+sb*(255-bb-bb)/255},hue:function(){setSat(sr,sg,sb,getSat(br,bg,bb));setLum(dr,dg,db,getLum(br,bg,bb))},saturation:function(){setSat(br,bg,bb,getSat(sr,sg,sb));setLum(dr,dg,db,getLum(br,bg,bb))},luminosity:function(){setLum(br,bg,bb,getLum(sr,sg,sb))},color:function(){setLum(sr,sg,sb,getLum(br,bg,bb))},add:function(){dr=min(br+sr,255);dg=min(bg+sg,255);db=min(bb+sb,255)},subtract:function(){dr=max(br-sr,0);dg=max(bg-sg,0);db=max(bb-sb,0)},average:function(){dr=(br+sr)/2;dg=(bg+sg)/2;db=(bb+sb)/2},negation:function(){dr=255-abs(255-sr-br);dg=255-abs(255-sg-bg);db=255-abs(255-sb-bb)}};var nativeModes=this.nativeModes=Base.each(["source-over","source-in","source-out","source-atop","destination-over","destination-in","destination-out","destination-atop","lighter","darker","copy","xor"],function(mode){this[mode]=true},{});var ctx=CanvasProvider.getContext(1,1);Base.each(modes,function(func,mode){var darken=mode==="darken",ok=false;ctx.save();try{ctx.fillStyle=darken?"#300":"#a00";ctx.fillRect(0,0,1,1);ctx.globalCompositeOperation=mode;if(ctx.globalCompositeOperation===mode){ctx.fillStyle=darken?"#a00":"#300";ctx.fillRect(0,0,1,1);ok=ctx.getImageData(0,0,1,1).data[0]!==darken?170:51}}catch(e){}ctx.restore();nativeModes[mode]=ok});CanvasProvider.release(ctx);this.process=function(mode,srcContext,dstContext,alpha,offset){var srcCanvas=srcContext.canvas,normal=mode==="normal";if(normal||nativeModes[mode]){dstContext.save();dstContext.setTransform(1,0,0,1,0,0);dstContext.globalAlpha=alpha;if(!normal)dstContext.globalCompositeOperation=mode;dstContext.drawImage(srcCanvas,offset.x,offset.y);dstContext.restore()}else{var process=modes[mode];if(!process)return;var dstData=dstContext.getImageData(offset.x,offset.y,srcCanvas.width,srcCanvas.height),dst=dstData.data,src=srcContext.getImageData(0,0,srcCanvas.width,srcCanvas.height).data;for(var i=0,l=dst.length;i<l;i+=4){sr=src[i];br=dst[i];sg=src[i+1];bg=dst[i+1];sb=src[i+2];bb=dst[i+2];sa=src[i+3];ba=dst[i+3];process();var a1=sa*alpha/255,a2=1-a1;dst[i]=a1*dr+a2*br;dst[i+1]=a1*dg+a2*bg;dst[i+2]=a1*db+a2*bb;dst[i+3]=sa*alpha+a2*ba}dstContext.putImageData(dstData,offset.x,offset.y)}}};var SVGStyles=Base.each({fillColor:["fill","color"],strokeColor:["stroke","color"],strokeWidth:["stroke-width","number"],strokeCap:["stroke-linecap","string"],strokeJoin:["stroke-linejoin","string"],strokeScaling:["vector-effect","lookup",{true:"none",false:"non-scaling-stroke"},function(item,value){return!value&&(item instanceof PathItem||item instanceof Shape||item instanceof TextItem)}],miterLimit:["stroke-miterlimit","number"],dashArray:["stroke-dasharray","array"],dashOffset:["stroke-dashoffset","number"],fontFamily:["font-family","string"],fontWeight:["font-weight","string"],fontSize:["font-size","number"],justification:["text-anchor","lookup",{left:"start",center:"middle",right:"end"}],opacity:["opacity","number"],blendMode:["mix-blend-mode","string"]},function(entry,key){var part=Base.capitalize(key),lookup=entry[2];this[key]={type:entry[1],property:key,attribute:entry[0],toSVG:lookup,fromSVG:lookup&&Base.each(lookup,function(value,name){this[value]=name},{}),exportFilter:entry[3],get:"get"+part,set:"set"+part}},{});var SVGNamespaces={href:"http://www.w3.org/1999/xlink",xlink:"http://www.w3.org/2000/xmlns"};new function(){var formatter;function setAttributes(node,attrs){for(var key in attrs){var val=attrs[key],namespace=SVGNamespaces[key];if(typeof val==="number")val=formatter.number(val);if(namespace){node.setAttributeNS(namespace,key,val)}else{node.setAttribute(key,val)}}return node}function createElement(tag,attrs){return setAttributes(document.createElementNS("http://www.w3.org/2000/svg",tag),attrs)}function getTransform(matrix,coordinates,center){var attrs=new Base,trans=matrix.getTranslation();if(coordinates){matrix=matrix.shiftless();var point=matrix._inverseTransform(trans);attrs[center?"cx":"x"]=point.x;attrs[center?"cy":"y"]=point.y;trans=null}if(!matrix.isIdentity()){var decomposed=matrix.decompose();if(decomposed&&!decomposed.shearing){var parts=[],angle=decomposed.rotation,scale=decomposed.scaling;if(trans&&!trans.isZero())parts.push("translate("+formatter.point(trans)+")");if(!Numerical.isZero(scale.x-1)||!Numerical.isZero(scale.y-1))parts.push("scale("+formatter.point(scale)+")");if(angle)parts.push("rotate("+formatter.number(angle)+")");attrs.transform=parts.join(" ")}else{attrs.transform="matrix("+matrix.getValues().join(",")+")"}}return attrs}function exportGroup(item,options){var attrs=getTransform(item._matrix),children=item._children;var node=createElement("g",attrs);for(var i=0,l=children.length;i<l;i++){var child=children[i];var childNode=exportSVG(child,options);if(childNode){if(child.isClipMask()){var clip=createElement("clipPath");clip.appendChild(childNode);setDefinition(child,clip,"clip");setAttributes(node,{"clip-path":"url(#"+clip.id+")"})}else{node.appendChild(childNode)}}}return node}function exportRaster(item,options){var attrs=getTransform(item._matrix,true),size=item.getSize(),image=item.getImage();attrs.x-=size.width/2;attrs.y-=size.height/2;attrs.width=size.width;attrs.height=size.height;attrs.href=options.embedImages===false&&image&&image.src||item.toDataURL();return createElement("image",attrs)}function exportPath(item,options){var matchShapes=options.matchShapes;if(matchShapes){var shape=item.toShape(false);if(shape)return exportShape(shape,options)}var segments=item._segments,type,attrs=getTransform(item._matrix);if(segments.length===0)return null;if(matchShapes&&!item.hasHandles()){if(segments.length>=3){type=item._closed?"polygon":"polyline";var parts=[];for(var i=0,l=segments.length;i<l;i++)parts.push(formatter.point(segments[i]._point));attrs.points=parts.join(" ")}else{type="line";var first=segments[0]._point,last=segments[segments.length-1]._point;attrs.set({x1:first.x,y1:first.y,x2:last.x,y2:last.y})}}else{type="path";attrs.d=item.getPathData(null,options.precision)}return createElement(type,attrs)}function exportShape(item){var type=item._type,radius=item._radius,attrs=getTransform(item._matrix,true,type!=="rectangle");if(type==="rectangle"){type="rect";var size=item._size,width=size.width,height=size.height;attrs.x-=width/2;attrs.y-=height/2;attrs.width=width;attrs.height=height;if(radius.isZero())radius=null}if(radius){if(type==="circle"){attrs.r=radius}else{attrs.rx=radius.width;attrs.ry=radius.height}}return createElement(type,attrs)}function exportCompoundPath(item,options){var attrs=getTransform(item._matrix);var data=item.getPathData(null,options.precision);if(data)attrs.d=data;return createElement("path",attrs)}function exportPlacedSymbol(item,options){var attrs=getTransform(item._matrix,true),symbol=item.getSymbol(),symbolNode=getDefinition(symbol,"symbol"),definition=symbol.getDefinition(),bounds=definition.getBounds();if(!symbolNode){symbolNode=createElement("symbol",{viewBox:formatter.rectangle(bounds)});symbolNode.appendChild(exportSVG(definition,options));setDefinition(symbol,symbolNode,"symbol")}attrs.href="#"+symbolNode.id;attrs.x+=bounds.x;attrs.y+=bounds.y;attrs.width=formatter.number(bounds.width);attrs.height=formatter.number(bounds.height);attrs.overflow="visible";return createElement("use",attrs)}function exportGradient(color){var gradientNode=getDefinition(color,"color");if(!gradientNode){var gradient=color.getGradient(),radial=gradient._radial,origin=color.getOrigin().transform(),destination=color.getDestination().transform(),attrs;if(radial){attrs={cx:origin.x,cy:origin.y,r:origin.getDistance(destination)};var highlight=color.getHighlight();if(highlight){highlight=highlight.transform();attrs.fx=highlight.x;attrs.fy=highlight.y}}else{attrs={x1:origin.x,y1:origin.y,x2:destination.x,y2:destination.y}}attrs.gradientUnits="userSpaceOnUse";gradientNode=createElement((radial?"radial":"linear")+"Gradient",attrs);var stops=gradient._stops;for(var i=0,l=stops.length;i<l;i++){var stop=stops[i],stopColor=stop._color,alpha=stopColor.getAlpha();attrs={offset:stop._rampPoint,"stop-color":stopColor.toCSS(true)};if(alpha<1)attrs["stop-opacity"]=alpha;gradientNode.appendChild(createElement("stop",attrs))}setDefinition(color,gradientNode,"color")}return"url(#"+gradientNode.id+")"}function exportText(item){var node=createElement("text",getTransform(item._matrix,true));node.textContent=item._content;return node}var exporters={Group:exportGroup,Layer:exportGroup,Raster:exportRaster,Path:exportPath,Shape:exportShape,CompoundPath:exportCompoundPath,PlacedSymbol:exportPlacedSymbol,PointText:exportText};function applyStyle(item,node,isRoot){var attrs={},parent=!isRoot&&item.getParent();if(item._name!=null)attrs.id=item._name;Base.each(SVGStyles,function(entry){var get=entry.get,type=entry.type,value=item[get]();if(entry.exportFilter?entry.exportFilter(item,value):!parent||!Base.equals(parent[get](),value)){if(type==="color"&&value!=null){var alpha=value.getAlpha();if(alpha<1)attrs[entry.attribute+"-opacity"]=alpha}attrs[entry.attribute]=value==null?"none":type==="number"?formatter.number(value):type==="color"?value.gradient?exportGradient(value,item):value.toCSS(true):type==="array"?value.join(","):type==="lookup"?entry.toSVG[value]:value}});if(attrs.opacity===1)delete attrs.opacity;if(!item._visible)attrs.visibility="hidden";return setAttributes(node,attrs)}var definitions;function getDefinition(item,type){if(!definitions)definitions={ids:{},svgs:{}};return item&&definitions.svgs[type+"-"+item._id]}function setDefinition(item,node,type){if(!definitions)getDefinition();var id=definitions.ids[type]=(definitions.ids[type]||0)+1;node.id=type+"-"+id;definitions.svgs[type+"-"+item._id]=node}function exportDefinitions(node,options){var svg=node,defs=null;if(definitions){svg=node.nodeName.toLowerCase()==="svg"&&node;for(var i in definitions.svgs){if(!defs){if(!svg){svg=createElement("svg");svg.appendChild(node)}defs=svg.insertBefore(createElement("defs"),svg.firstChild)}defs.appendChild(definitions.svgs[i])}definitions=null}return options.asString?(new XMLSerializer).serializeToString(svg):svg}function exportSVG(item,options,isRoot){var exporter=exporters[item._class],node=exporter&&exporter(item,options);if(node){var onExport=options.onExport;if(onExport)node=onExport(item,node,options)||node;var data=JSON.stringify(item._data);if(data&&data!=="{}"&&data!=="null")node.setAttribute("data-paper-data",data)}return node&&applyStyle(item,node,isRoot)}function setOptions(options){if(!options)options={};formatter=new Formatter(options.precision);return options}Item.inject({exportSVG:function(options){options=setOptions(options);return exportDefinitions(exportSVG(this,options,true),options)}});Project.inject({exportSVG:function(options){options=setOptions(options);var layers=this.layers,view=this.getView(),size=view.getViewSize(),node=createElement("svg",{x:0,y:0,width:size.width,height:size.height,version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"}),parent=node,matrix=view._matrix;if(!matrix.isIdentity())parent=node.appendChild(createElement("g",getTransform(matrix)));for(var i=0,l=layers.length;i<l;i++)parent.appendChild(exportSVG(layers[i],options,true));return exportDefinitions(node,options)}})};new function(){function getValue(node,name,isString,allowNull){var namespace=SVGNamespaces[name],value=namespace?node.getAttributeNS(namespace,name):node.getAttribute(name);if(value==="null")value=null;return value==null?allowNull?null:isString?"":0:isString?value:parseFloat(value)}function getPoint(node,x,y,allowNull){x=getValue(node,x,false,allowNull);y=getValue(node,y,false,allowNull);return allowNull&&(x==null||y==null)?null:new Point(x,y)}function getSize(node,w,h,allowNull){w=getValue(node,w,false,allowNull);h=getValue(node,h,false,allowNull);return allowNull&&(w==null||h==null)?null:new Size(w,h)}function convertValue(value,type,lookup){return value==="none"?null:type==="number"?parseFloat(value):type==="array"?value?value.split(/[\s,]+/g).map(parseFloat):[]:type==="color"?getDefinition(value)||value:type==="lookup"?lookup[value]:value}function importGroup(node,type,options,isRoot){var nodes=node.childNodes,isClip=type==="clippath",item=new Group,project=item._project,currentStyle=project._currentStyle,children=[];if(!isClip){item=applyAttributes(item,node,isRoot);project._currentStyle=item._style.clone()}if(isRoot){var defs=node.querySelectorAll("defs");for(var i=0,l=defs.length;i<l;i++){importSVG(defs[i],options,false)}}for(var i=0,l=nodes.length;i<l;i++){var childNode=nodes[i],child;if(childNode.nodeType===1&&childNode.nodeName.toLowerCase()!=="defs"&&(child=importSVG(childNode,options,false))&&!(child instanceof Symbol))children.push(child)}item.addChildren(children);if(isClip)item=applyAttributes(item.reduce(),node,isRoot);project._currentStyle=currentStyle;if(isClip||type==="defs"){item.remove();item=null}return item}function importPoly(node,type){var coords=node.getAttribute("points").match(/[+-]?(?:\d*\.\d+|\d+\.?)(?:[eE][+-]?\d+)?/g),points=[];for(var i=0,l=coords.length;i<l;i+=2)points.push(new Point(parseFloat(coords[i]),parseFloat(coords[i+1])));var path=new Path(points);if(type==="polygon")path.closePath();return path}function importPath(node){var data=node.getAttribute("d"),param={pathData:data};return(data.match(/m/gi)||[]).length>1||/z\S+/i.test(data)?new CompoundPath(param):new Path(param)}function importGradient(node,type){var id=(getValue(node,"href",true)||"").substring(1),isRadial=type==="radialgradient",gradient;if(id){gradient=definitions[id].getGradient()}else{var nodes=node.childNodes,stops=[];for(var i=0,l=nodes.length;i<l;i++){var child=nodes[i];if(child.nodeType===1)stops.push(applyAttributes(new GradientStop,child))}gradient=new Gradient(stops,isRadial)}var origin,destination,highlight;if(isRadial){origin=getPoint(node,"cx","cy");destination=origin.add(getValue(node,"r"),0);highlight=getPoint(node,"fx","fy",true)}else{origin=getPoint(node,"x1","y1");destination=getPoint(node,"x2","y2")}applyAttributes(new Color(gradient,origin,destination,highlight),node);return null}var importers={"#document":function(node,type,options,isRoot){var nodes=node.childNodes;for(var i=0,l=nodes.length;i<l;i++){var child=nodes[i];if(child.nodeType===1){var next=child.nextSibling;document.body.appendChild(child);var item=importSVG(child,options,isRoot);if(next){node.insertBefore(child,next)}else{node.appendChild(child)}return item}}},g:importGroup,svg:importGroup,clippath:importGroup,polygon:importPoly,polyline:importPoly,path:importPath,lineargradient:importGradient,radialgradient:importGradient,image:function(node){var raster=new Raster(getValue(node,"href",true));raster.on("load",function(){var size=getSize(node,"width","height");this.setSize(size);var center=this._matrix._transformPoint(getPoint(node,"x","y").add(size.divide(2)));this.translate(center)});return raster},symbol:function(node,type,options,isRoot){return new Symbol(importGroup(node,type,options,isRoot),true)},defs:importGroup,use:function(node){var id=(getValue(node,"href",true)||"").substring(1),definition=definitions[id],point=getPoint(node,"x","y");return definition?definition instanceof Symbol?definition.place(point):definition.clone().translate(point):null},circle:function(node){return new Shape.Circle(getPoint(node,"cx","cy"),getValue(node,"r"))},ellipse:function(node){return new Shape.Ellipse({center:getPoint(node,"cx","cy"),radius:getSize(node,"rx","ry")})},rect:function(node){var point=getPoint(node,"x","y"),size=getSize(node,"width","height"),radius=getSize(node,"rx","ry");return new Shape.Rectangle(new Rectangle(point,size),radius)},line:function(node){return new Path.Line(getPoint(node,"x1","y1"),getPoint(node,"x2","y2"))},text:function(node){var text=new PointText(getPoint(node,"x","y").add(getPoint(node,"dx","dy")));text.setContent(node.textContent.trim()||"");return text}};function applyTransform(item,value,name,node){var transforms=(node.getAttribute(name)||"").split(/\)\s*/g),matrix=new Matrix;for(var i=0,l=transforms.length;i<l;i++){var transform=transforms[i];if(!transform)break;var parts=transform.split(/\(\s*/),command=parts[0],v=parts[1].split(/[\s,]+/g);for(var j=0,m=v.length;j<m;j++)v[j]=parseFloat(v[j]);switch(command){case"matrix":matrix.concatenate(new Matrix(v[0],v[1],v[2],v[3],v[4],v[5]));break;case"rotate":matrix.rotate(v[0],v[1],v[2]);break;case"translate":matrix.translate(v[0],v[1]);break;case"scale":matrix.scale(v);break;case"skewX":matrix.skew(v[0],0);break;case"skewY":matrix.skew(0,v[0]);break}}item.transform(matrix)}function applyOpacity(item,value,name){var color=item[name==="fill-opacity"?"getFillColor":"getStrokeColor"]();if(color)color.setAlpha(parseFloat(value))}var attributes=Base.set(Base.each(SVGStyles,function(entry){this[entry.attribute]=function(item,value){item[entry.set](convertValue(value,entry.type,entry.fromSVG));if(entry.type==="color"&&item instanceof Shape){var color=item[entry.get]();if(color)color.transform((new Matrix).translate(item.getPosition(true).negate()))}}},{}),{id:function(item,value){definitions[value]=item;if(item.setName)item.setName(value)},"clip-path":function(item,value){var clip=getDefinition(value);if(clip){clip=clip.clone();clip.setClipMask(true);if(item instanceof Group){item.insertChild(0,clip)}else{return new Group(clip,item)}}},gradientTransform:applyTransform,transform:applyTransform,"fill-opacity":applyOpacity,"stroke-opacity":applyOpacity,visibility:function(item,value){item.setVisible(value==="visible")},display:function(item,value){item.setVisible(value!==null)},"stop-color":function(item,value){if(item.setColor)item.setColor(value)},"stop-opacity":function(item,value){if(item._color)item._color.setAlpha(parseFloat(value))},offset:function(item,value){var percentage=value.match(/(.*)%$/);item.setRampPoint(percentage?percentage[1]/100:parseFloat(value))},viewBox:function(item,value,name,node,styles){var rect=new Rectangle(convertValue(value,"array")),size=getSize(node,"width","height",true);if(item instanceof Group){var scale=size?rect.getSize().divide(size):1,matrix=(new Matrix).translate(rect.getPoint()).scale(scale);item.transform(matrix.inverted())}else if(item instanceof Symbol){if(size)rect.setSize(size);var clip=getAttribute(node,"overflow",styles)!="visible",group=item._definition;if(clip&&!rect.contains(group.getBounds())){clip=new Shape.Rectangle(rect).transform(group._matrix);clip.setClipMask(true);group.addChild(clip)}}}});function getAttribute(node,name,styles){var attr=node.attributes[name],value=attr&&attr.value;if(!value){var style=Base.camelize(name);value=node.style[style];if(!value&&styles.node[style]!==styles.parent[style])value=styles.node[style]}return!value?undefined:value==="none"?null:value}function applyAttributes(item,node,isRoot){var styles={node:DomElement.getStyles(node)||{},parent:!isRoot&&DomElement.getStyles(node.parentNode)||{}};Base.each(attributes,function(apply,name){var value=getAttribute(node,name,styles);if(value!==undefined)item=Base.pick(apply(item,value,name,node,styles),item)});return item}var definitions={};function getDefinition(value){var match=value&&value.match(/\((?:#|)([^)']+)/);return match&&definitions[match[1]]}function importSVG(source,options,isRoot){if(!source)return null;if(!options){options={}}else if(typeof options==="function"){options={onLoad:options}}var node=source,scope=paper;function onLoadCallback(svg){paper=scope;var item=importSVG(svg,options,isRoot),onLoad=options.onLoad,view=scope.project&&scope.getView();if(onLoad)onLoad.call(this,item);view.update()}if(isRoot){if(typeof source==="string"&&!/^.*</.test(source)){node=document.getElementById(source);if(node){source=null}else{return Http.request("get",source,onLoadCallback)}}else if(typeof File!=="undefined"&&source instanceof File){var reader=new FileReader;reader.onload=function(){onLoadCallback(reader.result)};return reader.readAsText(source)}}if(typeof source==="string")node=(new DOMParser).parseFromString(source,"image/svg+xml");if(!node.nodeName)throw new Error("Unsupported SVG source: "+source);var type=node.nodeName.toLowerCase(),importer=importers[type],item,data=node.getAttribute&&node.getAttribute("data-paper-data"),settings=scope.settings,applyMatrix=settings.applyMatrix;settings.applyMatrix=false;item=importer&&importer(node,type,options,isRoot)||null;settings.applyMatrix=applyMatrix;if(item){if(type!=="#document"&&!(item instanceof Group))item=applyAttributes(item,node,isRoot);var onImport=options.onImport;if(onImport)item=onImport(node,item,options)||item;if(options.expandShapes&&item instanceof Shape){item.remove();item=item.toPath()}if(data)item._data=JSON.parse(data)}if(isRoot){definitions={};if(item&&Base.pick(options.applyMatrix,applyMatrix))item.matrix.apply(true,true)}return item}Item.inject({importSVG:function(node,options){return this.addChild(importSVG(node,options,true))}});Project.inject({importSVG:function(node,options){this.activate();return importSVG(node,options,true)}})};Base.exports.PaperScript=function(){var exports,define,scope=this;!function(e,r){return"object"==typeof exports&&"object"==typeof module?r(exports):"function"==typeof define&&define.amd?define(["exports"],r):(r(e.acorn||(e.acorn={})),void 0)}(this,function(e){"use strict";function r(e){fr=e||{};for(var r in mr)Object.prototype.hasOwnProperty.call(fr,r)||(fr[r]=mr[r]);hr=fr.sourceFile||null}function t(e,r){var t=vr(dr,e);r+=" ("+t.line+":"+t.column+")";var n=new SyntaxError(r);throw n.pos=e,n.loc=t,n.raisedAt=br,n}function n(e){function r(e){if(1==e.length)return t+="return str === "+JSON.stringify(e[0])+";";t+="switch(str){";for(var r=0;r<e.length;++r)t+="case "+JSON.stringify(e[r])+":";t+="return true}return false;"}e=e.split(" ");var t="",n=[];e:for(var a=0;a<e.length;++a){for(var o=0;o<n.length;++o)if(n[o][0].length==e[a].length){n[o].push(e[a]);continue e}n.push([e[a]])}if(n.length>3){n.sort(function(e,r){return r.length-e.length}),t+="switch(str.length){";for(var a=0;a<n.length;++a){var i=n[a];t+="case "+i[0].length+":",r(i)}t+="}"}else r(e);return new Function("str",t)}function a(){this.line=Ar,this.column=br-Sr}function o(){Ar=1,br=Sr=0,Er=!0,u()}function i(e,r){gr=br,fr.locations&&(kr=new a),wr=e,u(),Cr=r,Er=e.beforeExpr}function s(){var e=fr.onComment&&fr.locations&&new a,r=br,n=dr.indexOf("*/",br+=2);if(-1===n&&t(br-2,"Unterminated comment"),br=n+2,fr.locations){Kt.lastIndex=r;for(var o;(o=Kt.exec(dr))&&o.index<br;)++Ar,Sr=o.index+o[0].length}fr.onComment&&fr.onComment(!0,dr.slice(r+2,n),r,br,e,fr.locations&&new a)}function c(){for(var e=br,r=fr.onComment&&fr.locations&&new a,t=dr.charCodeAt(br+=2);pr>br&&10!==t&&13!==t&&8232!==t&&8233!==t;)++br,t=dr.charCodeAt(br);fr.onComment&&fr.onComment(!1,dr.slice(e+2,br),e,br,r,fr.locations&&new a)}function u(){for(;pr>br;){var e=dr.charCodeAt(br);if(32===e)++br;else if(13===e){++br;var r=dr.charCodeAt(br);10===r&&++br,fr.locations&&(++Ar,Sr=br)}else if(10===e||8232===e||8233===e)++br,fr.locations&&(++Ar,Sr=br);else if(e>8&&14>e)++br;else if(47===e){var r=dr.charCodeAt(br+1);if(42===r)s();else{if(47!==r)break;c()}}else if(160===e)++br;else{if(!(e>=5760&&Jt.test(String.fromCharCode(e))))break;++br}}}function l(){var e=dr.charCodeAt(br+1);return e>=48&&57>=e?E(!0):(++br,i(xt))}function f(){var e=dr.charCodeAt(br+1);return Er?(++br,k()):61===e?x(Et,2):x(wt,1)}function d(){var e=dr.charCodeAt(br+1);return 61===e?x(Et,2):x(Dt,1)}function p(e){var r=dr.charCodeAt(br+1);return r===e?x(124===e?Lt:Ut,2):61===r?x(Et,2):x(124===e?Rt:Tt,1)}function h(){var e=dr.charCodeAt(br+1);return 61===e?x(Et,2):x(Vt,1)}function m(e){var r=dr.charCodeAt(br+1);return r===e?45==r&&62==dr.charCodeAt(br+2)&&Gt.test(dr.slice(Lr,br))?(br+=3,c(),u(),g()):x(St,2):61===r?x(Et,2):x(At,1)}function v(e){var r=dr.charCodeAt(br+1),t=1;return r===e?(t=62===e&&62===dr.charCodeAt(br+2)?3:2,61===dr.charCodeAt(br+t)?x(Et,t+1):x(jt,t)):33==r&&60==e&&45==dr.charCodeAt(br+2)&&45==dr.charCodeAt(br+3)?(br+=4,c(),u(),g()):(61===r&&(t=61===dr.charCodeAt(br+2)?3:2),x(Ot,t))}function b(e){var r=dr.charCodeAt(br+1);return 61===r?x(qt,61===dr.charCodeAt(br+2)?3:2):x(61===e?Ct:It,1)}function y(e){switch(e){case 46:return l();case 40:return++br,i(mt);case 41:return++br,i(vt);case 59:return++br,i(yt);case 44:return++br,i(bt);case 91:return++br,i(ft);case 93:return++br,i(dt);case 123:return++br,i(pt);case 125:return++br,i(ht);case 58:return++br,i(gt);case 63:return++br,i(kt);case 48:var r=dr.charCodeAt(br+1);if(120===r||88===r)return C();case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return E(!1);case 34:case 39:return A(e);case 47:return f(e);case 37:case 42:return d();case 124:case 38:return p(e);case 94:return h();case 43:case 45:return m(e);case 60:case 62:return v(e);case 61:case 33:return b(e);case 126:return x(It,1)}return!1}function g(e){if(e?br=yr+1:yr=br,fr.locations&&(xr=new a),e)return k();if(br>=pr)return i(Br);var r=dr.charCodeAt(br);if(Qt(r)||92===r)return L();var n=y(r);if(n===!1){var o=String.fromCharCode(r);if("\\"===o||$t.test(o))return L();t(br,"Unexpected character '"+o+"'")}return n}function x(e,r){var t=dr.slice(br,br+r);br+=r,i(e,t)}function k(){for(var e,r,n="",a=br;;){br>=pr&&t(a,"Unterminated regular expression");var o=dr.charAt(br);if(Gt.test(o)&&t(a,"Unterminated regular expression"),e)e=!1;else{if("["===o)r=!0;else if("]"===o&&r)r=!1;else if("/"===o&&!r)break;e="\\"===o}++br}var n=dr.slice(a,br);++br;var s=I();return s&&!/^[gmsiy]*$/.test(s)&&t(a,"Invalid regexp flag"),i(jr,new RegExp(n,s))}function w(e,r){for(var t=br,n=0,a=0,o=null==r?1/0:r;o>a;++a){var i,s=dr.charCodeAt(br);if(i=s>=97?s-97+10:s>=65?s-65+10:s>=48&&57>=s?s-48:1/0,i>=e)break;++br,n=n*e+i}return br===t||null!=r&&br-t!==r?null:n}function C(){br+=2;var e=w(16);return null==e&&t(yr+2,"Expected hexadecimal number"),Qt(dr.charCodeAt(br))&&t(br,"Identifier directly after number"),i(Or,e)}function E(e){var r=br,n=!1,a=48===dr.charCodeAt(br);e||null!==w(10)||t(r,"Invalid number"),46===dr.charCodeAt(br)&&(++br,w(10),n=!0);var o=dr.charCodeAt(br);(69===o||101===o)&&(o=dr.charCodeAt(++br),(43===o||45===o)&&++br,null===w(10)&&t(r,"Invalid number"),n=!0),Qt(dr.charCodeAt(br))&&t(br,"Identifier directly after number");var s,c=dr.slice(r,br);return n?s=parseFloat(c):a&&1!==c.length?/[89]/.test(c)||Tr?t(r,"Invalid number"):s=parseInt(c,8):s=parseInt(c,10),i(Or,s)}function A(e){br++;for(var r="";;){br>=pr&&t(yr,"Unterminated string constant");var n=dr.charCodeAt(br);if(n===e)return++br,i(Dr,r);if(92===n){n=dr.charCodeAt(++br);var a=/^[0-7]+/.exec(dr.slice(br,br+3));for(a&&(a=a[0]);a&&parseInt(a,8)>255;)a=a.slice(0,a.length-1);if("0"===a&&(a=null),++br,a)Tr&&t(br-2,"Octal literal in strict mode"),r+=String.fromCharCode(parseInt(a,8)),br+=a.length-1;else switch(n){case 110:r+="\n";break;case 114:r+="\r";break;case 120:r+=String.fromCharCode(S(2));break;case 117:r+=String.fromCharCode(S(4));break;case 85:r+=String.fromCharCode(S(8));break;case 116:r+="\t";break;case 98:r+="\b";break;case 118:r+="\v";break;case 102:r+="\f";break;case 48:r+="\0";break;case 13:10===dr.charCodeAt(br)&&++br;case 10:fr.locations&&(Sr=br,++Ar);break;default:r+=String.fromCharCode(n)}}else(13===n||10===n||8232===n||8233===n)&&t(yr,"Unterminated string constant"),r+=String.fromCharCode(n),++br}}function S(e){var r=w(16,e);return null===r&&t(yr,"Bad character escape sequence"),r}function I(){Bt=!1;for(var e,r=!0,n=br;;){var a=dr.charCodeAt(br);if(Yt(a))Bt&&(e+=dr.charAt(br)),++br;else{if(92!==a)break;Bt||(e=dr.slice(n,br)),Bt=!0,117!=dr.charCodeAt(++br)&&t(br,"Expecting Unicode escape sequence \\uXXXX"),++br;var o=S(4),i=String.fromCharCode(o);i||t(br-1,"Invalid Unicode escape"),(r?Qt(o):Yt(o))||t(br-4,"Invalid Unicode escape"),e+=i}r=!1}return Bt?e:dr.slice(n,br)}function L(){var e=I(),r=Fr;return Bt||(Wt(e)?r=lt[e]:(fr.forbidReserved&&(3===fr.ecmaVersion?Mt:zt)(e)||Tr&&Xt(e))&&t(yr,"The keyword '"+e+"' is reserved")),i(r,e)}function U(){Ir=yr,Lr=gr,Ur=kr,g()}function R(e){if(Tr=e,br=Lr,fr.locations)for(;Sr>br;)Sr=dr.lastIndexOf("\n",Sr-2)+1,--Ar;u(),g()}function V(){this.type=null,this.start=yr,this.end=null}function T(){this.start=xr,this.end=null,null!==hr&&(this.source=hr)}function q(){var e=new V;return fr.locations&&(e.loc=new T),fr.ranges&&(e.range=[yr,0]),e}function O(e){var r=new V;return r.start=e.start,fr.locations&&(r.loc=new T,r.loc.start=e.loc.start),fr.ranges&&(r.range=[e.range[0],0]),r}function j(e,r){return e.type=r,e.end=Lr,fr.locations&&(e.loc.end=Ur),fr.ranges&&(e.range[1]=Lr),e}function D(e){return fr.ecmaVersion>=5&&"ExpressionStatement"===e.type&&"Literal"===e.expression.type&&"use strict"===e.expression.value}function F(e){return wr===e?(U(),!0):void 0}function B(){return!fr.strictSemicolons&&(wr===Br||wr===ht||Gt.test(dr.slice(Lr,yr)))}function M(){F(yt)||B()||X()}function z(e){wr===e?U():X()}function X(){t(yr,"Unexpected token")}function N(e){"Identifier"!==e.type&&"MemberExpression"!==e.type&&t(e.start,"Assigning to rvalue"),Tr&&"Identifier"===e.type&&Nt(e.name)&&t(e.start,"Assigning to "+e.name+" in strict mode")}function W(e){Ir=Lr=br,fr.locations&&(Ur=new a),Rr=Tr=null,Vr=[],g();var r=e||q(),t=!0;for(e||(r.body=[]);wr!==Br;){var n=J();r.body.push(n),t&&D(n)&&R(!0),t=!1}return j(r,"Program")}function J(){(wr===wt||wr===Et&&"/="==Cr)&&g(!0);var e=wr,r=q();switch(e){case Mr:case Nr:U();var n=e===Mr;F(yt)||B()?r.label=null:wr!==Fr?X():(r.label=lr(),M());for(var a=0;a<Vr.length;++a){var o=Vr[a];if(null==r.label||o.name===r.label.name){if(null!=o.kind&&(n||"loop"===o.kind))break;if(r.label&&n)break}}return a===Vr.length&&t(r.start,"Unsyntactic "+e.keyword),j(r,n?"BreakStatement":"ContinueStatement");case Wr:return U(),M(),j(r,"DebuggerStatement");case Pr:return U(),Vr.push(Zt),r.body=J(),Vr.pop(),z(tt),r.test=P(),M(),j(r,"DoWhileStatement");case _r:if(U(),Vr.push(Zt),z(mt),wr===yt)return $(r,null);if(wr===rt){var i=q();return U(),G(i,!0),j(i,"VariableDeclaration"),1===i.declarations.length&&F(ut)?_(r,i):$(r,i)}var i=K(!1,!0);return F(ut)?(N(i),_(r,i)):$(r,i);case Gr:return U(),cr(r,!0);case Kr:return U(),r.test=P(),r.consequent=J(),r.alternate=F(Hr)?J():null,j(r,"IfStatement");case Qr:return Rr||t(yr,"'return' outside of function"),U(),F(yt)||B()?r.argument=null:(r.argument=K(),M()),j(r,"ReturnStatement");case Yr:U(),r.discriminant=P(),r.cases=[],z(pt),Vr.push(en);for(var s,c;wr!=ht;)if(wr===zr||wr===Jr){var u=wr===zr;s&&j(s,"SwitchCase"),r.cases.push(s=q()),s.consequent=[],U(),u?s.test=K():(c&&t(Ir,"Multiple default clauses"),c=!0,s.test=null),z(gt)}else s||X(),s.consequent.push(J());return s&&j(s,"SwitchCase"),U(),Vr.pop(),j(r,"SwitchStatement");case Zr:return U(),Gt.test(dr.slice(Lr,yr))&&t(Lr,"Illegal newline after throw"),r.argument=K(),M(),j(r,"ThrowStatement");case et:if(U(),r.block=H(),r.handler=null,wr===Xr){var l=q();U(),z(mt),l.param=lr(),Tr&&Nt(l.param.name)&&t(l.param.start,"Binding "+l.param.name+" in strict mode"),z(vt),l.guard=null,l.body=H(),r.handler=j(l,"CatchClause")}return r.guardedHandlers=qr,r.finalizer=F($r)?H():null,r.handler||r.finalizer||t(r.start,"Missing catch or finally clause"),j(r,"TryStatement");case rt:return U(),G(r),M(),j(r,"VariableDeclaration");case tt:return U(),r.test=P(),Vr.push(Zt),r.body=J(),Vr.pop(),j(r,"WhileStatement");case nt:return Tr&&t(yr,"'with' in strict mode"),U(),r.object=P(),r.body=J(),j(r,"WithStatement");case pt:return H();case yt:return U(),j(r,"EmptyStatement");default:var f=Cr,d=K();if(e===Fr&&"Identifier"===d.type&&F(gt)){for(var a=0;a<Vr.length;++a)Vr[a].name===f&&t(d.start,"Label '"+f+"' is already declared");var p=wr.isLoop?"loop":wr===Yr?"switch":null;return Vr.push({name:f,kind:p}),r.body=J(),Vr.pop(),r.label=d,j(r,"LabeledStatement")}return r.expression=d,M(),j(r,"ExpressionStatement")}}function P(){z(mt);var e=K();return z(vt),e}function H(e){var r,t=q(),n=!0,a=!1;for(t.body=[],z(pt);!F(ht);){var o=J();t.body.push(o),n&&e&&D(o)&&(r=a,R(a=!0)),n=!1}return a&&!r&&R(!1),j(t,"BlockStatement")}function $(e,r){return e.init=r,z(yt),e.test=wr===yt?null:K(),z(yt),e.update=wr===vt?null:K(),z(vt),e.body=J(),Vr.pop(),j(e,"ForStatement")}function _(e,r){return e.left=r,e.right=K(),z(vt),e.body=J(),Vr.pop(),j(e,"ForInStatement")}function G(e,r){for(e.declarations=[],e.kind="var";;){var n=q();if(n.id=lr(),Tr&&Nt(n.id.name)&&t(n.id.start,"Binding "+n.id.name+" in strict mode"),n.init=F(Ct)?K(!0,r):null,e.declarations.push(j(n,"VariableDeclarator")),!F(bt))break}return e}function K(e,r){var t=Q(r);if(!e&&wr===bt){var n=O(t);for(n.expressions=[t];F(bt);)n.expressions.push(Q(r));return j(n,"SequenceExpression")}return t}function Q(e){var r=Y(e);if(wr.isAssign){var t=O(r);return t.operator=Cr,t.left=r,U(),t.right=Q(e),N(r),j(t,"AssignmentExpression")}return r}function Y(e){var r=Z(e);if(F(kt)){var t=O(r);return t.test=r,t.consequent=K(!0),z(gt),t.alternate=K(!0,e),j(t,"ConditionalExpression")}return r}function Z(e){return er(rr(),-1,e)}function er(e,r,t){var n=wr.binop;if(null!=n&&(!t||wr!==ut)&&n>r){var a=O(e);a.left=e,a.operator=Cr,U(),a.right=er(rr(),n,t);var o=j(a,/&&|\|\|/.test(a.operator)?"LogicalExpression":"BinaryExpression");return er(o,r,t)}return e}function rr(){if(wr.prefix){var e=q(),r=wr.isUpdate;return e.operator=Cr,e.prefix=!0,Er=!0,U(),e.argument=rr(),r?N(e.argument):Tr&&"delete"===e.operator&&"Identifier"===e.argument.type&&t(e.start,"Deleting local variable in strict mode"),j(e,r?"UpdateExpression":"UnaryExpression")}for(var n=tr();wr.postfix&&!B();){var e=O(n);e.operator=Cr,e.prefix=!1,e.argument=n,N(n),U(),n=j(e,"UpdateExpression")}return n}function tr(){return nr(ar())}function nr(e,r){if(F(xt)){var t=O(e);return t.object=e,t.property=lr(!0),t.computed=!1,nr(j(t,"MemberExpression"),r)}if(F(ft)){var t=O(e);return t.object=e,t.property=K(),t.computed=!0,z(dt),nr(j(t,"MemberExpression"),r)}if(!r&&F(mt)){var t=O(e);return t.callee=e,t.arguments=ur(vt,!1),nr(j(t,"CallExpression"),r)}return e}function ar(){switch(wr){case ot:var e=q();return U(),j(e,"ThisExpression");case Fr:return lr();case Or:case Dr:case jr:var e=q();return e.value=Cr,e.raw=dr.slice(yr,gr),U(),j(e,"Literal");case it:case st:case ct:var e=q();return e.value=wr.atomValue,e.raw=wr.keyword,U(),j(e,"Literal");case mt:var r=xr,t=yr;U();var n=K();return n.start=t,n.end=gr,fr.locations&&(n.loc.start=r,n.loc.end=kr),fr.ranges&&(n.range=[t,gr]),z(vt),n;case ft:var e=q();return U(),e.elements=ur(dt,!0,!0),j(e,"ArrayExpression");case pt:return ir();case Gr:var e=q();return U(),cr(e,!1);case at:return or();default:X()}}function or(){var e=q();return U(),e.callee=nr(ar(),!0),e.arguments=F(mt)?ur(vt,!1):qr,j(e,"NewExpression")}function ir(){var e=q(),r=!0,n=!1;for(e.properties=[],U();!F(ht);){if(r)r=!1;else if(z(bt),fr.allowTrailingCommas&&F(ht))break;var a,o={key:sr()},i=!1;if(F(gt)?(o.value=K(!0),a=o.kind="init"):fr.ecmaVersion>=5&&"Identifier"===o.key.type&&("get"===o.key.name||"set"===o.key.name)?(i=n=!0,a=o.kind=o.key.name,o.key=sr(),wr!==mt&&X(),o.value=cr(q(),!1)):X(),"Identifier"===o.key.type&&(Tr||n))for(var s=0;s<e.properties.length;++s){var c=e.properties[s];if(c.key.name===o.key.name){var u=a==c.kind||i&&"init"===c.kind||"init"===a&&("get"===c.kind||"set"===c.kind);u&&!Tr&&"init"===a&&"init"===c.kind&&(u=!1),u&&t(o.key.start,"Redefinition of property")}}e.properties.push(o)}return j(e,"ObjectExpression")}function sr(){return wr===Or||wr===Dr?ar():lr(!0)}function cr(e,r){wr===Fr?e.id=lr():r?X():e.id=null,e.params=[];var n=!0;for(z(mt);!F(vt);)n?n=!1:z(bt),e.params.push(lr());var a=Rr,o=Vr;if(Rr=!0,Vr=[],e.body=H(!0),Rr=a,Vr=o,Tr||e.body.body.length&&D(e.body.body[0]))for(var i=e.id?-1:0;i<e.params.length;++i){var s=0>i?e.id:e.params[i];if((Xt(s.name)||Nt(s.name))&&t(s.start,"Defining '"+s.name+"' in strict mode"),i>=0)for(var c=0;i>c;++c)s.name===e.params[c].name&&t(s.start,"Argument name clash in strict mode")}return j(e,r?"FunctionDeclaration":"FunctionExpression")}function ur(e,r,t){for(var n=[],a=!0;!F(e);){if(a)a=!1;else if(z(bt),r&&fr.allowTrailingCommas&&F(e))break;t&&wr===bt?n.push(null):n.push(K(!0))}return n}function lr(e){var r=q();return r.name=wr===Fr?Cr:e&&!fr.forbidReserved&&wr.keyword||X(),Er=!1,U(),j(r,"Identifier")}e.version="0.4.0";var fr,dr,pr,hr;e.parse=function(e,t){return dr=String(e),pr=dr.length,r(t),o(),W(fr.program)};var mr=e.defaultOptions={ecmaVersion:5,strictSemicolons:!1,allowTrailingCommas:!0,forbidReserved:!1,locations:!1,onComment:null,ranges:!1,program:null,sourceFile:null},vr=e.getLineInfo=function(e,r){for(var t=1,n=0;;){Kt.lastIndex=n;var a=Kt.exec(e);if(!(a&&a.index<r))break;++t,n=a.index+a[0].length}return{line:t,column:r-n}};e.tokenize=function(e,t){function n(e){return g(e),a.start=yr,a.end=gr,a.startLoc=xr,a.endLoc=kr,a.type=wr,a.value=Cr,a}dr=String(e),pr=dr.length,r(t),o();var a={};return n.jumpTo=function(e,r){if(br=e,fr.locations){Ar=1,Sr=Kt.lastIndex=0;for(var t;(t=Kt.exec(dr))&&t.index<e;)++Ar,Sr=t.index+t[0].length}Er=r,u()},n};var br,yr,gr,xr,kr,wr,Cr,Er,Ar,Sr,Ir,Lr,Ur,Rr,Vr,Tr,qr=[],Or={type:"num"},jr={type:"regexp"},Dr={type:"string"},Fr={type:"name"},Br={type:"eof"},Mr={keyword:"break"},zr={keyword:"case",beforeExpr:!0},Xr={keyword:"catch"},Nr={keyword:"continue"},Wr={keyword:"debugger"},Jr={keyword:"default"},Pr={keyword:"do",isLoop:!0},Hr={keyword:"else",beforeExpr:!0},$r={keyword:"finally"},_r={keyword:"for",isLoop:!0},Gr={keyword:"function"},Kr={keyword:"if"},Qr={keyword:"return",beforeExpr:!0},Yr={keyword:"switch"},Zr={keyword:"throw",beforeExpr:!0},et={keyword:"try"},rt={keyword:"var"},tt={keyword:"while",isLoop:!0},nt={keyword:"with"},at={keyword:"new",beforeExpr:!0},ot={keyword:"this"},it={keyword:"null",atomValue:null},st={keyword:"true",atomValue:!0},ct={keyword:"false",atomValue:!1},ut={keyword:"in",binop:7,beforeExpr:!0},lt={break:Mr,case:zr,catch:Xr,continue:Nr,debugger:Wr,default:Jr,do:Pr,else:Hr,finally:$r,for:_r,function:Gr,if:Kr,return:Qr,switch:Yr,throw:Zr,try:et,var:rt,while:tt,with:nt,null:it,true:st,false:ct,new:at,in:ut,instanceof:{keyword:"instanceof",binop:7,beforeExpr:!0},this:ot,typeof:{keyword:"typeof",prefix:!0,beforeExpr:!0},void:{keyword:"void",prefix:!0,beforeExpr:!0},delete:{keyword:"delete",prefix:!0,beforeExpr:!0}},ft={type:"[",beforeExpr:!0},dt={type:"]"},pt={type:"{",beforeExpr:!0},ht={type:"}"},mt={type:"(",beforeExpr:!0},vt={type:")"},bt={type:",",beforeExpr:!0},yt={type:";",beforeExpr:!0},gt={type:":",beforeExpr:!0},xt={type:"."},kt={type:"?",beforeExpr:!0},wt={binop:10,beforeExpr:!0},Ct={isAssign:!0,beforeExpr:!0},Et={isAssign:!0,beforeExpr:!0},At={binop:9,prefix:!0,beforeExpr:!0},St={postfix:!0,prefix:!0,isUpdate:!0},It={prefix:!0,beforeExpr:!0},Lt={binop:1,beforeExpr:!0},Ut={binop:2,beforeExpr:!0},Rt={binop:3,beforeExpr:!0},Vt={binop:4,beforeExpr:!0},Tt={binop:5,beforeExpr:!0},qt={binop:6,beforeExpr:!0},Ot={binop:7,beforeExpr:!0},jt={binop:8,beforeExpr:!0},Dt={binop:10,beforeExpr:!0};e.tokTypes={bracketL:ft,bracketR:dt,braceL:pt,braceR:ht,parenL:mt,parenR:vt,comma:bt,semi:yt,colon:gt,dot:xt,question:kt,slash:wt,eq:Ct,name:Fr,eof:Br,num:Or,regexp:jr,string:Dr};for(var Ft in lt)e.tokTypes["_"+Ft]=lt[Ft];var Bt,Mt=n("abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile"),zt=n("class enum extends super const export import"),Xt=n("implements interface let package private protected public static yield"),Nt=n("eval arguments"),Wt=n("break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this"),Jt=/[\u1680\u180e\u2000-\u200a\u202f\u205f\u3000\ufeff]/,Pt="\xaa\xb5\xba\xc0-\xd6\xd8-\xf6\xf8-\u02c1\u02c6-\u02d1\u02e0-\u02e4\u02ec\u02ee\u0370-\u0374\u0376\u0377\u037a-\u037d\u0386\u0388-\u038a\u038c\u038e-\u03a1\u03a3-\u03f5\u03f7-\u0481\u048a-\u0527\u0531-\u0556\u0559\u0561-\u0587\u05d0-\u05ea\u05f0-\u05f2\u0620-\u064a\u066e\u066f\u0671-\u06d3\u06d5\u06e5\u06e6\u06ee\u06ef\u06fa-\u06fc\u06ff\u0710\u0712-\u072f\u074d-\u07a5\u07b1\u07ca-\u07ea\u07f4\u07f5\u07fa\u0800-\u0815\u081a\u0824\u0828\u0840-\u0858\u08a0\u08a2-\u08ac\u0904-\u0939\u093d\u0950\u0958-\u0961\u0971-\u0977\u0979-\u097f\u0985-\u098c\u098f\u0990\u0993-\u09a8\u09aa-\u09b0\u09b2\u09b6-\u09b9\u09bd\u09ce\u09dc\u09dd\u09df-\u09e1\u09f0\u09f1\u0a05-\u0a0a\u0a0f\u0a10\u0a13-\u0a28\u0a2a-\u0a30\u0a32\u0a33\u0a35\u0a36\u0a38\u0a39\u0a59-\u0a5c\u0a5e\u0a72-\u0a74\u0a85-\u0a8d\u0a8f-\u0a91\u0a93-\u0aa8\u0aaa-\u0ab0\u0ab2\u0ab3\u0ab5-\u0ab9\u0abd\u0ad0\u0ae0\u0ae1\u0b05-\u0b0c\u0b0f\u0b10\u0b13-\u0b28\u0b2a-\u0b30\u0b32\u0b33\u0b35-\u0b39\u0b3d\u0b5c\u0b5d\u0b5f-\u0b61\u0b71\u0b83\u0b85-\u0b8a\u0b8e-\u0b90\u0b92-\u0b95\u0b99\u0b9a\u0b9c\u0b9e\u0b9f\u0ba3\u0ba4\u0ba8-\u0baa\u0bae-\u0bb9\u0bd0\u0c05-\u0c0c\u0c0e-\u0c10\u0c12-\u0c28\u0c2a-\u0c33\u0c35-\u0c39\u0c3d\u0c58\u0c59\u0c60\u0c61\u0c85-\u0c8c\u0c8e-\u0c90\u0c92-\u0ca8\u0caa-\u0cb3\u0cb5-\u0cb9\u0cbd\u0cde\u0ce0\u0ce1\u0cf1\u0cf2\u0d05-\u0d0c\u0d0e-\u0d10\u0d12-\u0d3a\u0d3d\u0d4e\u0d60\u0d61\u0d7a-\u0d7f\u0d85-\u0d96\u0d9a-\u0db1\u0db3-\u0dbb\u0dbd\u0dc0-\u0dc6\u0e01-\u0e30\u0e32\u0e33\u0e40-\u0e46\u0e81\u0e82\u0e84\u0e87\u0e88\u0e8a\u0e8d\u0e94-\u0e97\u0e99-\u0e9f\u0ea1-\u0ea3\u0ea5\u0ea7\u0eaa\u0eab\u0ead-\u0eb0\u0eb2\u0eb3\u0ebd\u0ec0-\u0ec4\u0ec6\u0edc-\u0edf\u0f00\u0f40-\u0f47\u0f49-\u0f6c\u0f88-\u0f8c\u1000-\u102a\u103f\u1050-\u1055\u105a-\u105d\u1061\u1065\u1066\u106e-\u1070\u1075-\u1081\u108e\u10a0-\u10c5\u10c7\u10cd\u10d0-\u10fa\u10fc-\u1248\u124a-\u124d\u1250-\u1256\u1258\u125a-\u125d\u1260-\u1288\u128a-\u128d\u1290-\u12b0\u12b2-\u12b5\u12b8-\u12be\u12c0\u12c2-\u12c5\u12c8-\u12d6\u12d8-\u1310\u1312-\u1315\u1318-\u135a\u1380-\u138f\u13a0-\u13f4\u1401-\u166c\u166f-\u167f\u1681-\u169a\u16a0-\u16ea\u16ee-\u16f0\u1700-\u170c\u170e-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176c\u176e-\u1770\u1780-\u17b3\u17d7\u17dc\u1820-\u1877\u1880-\u18a8\u18aa\u18b0-\u18f5\u1900-\u191c\u1950-\u196d\u1970-\u1974\u1980-\u19ab\u19c1-\u19c7\u1a00-\u1a16\u1a20-\u1a54\u1aa7\u1b05-\u1b33\u1b45-\u1b4b\u1b83-\u1ba0\u1bae\u1baf\u1bba-\u1be5\u1c00-\u1c23\u1c4d-\u1c4f\u1c5a-\u1c7d\u1ce9-\u1cec\u1cee-\u1cf1\u1cf5\u1cf6\u1d00-\u1dbf\u1e00-\u1f15\u1f18-\u1f1d\u1f20-\u1f45\u1f48-\u1f4d\u1f50-\u1f57\u1f59\u1f5b\u1f5d\u1f5f-\u1f7d\u1f80-\u1fb4\u1fb6-\u1fbc\u1fbe\u1fc2-\u1fc4\u1fc6-\u1fcc\u1fd0-\u1fd3\u1fd6-\u1fdb\u1fe0-\u1fec\u1ff2-\u1ff4\u1ff6-\u1ffc\u2071\u207f\u2090-\u209c\u2102\u2107\u210a-\u2113\u2115\u2119-\u211d\u2124\u2126\u2128\u212a-\u212d\u212f-\u2139\u213c-\u213f\u2145-\u2149\u214e\u2160-\u2188\u2c00-\u2c2e\u2c30-\u2c5e\u2c60-\u2ce4\u2ceb-\u2cee\u2cf2\u2cf3\u2d00-\u2d25\u2d27\u2d2d\u2d30-\u2d67\u2d6f\u2d80-\u2d96\u2da0-\u2da6\u2da8-\u2dae\u2db0-\u2db6\u2db8-\u2dbe\u2dc0-\u2dc6\u2dc8-\u2dce\u2dd0-\u2dd6\u2dd8-\u2dde\u2e2f\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303c\u3041-\u3096\u309d-\u309f\u30a1-\u30fa\u30fc-\u30ff\u3105-\u312d\u3131-\u318e\u31a0-\u31ba\u31f0-\u31ff\u3400-\u4db5\u4e00-\u9fcc\ua000-\ua48c\ua4d0-\ua4fd\ua500-\ua60c\ua610-\ua61f\ua62a\ua62b\ua640-\ua66e\ua67f-\ua697\ua6a0-\ua6ef\ua717-\ua71f\ua722-\ua788\ua78b-\ua78e\ua790-\ua793\ua7a0-\ua7aa\ua7f8-\ua801\ua803-\ua805\ua807-\ua80a\ua80c-\ua822\ua840-\ua873\ua882-\ua8b3\ua8f2-\ua8f7\ua8fb\ua90a-\ua925\ua930-\ua946\ua960-\ua97c\ua984-\ua9b2\ua9cf\uaa00-\uaa28\uaa40-\uaa42\uaa44-\uaa4b\uaa60-\uaa76\uaa7a\uaa80-\uaaaf\uaab1\uaab5\uaab6\uaab9-\uaabd\uaac0\uaac2\uaadb-\uaadd\uaae0-\uaaea\uaaf2-\uaaf4\uab01-\uab06\uab09-\uab0e\uab11-\uab16\uab20-\uab26\uab28-\uab2e\uabc0-\uabe2\uac00-\ud7a3\ud7b0-\ud7c6\ud7cb-\ud7fb\uf900-\ufa6d\ufa70-\ufad9\ufb00-\ufb06\ufb13-\ufb17\ufb1d\ufb1f-\ufb28\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40\ufb41\ufb43\ufb44\ufb46-\ufbb1\ufbd3-\ufd3d\ufd50-\ufd8f\ufd92-\ufdc7\ufdf0-\ufdfb\ufe70-\ufe74\ufe76-\ufefc\uff21-\uff3a\uff41-\uff5a\uff66-\uffbe\uffc2-\uffc7\uffca-\uffcf\uffd2-\uffd7\uffda-\uffdc",Ht="\u0300-\u036f\u0483-\u0487\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u0620-\u0649\u0672-\u06d3\u06e7-\u06e8\u06fb-\u06fc\u0730-\u074a\u0800-\u0814\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0840-\u0857\u08e4-\u08fe\u0900-\u0903\u093a-\u093c\u093e-\u094f\u0951-\u0957\u0962-\u0963\u0966-\u096f\u0981-\u0983\u09bc\u09be-\u09c4\u09c7\u09c8\u09d7\u09df-\u09e0\u0a01-\u0a03\u0a3c\u0a3e-\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a66-\u0a71\u0a75\u0a81-\u0a83\u0abc\u0abe-\u0ac5\u0ac7-\u0ac9\u0acb-\u0acd\u0ae2-\u0ae3\u0ae6-\u0aef\u0b01-\u0b03\u0b3c\u0b3e-\u0b44\u0b47\u0b48\u0b4b-\u0b4d\u0b56\u0b57\u0b5f-\u0b60\u0b66-\u0b6f\u0b82\u0bbe-\u0bc2\u0bc6-\u0bc8\u0bca-\u0bcd\u0bd7\u0be6-\u0bef\u0c01-\u0c03\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62-\u0c63\u0c66-\u0c6f\u0c82\u0c83\u0cbc\u0cbe-\u0cc4\u0cc6-\u0cc8\u0cca-\u0ccd\u0cd5\u0cd6\u0ce2-\u0ce3\u0ce6-\u0cef\u0d02\u0d03\u0d46-\u0d48\u0d57\u0d62-\u0d63\u0d66-\u0d6f\u0d82\u0d83\u0dca\u0dcf-\u0dd4\u0dd6\u0dd8-\u0ddf\u0df2\u0df3\u0e34-\u0e3a\u0e40-\u0e45\u0e50-\u0e59\u0eb4-\u0eb9\u0ec8-\u0ecd\u0ed0-\u0ed9\u0f18\u0f19\u0f20-\u0f29\u0f35\u0f37\u0f39\u0f41-\u0f47\u0f71-\u0f84\u0f86-\u0f87\u0f8d-\u0f97\u0f99-\u0fbc\u0fc6\u1000-\u1029\u1040-\u1049\u1067-\u106d\u1071-\u1074\u1082-\u108d\u108f-\u109d\u135d-\u135f\u170e-\u1710\u1720-\u1730\u1740-\u1750\u1772\u1773\u1780-\u17b2\u17dd\u17e0-\u17e9\u180b-\u180d\u1810-\u1819\u1920-\u192b\u1930-\u193b\u1951-\u196d\u19b0-\u19c0\u19c8-\u19c9\u19d0-\u19d9\u1a00-\u1a15\u1a20-\u1a53\u1a60-\u1a7c\u1a7f-\u1a89\u1a90-\u1a99\u1b46-\u1b4b\u1b50-\u1b59\u1b6b-\u1b73\u1bb0-\u1bb9\u1be6-\u1bf3\u1c00-\u1c22\u1c40-\u1c49\u1c5b-\u1c7d\u1cd0-\u1cd2\u1d00-\u1dbe\u1e01-\u1f15\u200c\u200d\u203f\u2040\u2054\u20d0-\u20dc\u20e1\u20e5-\u20f0\u2d81-\u2d96\u2de0-\u2dff\u3021-\u3028\u3099\u309a\ua640-\ua66d\ua674-\ua67d\ua69f\ua6f0-\ua6f1\ua7f8-\ua800\ua806\ua80b\ua823-\ua827\ua880-\ua881\ua8b4-\ua8c4\ua8d0-\ua8d9\ua8f3-\ua8f7\ua900-\ua909\ua926-\ua92d\ua930-\ua945\ua980-\ua983\ua9b3-\ua9c0\uaa00-\uaa27\uaa40-\uaa41\uaa4c-\uaa4d\uaa50-\uaa59\uaa7b\uaae0-\uaae9\uaaf2-\uaaf3\uabc0-\uabe1\uabec\uabed\uabf0-\uabf9\ufb20-\ufb28\ufe00-\ufe0f\ufe20-\ufe26\ufe33\ufe34\ufe4d-\ufe4f\uff10-\uff19\uff3f",$t=new RegExp("["+Pt+"]"),_t=new RegExp("["+Pt+Ht+"]"),Gt=/[\n\r\u2028\u2029]/,Kt=/\r\n|[\n\r\u2028\u2029]/g,Qt=e.isIdentifierStart=function(e){return 65>e?36===e:91>e?!0:97>e?95===e:123>e?!0:e>=170&&$t.test(String.fromCharCode(e))},Yt=e.isIdentifierChar=function(e){return 48>e?36===e:58>e?!0:65>e?!1:91>e?!0:97>e?95===e:123>e?!0:e>=170&&_t.test(String.fromCharCode(e))},Zt={kind:"loop"},en={kind:"switch"}});var binaryOperators={"+":"__add","-":"__subtract","*":"__multiply","/":"__divide","%":"__modulo","==":"equals","!=":"equals"};var unaryOperators={"-":"__negate","+":null};var fields=Base.each(["add","subtract","multiply","divide","modulo","negate"],function(name){this["__"+name]="#"+name},{});Point.inject(fields);Size.inject(fields);Color.inject(fields);function __$__(left,operator,right){var handler=binaryOperators[operator];if(left&&left[handler]){var res=left[handler](right);return operator==="!="?!res:res}switch(operator){case"+":return left+right;case"-":return left-right;case"*":return left*right;case"/":return left/right;case"%":return left%right;case"==":return left==right;case"!=":return left!=right}}function $__(operator,value){var handler=unaryOperators[operator];if(handler&&value&&value[handler])return value[handler]();switch(operator){case"+":return+value;case"-":return-value}}function parse(code,options){return scope.acorn.parse(code,options)}function compile(code,url,options){if(!code)return"";options=options||{};url=url||"";var insertions=[];function getOffset(offset){for(var i=0,l=insertions.length;i<l;i++){var insertion=insertions[i];if(insertion[0]>=offset)break;offset+=insertion[1]}return offset}function getCode(node){return code.substring(getOffset(node.range[0]),getOffset(node.range[1]))}function getBetween(left,right){return code.substring(getOffset(left.range[1]),getOffset(right.range[0]))}function replaceCode(node,str){var start=getOffset(node.range[0]),end=getOffset(node.range[1]),insert=0;for(var i=insertions.length-1;i>=0;i--){if(start>insertions[i][0]){insert=i+1;break}}insertions.splice(insert,0,[start,str.length-end+start]);code=code.substring(0,start)+str+code.substring(end)}function walkAST(node,parent){if(!node)return;for(var key in node){if(key==="range"||key==="loc")continue;var value=node[key];if(Array.isArray(value)){for(var i=0,l=value.length;i<l;i++)walkAST(value[i],node)}else if(value&&typeof value==="object"){walkAST(value,node)}}switch(node.type){case"UnaryExpression":if(node.operator in unaryOperators&&node.argument.type!=="Literal"){var arg=getCode(node.argument);replaceCode(node,'$__("'+node.operator+'", '+arg+")")}break;case"BinaryExpression":if(node.operator in binaryOperators&&node.left.type!=="Literal"){var left=getCode(node.left),right=getCode(node.right),between=getBetween(node.left,node.right),operator=node.operator;replaceCode(node,"__$__("+left+","+between.replace(new RegExp("\\"+operator),'"'+operator+'"')+", "+right+")")}break;case"UpdateExpression":case"AssignmentExpression":var parentType=parent&&parent.type;if(!(parentType==="ForStatement"||parentType==="BinaryExpression"&&/^[=!<>]/.test(parent.operator)||parentType==="MemberExpression"&&parent.computed)){if(node.type==="UpdateExpression"){var arg=getCode(node.argument),exp="__$__("+arg+', "'+node.operator[0]+'", 1)',str=arg+" = "+exp;if(!node.prefix&&(parentType==="AssignmentExpression"||parentType==="VariableDeclarator")){if(getCode(parent.left||parent.id)===arg)str=exp;str=arg+"; "+str}replaceCode(node,str)}else{if(/^.=$/.test(node.operator)&&node.left.type!=="Literal"){var left=getCode(node.left),right=getCode(node.right);replaceCode(node,left+" = __$__("+left+', "'+node.operator[0]+'", '+right+")")}}}break}}var sourceMap=null,browser=paper.browser,version=browser.versionNumber,lineBreaks=/\r\n|\n|\r/gm;if(browser.chrome&&version>=30||browser.webkit&&version>=537.76||browser.firefox&&version>=23){var offset=0;if(window.location.href.indexOf(url)===0){var html=document.getElementsByTagName("html")[0].innerHTML;offset=html.substr(0,html.indexOf(code)+1).match(lineBreaks).length+1}var mappings=["AAAA"];mappings.length=(code.match(lineBreaks)||[]).length+1+offset;sourceMap={version:3,file:url,names:[],mappings:mappings.join(";AACA"),sourceRoot:"",sources:[url]};var source=options.source||!url&&code;if(source)sourceMap.sourcesContent=[source]}walkAST(parse(code,{ranges:true}));if(sourceMap){code=new Array(offset+1).join("\n")+code+"\n//# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(sourceMap))))+"\n//# sourceURL="+(url||"paperscript")}return code}function execute(code,scope,url,options){paper=scope;var view=scope.getView(),tool=/\s+on(?:Key|Mouse)(?:Up|Down|Move|Drag)\b/.test(code)?new Tool:null,toolHandlers=tool?tool._events:[],handlers=["onFrame","onResize"].concat(toolHandlers),params=[],args=[],func;code=compile(code,url,options);function expose(scope,hidden){for(var key in scope){if((hidden||!/^_/.test(key))&&new RegExp("([\\b\\s\\W]|^)"+key.replace(/\$/g,"\\$")+"\\b").test(code)){params.push(key);args.push(scope[key])}}}expose({__$__:__$__,$__:$__,paper:scope,view:view,tool:tool},true);expose(scope);handlers=Base.each(handlers,function(key){if(new RegExp("\\s+"+key+"\\b").test(code)){params.push(key);this.push(key+": "+key)}},[]).join(", ");if(handlers)code+="\nreturn { "+handlers+" };";var browser=paper.browser;if(browser.chrome||browser.firefox){var script=document.createElement("script"),head=document.head||document.getElementsByTagName("head")[0];if(browser.firefox)code="\n"+code;script.appendChild(document.createTextNode("paper._execute = function("+params+") {"+code+"\n}"));head.appendChild(script);func=paper._execute;delete paper._execute;head.removeChild(script)}else{func=Function(params,code)}var res=func.apply(scope,args)||{};Base.each(toolHandlers,function(key){var value=res[key];if(value)tool[key]=value});if(view){if(res.onResize)view.setOnResize(res.onResize);view.emit("resize",{size:view.size,delta:new Point});if(res.onFrame)view.setOnFrame(res.onFrame);view.update()}}function loadScript(script){if(/^text\/(?:x-|)paperscript$/.test(script.type)&&PaperScope.getAttribute(script,"ignore")!=="true"){var canvasId=PaperScope.getAttribute(script,"canvas"),canvas=document.getElementById(canvasId),src=script.src||script.getAttribute("data-src"),async=PaperScope.hasAttribute(script,"async"),scopeAttribute="data-paper-scope";if(!canvas)throw new Error('Unable to find canvas with id "'+canvasId+'"');var scope=PaperScope.get(canvas.getAttribute(scopeAttribute))||(new PaperScope).setup(canvas);canvas.setAttribute(scopeAttribute,scope._id);if(src){Http.request("get",src,function(code){execute(code,scope,src)},async)}else{execute(script.innerHTML,scope,script.baseURI)}script.setAttribute("data-paper-ignore","true");return scope}}function loadAll(){Base.each(document.getElementsByTagName("script"),loadScript)}function load(script){return script?loadScript(script):loadAll()}if(document.readyState==="complete"){setTimeout(loadAll)}else{DomEvent.add(window,{load:loadAll})}return{compile:compile,execute:execute,load:load,parse:parse}}.call(this);paper=new(PaperScope.inject(Base.exports,{enumerable:true,Base:Base,Numerical:Numerical,Key:Key}));if(typeof define==="function"&&define.amd){define("paper",paper)}else if(typeof module==="object"&&module){module.exports=paper}return paper}},{}],3:[function(require,module,exports){(function(process){if(process.env.npm_package_name==="pseudomap"&&process.env.npm_lifecycle_script==="test")process.env.TEST_PSEUDOMAP="true";if(typeof Map==="function"&&!process.env.TEST_PSEUDOMAP){module.exports=Map}else{module.exports=require("./pseudomap")}}).call(this,require("_process"))},{"./pseudomap":4,_process:251}],4:[function(require,module,exports){var hasOwnProperty=Object.prototype.hasOwnProperty;module.exports=PseudoMap;function PseudoMap(set){if(!(this instanceof PseudoMap))throw new TypeError("Constructor PseudoMap requires 'new'");this.clear();if(set){if(set instanceof PseudoMap||typeof Map==="function"&&set instanceof Map)set.forEach(function(value,key){this.set(key,value)},this);else if(Array.isArray(set))set.forEach(function(kv){this.set(kv[0],kv[1])},this);else throw new TypeError("invalid argument")}}PseudoMap.prototype.forEach=function(fn,thisp){thisp=thisp||this;Object.keys(this._data).forEach(function(k){if(k!=="size")fn.call(thisp,this._data[k].value,this._data[k].key)},this)};PseudoMap.prototype.has=function(k){return!!find(this._data,k)};PseudoMap.prototype.get=function(k){var res=find(this._data,k);return res&&res.value};PseudoMap.prototype.set=function(k,v){set(this._data,k,v)};PseudoMap.prototype.delete=function(k){var res=find(this._data,k);if(res){delete this._data[res._index];this._data.size--}};PseudoMap.prototype.clear=function(){var data=Object.create(null);data.size=0;Object.defineProperty(this,"_data",{value:data,enumerable:false,configurable:true,writable:false})};Object.defineProperty(PseudoMap.prototype,"size",{get:function(){return this._data.size},set:function(n){},enumerable:true,configurable:true});PseudoMap.prototype.values=PseudoMap.prototype.keys=PseudoMap.prototype.entries=function(){throw new Error("iterators are not implemented in this version")};function same(a,b){return a===b||a!==a&&b!==b}function Entry(k,v,i){this.key=k;this.value=v;this._index=i}function find(data,k){for(var i=0,s="_"+k,key=s;hasOwnProperty.call(data,key);key=s+i++){if(same(data[key].key,k))return data[key]}}function set(data,k,v){for(var i=0,s="_"+k,key=s;hasOwnProperty.call(data,key);key=s+i++){if(same(data[key].key,k)){data[key].value=v;return}}data.size++;data[key]=new Entry(k,v,key)}},{}],5:[function(require,module,exports){var paper=require("paper");function createCanvas(element,options){var canvas=document.createElement("canvas");canvas.width=options.width||100;canvas.height=options.height||100;canvas.style.border="1px solid black";element.appendChild(canvas);return canvas}function convertDraw(world,additional){var additional=additional||{};var xyf=_.flatten(_.map(world.features,function(val,y){return _.map(val,function(feat,x){return{feat:feat,pos:[x,y]}})}));var filterHasName=function(ar){return _.filter(ar,function(x){return x.feat.name})};var blocked=_.map(_.filter(xyf,function(x){return x.feat=="#"}),"pos");var terminal=_.map(filterHasName(xyf),"pos");var world2={blockedStates:blocked,terminals:terminal,xLim:world.xLim,yLim:world.yLim};var featureLabels=_.map(filterHasName(xyf),function(a){return{point:a.pos,content:a.feat.name}});var additionalLabels=additional.labels||[];var labels=additionalLabels.concat(featureLabels);var trajectory=additional.trajecotry;return draw(world2,_.extend(additional,{labels:labels}))}var pomConvert=function(world,additional){var trajectory=(additional||{}).trajectory;if(trajectory){var trajectory=_.isArray(trajectory[0])?_.map(trajectory,0):trajectory;var trajectory=_.has(trajectory[0],"manifestState")?_.map(trajectory,"manifestState"):trajectory}var additional=_.extend(additional,{trajectory:trajectory});return convertDraw(world.MDPWorld,additional)};function draw(world,additional){if(world.MDPWorld){return pomConvert(world,additional)}if(world.features){return convertDraw(world,additional)}if(typeof wpEditor==="undefined"){console.log("GridWorld.draw: no wpEditor, not drawing");return}var element=wpEditor.makeResultContainer();var canvas=createCanvas(element,{width:world.xLim*100,height:world.yLim*100});paper.setup(canvas);var color={blocked:"grey",terminal:new paper.Color(.7),agent:"blue"};var position=function(coords){return[coords[0],world.yLim-coords[1]]};var makeSquare=function(c){var rect=new paper.Rectangle([0,0],[1,1]);var path=new paper.Path.Rectangle(rect,0);path.fillColor=c;path.remove();return path};var label=new paper.PointText({fillColor:new paper.Color(.1,.8),fontSize:16,justification:"center"});label.scale(.02);var toHeat=function(v){var mag=Math.min(Math.abs(v)/20,1);if(v>0){return new paper.Color(0,1,0,mag)}else{return new paper.Color(1,0,0,mag)}};var addUtilities=function(v){var group=new paper.Group;group.addChild(new paper.Path.Rectangle([-.5,+.5],[world.xLim,world.yLim]));var lastCoord;for(var i=0;i<v.length;i++){var coord=v[i][0].loc;var LRUD=v[i][1];var LURD=[LRUD[0],LRUD[2],LRUD[1],LRUD[3]];if(!_.isEqual(lastCoord,coord)){for(var j=0;j<4;j++){var tri=triangleSquare(coord,j*90,toHeat(LURD[j]),new paper.Color(.5,.4));group.addChild(tri);var l=makeLabel({point:[coord[0]+.3*Math.cos(-j*Math.PI/2+Math.PI),coord[1]+.3*Math.sin(-j*Math.PI/2+Math.PI)],content:LURD[j].toFixed(1),fontSize:10});group.addChild(l)}}lastCoord=coord}return group};var triangleSquare=function(coord,orientation,color,borderColor){var a=new paper.Path([[-.5,-.5],[0,0],[-.5,+.5]]);var j=orientation;a.closed=true;a.fillColor=color;a.strokeColor=borderColor;a.rotate(orientation);var offsetx=Math.cos(-orientation/90*Math.PI/2+Math.PI);var offsety=Math.sin(-orientation/90*Math.PI/2+Math.PI);a.position=position([coord[0]+offsetx*.25,coord[1]+offsety*.25]);return a};var makeLabel=function(a){var copy=_.extend(label.clone(),a);copy.point=position(a.point);copy.point.y+=copy.bounds.height/3.5;return copy};var makeGrid=function(world){var group=new paper.Group;for(var i=0;i<world.xLim;i++){for(var j=0;j<world.yLim;j++){var grid=new paper.Path.Rectangle([i-.5,j+.5],[1,1]);grid.strokeColor=new paper.Color(.5,.2);grid.fillColor=new paper.Color(1,0);group.addChild(grid)}}return group};var addShapes=function(coords,shape,group){for(var i=0;i<coords.length;i++){var copy=shape.clone();copy.position=position(coords[i]);group.addChild(copy)}};var addAgentPath=function(trajectory,paths,group){var trajectory=_.has(trajectory[0],"loc")?trajectory:_.map(trajectory,0);var coords=_.map(trajectory,"loc");console.log(coords);var agentPath=new paper.Path;agentPath.strokeColor="black";agentPath.strokeWidth=2;agentPath.dashArray=[8,8];group.addChild(agentPath);var agent=new paper.Path.Circle(position(coords[0]),.3);agent.fillColor=color.agent;group.addChild(agent);var pathsGroup=new paper.Group;group.addChild(pathsGroup);var segPerSec=3;var extraAtEnd=1;var lastTime=0;var scale,offsetx,offsety;var active=true;var offsett=0;paper.view.onFrame=function(event){if(scale===undefined){scale=agent.bounds.width/2/.3;offsetx=agent.position.x-position(coords[0])[0]*scale;offsety=agent.position.y-position(coords[0])[1]*scale}var scalePosition=function(v){var x=position(v);return[x[0]*scale+offsetx,x[1]*scale+offsety]};if(active){if(event.time-lastTime>.1){offsett+=event.time-lastTime}lastTime=event.time;var segments=(event.time-offsett)*segPerSec;var frac=segments%1;var idx=Math.floor(Math.min(Math.floor(segments)%(trajectory.length+extraAtEnd),trajectory.length-1));agentPath.remove();var currentLocation;if(idx<trajectory.length-1&&coords[idx]!="break"&&coords[idx+1]!="break"){currentLocation=[(1-frac)*coords[idx][0]+frac*coords[idx+1][0],(1-frac)*coords[idx][1]+frac*coords[idx+1][1]]}else if(coords[idx]=="break"){currentLocation=coords[idx-1]}else{currentLocation=coords[idx]}var i;for(i=idx;i>=0&&coords[i]!="break";i-=1){}var currentPath=coords.slice(i+1,idx+1);currentPath.push(currentLocation);if(paths){pathsGroup.remove();pathsGroup=addUtilities(paths[idx]);group.addChild(pathsGroup);pathsGroup.scale(scale);pathsGroup.translate(world.xLim/2*scale,world.yLim/2*scale);var fudgeFactor=33;pathsGroup.translate(-pathsGroup.bounds.topLeft.x+fudgeFactor,-pathsGroup.bounds.topLeft.y);console.log()}agentPath=new paper.Path;agentPath.strokeColor="black";agentPath.strokeWidth=2;agentPath.dashArray=[8,8];group.addChild(agentPath);agentPath.addSegments(_.map(currentPath,scalePosition));agent.position=scalePosition(currentLocation)}};paper.view.on("mousedown",function(event){active=!active})};var axisx=_.map(_.range(world.xLim),function(i){return{point:[i,-.75],content:i}});var axisy=_.map(_.range(world.yLim),function(i){return{point:[-.75,i],content:i}});var makeTerminal=function(coords){var group=new paper.Group;var tri=undefined;for(var i=0;i<4;i++){var gradient={gradient:{stops:[["white",.75],[color.terminal,1]],radial:false},origin:[0,0],destination:[-.5,0]};tri=triangleSquare(coords,i*90,gradient,new paper.Color(0,0));group.addChild(tri)}return group};var group=new paper.Group;addShapes(world.blockedStates,makeSquare(color.blocked),group);var f=_.map(world.terminals,makeTerminal);group.addChildren(f);group.addChild(makeGrid(world));group.addChildren(_.map(axisx,makeLabel));group.addChildren(_.map(axisy,makeLabel));group.addChildren(_.map(world.labels,makeLabel));if(world.labels){group.addChildren(_.map(world.labels,makeLabel))}if(additional){if(additional.actionExpectedUtilities){group.addChild(addUtilities(additional.actionExpectedUtilities))}if(additional.trajectory){addAgentPath(additional.trajectory,additional.dynamicActionExpectedUtilities,group)}if(additional.labels){group.addChildren(_.map(additional.labels,makeLabel))}}group.fitBounds(paper.view.bounds);paper.view.draw()}var printDist=function(x,k){var distValues=_.sortBy(x.support(),function(v){return-x.score(v)});var distValues=typeof k=="undefined"?distValues:distValues.slice(0,k);console.log("vegaPrint Dist:");distValues.map(function(v){var prob=Math.exp(x.score(v));if(prob>0){console.log(JSON.stringify(v)+": "+prob.toFixed(5))}});console.log(" \n")};module.exports={draw:draw,vegaPrint:printDist,print:printDist,bar:printDist,line:printDist}},{paper:2}],6:[function(require,module,exports){var serialize=require("./serialize");var LRU=require("lru-cache");function cache(f,maxSize){var c=LRU(maxSize);var cf=function(s,k,a){var args=Array.prototype.slice.call(arguments,3);var stringedArgs=serialize(args);if(c.has(stringedArgs)){return k(s,c.get(stringedArgs))}else{var newk=function(s,r){if(c.has(stringedArgs)){console.log("Already in cache:",stringedArgs);if(serialize(c.get(stringedArgs))!==serialize(r)){console.log("OLD AND NEW CACHE VALUE DIFFER!");console.log("Old value:",c.get(stringedArgs));console.log("New value:",r)}}c.set(stringedArgs,r);if(!maxSize&&c.length===1e4){console.log(c.length+" function calls have been cached.");console.log("The size of the cache can be limited by calling cache(f, maxSize).")}return k(s,r)};return f.apply(this,[s,newk,a].concat(args))}};return cf}module.exports={cache:cache}},{"./serialize":7,"lru-cache":1}],7:[function(require,module,exports){function InfToJSON(k,v){if(v===Infinity){return"Infinity"}else if(v===-Infinity){return"-Infinity"}else{return v}}function InfFromJSON(k,v){if(v==="Infinity"){return Infinity}else if(v==="-Infinity"){return-Infinity}else{return v}}function serialize(o){return JSON.stringify(o,InfToJSON)}module.exports=serialize},{}],8:[function(require,module,exports){"use strict";var Tensor=ad.tensor.__Tensor;function _sumreduce0(t){if(t.dims.length!==2){throw new Error("sumreduce0 is only implemented for matrices.")}var h=t.dims[0];var w=t.dims[1];var out=new Tensor([h,1]);for(var i=0;i<h;i++){for(var j=0;j<w;j++){out.data[i]+=t.data[i*w+j]}}return out}var sumreduce0=ad.newUnaryFunction({OutputType:Tensor,name:"sumreduce0",forward:function(a){return _sumreduce0(a)},backward:function(a){var h=a.x.dims[0];var w=a.x.dims[1];for(var i=0;i<h;i++){for(var j=0;j<w;j++){a.dx.data[i*w+j]+=this.dx.data[i]}}}});function _relu(t){var _t=t;var out=new Tensor(_t.dims);for(var i=0;i<_t.length;i++){out.data[i]=_t.data[i]<0?0:_t.data[i]}return out}var relu=ad.newUnaryFunction({OutputType:Tensor,name:"relu",forward:function(t){return _relu(t)},backward:function(x){for(var i=0;i<x.x.length;i++){x.dx.data[i]+=x.x.data[i]<0?0:this.dx.data[i]}}});var leakyness=100;function _lrelu(t){var _t=t;var out=new Tensor(_t.dims);for(var i=0;i<_t.length;i++){out.data[i]=_t.data[i]<0?_t.data[i]/leakyness:_t.data[i]}return out}var lrelu=ad.newUnaryFunction({OutputType:Tensor,name:"lrelu",forward:function(t){return _lrelu(t)},backward:function(x){for(var i=0;i<x.x.length;i++){x.dx.data[i]+=x.x.data[i]<0?this.dx.data[i]/leakyness:this.dx.data[i]}}});function idMatrix(n){if(n<=0){throw new Error("n should be > 0.")}var out=new Tensor([n,n]);for(var i=0;i<n;i++){out.data[i*(n+1)]=1}return out}function oneHot(index,length){if(length<=0){throw new Error("length should be > 0.")}if(index<0||index>=length){throw new Error("index out of bounds")}var out=new Tensor([length,1]);out.data[index]=1;return out}function checkNetName(name){if(!name){throw new Error("A network must be given a name.")}}module.exports={sumreduce0:sumreduce0,_sumreduce0:_sumreduce0,relu:relu,lrelu:lrelu,idMatrix:idMatrix,oneHot:oneHot,checkNetName:checkNetName}},{}],9:[function(require,module,exports){var getLowResNow=function(){return(new Date).getTime()};var getNow=typeof window!=="undefined"&&window.performance?function(){return window.performance.now()}:getLowResNow;var sleep=function(ms){var now=getNow();while(getNow()<now+ms){}};module.exports={now:getNow,sleep:sleep}},{}],10:[function(require,module,exports){"use strict";var nop=function(){};function makeUnaryDerivatives(code){if(code===undefined){return{scalar:nop,tensor:nop}}else{return{scalar:new Function("_x",["var x = _x.x;","var out = this.x;","_x.dx += ("+code+") * this.dx;"].join("\n")),tensor:new Function("_x",["var n = _x.x.length;","while (n--) {","\tvar x = _x.x.data[n];","\tvar out = this.x.data[n];","   _x.dx.data[n] += ("+code+") * this.dx.data[n];","}"].join("\n"))}}}function makeBinaryDerivatives(code1,code2){if(code1===undefined&&code2===undefined){return{scalar:[nop,nop],tensor:[nop,nop]}}else{return{scalar:[new Function("_x","_y",["var x = _x.x;",'var y = (typeof _y === "number") ? _y : _y.x;',"var out = this.x;","_x.dx += ("+code1+") * this.dx;"].join("\n")),new Function("_x","_y",['var x = (typeof _x === "number") ? _x : _x.x;',"var y = _y.x;","var out = this.x;","_y.dx += ("+code2+") * this.dx;"].join("\n"))],tensor:[new Function("_x","_y",["var _xx = _x.x;","var _yx = _y.x || _y;","var n = _xx.length;",'if (typeof _yx === "number") {',"\twhile (n--) {","\t\tvar x = _xx.data[n];","\t\tvar y = _yx;","\t\tvar out = this.x.data[n];","\t   _x.dx.data[n] += ("+code1+") * this.dx.data[n];","\t}","} else {","\twhile (n--) {","\t\tvar x = _xx.data[n];","\t\tvar y = _yx.data[n];","\t\tvar out = this.x.data[n];","\t   _x.dx.data[n] += ("+code1+") * this.dx.data[n];","\t}","}"].join("\n")),new Function("_x","_y",["var _xx = _x.x || _x;","var _yx = _y.x;","var n = _xx.length;",'if (typeof _yx === "number") {',"\twhile (n--) {","\t\tvar x = _xx.data[n];","\t\tvar y = _yx;","\t\tvar out = this.x.data[n];","\t   _y.dx += ("+code2+") * this.dx.data[n];","\t}","} else {","\twhile (n--) {","\t\tvar x = _xx.data[n];","\t\tvar y = _yx.data[n];","\t\tvar out = this.x.data[n];","\t   _y.dx.data[n] += ("+code2+") * this.dx.data[n];","\t}","}"].join("\n"))]}}}var d={};d.neg=makeUnaryDerivatives("-1");d.add=makeBinaryDerivatives("1","1");d.sub=makeBinaryDerivatives("1","-1");d.mul=makeBinaryDerivatives("y","x");d.div=makeBinaryDerivatives("1/y","-x/(y*y)");d.sqrt=makeUnaryDerivatives("1/(2*out)");d.exp=makeUnaryDerivatives("out");d.log=makeUnaryDerivatives("1/x");d.pow=makeBinaryDerivatives("y*Math.pow(x,y-1)","Math.log(x)*out");d.sin=makeUnaryDerivatives("Math.cos(x)");d.cos=makeUnaryDerivatives("-Math.sin(x)");d.tan=makeUnaryDerivatives("1 + out*out");d.asin=makeUnaryDerivatives("1 / Math.sqrt(1 - x*x)");d.acos=makeUnaryDerivatives("-1 / Math.sqrt(1 - x*x)");d.atan=makeUnaryDerivatives("1 / (1 + x*x)");d.atan2=makeBinaryDerivatives("y/(x*x + y*y)","-x/(x*x + y*y)");d.sinh=makeUnaryDerivatives("Math.cosh(x)");d.cosh=makeUnaryDerivatives("Math.sinh(x)");d.tanh=makeUnaryDerivatives("1 - out*out");d.asinh=makeUnaryDerivatives("1 / Math.sqrt(x*x + 1)");d.acosh=makeUnaryDerivatives("1 / Math.sqrt(x*x - 1)");d.atanh=makeUnaryDerivatives("1 / (1 - x*x)");d.sigmoid=makeUnaryDerivatives("out * (1 - out)");d.abs=makeUnaryDerivatives("x >= 0 ? 1 : -1");d.floor=makeUnaryDerivatives();d.ceil=makeUnaryDerivatives();d.round=makeUnaryDerivatives();d.min=makeBinaryDerivatives();d.max=makeBinaryDerivatives();module.exports=d},{}],11:[function(require,module,exports){"use strict";var assert=require("assert");var graph=require("./graph.js");var Node=graph.Node;var Tensor=require("../tensor.js");function checkOutputType(OutputType){assert(OutputType===Tensor||OutputType===Number,"Attempting to create AD function with invalid output type '"+OutputType+"'; valid options are 'Number' and 'Tensor'")}function newUnaryFunction(opts){var OutputType=opts.OutputType;var name=opts.name;var forward=opts.forward;var backward=opts.backward;checkOutputType(OutputType);var NodeType=OutputType===Tensor?graph.TensorNode:graph.ScalarNode;function bw(){backward.call(this,this.inputs[0])}return function(x){if(x instanceof Node){var inputs=[x];return new NodeType(forward(x.x),inputs,inputs,bw,name)}else{return forward(x)}}}function newBinaryFunction(opts){var OutputType=opts.OutputType;var name=opts.name;var forward=opts.forward;var backward1=opts.backward1;var backward2=opts.backward2;checkOutputType(OutputType);var NodeType=OutputType===Tensor?graph.TensorNode:graph.ScalarNode;function backward11(){backward1.call(this,this.inputs[0],this.inputs[1].x);backward2.call(this,this.inputs[0].x,this.inputs[1])}function backward10(){backward1.call(this,this.inputs[0],this.inputs[1])}function backward01(){backward2.call(this,this.inputs[0],this.inputs[1])}return function(x,y){var xIsNode=x instanceof Node;var yIsNode=y instanceof Node;if(xIsNode&&yIsNode){var inputs=[x,y];return new NodeType(forward(x.x,y.x),inputs,inputs,backward11,name)}else if(xIsNode){return new NodeType(forward(x.x,y),[x],[x,y],backward10,name)}else if(yIsNode){return new NodeType(forward(x,y.x),[y],[x,y],backward01,name)}else{return forward(x,y)}}}function newFunction(opts){var OutputType=opts.OutputType;var name=opts.name;var forward=opts.forward;var backward=opts.backward;var getParents=opts.getParents;checkOutputType(OutputType);var NodeType=OutputType===Tensor?graph.TensorNode:graph.ScalarNode;function bw(){backward.apply(this,this.inputs)}return function(){var output=forward.apply(null,arguments);var parents=getParents.apply(null,arguments);var inputs=new Array(arguments.length);for(var i=0;i<inputs.length;++i){inputs[i]=arguments[i]}var n=parents.length;if(n===0){return output}else{return new NodeType(output,parents,inputs,bw,name)}}}function naryGetParents(){var args=arguments.length===1&&arguments[0]instanceof Array?arguments[0]:arguments;var p=[];var n=args.length;while(n--){var arg=args[n];if(arg instanceof Node){p.push(arg)}}return p}function liftUnaryFunction(f){return function(x){return f(x instanceof Node?x.x:x)}}function liftBinaryFunction(f){return function(x,y){var xprim=x instanceof Node?x.x:x;var yprim=y instanceof Node?y.x:y;return f(xprim,yprim)}}module.exports={newUnaryFunction:newUnaryFunction,newBinaryFunction:newBinaryFunction,newFunction:newFunction,naryGetParents:naryGetParents,liftUnaryFunction:liftUnaryFunction,liftBinaryFunction:liftBinaryFunction}},{"../tensor.js":31,"./graph.js":13,assert:248}],12:[function(require,module,exports){"use strict";var Tensor=require("../tensor.js");var graph=require("./graph.js");var Node=graph.Node;var func=require("./func.js");var derivs=require("./derivatives.js");var Scalar=Number;Math.sigmoid=function(x){return 1/(1+Math.exp(-x))};function makeFunctions(OutputType){var fns={};function backward(derivFns){return OutputType===Tensor?derivFns.tensor:derivFns.scalar}var namePrefix=OutputType===Scalar?"scalar.":"tensor.";var unops={neg:OutputType===Tensor?function(x){return x.neg()}:function(x){return-x}};for(var op in unops){fns[op]=func.newUnaryFunction({OutputType:OutputType,name:namePrefix+op,forward:unops[op],backward:backward(derivs[op])})}var binops={add:OutputType===Tensor?function(x,y){return x.add(y)}:function(x,y){return x+y},sub:OutputType===Tensor?function(x,y){return x.sub(y)}:function(x,y){return x-y},mul:OutputType===Tensor?function(x,y){return x.mul(y)}:function(x,y){return x*y},div:OutputType===Tensor?function(x,y){return x.div(y)}:function(x,y){return x/y}};for(var op in binops){fns[op]=func.newBinaryFunction({OutputType:OutputType,name:namePrefix+op,forward:binops[op],backward1:backward(derivs[op])[0],backward2:backward(derivs[op])[1]})}var unaryFns=["floor","ceil","round","sqrt","exp","log","abs","sin","cos","tan","asin","acos","atan","sinh","cosh","tanh","asinh","acosh","atanh","sigmoid"];var binaryFns=["pow","min","max","atan2"];for(var i=0;i<unaryFns.length;i++){var fnname=unaryFns[i];var forward=OutputType===Tensor?new Function("x","return x."+fnname+"();"):new Function("x","return Math."+fnname+"(x);");fns[fnname]=func.newUnaryFunction({OutputType:OutputType,name:namePrefix+fnname,forward:forward,backward:backward(derivs[fnname])})}for(var i=0;i<binaryFns.length;i++){var fnname=binaryFns[i];var forward=OutputType===Tensor?new Function("x","y","return x."+fnname+"(y);"):new Function("x","y","return Math."+fnname+"(x, y);");fns[fnname]=func.newBinaryFunction({OutputType:OutputType,name:namePrefix+fnname,forward:forward,backward1:backward(derivs[fnname])[0],backward2:backward(derivs[fnname])[1]})}fns.isNaN=OutputType===Scalar?func.liftUnaryFunction(isNaN):func.liftUnaryFunction(function(t){return t.isNaN()});fns.isFinite=OutputType===Scalar?func.liftUnaryFunction(isFinite):func.liftUnaryFunction(function(t){return t.isFinite()});return fns}var fns={scalar:makeFunctions(Scalar),tensor:makeFunctions(Tensor)};Object.getOwnPropertyNames(Math).forEach(function(p){if(!fns.scalar.hasOwnProperty(p)){fns.scalar[p]=Math[p]}});fns.scalar.eq=func.liftBinaryFunction(function(x,y){return x==y});fns.scalar.neq=func.liftBinaryFunction(function(x,y){return x!=y});fns.scalar.peq=func.liftBinaryFunction(function(x,y){return x===y});fns.scalar.pneq=func.liftBinaryFunction(function(x,y){return x!==y});fns.scalar.gt=func.liftBinaryFunction(function(x,y){return x>y});fns.scalar.lt=func.liftBinaryFunction(function(x,y){return x<y});fns.scalar.geq=func.liftBinaryFunction(function(x,y){return x>=y});fns.scalar.leq=func.liftBinaryFunction(function(x,y){return x<=y});fns.tensor.transpose=func.newUnaryFunction({OutputType:Tensor,name:"transpose",forward:function(a){return a.transpose()},backward:function(a){var h=this.x.dims[0];var w=this.x.dims[1];for(var i=0;i<h;i++){for(var j=0;j<w;j++){a.dx.data[j*h+i]+=this.dx.data[i*w+j]}}}});fns.tensor.diagonal=func.newUnaryFunction({OutputType:Tensor,name:"diagonal",forward:function(a){return a.diagonal()},backward:function(a){var n=a.dx.dims[0];for(var i=0;i<n;i++){a.dx.data[i]+=this.dx.data[i*(n+1)]}}});fns.tensor.inverse=func.newUnaryFunction({OutputType:Tensor,name:"inverse",forward:function(A){return A.inverse()},backward:function(A){var xT=this.x.transpose();A.dx=A.dx.add(xT.dot(this.dx).dot(xT).neg())}});fns.tensor.determinant=func.newUnaryFunction({OutputType:Number,name:"determinant",forward:function(A){return A.determinant()},backward:function(A){var n=A.x.dims[0];var invA=A.x.inverse();for(var i=0;i<n;i++){for(var j=0;j<n;j++){A.dx.data[i*n+j]+=this.x*this.dx*invA.data[j*n+i]}}}});fns.tensor.dot=func.newBinaryFunction({OutputType:Tensor,name:"dot",forward:function(a,b){return a.dot(b)},backward1:function(A,B){var Ap=ad.value(A);var Bp=ad.value(B);var Ah=Ap.dims[0];var Aw=Ap.dims[1];var Bw=Bp.dims[1];var wout=Bw;for(var l=0;l<Ah;l++){for(var m=0;m<Aw;m++){var z=0;for(var j=0;j<wout;j++){z+=this.dx.data[l*wout+j]*Bp.data[m*Bw+j]}A.dx.data[l*Aw+m]+=z}}},backward2:function(A,B){var Ap=ad.value(A);var Bp=ad.value(B);var Ah=Ap.dims[0];var Aw=Ap.dims[1];var Bh=Bp.dims[0];var Bw=Bp.dims[1];var wout=Bw;for(var l=0;l<Bh;l++){for(var m=0;m<Bw;m++){var z=0;for(var i=0;i<Ah;i++){z+=this.dx.data[i*wout+m]*Ap.data[i*Aw+l]}B.dx.data[l*Bw+m]+=z}}}});fns.tensor.cholesky=func.newUnaryFunction({OutputType:Tensor,name:"cholesky",forward:function(x){return x.cholesky()},backward:function(x){var i,j,k;var L=this;var dL=this.dx.tril();var n=L.x.dims[0];for(k=n-1;k>=0;k--){for(j=k+1;j<n;j++){for(i=j;i<n;i++){dL.data[i*n+k]-=dL.data[i*n+j]*L.x.data[j*n+k];dL.data[j*n+k]-=dL.data[i*n+j]*L.x.data[i*n+k]}}for(j=k+1;j<n;j++){dL.data[j*n+k]/=L.x.data[k*n+k];dL.data[k*n+k]-=dL.data[j*n+k]*L.x.data[j*n+k]}dL.data[k*n+k]/=2*L.x.data[k*n+k]}x.dx.addeq(dL)}});fns.tensor.sumreduce=func.newUnaryFunction({OutputType:Scalar,name:"sumreduce",forward:function(t){return t.sumreduce()},backward:function(t){var n=t.dx.data.length;while(n--){t.dx.data[n]+=this.dx}}});fns.tensor.allreduce=func.liftUnaryFunction(function(t){return t.allreduce()});fns.tensor.anyreduce=func.liftUnaryFunction(function(t){return t.anyreduce()});fns.tensor.get=func.newFunction({OutputType:Scalar,name:"tensor.get",forward:function(t,i){return t instanceof Node?t.x.data[i]:t.data[i]},backward:function(t,i){if(t instanceof Node){t.dx.data[i]+=this.dx}},getParents:function(t,i){return t instanceof Node?[t]:[]}});fns.tensor.toScalars=function(t){var n=t instanceof Node?t.x.length:t.length;var s=new Array(n);while(n--){s[n]=fns.tensor.get(t,n)}return s};fns.tensor.range=func.newFunction({OutputType:Tensor,name:"tensor.range",forward:function(t,start,end){t=t instanceof Node?t.x:t;var n=end-start;var tn=new Tensor([n]);while(n--){var i=start+n;tn.data[n]=t.data[i]}return tn},backward:function(t,start,end){if(t instanceof Node){var n=end-start;while(n--){var i=start+n;t.dx.data[i]+=this.dx.data[n]}}},getParents:function(t,start,end){return t instanceof Node?[t]:[]}});fns.tensor.split=function(t,lengths){var ts=new Array(lengths.length);var start=0;for(var i=0;i<lengths.length;i++){var l=lengths[i];ts[i]=fns.tensor.range(t,start,start+l);start+=l}return ts};fns.tensor.fromScalars=func.newFunction({OutputType:Tensor,name:"tensor.fromScalars",forward:function(){var args=arguments.length===1&&arguments[0]instanceof Array?arguments[0]:arguments;var n=args.length;var t=new Tensor([n]);while(n--){var arg=args[n];t.data[n]=arg instanceof Node?arg.x:arg}return t},backward:function(){var args=arguments.length===1&&arguments[0]instanceof Array?arguments[0]:arguments;var n=args.length;while(n--){var arg=args[n];if(arg instanceof Node){arg.dx+=this.dx.data[n]}}},getParents:func.naryGetParents});fns.tensor.concat=func.newFunction({OutputType:Tensor,name:"tensor.concat",forward:function(){var args=arguments.length===1&&arguments[0]instanceof Array?arguments[0]:arguments;var n=args.length;var size=0;while(n--){var arg=args[n];var tn=arg instanceof Node?arg.x:arg;size+=tn.length}var t=new Tensor([size]);n=args.length;var i=0;for(var j=0;j<n;j++){var arg=args[j];var tn=arg instanceof Node?arg.x:arg;t.copy(tn,i);i+=tn.length}return t},backward:function(){var args=arguments.length===1&&arguments[0]instanceof Array?arguments[0]:arguments;var n=args.length;var i=0;for(var j=0;j<n;j++){var arg=args[j];if(arg instanceof Node){var tn=arg;var len=tn.dx.length;while(len--){tn.dx.data[len]+=this.dx.data[i+len]}i+=tn.dx.length}else i+=arg.length}},getParents:func.naryGetParents});fns.tensor.reshape=function(t,dims){if(t instanceof Node){var node=t.refClone();node.x.reshape(dims);node.dx.reshape(dims);return node}else{var ref=t.refClone();ref.reshape(dims);return ref}};fns.scalar.sum=func.newFunction({OutputType:Scalar,name:"scalar.sum",forward:function(){var args=arguments.length===1&&arguments[0]instanceof Array?arguments[0]:arguments;var thesum=0;var n=args.length;while(n--){var arg=args[n];var x=arg instanceof Node?arg.x:arg;thesum+=x}return thesum},backward:function(){var args=arguments.length===1&&arguments[0]instanceof Array?arguments[0]:arguments;var n=args.length;while(n--){var arg=args[n];if(arg instanceof Node){arg.dx+=this.dx}}},getParents:func.naryGetParents});fns.tensor.softmax=func.newUnaryFunction({OutputType:Tensor,name:"tensor.softmax",forward:function(t){return t.softmax()},backward:function(t){var n=t.dx.data.length;var s=0;for(var i=0;i<n;i++){s+=this.x.data[i]*this.dx.data[i]}for(var j=0;j<n;j++){t.dx.data[j]+=this.x.data[j]*(this.dx.data[j]-s)}}});module.exports=fns},{"../tensor.js":31,"./derivatives.js":10,"./func.js":11,"./graph.js":13}],13:[function(require,module,exports){"use strict";var Tensor=require("../tensor.js");function Node(x,parents,inputs,backward,name){this.x=x;this.parents=parents;this.inputs=inputs;if(backward!==undefined)this.backward=backward;this.outDegree=0;this.name=name||"node"}Node.prototype.copy=function(other){this.x=other.x;this.parents=other.parents;this.inputs=other.inputs;if(other.backward!==undefined)this.backward=other.backward;this.outDegree=other.outDegree;this.name=other.name};Node.prototype.clone=function(){var node=Object.create(Node.prototype);node.copy(this);return node};Node.prototype.computeOutDegree=function(){var stack=[this];while(stack.length>0){var node=stack.pop();node.outDegree++;if(node.outDegree===1){var n=node.parents.length;while(n--)stack.push(node.parents[n])}}};Node.prototype.backpropRec=function(){var stack=[this];while(stack.length>0){var node=stack.pop();node.outDegree--;if(node.outDegree===0){node.backward();var n=node.parents.length;while(n--)stack.push(node.parents[n])}}};Node.prototype.zeroDerivativesRec=function(){var stack=[this];while(stack.length>0){var node=stack.pop();node.outDegree--;if(node.outDegree===0){node.zeroDerivativesImpl();var n=node.parents.length;while(n--)stack.push(node.parents[n])}}};Node.prototype.zeroDerivatives=function(){this.computeOutDegree();this.zeroDerivativesRec()};Node.prototype.backward=function(){};function ScalarNode(x,parents,inputs,backward,name){Node.call(this,x,parents,inputs,backward,name||"scalarNode");this.dx=0}ScalarNode.prototype=Object.create(Node.prototype);ScalarNode.prototype.copy=function(other){Node.prototype.copy.call(this,other);this.dx=other.dx};ScalarNode.prototype.clone=function(){var node=Object.create(ScalarNode.prototype);node.copy(this);return node};ScalarNode.prototype.backprop=function(){this.dx=1;this.computeOutDegree();this.backpropRec()};ScalarNode.prototype.zeroDerivativesImpl=function(){this.dx=0};function TensorNode(x,parents,inputs,backward,name){Node.call(this,x,parents,inputs,backward,name||"tensorNode");this.dx=new Tensor(x.dims)}TensorNode.prototype=Object.create(Node.prototype);TensorNode.prototype.copy=function(other){Node.prototype.copy.call(this,other);this.x=other.x.clone();this.dx=other.dx.clone()};TensorNode.prototype.clone=function(){var node=Object.create(Tensor.prototype);node.copy(this);return node};TensorNode.prototype.refCopy=function(other){Node.prototype.copy.call(this,other);this.x=other.x.refClone();this.dx=other.dx.refClone()};TensorNode.prototype.refClone=function(){var node=Object.create(TensorNode.prototype);node.refCopy(this);return node};TensorNode.prototype.backprop=function(){this.dx.fill(1);this.computeOutDegree();this.backpropRec()};TensorNode.prototype.zeroDerivativesImpl=function(){this.dx.zero()};module.exports={Node:Node,ScalarNode:ScalarNode,TensorNode:TensorNode}},{"../tensor.js":31}],14:[function(require,module,exports){"use strict";var utils=require("../utils.js");var graph=require("./graph.js");var Tensor=require("../tensor.js");var Node=graph.Node;var ScalarNode=graph.ScalarNode;var TensorNode=graph.TensorNode;var emptylist=[];function liftScalar(x,name){return new ScalarNode(x,emptylist,emptylist,undefined,name)}function liftTensor(x,name){return new TensorNode(x,emptylist,emptylist,undefined,name)}function doLift(x,name){return x instanceof Tensor?liftTensor(x,name):liftScalar(x,name)}var ad={lift:function(x,name){return x instanceof Node?x:doLift(x,name)},isLifted:function(x){return x instanceof Node},value:function(x){return x instanceof Node?x.x:x},derivative:function(x){return x.dx}};ad.params=function(dims,name){return ad.lift(new Tensor(dims).fillRandom(),name)};var func=require("./func.js");var functions=require("./functions.js");ad=utils.mergeObjects(ad,func,functions);module.exports=ad},{"../tensor.js":31,"../utils.js":32,"./func.js":11,"./functions.js":12,"./graph.js":13}],15:[function(require,module,exports){"use strict";var assert=require("assert");var utils=require("../utils.js");var Network=require("./network.js");function compound(fn,subnets,optname){function CompoundNetwork(subnets){Network.call(this);this.name=optname||"compoundNetwork";this.networks=subnets.slice();for(var i=0;i<subnets.length;i++){this.paramGetters=this.paramGetters.concat(subnets[i].paramGetters);this.paramSetters=this.paramSetters.concat(subnets[i].paramSetters)}this.paramGetters=utils.deduplicate(this.paramGetters);this.paramSetters=utils.deduplicate(this.paramSetters)}CompoundNetwork.prototype=Object.create(Network.prototype);CompoundNetwork.prototype.eval=fn;CompoundNetwork.prototype.setTraining=function(flag){Network.prototype.setTraining.call(this,flag);for(var i=0;i<this.networks.length;i++){this.networks[i].setTraining(flag)}};if(optname){CompoundNetwork.prototype.serializeJSON=function(){return{type:optname,networks:this.networks.map(function(n){return n.serializeJSON()})}};Network.deserializers[optname]=function(json){return new CompoundNetwork(json.networks.map(function(jn){return Network.deserializeJSON(jn)}))}}else{CompoundNetwork.prototype.serializeJSON=function(){assert(false,"Cannot serialize unnamed compound network.")}}return new CompoundNetwork(subnets)}function ASTNode(type,parents){this.type=type;this.parents=parents||[]}function SelectNetwork(i){Network.call(this);this.name="select";this.i=i}SelectNetwork.prototype=Object.create(Network.prototype);SelectNetwork.prototype.eval=function(tensors){return tensors[this.i]};SelectNetwork.prototype.serializeJSON=function(){return{type:"select",i:this.i}};Network.deserializers.select=function(json){return new SelectNetwork(json.i)};ASTNode.prototype.split=function(n){var nodes=new Array(n);for(var i=0;i<n;i++){var net=new SelectNetwork(i);nodes[i]=net.compose(this)}return nodes};function input(){return new ASTNode("input")}Network.prototype.compose=function(){var node=new ASTNode("compose",Array.prototype.slice.call(arguments));node.network=this;return node};function compile(inputs,outputs,optname,optDebug){for(var i=0;i<inputs.length;i++){assert(inputs[i].type==="input","Inputs to composite neural network must be nn.ast.input()")}var visited=[];for(var i=0;i<outputs.length;i++){var fringe=[outputs[i]];while(fringe.length>0){var node=fringe.pop();if(!(node.type==="input")&&visited.indexOf(node)===-1){visited.push(node);for(var i=0;i<node.parents.length;i++){fringe.push(node.parents[i])}}}}visited.reverse();var body="var args = arguments;\n";var outs=[];for(var i=0;i<visited.length;i++){var node=visited[i];var ins=node.parents.map(function(p){var i=inputs.indexOf(p);if(i!==-1)return"args["+i+"]";i=visited.indexOf(p);if(i!==-1)return"r"+i;assert(false,"impossible")});body+="var r"+i+" = this.networks["+i+"].eval("+ins+");\n";if(optDebug){var ri="r"+i;var ri_val=ri+"_val";var neti="this.networks["+i+"]";body+=["var "+ri_val+" = "+ri+".x || "+ri+";","if (!"+ri_val+".isFinite().allreduce()) {",'\tvar err = "Non-finite value in output of network '+i+' ("+'+neti+'.name+")\\n";','   err += "Output:\\n";','\terr += "["+'+ri_val+'.toString()+"]\\n";','   err += "Inputs:\\n";',ins.map(function(input){var inval="("+input+".x || "+input+")";return'\terr += "["+'+inval+'.toString()+"]\\n";'}).join("\n"),"   throw new Error(err);","}"].join("\n")}if(outputs.indexOf(node)!==-1){outs.push("r"+i)}}body+="return "+(outs.length>1?"["+outs+"]":outs[0])+";";var fn=new Function(body);var networks=visited.map(function(n){return n.network});var net=compound(fn,networks);net.name=optname||"compiledNetwork";net.nodes=inputs.concat(visited);net.inputs=inputs.map(function(n){return net.nodes.indexOf(n)});net.outputs=outputs.map(function(n){return net.nodes.indexOf(n)});net.serializeJSON=function(){var jnodes=this.nodes.map(function(n){var jn={type:n.type,parents:n.parents.map(function(p){return this.nodes.indexOf(p)}.bind(this))};if(jn.type==="compose"){jn.network=n.network.serializeJSON()}return jn}.bind(this));return{type:"compiled",name:this.name,nodes:jnodes,inputs:this.inputs,outputs:this.outputs}};return net}Network.deserializers.compiled=function(json){var nodes=[];for(var i=0;i<json.nodes.length;i++){var jn=json.nodes[i];var n=new ASTNode(jn.type,jn.parents.map(function(pi){return nodes[pi]}));if(jn.type==="compose"){n.network=Network.deserializeJSON(jn.network)}nodes.push(n)}var inputs=json.inputs.map(function(i){return nodes[i]});var outputs=json.outputs.map(function(i){return nodes[i]});return compile(inputs,outputs,json.name)};function sequence(networks,optname,optDebug){var inputNode=input();var currNode=inputNode;for(var i=0;i<networks.length;i++){currNode=networks[i].compose(currNode)}var net=compile([inputNode],[currNode],undefined,optDebug);net.name=optname||"sequenceNetwork";net.serializeJSON=function(){return{type:"sequence",name:this.name,networks:this.networks.map(function(n){return n.serializeJSON()})}};return net}Network.deserializers.sequence=function(json){var networks=json.networks.map(function(jn){return Network.deserializeJSON(jn)});return sequence(networks,json.name)};module.exports={compound:compound,ast:{input:input,compile:compile},sequence:sequence}},{"../utils.js":32,"./network.js":18,assert:248}],16:[function(require,module,exports){"use strict";var utils=require("../utils.js");var Network=require("./network.js");module.exports={Network:Network,deserializeJSON:Network.deserializeJSON};var lifting=require("./lifting.js");var composition=require("./composition.js");var lifted=require("./networks/lifted.js");var linear=require("./networks/linear.js");var convolution=require("./networks/convolution.js");var pooling=require("./networks/pooling.js");var activation=require("./networks/activation.js");var perceptron=require("./networks/perceptron.js");var misc=require("./networks/misc.js");module.exports=utils.mergeObjects(module.exports,lifting,composition,lifted,linear,convolution,pooling,activation,perceptron,misc)},{"../utils.js":32,"./composition.js":15,"./lifting.js":17,"./network.js":18,"./networks/activation.js":19,"./networks/convolution.js":20,"./networks/lifted.js":21,"./networks/linear.js":22,"./networks/misc.js":23,"./networks/perceptron.js":24,"./networks/pooling.js":25}],17:[function(require,module,exports){"use strict";var Network=require("./network.js");function lift(adfn,optname){var net=new Network;net.eval=adfn;net.name=optname||"liftedNetwork";if(optname){net.serializeJSON=function(){return{type:optname}};Network.deserializers[optname]=function(json){return net}}else{net.serializeJSON=function(){assert(false,"Cannot serialize unnamed lifted network.")}}return net}function partialeval(adfn,name){var netCreateFn=function(){var partialargs=Array.prototype.slice.call(arguments);var fnToLift=function(t){var tensorargs=Array.prototype.slice.call(arguments);return adfn.apply(null,tensorargs.concat(partialargs))};var net=lift(fnToLift);net.name=name;if(name){net.serializeJSON=function(){var json={type:name};for(var i=0;i<partialargs.length;i++){json["arg"+i]=partialargs[i]}return json}}return net};if(name){Network.deserializers[name]=function(json){var args=[];for(var prop in json){if(prop.startsWith("arg")){var idx=parseInt(prop.slice(3));args[idx]=json[prop]}}return netCreateFn.apply(null,args)}}return netCreateFn}module.exports={lift:lift,partialeval:partialeval}},{"./network.js":18}],18:[function(require,module,exports){"use strict";var assert=require("assert");function Network(){this.name="";this.isTraining=false;this.paramGetters=[];this.paramSetters=[]}Network.prototype.eval=function(){assert(false,"Neural networks must implement the 'eval' method.")};Network.prototype.getParameters=function(){if(this.__parameters===undefined){this.__parameters=this.paramGetters.map(function(f){return f()})}return this.__parameters};Network.prototype.setParameters=function(params){if(params.length!==this.paramSetters.length){assert(false,"Network.setParameters: size mismatch (network has "+this.paramSetters.length+" parameters, not "+params.length)}for(var i=0;i<params.length;i++){this.paramSetters[i](params[i])}this.__parameters=params.slice()};Network.prototype.setTraining=function(boolflag){this.isTraining=boolflag};Network.prototype.serializeJSON=function(){assert(false,"Neural networks must implement the 'serializeJSON' method.")};Network.deserializers={};Network.deserializeJSON=function(json){assert(json.type!==undefined,"Network JSON blob has no 'type' field.");assert(Network.deserializers.hasOwnProperty(json.type),"Network JSON blob has unrecognized type '"+json.type+"'");return Network.deserializers[json.type](json)};module.exports=Network},{assert:248}],19:[function(require,module,exports){"use strict";var Tensor=require("../../tensor.js");var ad=require("../../ad");var lift=require("../lifting.js").lift;var relu=lift(ad.newUnaryFunction({OutputType:Tensor,name:"relu",forward:function(x){x=ad.value(x);var y=x.clone();var n=x.length;while(n--){y.data[n]=y.data[n]<0?0:y.data[n]}return y},backward:function(x){var n=x.x.length;while(n--){x.dx.data[n]+=x.x.data[n]<=0?0:this.dx.data[n]}}}),"relu");var sigmoidCentered=lift(function(x){return ad.tensor.sub(ad.tensor.mul(ad.tensor.sigmoid(x),2),1)});module.exports={relu:relu,sigmoidCentered:sigmoidCentered}},{"../../ad":14,"../../tensor.js":31,"../lifting.js":17}],20:[function(require,module,exports){"use strict";var Tensor=require("../../tensor.js");var ad=require("../../ad");var Network=require("../network.js");var assert=require("assert");function ConvolutionNetwork(nIn,nOut,fW,fH,sX,sY,pX,pY,optname){Network.call(this);this.name=optname||"convolution";this.inDepth=nIn;this.outDepth=nOut;this.filterWidth=fW;this.filterHeight=fH;this.strideX=sX;this.strideY=sY;this.padX=pX;this.padY=pY;this.filters=ad.params([nOut,nIn,fH,fW],this.name+"_filters");this.biases=ad.params([nOut],this.name+"_biases");this.paramGetters=[function(){return this.filters}.bind(this),function(){return this.biases}.bind(this)];this.paramSetters=[function(filters){this.filters=filters}.bind(this),function(biases){this.biases=biases}.bind(this)]}ConvolutionNetwork.prototype=Object.create(Network.prototype);ConvolutionNetwork.prototype.serializeJSON=function(){return{type:"convolution",name:this.name,inDepth:this.inDepth,outDepth:this.outDepth,filterWidth:this.filterWidth,filterHeight:this.filterHeight,strideX:this.strideX,strideY:this.strideY,padX:this.padX,padY:this.padY,filters:ad.value(this.filters).toFlatArray(),biases:ad.value(this.biases).toFlatArray()}};Network.deserializers.convolution=function(json){var net=new ConvolutionNetwork(json.inDepth,json.outDepth,json.filterWidth,json.filterHeight,json.strideX,json.strideY,json.padX,json.padY,json.name);ad.value(net.filters).fromFlatArray(json.filters);ad.value(net.biases).fromFlatArray(json.biases);return net};var convolve=ad.newFunction({OutputType:Tensor,name:"convolution",forward:function(inImg,filters,biases,strideX,strideY,padX,padY){inImg=ad.value(inImg);filters=ad.value(filters);biases=ad.value(biases);var fH=filters.dims[2];var fW=filters.dims[3];var iD=inImg.dims[0];var iH=inImg.dims[1];var iW=inImg.dims[2];var oD=filters.dims[0];var oH=Math.floor((iH+2*padY-fH)/strideY+1);var oW=Math.floor((iW+2*padX-fW)/strideX+1);if(iD!==filters.dims[1]){assert(false,"Convolutional network: input depth is "+iD+" but should be "+filters.dims[1])}var outImg=new Tensor([oD,oH,oW]);for(var d=0;d<oD;d++){var x=-padX;var y=-padY;for(var ay=0;ay<oH;y+=strideY,ay++){x=-padX;for(var ax=0;ax<oW;x+=strideX,ax++){var a=biases.data[d];for(var fd=0;fd<iD;fd++){for(var fy=0;fy<fH;fy++){var iy=y+fy;for(var fx=0;fx<fW;fx++){var ix=x+fx;if(iy>=0&&iy<iH&&ix>=0&&ix<iW){var iIdx=ix+iW*(iy+iH*fd);var fIdx=fx+fW*(fy+fH*(fd+iD*d));a+=filters.data[fIdx]*inImg.data[iIdx]}}}}outImg.data[ax+oW*(ay+oH*d)]=a}}}return outImg},backward:function(inImg,filters,biases,strideX,strideY,padX,padY){var inImgP=ad.value(inImg);var filtersP=ad.value(filters);var biasesP=ad.value(biases);var iIs=inImg!==inImgP;var fIs=filters!==filtersP;var bIs=biases!==biasesP;var fH=filtersP.dims[2];var fW=filtersP.dims[3];var iD=inImgP.dims[0];var iH=inImgP.dims[1];var iW=inImgP.dims[2];var oD=filtersP.dims[0];var oH=this.x.dims[1];var oW=this.x.dims[2];for(var d=0;d<oD;d++){var x=-padX;var y=-padY;for(var ay=0;ay<oH;y+=strideY,ay++){x=-padX;for(var ax=0;ax<oW;x+=strideX,ax++){var thisGrad=this.dx.data[ax+oW*(ay+oH*d)];if(bIs)biases.dx.data[d]+=thisGrad;for(var fd=0;fd<iD;fd++){for(var fy=0;fy<fH;fy++){var iy=y+fy;for(var fx=0;fx<fW;fx++){var ix=x+fx;if(iy>=0&&iy<iH&&ix>=0&&ix<iW){var iIdx=ix+iW*(iy+iH*fd);var fIdx=fx+fW*(fy+fH*(fd+iD*d));if(iIs){inImg.dx.data[iIdx]+=filtersP.data[fIdx]*thisGrad}if(fIs){filters.dx.data[fIdx]+=inImgP.data[iIdx]*thisGrad}}}}}}}}},getParents:function(inImg,filters,biases,strideX,strideY,padX,padY){var p=[];if(ad.isLifted(inImg))p.push(inImg);if(ad.isLifted(filters))p.push(filters);if(ad.isLifted(biases))p.push(biases);return p}});ConvolutionNetwork.prototype.eval=function(img){var filters=this.isTraining?this.filters:ad.value(this.filters);var biases=this.isTraining?this.biases:ad.value(this.biases);return convolve(img,filters,biases,this.strideX,this.strideY,this.padX,this.padY)};function convolution(opts,optname){var nIn=opts.inDepth||1;var nOut=opts.outDepth||1;var fW=opts.filterWidth||opts.filterSize;var fH=opts.filterHeight||opts.filterSize;var sX=opts.strideX||opts.stride||1;var sY=opts.strideY||opts.stride||1;var pX=opts.padX||opts.pad||"same";var pY=opts.padY||opts.pad||"same";if(pX==="same"){pX=Math.floor((fW-1)/2)}if(pY==="same"){pY=Math.floor((fH-1)/2)}return new ConvolutionNetwork(nIn,nOut,fW,fH,sX,sY,pX,pY,optname)}module.exports={convolution:convolution,convolve:convolve}},{"../../ad":14,"../../tensor.js":31,"../network.js":18,assert:248}],21:[function(require,module,exports){"use strict";var adfunctions=require("../../ad/functions.js");var lifting=require("../lifting.js");module.exports={};for(var fnname in adfunctions.tensor){module.exports[fnname]=lifting.lift(adfunctions.tensor[fnname],fnname)}module.exports.range=lifting.partialeval(adfunctions.tensor.range,"range");module.exports.split=lifting.partialeval(adfunctions.tensor.split,"split");module.exports.reshape=lifting.partialeval(adfunctions.tensor.reshape,"reshape")},{"../../ad/functions.js":12,"../lifting.js":17}],22:[function(require,module,exports){"use strict";var Tensor=require("../../tensor.js");var ad=require("../../ad");var Network=require("../network.js");var assert=require("assert");function LinearNetwork(nIn,nOut,optname){Network.call(this);this.name=optname||"linear";this.inSize=nIn;this.outSize=nOut;this.weights=ad.params([nOut,nIn],this.name+"_weights");this.biases=ad.params([nOut],this.name+"_biases");this.paramGetters=[function(){return this.weights}.bind(this),function(){return this.biases}.bind(this)];this.paramSetters=[function(weights){this.weights=weights}.bind(this),function(biases){this.biases=biases}.bind(this)]}LinearNetwork.prototype=Object.create(Network.prototype);LinearNetwork.prototype.serializeJSON=function(){return{type:"linear",name:this.name,inSize:this.inSize,outSize:this.outSize,weights:ad.value(this.weights).toFlatArray(),biases:ad.value(this.biases).toFlatArray()}};Network.deserializers.linear=function(json){var net=new LinearNetwork(json.inSize,json.outSize,json.name);ad.value(net.weights).fromFlatArray(json.weights);ad.value(net.biases).fromFlatArray(json.biases);return net};var mvmuladd=ad.newFunction({OutputType:Tensor,name:"mvmuladd",forward:function(A,x,b){A=ad.value(A);x=ad.value(x);b=ad.value(b);var w=x.length;var h=b.length;if(w!==A.dims[1]){assert(false,"Linear network: input size is "+w+" but should be "+A.dims[1])}var y=b.clone();for(var r=0;r<h;r++){var off=r*w;for(var c=0;c<w;c++){y.data[r]+=A.data[off+c]*x.data[c]}}return y},backward:function(A,x,b){var Ap=ad.value(A);var xp=ad.value(x);var bp=ad.value(b);var aIs=A!==Ap;var xIs=x!==xp;var bIs=b!==bp;var w=xp.length;var h=bp.length;for(var r=0;r<h;r++){var off=r*w;var thisdx=this.dx.data[r];if(bIs){b.dx.data[r]+=thisdx}for(var c=0;c<w;c++){if(xIs){x.dx.data[c]+=Ap.data[off+c]*thisdx}if(aIs){A.dx.data[off+c]+=xp.data[c]*thisdx}}}},getParents:ad.naryGetParents});LinearNetwork.prototype.eval=function(x){var A=this.isTraining?this.weights:ad.value(this.weights);var b=this.isTraining?this.biases:ad.value(this.biases);return mvmuladd(A,x,b)};function linear(nIn,nOut,optname){return new LinearNetwork(nIn,nOut,optname)}function LayerwiseLinearNetwork(nIn,nOut,optname){Network.call(this);this.name=optname||"layerwiseLinear";this.inSize=nIn;this.outSize=nOut;this.weights=ad.params([nOut,nIn],this.name+"_weights");this.biases=ad.params([nOut],this.name+"_biases");this.paramGetters=[function(){return this.weights}.bind(this),function(){return this.biases}.bind(this)];this.paramSetters=[function(weights){this.weights=weights}.bind(this),function(biases){this.biases=biases}.bind(this)]}LayerwiseLinearNetwork.prototype=Object.create(Network.prototype);LayerwiseLinearNetwork.prototype.serializeJSON=function(){return{type:"layerwiseLinear",name:this.name,inSize:this.inSize,outSize:this.outSize,weights:ad.value(this.weights).toFlatArray(),biases:ad.value(this.biases).toFlatArray()}};Network.deserializers.layerwiseLinear=function(json){var net=new LayerwiseLinearNetwork(json.inSize,json.outSize,json.name);ad.value(net.weights).fromFlatArray(json.weights);ad.value(net.biases).fromFlatArray(json.biases);return net};var layerwiseMVMulAdd=ad.newFunction({OutputType:Tensor,name:"layerwiseMVMulAdd",forward:function(img,weights,biases){img=ad.value(img);weights=ad.value(weights);biases=ad.value(biases);var inD=img.dims[0];if(inD!==weights.dims[1]){assert(false,"LayerwiseLinear Network: input depth is "+inD+" but should be "+weights.dims[1])}var h=img.dims[1];var w=img.dims[2];var outD=weights.dims[0];var outImg=new Tensor([outD,h,w]);for(var y=0;y<h;y++){for(var x=0;x<w;x++){for(var od=0;od<outD;od++){var outIdx=x+w*(y+h*od);outImg.data[outIdx]=biases.data[od];for(var id=0;id<inD;id++){var wIdx=id+od*inD;var wt=weights.data[wIdx];var inIdx=x+w*(y+h*id);var imval=img.data[inIdx];outImg.data[outIdx]+=wt*imval}}}}return outImg},backward:function(img,weights,biases){var imgp=ad.value(img);var weightsp=ad.value(weights);var biasesp=ad.value(biases);var imgIs=img!==imgp;var weightsIs=weights!==weightsp;var biasesIs=biases!==biasesp;var h=imgp.dims[1];var w=imgp.dims[2];var outD=weightsp.dims[0];var inD=weightsp.dims[1];for(var y=0;y<h;y++){for(var x=0;x<w;x++){for(var od=0;od<outD;od++){var outIdx=x+w*(y+h*od);var thisdx=this.dx.data[outIdx];if(biasesIs){biases.dx.data[od]+=thisdx}for(var id=0;id<inD;id++){var wIdx=id+od*inD;var inIdx=x+w*(y+h*id);if(weightsIs){var imval=imgp.data[inIdx];weights.dx.data[wIdx]+=imval*thisdx}if(imgIs){var wt=weightsp.data[wIdx];img.dx.data[inIdx]+=wt*thisdx}}}}}},getParents:ad.naryGetParents});LayerwiseLinearNetwork.prototype.eval=function(img){var weights=this.isTraining?this.weights:ad.value(this.weights);var biases=this.isTraining?this.biases:ad.value(this.biases);return layerwiseMVMulAdd(img,weights,biases)};function layerwiseLinear(nIn,nOut,optname){return new LayerwiseLinearNetwork(nIn,nOut,optname)}module.exports={linear:linear,layerwiseLinear:layerwiseLinear}},{"../../ad":14,"../../tensor.js":31,"../network.js":18,assert:248}],23:[function(require,module,exports){"use strict";var ad=require("../../ad");var Network=require("../network.js");function ConstantParamNetwork(dims,optname){Network.call(this);this.name=optname||"constantparams";this.dims=dims;this.params=ad.params(dims,this.name);this.paramGetters=[function(){return this.params}.bind(this)];this.paramSetters=[function(params){this.params=params}.bind(this)]}ConstantParamNetwork.prototype=Object.create(Network.prototype);ConstantParamNetwork.prototype.eval=function(){return this.isTraining?this.params:ad.value(this.params)};ConstantParamNetwork.prototype.serializeJSON=function(){return{type:"constantparams",name:this.name,dims:this.dims,params:ad.value(this.params).toFlatArray()}};Network.deserializers.constantparams=function(json){var net=new ConstantParamNetwork(json.dims,json.name);ad.value(net.params).fromFlatArray(json.params);return net};function constantparams(dims,optname){return new ConstantParamNetwork(dims,optname)}module.exports={constantparams:constantparams}},{"../../ad":14,"../network.js":18}],24:[function(require,module,exports){"use strict";var sequence=require("../composition.js").sequence;var linear=require("./linear.js").linear;function mlp(nIn,layerdefs,optname,optDebug){optname=optname||"mlp";var nets=[];for(var i=0;i<layerdefs.length;i++){var ldef=layerdefs[i];nets.push(linear(nIn,ldef.nOut,optname+"_layer"+i));if(ldef.activation){nets.push(ldef.activation)}nIn=ldef.nOut}return sequence(nets,optname||"multiLayerPerceptron",optDebug)}module.exports={mlp:mlp}},{"../composition.js":15,"./linear.js":22}],25:[function(require,module,exports){"use strict";var Tensor=require("../../tensor.js");var ad=require("../../ad");var Network=require("../network.js");function MaxPoolNetwork(fW,fH,sX,sY,pX,pY){Network.call(this);this.filterWidth=fW;this.filterHeight=fH;this.strideX=sX;this.strideY=sY;this.padX=pX;this.padY=pY;this.name="maxpool"}MaxPoolNetwork.prototype=Object.create(Network.prototype);MaxPoolNetwork.prototype.serializeJSON=function(){return{type:"maxpool",filterWidth:this.filterWidth,filterHeight:this.filterHeight,strideX:this.strideX,strideY:this.strideY,padX:this.padX,padY:this.padY}};Network.deserializers.maxpool=function(json){return new MaxPoolNetwork(json.filterWidth,json.filterHeight,json.strideX,json.strideY,json.padX,json.padY)};var maxIndices;var maxpoolingImpl=ad.newFunction({OutputType:Tensor,name:"maxpooling",forward:function(inImg,fW,fH,sX,sY,pX,pY){inImg=ad.value(inImg);var D=inImg.dims[0];var iH=inImg.dims[1];var iW=inImg.dims[2];var oH=Math.floor((iH+2*pY-fH)/sY+1);var oW=Math.floor((iW+2*pX-fW)/sX+1);var outImg=new Tensor([D,oH,oW]);maxIndices=new Int32Array(D*oH*oW);for(var d=0;d<D;d++){var x=-pX;var y=-pY;for(var ay=0;ay<oH;y+=sY,ay++){x=-pX;for(var ax=0;ax<oW;x+=sX,ax++){var maxval=-Infinity;var maxidx=-1;for(var fy=0;fy<fH;fy++){var iy=y+fy;for(var fx=0;fx<fW;fx++){var ix=x+fx;if(iy>=0&&iy<iH&&ix>=0&&ix<iW){var idx=ix+iW*(iy+iH*d);var v=inImg.data[idx];if(v>maxval){maxval=v;maxidx=idx}}}}var outidx=ax+oW*(ay+oH*d);outImg.data[outidx]=maxval;maxIndices[outidx]=maxidx}}}return outImg},backward:function(inImg,fW,fH,sX,sY,pX,pY){var D=inImg.x.dims[0];var iH=inImg.x.dims[1];var iW=inImg.x.dims[2];var oH=this.x.dims[1];var oW=this.x.dims[2];for(var d=0;d<D;d++){var x=-pX;var y=-pY;for(var ay=0;ay<oH;y+=sY,ay++){x=-pX;for(var ax=0;ax<oW;x+=sX,ax++){var outidx=ax+oW*(ay+oH*d);var inidx=this.maxIndices[outidx];inImg.dx.data[inidx]+=this.dx.data[outidx]}}}},getParents:function(inImg,fW,fH,sX,sY,pX,pY){return ad.isLifted(inImg)?[inImg]:[]}});function maxpooling(inImg,fW,fH,sX,sY,pX,pY){var outImg=maxpoolingImpl(inImg,fW,fH,sX,sY,pX,pY);if(ad.isLifted(outImg)){outImg.maxIndices=maxIndices}return outImg}MaxPoolNetwork.prototype.eval=function(img){return maxpooling(img,this.filterWidth,this.filterHeight,this.strideX,this.strideY,this.padX,this.padY)};function maxpool(opts){var fW=opts.filterWidth||opts.filterSize;var fH=opts.filterHeight||opts.filterSize;var sX=opts.strideX||opts.stride||fW;var sY=opts.strideY||opts.stride||fH;var pX=opts.padX||opts.pad||0;var pY=opts.padY||opts.pad||0;return new MaxPoolNetwork(fW,fH,sX,sY,pX,pY)}function MinPoolNetwork(fW,fH,sX,sY,pX,pY){Network.call(this);this.filterWidth=fW;this.filterHeight=fH;this.strideX=sX;this.strideY=sY;this.padX=pX;this.padY=pY;this.name="minpool"}MinPoolNetwork.prototype=Object.create(Network.prototype);MinPoolNetwork.prototype.serializeJSON=function(){return{type:"minpool",filterWidth:this.filterWidth,filterHeight:this.filterHeight,strideX:this.strideX,strideY:this.strideY,padX:this.padX,padY:this.padY}};Network.deserializers.minpool=function(json){return new MinPoolNetwork(json.filterWidth,json.filterHeight,json.strideX,json.strideY,json.padX,json.padY)};var minIndices;var minpoolingImpl=ad.newFunction({OutputType:Tensor,name:"maxpooling",forward:function(inImg,fW,fH,sX,sY,pX,pY){inImg=ad.value(inImg);var D=inImg.dims[0];var iH=inImg.dims[1];var iW=inImg.dims[2];var oH=Math.floor((iH+2*pY-fH)/sY+1);var oW=Math.floor((iW+2*pX-fW)/sX+1);var outImg=new Tensor([D,oH,oW]);minIndices=new Int32Array(D*oH*oW);for(var d=0;d<D;d++){var x=-pX;var y=-pY;for(var ay=0;ay<oH;y+=sY,ay++){x=-pX;for(var ax=0;ax<oW;x+=sX,ax++){var minval=Infinity;var minidx=-1;for(var fy=0;fy<fH;fy++){var iy=y+fy;for(var fx=0;fx<fW;fx++){var ix=x+fx;if(iy>=0&&iy<iH&&ix>=0&&ix<iW){var idx=ix+iW*(iy+iH*d);var v=inImg.data[idx];if(v<minval){minval=v;minidx=idx}}}}var outidx=ax+oW*(ay+oH*d);outImg.data[outidx]=minval;minIndices[outidx]=minidx}}}return outImg},backward:function(inImg,fW,fH,sX,sY,pX,pY){var D=inImg.x.dims[0];var iH=inImg.x.dims[1];var iW=inImg.x.dims[2];var oH=this.x.dims[1];var oW=this.x.dims[2];for(var d=0;d<D;d++){var x=-pX;var y=-pY;for(var ay=0;ay<oH;y+=sY,ay++){x=-pX;for(var ax=0;ax<oW;x+=sX,ax++){var outidx=ax+oW*(ay+oH*d);var inidx=this.minIndices[outidx];inImg.dx.data[inidx]+=this.dx.data[outidx]}}}},getParents:function(inImg,fW,fH,sX,sY,pX,pY){return ad.isLifted(inImg)?[inImg]:[]}});function minpooling(inImg,fW,fH,sX,sY,pX,pY){var outImg=minpoolingImpl(inImg,fW,fH,sX,sY,pX,pY);if(ad.isLifted(outImg)){outImg.minIndices=minIndices}return outImg}MinPoolNetwork.prototype.eval=function(img){return minpooling(img,this.filterWidth,this.filterHeight,this.strideX,this.strideY,this.padX,this.padY)};function minpool(opts){var fW=opts.filterWidth||opts.filterSize;var fH=opts.filterHeight||opts.filterSize;var sX=opts.strideX||opts.stride||fW;var sY=opts.strideY||opts.stride||fH;var pX=opts.padX||opts.pad||0;var pY=opts.padY||opts.pad||0;return new MinPoolNetwork(fW,fH,sX,sY,pX,pY)}function MeanPoolNetwork(fW,fH,sX,sY,pX,pY){Network.call(this);this.filterWidth=fW;this.filterHeight=fH;this.strideX=sX;this.strideY=sY;this.padX=pX;this.padY=pY;this.name="meanpool"}MeanPoolNetwork.prototype=Object.create(Network.prototype);MeanPoolNetwork.prototype.serializeJSON=function(){return{type:"meanpool",filterWidth:this.filterWidth,filterHeight:this.filterHeight,strideX:this.strideX,strideY:this.strideY,padX:this.padX,padY:this.padY}};Network.deserializers.meanpool=function(json){return new MeanPoolNetwork(json.filterWidth,json.filterHeight,json.strideX,json.strideY,json.padX,json.padY)};var meanpooling=ad.newFunction({OutputType:Tensor,name:"meanpooling",forward:function(inImg,fW,fH,sX,sY,pX,pY){inImg=ad.value(inImg);var D=inImg.dims[0];var iH=inImg.dims[1];var iW=inImg.dims[2];var oH=Math.floor((iH+2*pY-fH)/sY+1);var oW=Math.floor((iW+2*pX-fW)/sX+1);var fN=fW*fH;var outImg=new Tensor([D,oH,oW]);for(var d=0;d<D;d++){var x=-pX;var y=-pY;for(var ay=0;ay<oH;y+=sY,ay++){x=-pX;for(var ax=0;ax<oW;x+=sX,ax++){var avgval=0;for(var fy=0;fy<fH;fy++){var iy=y+fy;for(var fx=0;fx<fW;fx++){var ix=x+fx;if(iy>=0&&iy<iH&&ix>=0&&ix<iW){var idx=ix+iW*(iy+iH*d);var v=inImg.data[idx];avgval+=v}}}var outidx=ax+oW*(ay+oH*d);outImg.data[outidx]=avgval/fN}}}return outImg},backward:function(inImg,fW,fH,sX,sY,pX,pY){var D=inImg.x.dims[0];var iH=inImg.x.dims[1];var iW=inImg.x.dims[2];var oH=this.x.dims[1];var oW=this.x.dims[2];var fN=fW*fH;for(var d=0;d<D;d++){var x=-pX;var y=-pY;for(var ay=0;ay<oH;y+=sY,ay++){x=-pX;for(var ax=0;ax<oW;x+=sX,ax++){var outidx=ax+oW*(ay+oH*d);var outDx=this.dx.data[outidx]/fN;for(var fy=0;fy<fH;fy++){var iy=y+fy;for(var fx=0;fx<fW;fx++){var ix=x+fx;if(iy>=0&&iy<iH&&ix>=0&&ix<iW){var inidx=ix+iW*(iy+iH*d);inImg.dx.data[inidx]+=outDx}}}}}}},getParents:function(inImg,fW,fH,sX,sY,pX,pY){return ad.isLifted(inImg)?[inImg]:[]}});MeanPoolNetwork.prototype.eval=function(img){return meanpooling(img,this.filterWidth,this.filterHeight,this.strideX,this.strideY,this.padX,this.padY)};function meanpool(opts){var fW=opts.filterWidth||opts.filterSize;var fH=opts.filterHeight||opts.filterSize;var sX=opts.strideX||opts.stride||fW;var sY=opts.strideY||opts.stride||fH;var pX=opts.padX||opts.pad||0;var pY=opts.padY||opts.pad||0;return new MeanPoolNetwork(fW,fH,sX,sY,pX,pY)}module.exports={maxpool:maxpool,minpool:minpool,meanpool:meanpool}},{"../../ad":14,"../../tensor.js":31,"../network.js":18}],26:[function(require,module,exports){"use strict";var utils=require("../utils.js");var methods=require("./methods.js");var optimize=require("./optimize.js");var loss=require("./loss.js");module.exports=utils.mergeObjects({},methods,optimize,loss)},{"../utils.js":32,"./loss.js":27,"./methods.js":28,"./optimize.js":29}],27:[function(require,module,exports){"use strict";var assert=require("assert");var ad=require("../ad");function classificationLoss(outputProbs,trueClassIndex){var n=ad.value(outputProbs).length;assert(trueClassIndex<n,"Training datum has true class label "+trueClassIndex+", but network only outputs "+n+" class probabilities.");return ad.scalar.neg(ad.scalar.log(ad.tensor.get(outputProbs,trueClassIndex)))}function regressionLoss(output,trueOutput){var n=ad.value(output).length;var m=trueOutput.length;assert(n===m,"Network output has different dimensionality than training data ("+n+" vs. "+m+")");var diff=ad.tensor.sub(output,trueOutput);return ad.tensor.sumreduce(ad.tensor.mul(diff,diff))}module.exports={classificationLoss:classificationLoss,regressionLoss:regressionLoss}},{"../ad":14,assert:248}],28:[function(require,module,exports){"use strict";var utils=require("../utils.js");var tstruct=require("./tensorStruct.js");var EPS=1e-8;function sgd(options){options=utils.mergeDefaults(options,{stepSize:.1,stepSizeDecay:1,mu:0});var stepSize=options.stepSize;var stepSizeIsFunction=typeof stepSize==="function";var decay=options.stepSizeDecay;var mu=options.mu;var vStruct;return function(grad,param,step){var stepSize_=stepSizeIsFunction?stepSize(step):stepSize;if(!vStruct)vStruct=tstruct.emptyLike(grad);tstruct.foreach(grad,[{struct:param,ifMissing:tstruct.ifMissing.impossible},{struct:vStruct,ifMissing:tstruct.ifMissing.zeros}],function(g,p,v){v.muleq(mu).subeq(g.mul(stepSize_));p.addeq(v)});if(!stepSizeIsFunction)stepSize*=decay}}function adagrad(options){options=utils.mergeDefaults(options,{stepSize:.1});var stepSize=options.stepSize;var stepSizeIsFunction=typeof stepSize==="function";var g2Struct;return function(grad,param,step){var stepSize_=stepSizeIsFunction?stepSize(step):stepSize;if(!g2Struct)g2Struct=tstruct.emptyLike(grad);tstruct.foreach(grad,[{struct:param,ifMissing:tstruct.ifMissing.impossible},{struct:g2Struct,ifMissing:tstruct.ifMissing.zeros}],function(g,p,g2){g2.addeq(g.mul(g));p.subeq(g.div(g2.sqrt().addeq(EPS)).muleq(stepSize_))})}}function rmsprop(options){options=utils.mergeDefaults(options,{stepSize:.1,decayRate:.9});var stepSize=options.stepSize;var stepSizeIsFunction=typeof stepSize==="function";var decayRate=options.decayRate;var g2Struct;return function(grad,param,step){var stepSize_=stepSizeIsFunction?stepSize(step):stepSize;if(!g2Struct)g2Struct=tstruct.emptyLike(grad);tstruct.foreach(grad,[{struct:param,ifMissing:tstruct.ifMissing.impossible},{struct:g2Struct,ifMissing:tstruct.ifMissing.zeros}],function(g,p,g2){g2.muleq(decayRate).addeq(g.mul(g).muleq(1-decayRate));p.subeq(g.div(g2.sqrt().addeq(EPS)).muleq(stepSize_))})}}function adam(options){options=utils.mergeDefaults(options,{stepSize:.001,decayRate1:.9,decayRate2:.999});var stepSize=options.stepSize;var stepSizeIsFunction=typeof stepSize==="function";var decayRate1=options.decayRate1;var decayRate2=options.decayRate2;var mStruct;var vStruct;return function(grad,param,step){var stepSize_=stepSizeIsFunction?stepSize(step):stepSize;var t=step+1;if(!mStruct)mStruct=tstruct.emptyLike(grad);if(!vStruct)vStruct=tstruct.emptyLike(grad);tstruct.foreach(grad,[{struct:param,ifMissing:tstruct.ifMissing.impossible},{struct:mStruct,ifMissing:tstruct.ifMissing.zeros},{struct:vStruct,ifMissing:tstruct.ifMissing.zeros}],function(g,p,m,v){m.muleq(decayRate1).addeq(g.mul(1-decayRate1));v.muleq(decayRate2).addeq(g.mul(g).muleq(1-decayRate2));var alpha_t=stepSize_*Math.sqrt(1-Math.pow(decayRate2,t))/(1-Math.pow(decayRate1,t));p.subeq(m.div(v.sqrt().addeq(EPS)).muleq(alpha_t))})}}module.exports={sgd:sgd,adagrad:adagrad,rmsprop:rmsprop,adam:adam}},{"../utils.js":32,"./tensorStruct.js":30}],29:[function(require,module,exports){"use strict";var assert=require("assert");var ad=require("../ad");var utils=require("../utils.js");var methods=require("./methods.js");var tstruct=require("./tensorStruct.js");function optimize(fn,options){options=utils.mergeDefaults(options,{iterations:100,method:methods.sgd(),verbose:false});var iters=options.iterations;var method=options.method;var verbose=options.verbose;for(var i=0;i<iters;i++){var rets=fn();assert(rets.gradients!==undefined);assert(rets.parameters!==undefined);method(rets.gradients,rets.parameters,i);if(verbose){console.log("[optimize] done iteration "+(i+1)+"/"+iters)}}}function makeOptimizable(fn){return function(){var rets=fn();assert(rets.parameters!==undefined);assert(rets.loss!==undefined);tstruct.foreach(rets.parameters,[],function(p){p.zeroDerivatives()});rets.loss.backprop();var newrets={gradients:tstruct.map(rets.parameters,ad.derivative),parameters:tstruct.map(rets.parameters,ad.value)};return newrets}}function adOptimize(fn,options){optimize(makeOptimizable(fn),options)}function adTrain(fn,trainingData,lossFn,options){options=utils.mergeDefaults(options,{batchSize:1});var batchSize=options.batchSize;var shuffle=options.shuffle;var idx=-1;var singleFn=makeOptimizable(function(){var trainingDatum=trainingData[idx];var rets=fn(trainingDatum.input);var loss=lossFn(rets.output,trainingDatum.output);return{parameters:rets.parameters,loss:loss}});var batchFn=function(){var gradients;var parameters;for(var i=0;i<batchSize;i++){idx=shuffle===false?(idx+1)%trainingData.length:Math.floor(Math.random()*trainingData.length);var rets=singleFn();if(gradients===undefined){gradients=rets.gradients;parameters=rets.parameters}else{tstruct.foreach(rets.gradients,[{struct:gradients,ifMissing:tstruct.ifMissing.zeros},{struct:rets.parameters,ifMissing:tstruct.ifMissing.impossible},{struct:parameters,ifMissing:tstruct.ifMissing.copyFromCoStruct(1)}],function(newg,g){g.addeq(newg)})}}if(batchSize>1){tstruct.foreach(gradients,[],function(g){g.diveq(batchSize)})}return{parameters:parameters,gradients:gradients}};optimize(batchFn,options)}function nnTrain(nn,trainingData,lossFn,options){var fn=function(input){return{output:nn.eval(input),parameters:nn.getParameters()}};nn.setTraining(true);adTrain(fn,trainingData,lossFn,options);nn.setTraining(false)}module.exports={optimize:optimize,adOptimize:adOptimize,adTrain:adTrain,nnTrain:nnTrain}},{"../ad":14,"../utils.js":32,"./methods.js":28,"./tensorStruct.js":30,assert:248}],30:[function(require,module,exports){"use strict";var assert=require("assert");var utils=require("../utils.js");var Tensor=require("../tensor.js");var ad=require("../ad");function type(struct){if(struct instanceof Tensor||ad.isLifted(struct)&&ad.value(struct)instanceof Tensor){return"tensor"}else if(Array.isArray(struct)){return"array"}else if(typeof struct==="object"){return"object"}else{throw new Error("Malformed Tensor structure; expected Tensor, Array, or object, got "+typeof x)}}function emptyLike(struct){var t=type(struct);if(t==="tensor"){return new Tensor(struct.dims)}else if(t==="array"){return[]}else if(t==="object"){return{}}}function map(struct,fn){var t=type(struct);if(t==="tensor"){return fn(struct)}else if(t==="array"){var ret=[];for(var i=0;i<struct.length;i++){ret[i]=map(struct[i],fn)}return ret}else if(t==="object"){var ret={};for(var prop in struct){ret[prop]=map(struct[prop],fn)}return ret}}function foreach(struct,coIteratees,fn){var _foreach;if(coIteratees.length===0){_foreach=function(struct){var t=type(struct);if(t==="tensor"){fn(struct)}else if(t==="array"){for(var i=0;i<struct.length;i++){_foreach(struct[i])}}else if(t==="object"){for(var prop in struct){_foreach(struct[prop])}}};_foreach(struct)}else{var missingFns=coIteratees.map(function(c){return c.ifMissing});_foreach=function(struct,coStructs){var t=type(struct);if(t==="tensor"){fn.apply(null,[struct].concat(coStructs))}else if(t==="array"){var subCoStructLists=[];for(var j=0;j<struct.length;j++){var subCoStructList=[];for(var i=0;i<coStructs.length;i++)subCoStructList.push(coStructs[i][j]);subCoStructLists.push(subCoStructList)}for(var i=0;i<coStructs.length;i++){var coStruct=coStructs[i];var missing=missingFns[i];var n=struct.length;var m=coStruct.length;for(var j=m;j<n;j++){var toAdd=missing(struct[j],subCoStructLists[j]);coStruct.push(toAdd);subCoStructLists[j][i]=toAdd}}for(var j=0;j<struct.length;j++){_foreach(struct[j],subCoStructLists[j])}}else if(t==="object"){var subCoStructLists={};for(var prop in struct){var subCoStructList=[];for(var i=0;i<coStructs.length;i++)subCoStructList.push(coStructs[i][prop]);subCoStructLists[prop]=subCoStructList}for(var i=0;i<coStructs.length;i++){var coStruct=coStructs[i];var missing=missingFns[i];for(var prop in struct){if(!coStruct.hasOwnProperty(prop)){var toAdd=missing(struct[prop],subCoStructLists[prop]);coStruct[prop]=toAdd;subCoStructLists[prop][i]=toAdd}}}for(var prop in struct){_foreach(struct[prop],subCoStructLists[prop])}}};var coStructs=coIteratees.map(function(c){return c.struct});_foreach(struct,coStructs,fn)}}var ifMissing={impossible:function(struct,coStructs){throw new Error("impossible for this struct to have missing elements")},zeros:function(struct,coStructs){return map(struct,function(x){return new Tensor(x.dims)})},copyFromStruct:function(struct,coStructs){return map(struct,function(x){return x})},copyFromCoStruct:function(index){return function(struct,coStructs){return map(coStructs[index],function(x){return x})}}};module.exports={emptyLike:emptyLike,map:map,foreach:foreach,ifMissing:ifMissing}},{"../ad":14,"../tensor.js":31,"../utils.js":32,assert:248}],31:[function(require,module,exports){"use strict";var assert=require("assert");var utils=require("./utils.js");function TypedArrayBackingStore(ArrayType){return{new:function(n){return new ArrayType(n)},set:function(tgt,src,offset){tgt.set(src,offset)}}}var ArrayBackingStore={ArrayType:Array,new:function(n){var a=new Array(n);while(n--){a[n]=0}return a},set:function(tgt,src,offset){for(var i=0;i<src.length;i++){tgt[i+offset]=src[i]}}};var BackingStore=TypedArrayBackingStore(Float64Array);function Tensor(dims){this.dims=dims;var size=1;var n=dims.length;while(n--)size*=dims[n];this.length=size;this.data=BackingStore.new(size)}Object.defineProperties(Tensor.prototype,{rank:{get:function(){return this.dims.length}}});Tensor.prototype.reshape=function(dims){var size=1;var n=dims.length;while(n--)size*=dims[n];assert(size===this.length,"Tensor reshape invalid size");this.dims=dims;return this};Tensor.prototype.fill=function(val){var n=this.length;while(n--)this.data[n]=val;return this};Tensor.prototype.zero=function(){return this.fill(0)};Tensor.prototype.fillRandom=function(){var scale=1/this.length;var n=this.length;while(n--)this.data[n]=utils.gaussianSample(0,scale);return this};Tensor.prototype.copy=function(other,offset){offset=offset||0;BackingStore.set(this.data,other.data,offset);return this};Tensor.prototype.clone=function(){var copy=new Tensor(this.dims);return copy.copy(this)};Tensor.prototype.refCopy=function(other){this.dims=other.dims;this.length=other.length;this.data=other.data;return this};Tensor.prototype.refClone=function(){var t=Object.create(Tensor.prototype);return t.refCopy(this)};Tensor.prototype.get=function(coords){var idx=0;var n=this.dims.length;for(var i=0;i<n;i++){idx=idx*this.dims[i]+coords[i]}return this.data[idx]};Tensor.prototype.set=function(coords,val){var idx=0;var n=this.dims.length;for(var i=0;i<n;i++){idx=idx*this.dims[i]+coords[i]}this.data[idx]=val};function toArrayRec(tensor,coords){if(coords.length===tensor.rank){return tensor.get(coords)}else{var dim=coords.length;var arr=[];for(var i=0;i<tensor.dims[dim];i++){arr.push(toArrayRec(tensor,coords.concat([i])))}return arr}}Tensor.prototype.toArray=function(){return toArrayRec(this,[])};function fromArrayRec(tensor,coords,x){if(!(x instanceof Array)){tensor.set(coords,x)}else{var dim=coords.length;for(var i=0;i<tensor.dims[dim];i++){fromArrayRec(tensor,coords.concat([i]),x[i])}}}Tensor.prototype.fromArray=function(arr){fromArrayRec(this,[],arr);return this};Tensor.prototype.toString=function(){return this.toArray().toString()};Tensor.prototype.toFlatArray=function(){return Array.prototype.slice.call(this.data)};Tensor.prototype.fromFlatArray=function(arr){BackingStore.set(this.data,arr,0);return this};function addUnaryMethod(name,fncode){var fneq=new Function(["var n = this.data.length;","while (n--) {","\tvar x = this.data[n];","\tthis.data[n] = "+fncode+";","}","return this;"].join("\n"));Tensor.prototype[name+"eq"]=fneq;Tensor.prototype[name]=function(){var nt=this.clone();return fneq.call(nt)}}function addBinaryMethod(name,fncode){var fneqS=new Function("s",["var n = this.data.length;","var b = s;","while (n--) {","\tvar a = this.data[n];","\tthis.data[n] = "+fncode+";","}","return this;"].join("\n"));var fneqT=new Function("t",["var n = this.data.length;","while (n--) {","\tvar a = this.data[n];","\tvar b = t.data[n];","\tthis.data[n] = "+fncode+";","}","return this;"].join("\n"));var fneq=function(x){if(x.constructor===Tensor)return fneqT.call(this,x);else return fneqS.call(this,x)};Tensor.prototype[name+"eq"]=fneq;Tensor.prototype[name]=function(x){var nt=this.clone();return fneq.call(nt,x)}}function addReduction(name,initcode,fncode){Tensor.prototype[name+"reduce"]=new Function(["var accum = "+initcode+";","var n = this.data.length;","while (n--) {","\tvar x = this.data[n];","\taccum = "+fncode+";","}","return accum;"].join("\n"))}addUnaryMethod("neg","-x");addUnaryMethod("round","Math.round(x)");addUnaryMethod("log","Math.log(x)");addUnaryMethod("exp","Math.exp(x)");addUnaryMethod("sqrt","Math.sqrt(x)");addUnaryMethod("abs","Math.abs(x)");addUnaryMethod("ceil","Math.ceil(x)");addUnaryMethod("floor","Math.floor(x)");addUnaryMethod("cos","Math.cos(x)");addUnaryMethod("sin","Math.sin(x)");addUnaryMethod("tan","Math.tan(x)");addUnaryMethod("acos","Math.acos(x)");addUnaryMethod("asin","Math.asin(x)");addUnaryMethod("atan","Math.atan(x)");addUnaryMethod("cosh","Math.cosh(x)");addUnaryMethod("sinh","Math.sinh(x)");addUnaryMethod("tanh","Math.tanh(x)");addUnaryMethod("acosh","Math.acosh(x)");addUnaryMethod("asinh","Math.asinh(x)");addUnaryMethod("atanh","Math.atanh(x)");addUnaryMethod("sigmoid","1 / (1 + Math.exp(-x))");addUnaryMethod("isFinite","isFinite(x)");addUnaryMethod("isNaN","isNaN(x)");addUnaryMethod("invert","1/x");addUnaryMethod("pseudoinvert","x === 0 ? 0 : 1/x");addBinaryMethod("add","a + b");addBinaryMethod("sub","a - b");addBinaryMethod("mul","a * b");addBinaryMethod("div","a / b");addBinaryMethod("mod","a % b");addBinaryMethod("min","Math.min(a, b)");addBinaryMethod("max","Math.max(a, b)");addBinaryMethod("pow","Math.pow(a, b)");addBinaryMethod("atan2","Math.atan2(a, b)");addBinaryMethod("eq","a === b");addBinaryMethod("neq","a !== b");addBinaryMethod("gt","a > b");addBinaryMethod("ge","a >= b");addBinaryMethod("lt","a < b");addBinaryMethod("le","a <= b");addReduction("sum","0","accum + x");addReduction("min","Infinity","Math.min(accum, x)");addReduction("max","-Infinity","Math.max(accum, x)");addReduction("all","true","accum && (x !== 0)");addReduction("any","false","accum || (x !== 0)");Tensor.prototype.softmax=function(){var max=-Infinity;var n=this.data.length;while(n--){max=Math.max(max,this.data[n])}var t=new Tensor(this.dims);n=this.data.length;var sum=0;while(n--){t.data[n]=Math.exp(this.data[n]-max);sum+=t.data[n]}n=this.data.length;while(n--){t.data[n]/=sum}return t};Tensor.prototype.transpose=function(){assert.ok(this.rank===2);var h=this.dims[0];var w=this.dims[1];var y=new Tensor([w,h]);for(var i=0;i<h;i++){for(var j=0;j<w;j++){y.data[j*h+i]=this.data[i*w+j]}}return y};Tensor.prototype.diagonal=function(){assert.ok(this.rank===2);assert.ok(this.dims[1]===1);var n=this.dims[0];var y=new Tensor([n,n]);for(var i=0;i<n;i++){y.data[i*(n+1)]=this.data[i]}return y};Tensor.prototype.inverse=function(){assert.ok(this.rank===2);assert.ok(this.dims[0]===this.dims[1]);var n=this.dims[0];var Ai,Aj;var Ii,Ij;var i,j,k,x;var A=[];for(i=0;i<n;i++){Ai=new Float64Array(n);A.push(Ai);for(j=0;j<n;j++){Ai[j]=this.data[i*n+j]}}var I=[];for(i=0;i<n;i++){Ii=new Array(n);I.push(Ii);for(j=0;j<n;j++){Ii[j]=i===j?1:0}}for(j=0;j<n;++j){var i0=-1;var v0=-1;for(i=j;i!==n;++i){k=Math.abs(A[i][j]);if(k>v0){i0=i;v0=k}}Aj=A[i0];A[i0]=A[j];A[j]=Aj;Ij=I[i0];I[i0]=I[j];I[j]=Ij;x=Aj[j];for(k=j;k!==n;++k){Aj[k]/=x}for(k=n-1;k!==-1;--k){Ij[k]/=x}for(i=n-1;i!==-1;--i){if(i!==j){Ai=A[i];Ii=I[i];x=Ai[j];for(k=j+1;k!==n;++k){Ai[k]-=Aj[k]*x}for(k=n-1;k>0;--k){Ii[k]-=Ij[k]*x;--k;Ii[k]-=Ij[k]*x}if(k===0){Ii[0]-=Ij[0]*x}}}}return new Tensor([n,n]).fromArray(I)};Tensor.prototype.determinant=function(){assert.ok(this.rank===2);assert.ok(this.dims[0]===this.dims[1]);var n=this.dims[0];var ret=1;var i,j,k;var Aj,Ai,alpha,temp,k1,k2,k3;var A=[];for(i=0;i<n;i++){Ai=new Float64Array(n);A.push(Ai);for(j=0;j<n;j++){Ai[j]=this.data[i*n+j]}}for(j=0;j<n-1;j++){k=j;for(i=j+1;i<n;i++){if(Math.abs(A[i][j])>Math.abs(A[k][j])){k=i}}if(k!==j){temp=A[k];A[k]=A[j];A[j]=temp;ret*=-1}Aj=A[j];for(i=j+1;i<n;i++){Ai=A[i];alpha=Ai[j]/Aj[j];for(k=j+1;k<n-1;k+=2){k1=k+1;Ai[k]-=Aj[k]*alpha;Ai[k1]-=Aj[k1]*alpha}if(k!==n){Ai[k]-=Aj[k]*alpha}}if(Aj[j]===0){return 0}ret*=Aj[j]}return ret*A[j][j]};Tensor.prototype.dot=function(t){var a=this,b=t;if(a.rank!==2||b.rank!==2){throw new Error("Inputs to dot should have rank = 2.")}if(a.dims[1]!==b.dims[0]){throw new Error("Dimension mismatch in dot. Inputs have dimension "+a.dims+" and "+b.dims+".")}var l=a.dims[1];var h=a.dims[0],w=b.dims[1];var y=new Tensor([h,w]);for(var r=0;r<h;r++){for(var c=0;c<w;c++){var z=0;for(var i=0;i<l;i++){z+=a.data[r*l+i]*b.data[w*i+c]}y.data[r*w+c]=z}}return y};Tensor.prototype.cholesky=function(){var a=this;assert.ok(a.rank===2&&a.dims[0]===a.dims[1],"cholesky is only defined for square matrices.");var s;var n=a.dims[0];var L=new Tensor([n,n]);for(var i=0;i<n;i++){for(var j=0;j<=i;j++){s=0;for(var k=0;k<j;k++){s+=L.data[i*n+k]*L.data[j*n+k]}L.data[i*n+j]=i===j?Math.sqrt(a.data[i*n+i]-s):1/L.data[j*n+j]*(a.data[i*n+j]-s)}}return L};Tensor.prototype.tril=function(){var a=this;assert.ok(a.rank===2&&a.dims[0]===a.dims[1],"tril is only defined for square matrices.");var n=a.dims[0];var ret=new Tensor([n,n]);for(var i=0;i<n;i++){for(var j=0;j<=i;j++){ret.data[i*n+j]=a.data[i*n+j]}}return ret};module.exports=Tensor},{"./utils.js":32,assert:248}],32:[function(require,module,exports){"use strict";function gaussianSample(mu,sigma){var u,v,x,y,q;do{u=1-Math.random();v=1.7156*(Math.random()-.5);x=u-.449871;y=Math.abs(v)+.386595;q=x*x+y*(.196*y-.25472*x)}while(q>=.27597&&(q>.27846||v*v>-4*u*u*Math.log(u)));return mu+sigma*v/u}function deduplicate(list){var retlist=[];for(var i=0;i<list.length;i++){var item=list[i];if(retlist.indexOf(item)===-1){retlist.push(item)}}return retlist}function mergeObjects(tgt){tgt=tgt||{};for(var i=1;i<arguments.length;i++){var src=arguments[i];for(var prop in src){tgt[prop]=src[prop]}}return tgt}function cloneObject(obj){return mergeObjects({},obj)}function mergeDefaults(obj,defaults){return mergeObjects({},defaults,obj)}module.exports={gaussianSample:gaussianSample,deduplicate:deduplicate,mergeObjects:mergeObjects,cloneObject:cloneObject,mergeDefaults:mergeDefaults}},{}],33:[function(require,module,exports){module.exports=function(fork){fork.use(require("./es7"));var types=fork.use(require("../lib/types"));var defaults=fork.use(require("../lib/shared")).defaults;var def=types.Type.def;var or=types.Type.or;def("Noop").bases("Node").build();def("DoExpression").bases("Expression").build("body").field("body",[def("Statement")]);def("Super").bases("Expression").build();def("BindExpression").bases("Expression").build("object","callee").field("object",or(def("Expression"),null)).field("callee",def("Expression"));def("Decorator").bases("Node").build("expression").field("expression",def("Expression"));def("Property").field("decorators",or([def("Decorator")],null),defaults["null"]);def("MethodDefinition").field("decorators",or([def("Decorator")],null),defaults["null"]);def("MetaProperty").bases("Expression").build("meta","property").field("meta",def("Identifier")).field("property",def("Identifier"));def("ParenthesizedExpression").bases("Expression").build("expression").field("expression",def("Expression"));def("ImportSpecifier").bases("ModuleSpecifier").build("imported","local").field("imported",def("Identifier"));def("ImportDefaultSpecifier").bases("ModuleSpecifier").build("local");def("ImportNamespaceSpecifier").bases("ModuleSpecifier").build("local");def("ExportDefaultDeclaration").bases("Declaration").build("declaration").field("declaration",or(def("Declaration"),def("Expression")));def("ExportNamedDeclaration").bases("Declaration").build("declaration","specifiers","source").field("declaration",or(def("Declaration"),null)).field("specifiers",[def("ExportSpecifier")],defaults.emptyArray).field("source",or(def("Literal"),null),defaults["null"]);def("ExportSpecifier").bases("ModuleSpecifier").build("local","exported").field("exported",def("Identifier"));def("ExportNamespaceSpecifier").bases("Specifier").build("exported").field("exported",def("Identifier"));def("ExportDefaultSpecifier").bases("Specifier").build("exported").field("exported",def("Identifier"));def("ExportAllDeclaration").bases("Declaration").build("exported","source").field("exported",or(def("Identifier"),null)).field("source",def("Literal"));def("CommentBlock").bases("Comment").build("value","leading","trailing");def("CommentLine").bases("Comment").build("value","leading","trailing")}},{"../lib/shared":50,"../lib/types":51,"./es7":39}],34:[function(require,module,exports){module.exports=function(fork){fork.use(require("./babel"));var types=fork.use(require("../lib/types"));var defaults=fork.use(require("../lib/shared")).defaults;var def=types.Type.def;var or=types.Type.or;def("Directive").bases("Node").build("value").field("value",def("DirectiveLiteral"));def("DirectiveLiteral").bases("Node","Expression").build("value").field("value",String,defaults["use strict"]);def("BlockStatement").bases("Statement").build("body").field("body",[def("Statement")]).field("directives",[def("Directive")],defaults.emptyArray);def("Program").bases("Node").build("body").field("body",[def("Statement")]).field("directives",[def("Directive")],defaults.emptyArray);def("StringLiteral").bases("Literal").build("value").field("value",String);def("NumericLiteral").bases("Literal").build("value").field("value",Number);def("NullLiteral").bases("Literal").build().field("value",null,defaults["null"]);def("BooleanLiteral").bases("Literal").build("value").field("value",Boolean);def("RegExpLiteral").bases("Literal").build("pattern","flags").field("pattern",String).field("flags",String).field("value",RegExp,function(){return new RegExp(this.pattern,this.flags)});var ObjectExpressionProperty=or(def("Property"),def("ObjectMethod"),def("ObjectProperty"),def("SpreadProperty"));def("ObjectExpression").bases("Expression").build("properties").field("properties",[ObjectExpressionProperty]);def("ObjectMethod").bases("Node","Function").build("kind","key","params","body","computed").field("kind",or("method","get","set")).field("key",or(def("Literal"),def("Identifier"),def("Expression"))).field("params",[def("Pattern")]).field("body",def("BlockStatement")).field("computed",Boolean,defaults["false"]).field("generator",Boolean,defaults["false"]).field("async",Boolean,defaults["false"]).field("decorators",or([def("Decorator")],null),defaults["null"]);def("ObjectProperty").bases("Node").build("key","value").field("key",or(def("Literal"),def("Identifier"),def("Expression"))).field("value",or(def("Expression"),def("Pattern"))).field("computed",Boolean,defaults["false"]);var ClassBodyElement=or(def("MethodDefinition"),def("VariableDeclarator"),def("ClassPropertyDefinition"),def("ClassProperty"),def("ClassMethod"));def("ClassBody").bases("Declaration").build("body").field("body",[ClassBodyElement]);def("ClassMethod").bases("Declaration","Function").build("kind","key","params","body","computed","static").field("kind",or("get","set","method","constructor")).field("key",or(def("Literal"),def("Identifier"),def("Expression"))).field("params",[def("Pattern")]).field("body",def("BlockStatement")).field("computed",Boolean,defaults["false"]).field("static",Boolean,defaults["false"]).field("generator",Boolean,defaults["false"]).field("async",Boolean,defaults["false"]).field("decorators",or([def("Decorator")],null),defaults["null"]);var ObjectPatternProperty=or(def("Property"),def("PropertyPattern"),def("SpreadPropertyPattern"),def("SpreadProperty"),def("ObjectProperty"),def("RestProperty"));def("ObjectPattern").bases("Pattern").build("properties").field("properties",[ObjectPatternProperty]).field("decorators",or([def("Decorator")],null),defaults["null"]);def("SpreadProperty").bases("Node").build("argument").field("argument",def("Expression"));def("RestProperty").bases("Node").build("argument").field("argument",def("Expression"));def("ForAwaitStatement").bases("Statement").build("left","right","body").field("left",or(def("VariableDeclaration"),def("Expression"))).field("right",def("Expression")).field("body",def("Statement"));def("Import").bases("Expression").build()}},{"../lib/shared":50,"../lib/types":51,"./babel":33}],35:[function(require,module,exports){module.exports=function(fork){fork.use(require("./babel6-core"));fork.use(require("./flow"))}},{"./babel6-core":34,"./flow":41}],36:[function(require,module,exports){module.exports=function(fork){var types=fork.use(require("../lib/types"));var Type=types.Type;var def=Type.def;var or=Type.or;var shared=fork.use(require("../lib/shared"));var defaults=shared.defaults;var geq=shared.geq;def("Printable").field("loc",or(def("SourceLocation"),null),defaults["null"],true);def("Node").bases("Printable").field("type",String).field("comments",or([def("Comment")],null),defaults["null"],true);def("SourceLocation").build("start","end","source").field("start",def("Position")).field("end",def("Position")).field("source",or(String,null),defaults["null"]);def("Position").build("line","column").field("line",geq(1)).field("column",geq(0));def("File").bases("Node").build("program","name").field("program",def("Program")).field("name",or(String,null),defaults["null"]);def("Program").bases("Node").build("body").field("body",[def("Statement")]);def("Function").bases("Node").field("id",or(def("Identifier"),null),defaults["null"]).field("params",[def("Pattern")]).field("body",def("BlockStatement"));def("Statement").bases("Node");def("EmptyStatement").bases("Statement").build();def("BlockStatement").bases("Statement").build("body").field("body",[def("Statement")]);def("ExpressionStatement").bases("Statement").build("expression").field("expression",def("Expression"));def("IfStatement").bases("Statement").build("test","consequent","alternate").field("test",def("Expression")).field("consequent",def("Statement")).field("alternate",or(def("Statement"),null),defaults["null"]);def("LabeledStatement").bases("Statement").build("label","body").field("label",def("Identifier")).field("body",def("Statement"));def("BreakStatement").bases("Statement").build("label").field("label",or(def("Identifier"),null),defaults["null"]);def("ContinueStatement").bases("Statement").build("label").field("label",or(def("Identifier"),null),defaults["null"]);def("WithStatement").bases("Statement").build("object","body").field("object",def("Expression")).field("body",def("Statement"));def("SwitchStatement").bases("Statement").build("discriminant","cases","lexical").field("discriminant",def("Expression")).field("cases",[def("SwitchCase")]).field("lexical",Boolean,defaults["false"]);def("ReturnStatement").bases("Statement").build("argument").field("argument",or(def("Expression"),null));def("ThrowStatement").bases("Statement").build("argument").field("argument",def("Expression"));def("TryStatement").bases("Statement").build("block","handler","finalizer").field("block",def("BlockStatement")).field("handler",or(def("CatchClause"),null),function(){return this.handlers&&this.handlers[0]||null}).field("handlers",[def("CatchClause")],function(){return this.handler?[this.handler]:[]},true).field("guardedHandlers",[def("CatchClause")],defaults.emptyArray).field("finalizer",or(def("BlockStatement"),null),defaults["null"]);def("CatchClause").bases("Node").build("param","guard","body").field("param",def("Pattern")).field("guard",or(def("Expression"),null),defaults["null"]).field("body",def("BlockStatement"));def("WhileStatement").bases("Statement").build("test","body").field("test",def("Expression")).field("body",def("Statement"));def("DoWhileStatement").bases("Statement").build("body","test").field("body",def("Statement")).field("test",def("Expression"));def("ForStatement").bases("Statement").build("init","test","update","body").field("init",or(def("VariableDeclaration"),def("Expression"),null)).field("test",or(def("Expression"),null)).field("update",or(def("Expression"),null)).field("body",def("Statement"));def("ForInStatement").bases("Statement").build("left","right","body").field("left",or(def("VariableDeclaration"),def("Expression"))).field("right",def("Expression")).field("body",def("Statement"));def("DebuggerStatement").bases("Statement").build();def("Declaration").bases("Statement");def("FunctionDeclaration").bases("Function","Declaration").build("id","params","body").field("id",def("Identifier"));def("FunctionExpression").bases("Function","Expression").build("id","params","body");def("VariableDeclaration").bases("Declaration").build("kind","declarations").field("kind",or("var","let","const")).field("declarations",[def("VariableDeclarator")]);def("VariableDeclarator").bases("Node").build("id","init").field("id",def("Pattern")).field("init",or(def("Expression"),null));def("Expression").bases("Node","Pattern");def("ThisExpression").bases("Expression").build();def("ArrayExpression").bases("Expression").build("elements").field("elements",[or(def("Expression"),null)]);def("ObjectExpression").bases("Expression").build("properties").field("properties",[def("Property")]);def("Property").bases("Node").build("kind","key","value").field("kind",or("init","get","set")).field("key",or(def("Literal"),def("Identifier"))).field("value",def("Expression"));def("SequenceExpression").bases("Expression").build("expressions").field("expressions",[def("Expression")]);var UnaryOperator=or("-","+","!","~","typeof","void","delete");def("UnaryExpression").bases("Expression").build("operator","argument","prefix").field("operator",UnaryOperator).field("argument",def("Expression")).field("prefix",Boolean,defaults["true"]);var BinaryOperator=or("==","!=","===","!==","<","<=",">",">=","<<",">>",">>>","+","-","*","/","%","&","|","^","in","instanceof","..");def("BinaryExpression").bases("Expression").build("operator","left","right").field("operator",BinaryOperator).field("left",def("Expression")).field("right",def("Expression"));var AssignmentOperator=or("=","+=","-=","*=","/=","%=","<<=",">>=",">>>=","|=","^=","&=");def("AssignmentExpression").bases("Expression").build("operator","left","right").field("operator",AssignmentOperator).field("left",def("Pattern")).field("right",def("Expression"));var UpdateOperator=or("++","--");def("UpdateExpression").bases("Expression").build("operator","argument","prefix").field("operator",UpdateOperator).field("argument",def("Expression")).field("prefix",Boolean);var LogicalOperator=or("||","&&");def("LogicalExpression").bases("Expression").build("operator","left","right").field("operator",LogicalOperator).field("left",def("Expression")).field("right",def("Expression"));def("ConditionalExpression").bases("Expression").build("test","consequent","alternate").field("test",def("Expression")).field("consequent",def("Expression")).field("alternate",def("Expression"));def("NewExpression").bases("Expression").build("callee","arguments").field("callee",def("Expression")).field("arguments",[def("Expression")]);def("CallExpression").bases("Expression").build("callee","arguments").field("callee",def("Expression")).field("arguments",[def("Expression")]);def("MemberExpression").bases("Expression").build("object","property","computed").field("object",def("Expression")).field("property",or(def("Identifier"),def("Expression"))).field("computed",Boolean,function(){var type=this.property.type;if(type==="Literal"||type==="MemberExpression"||type==="BinaryExpression"){return true}return false});def("Pattern").bases("Node");def("SwitchCase").bases("Node").build("test","consequent").field("test",or(def("Expression"),null)).field("consequent",[def("Statement")]);def("Identifier").bases("Node","Expression","Pattern").build("name").field("name",String);def("Literal").bases("Node","Expression").build("value").field("value",or(String,Boolean,null,Number,RegExp)).field("regex",or({pattern:String,flags:String},null),function(){if(this.value instanceof RegExp){var flags="";if(this.value.ignoreCase)flags+="i";if(this.value.multiline)flags+="m";if(this.value.global)flags+="g";return{pattern:this.value.source,flags:flags}}return null});def("Comment").bases("Printable").field("value",String).field("leading",Boolean,defaults["true"]).field("trailing",Boolean,defaults["false"])}},{"../lib/shared":50,"../lib/types":51}],37:[function(require,module,exports){module.exports=function(fork){fork.use(require("./core"));var types=fork.use(require("../lib/types"));var def=types.Type.def;var or=types.Type.or;def("XMLDefaultDeclaration").bases("Declaration").field("namespace",def("Expression"));def("XMLAnyName").bases("Expression");def("XMLQualifiedIdentifier").bases("Expression").field("left",or(def("Identifier"),def("XMLAnyName"))).field("right",or(def("Identifier"),def("Expression"))).field("computed",Boolean);def("XMLFunctionQualifiedIdentifier").bases("Expression").field("right",or(def("Identifier"),def("Expression"))).field("computed",Boolean);def("XMLAttributeSelector").bases("Expression").field("attribute",def("Expression"));def("XMLFilterExpression").bases("Expression").field("left",def("Expression")).field("right",def("Expression"));def("XMLElement").bases("XML","Expression").field("contents",[def("XML")]);def("XMLList").bases("XML","Expression").field("contents",[def("XML")]);def("XML").bases("Node");def("XMLEscape").bases("XML").field("expression",def("Expression"));def("XMLText").bases("XML").field("text",String);def("XMLStartTag").bases("XML").field("contents",[def("XML")]);def("XMLEndTag").bases("XML").field("contents",[def("XML")]);def("XMLPointTag").bases("XML").field("contents",[def("XML")]);def("XMLName").bases("XML").field("contents",or(String,[def("XML")]));def("XMLAttribute").bases("XML").field("value",String);def("XMLCdata").bases("XML").field("contents",String);def("XMLComment").bases("XML").field("contents",String);def("XMLProcessingInstruction").bases("XML").field("target",String).field("contents",or(String,null))}},{"../lib/types":51,"./core":36}],38:[function(require,module,exports){module.exports=function(fork){fork.use(require("./core"));var types=fork.use(require("../lib/types"));var def=types.Type.def;var or=types.Type.or;var defaults=fork.use(require("../lib/shared")).defaults;def("Function").field("generator",Boolean,defaults["false"]).field("expression",Boolean,defaults["false"]).field("defaults",[or(def("Expression"),null)],defaults.emptyArray).field("rest",or(def("Identifier"),null),defaults["null"]);def("RestElement").bases("Pattern").build("argument").field("argument",def("Pattern"));def("SpreadElementPattern").bases("Pattern").build("argument").field("argument",def("Pattern"));def("FunctionDeclaration").build("id","params","body","generator","expression");def("FunctionExpression").build("id","params","body","generator","expression");def("ArrowFunctionExpression").bases("Function","Expression").build("params","body","expression").field("id",null,defaults["null"]).field("body",or(def("BlockStatement"),def("Expression"))).field("generator",false,defaults["false"]);def("ForOfStatement").bases("Statement").build("left","right","body").field("left",or(def("VariableDeclaration"),def("Pattern"))).field("right",def("Expression")).field("body",def("Statement"));def("YieldExpression").bases("Expression").build("argument","delegate").field("argument",or(def("Expression"),null)).field("delegate",Boolean,defaults["false"]);def("GeneratorExpression").bases("Expression").build("body","blocks","filter").field("body",def("Expression")).field("blocks",[def("ComprehensionBlock")]).field("filter",or(def("Expression"),null));def("ComprehensionExpression").bases("Expression").build("body","blocks","filter").field("body",def("Expression")).field("blocks",[def("ComprehensionBlock")]).field("filter",or(def("Expression"),null));def("ComprehensionBlock").bases("Node").build("left","right","each").field("left",def("Pattern")).field("right",def("Expression")).field("each",Boolean);def("Property").field("key",or(def("Literal"),def("Identifier"),def("Expression"))).field("value",or(def("Expression"),def("Pattern"))).field("method",Boolean,defaults["false"]).field("shorthand",Boolean,defaults["false"]).field("computed",Boolean,defaults["false"]);def("PropertyPattern").bases("Pattern").build("key","pattern").field("key",or(def("Literal"),def("Identifier"),def("Expression"))).field("pattern",def("Pattern")).field("computed",Boolean,defaults["false"]);def("ObjectPattern").bases("Pattern").build("properties").field("properties",[or(def("PropertyPattern"),def("Property"))]);def("ArrayPattern").bases("Pattern").build("elements").field("elements",[or(def("Pattern"),null)]);def("MethodDefinition").bases("Declaration").build("kind","key","value","static").field("kind",or("constructor","method","get","set")).field("key",or(def("Literal"),def("Identifier"),def("Expression"))).field("value",def("Function")).field("computed",Boolean,defaults["false"]).field("static",Boolean,defaults["false"]);def("SpreadElement").bases("Node").build("argument").field("argument",def("Expression"));def("ArrayExpression").field("elements",[or(def("Expression"),def("SpreadElement"),def("RestElement"),null)]);def("NewExpression").field("arguments",[or(def("Expression"),def("SpreadElement"))]);def("CallExpression").field("arguments",[or(def("Expression"),def("SpreadElement"))]);def("AssignmentPattern").bases("Pattern").build("left","right").field("left",def("Pattern")).field("right",def("Expression"));var ClassBodyElement=or(def("MethodDefinition"),def("VariableDeclarator"),def("ClassPropertyDefinition"),def("ClassProperty"));def("ClassProperty").bases("Declaration").build("key").field("key",or(def("Literal"),def("Identifier"),def("Expression"))).field("computed",Boolean,defaults["false"]);def("ClassPropertyDefinition").bases("Declaration").build("definition").field("definition",ClassBodyElement);def("ClassBody").bases("Declaration").build("body").field("body",[ClassBodyElement]);def("ClassDeclaration").bases("Declaration").build("id","body","superClass").field("id",or(def("Identifier"),null)).field("body",def("ClassBody")).field("superClass",or(def("Expression"),null),defaults["null"]);def("ClassExpression").bases("Expression").build("id","body","superClass").field("id",or(def("Identifier"),null),defaults["null"]).field("body",def("ClassBody")).field("superClass",or(def("Expression"),null),defaults["null"]).field("implements",[def("ClassImplements")],defaults.emptyArray);def("ClassImplements").bases("Node").build("id").field("id",def("Identifier")).field("superClass",or(def("Expression"),null),defaults["null"]);def("Specifier").bases("Node");def("ModuleSpecifier").bases("Specifier").field("local",or(def("Identifier"),null),defaults["null"]).field("id",or(def("Identifier"),null),defaults["null"]).field("name",or(def("Identifier"),null),defaults["null"]);def("TaggedTemplateExpression").bases("Expression").build("tag","quasi").field("tag",def("Expression")).field("quasi",def("TemplateLiteral"));def("TemplateLiteral").bases("Expression").build("quasis","expressions").field("quasis",[def("TemplateElement")]).field("expressions",[def("Expression")]);def("TemplateElement").bases("Node").build("value","tail").field("value",{cooked:String,raw:String}).field("tail",Boolean)}},{"../lib/shared":50,"../lib/types":51,"./core":36}],39:[function(require,module,exports){module.exports=function(fork){fork.use(require("./es6"));var types=fork.use(require("../lib/types"));var def=types.Type.def;var or=types.Type.or;var builtin=types.builtInTypes;var defaults=fork.use(require("../lib/shared")).defaults;def("Function").field("async",Boolean,defaults["false"]);def("SpreadProperty").bases("Node").build("argument").field("argument",def("Expression"));def("ObjectExpression").field("properties",[or(def("Property"),def("SpreadProperty"))]);def("SpreadPropertyPattern").bases("Pattern").build("argument").field("argument",def("Pattern"));def("ObjectPattern").field("properties",[or(def("Property"),def("PropertyPattern"),def("SpreadPropertyPattern"))]);def("AwaitExpression").bases("Expression").build("argument","all").field("argument",or(def("Expression"),null)).field("all",Boolean,defaults["false"])}},{"../lib/shared":50,"../lib/types":51,"./es6":38}],40:[function(require,module,exports){module.exports=function(fork){fork.use(require("./es7"));var types=fork.use(require("../lib/types"));var defaults=fork.use(require("../lib/shared")).defaults;var def=types.Type.def;var or=types.Type.or;def("VariableDeclaration").field("declarations",[or(def("VariableDeclarator"),def("Identifier"))]);def("Property").field("value",or(def("Expression"),def("Pattern")));def("ArrayPattern").field("elements",[or(def("Pattern"),def("SpreadElement"),null)]);def("ObjectPattern").field("properties",[or(def("Property"),def("PropertyPattern"),def("SpreadPropertyPattern"),def("SpreadProperty"))]);def("ExportSpecifier").bases("ModuleSpecifier").build("id","name");def("ExportBatchSpecifier").bases("Specifier").build();def("ImportSpecifier").bases("ModuleSpecifier").build("id","name");def("ImportNamespaceSpecifier").bases("ModuleSpecifier").build("id");def("ImportDefaultSpecifier").bases("ModuleSpecifier").build("id");def("ExportDeclaration").bases("Declaration").build("default","declaration","specifiers","source").field("default",Boolean).field("declaration",or(def("Declaration"),def("Expression"),null)).field("specifiers",[or(def("ExportSpecifier"),def("ExportBatchSpecifier"))],defaults.emptyArray).field("source",or(def("Literal"),null),defaults["null"]);def("ImportDeclaration").bases("Declaration").build("specifiers","source","importKind").field("specifiers",[or(def("ImportSpecifier"),def("ImportNamespaceSpecifier"),def("ImportDefaultSpecifier"))],defaults.emptyArray).field("source",def("Literal")).field("importKind",or("value","type"),function(){return"value"});def("Block").bases("Comment").build("value","leading","trailing");def("Line").bases("Comment").build("value","leading","trailing")}},{"../lib/shared":50,"../lib/types":51,"./es7":39}],41:[function(require,module,exports){module.exports=function(fork){fork.use(require("./es7"));var types=fork.use(require("../lib/types"));var def=types.Type.def;var or=types.Type.or;var defaults=fork.use(require("../lib/shared")).defaults;def("Type").bases("Node");def("AnyTypeAnnotation").bases("Type").build();def("EmptyTypeAnnotation").bases("Type").build();def("MixedTypeAnnotation").bases("Type").build();def("VoidTypeAnnotation").bases("Type").build();def("NumberTypeAnnotation").bases("Type").build();def("NumberLiteralTypeAnnotation").bases("Type").build("value","raw").field("value",Number).field("raw",String);def("NumericLiteralTypeAnnotation").bases("Type").build("value","raw").field("value",Number).field("raw",String);def("StringTypeAnnotation").bases("Type").build();def("StringLiteralTypeAnnotation").bases("Type").build("value","raw").field("value",String).field("raw",String);def("BooleanTypeAnnotation").bases("Type").build();def("BooleanLiteralTypeAnnotation").bases("Type").build("value","raw").field("value",Boolean).field("raw",String);def("TypeAnnotation").bases("Node").build("typeAnnotation").field("typeAnnotation",def("Type"));def("NullableTypeAnnotation").bases("Type").build("typeAnnotation").field("typeAnnotation",def("Type"));def("NullLiteralTypeAnnotation").bases("Type").build();def("NullTypeAnnotation").bases("Type").build();def("ThisTypeAnnotation").bases("Type").build();def("ExistsTypeAnnotation").bases("Type").build();def("ExistentialTypeParam").bases("Type").build();def("FunctionTypeAnnotation").bases("Type").build("params","returnType","rest","typeParameters").field("params",[def("FunctionTypeParam")]).field("returnType",def("Type")).field("rest",or(def("FunctionTypeParam"),null)).field("typeParameters",or(def("TypeParameterDeclaration"),null));def("FunctionTypeParam").bases("Node").build("name","typeAnnotation","optional").field("name",def("Identifier")).field("typeAnnotation",def("Type")).field("optional",Boolean);def("ArrayTypeAnnotation").bases("Type").build("elementType").field("elementType",def("Type"));def("ObjectTypeAnnotation").bases("Type").build("properties","indexers","callProperties").field("properties",[or(def("ObjectTypeProperty"),def("ObjectTypeSpreadProperty"))]).field("indexers",[def("ObjectTypeIndexer")],defaults.emptyArray).field("callProperties",[def("ObjectTypeCallProperty")],defaults.emptyArray).field("exact",Boolean,defaults["false"]);def("ObjectTypeProperty").bases("Node").build("key","value","optional").field("key",or(def("Literal"),def("Identifier"))).field("value",def("Type")).field("optional",Boolean).field("variance",or("plus","minus",null),defaults["null"]);def("ObjectTypeIndexer").bases("Node").build("id","key","value").field("id",def("Identifier")).field("key",def("Type")).field("value",def("Type")).field("variance",or("plus","minus",null),defaults["null"]);def("ObjectTypeCallProperty").bases("Node").build("value").field("value",def("FunctionTypeAnnotation")).field("static",Boolean,defaults["false"]);def("QualifiedTypeIdentifier").bases("Node").build("qualification","id").field("qualification",or(def("Identifier"),def("QualifiedTypeIdentifier"))).field("id",def("Identifier"));def("GenericTypeAnnotation").bases("Type").build("id","typeParameters").field("id",or(def("Identifier"),def("QualifiedTypeIdentifier"))).field("typeParameters",or(def("TypeParameterInstantiation"),null));def("MemberTypeAnnotation").bases("Type").build("object","property").field("object",def("Identifier")).field("property",or(def("MemberTypeAnnotation"),def("GenericTypeAnnotation")));def("UnionTypeAnnotation").bases("Type").build("types").field("types",[def("Type")]);def("IntersectionTypeAnnotation").bases("Type").build("types").field("types",[def("Type")]);def("TypeofTypeAnnotation").bases("Type").build("argument").field("argument",def("Type"));def("ObjectTypeSpreadProperty").bases("Node").build("argument").field("argument",def("Type"));def("Identifier").field("typeAnnotation",or(def("TypeAnnotation"),null),defaults["null"]);def("ObjectPattern").field("typeAnnotation",or(def("TypeAnnotation"),null),defaults["null"]);def("TypeParameterDeclaration").bases("Node").build("params").field("params",[def("TypeParameter")]);def("TypeParameterInstantiation").bases("Node").build("params").field("params",[def("Type")]);def("TypeParameter").bases("Type").build("name","variance","bound").field("name",String).field("variance",or("plus","minus",null),defaults["null"]).field("bound",or(def("TypeAnnotation"),null),defaults["null"]);def("Function").field("returnType",or(def("TypeAnnotation"),null),defaults["null"]).field("typeParameters",or(def("TypeParameterDeclaration"),null),defaults["null"]);def("ClassProperty").build("key","value","typeAnnotation","static").field("value",or(def("Expression"),null)).field("typeAnnotation",or(def("TypeAnnotation"),null)).field("static",Boolean,defaults["false"]).field("variance",or("plus","minus",null),defaults["null"]);def("ClassImplements").field("typeParameters",or(def("TypeParameterInstantiation"),null),defaults["null"]);def("InterfaceDeclaration").bases("Declaration").build("id","body","extends").field("id",def("Identifier")).field("typeParameters",or(def("TypeParameterDeclaration"),null),defaults["null"]).field("body",def("ObjectTypeAnnotation")).field("extends",[def("InterfaceExtends")]);def("DeclareInterface").bases("InterfaceDeclaration").build("id","body","extends");def("InterfaceExtends").bases("Node").build("id").field("id",def("Identifier")).field("typeParameters",or(def("TypeParameterInstantiation"),null));def("TypeAlias").bases("Declaration").build("id","typeParameters","right").field("id",def("Identifier")).field("typeParameters",or(def("TypeParameterDeclaration"),null)).field("right",def("Type"));def("OpaqueType").bases("Declaration").build("id","typeParameters","impltype","supertype").field("id",def("Identifier")).field("typeParameters",or(def("TypeParameterDeclaration"),null)).field("implType",def("Type")).field("superType",def("Type"));def("DeclareTypeAlias").bases("TypeAlias").build("id","typeParameters","right");def("DeclareOpaqueType").bases("TypeAlias").build("id","typeParameters","supertype");def("TypeCastExpression").bases("Expression").build("expression","typeAnnotation").field("expression",def("Expression")).field("typeAnnotation",def("TypeAnnotation"));def("TupleTypeAnnotation").bases("Type").build("types").field("types",[def("Type")]);def("DeclareVariable").bases("Statement").build("id").field("id",def("Identifier"));def("DeclareFunction").bases("Statement").build("id").field("id",def("Identifier"));def("DeclareClass").bases("InterfaceDeclaration").build("id");def("DeclareModule").bases("Statement").build("id","body").field("id",or(def("Identifier"),def("Literal"))).field("body",def("BlockStatement"));def("DeclareModuleExports").bases("Statement").build("typeAnnotation").field("typeAnnotation",def("Type"));def("DeclareExportDeclaration").bases("Declaration").build("default","declaration","specifiers","source").field("default",Boolean).field("declaration",or(def("DeclareVariable"),def("DeclareFunction"),def("DeclareClass"),def("Type"),null)).field("specifiers",[or(def("ExportSpecifier"),def("ExportBatchSpecifier"))],defaults.emptyArray).field("source",or(def("Literal"),null),defaults["null"]);def("DeclareExportAllDeclaration").bases("Declaration").build("source").field("source",or(def("Literal"),null),defaults["null"])}},{"../lib/shared":50,"../lib/types":51,"./es7":39}],42:[function(require,module,exports){module.exports=function(fork){fork.use(require("./es7"));var types=fork.use(require("../lib/types"));var def=types.Type.def;var or=types.Type.or;var defaults=fork.use(require("../lib/shared")).defaults;def("JSXAttribute").bases("Node").build("name","value").field("name",or(def("JSXIdentifier"),def("JSXNamespacedName"))).field("value",or(def("Literal"),def("JSXExpressionContainer"),null),defaults["null"]);def("JSXIdentifier").bases("Identifier").build("name").field("name",String);def("JSXNamespacedName").bases("Node").build("namespace","name").field("namespace",def("JSXIdentifier")).field("name",def("JSXIdentifier"));def("JSXMemberExpression").bases("MemberExpression").build("object","property").field("object",or(def("JSXIdentifier"),def("JSXMemberExpression"))).field("property",def("JSXIdentifier")).field("computed",Boolean,defaults.false);var JSXElementName=or(def("JSXIdentifier"),def("JSXNamespacedName"),def("JSXMemberExpression"));def("JSXSpreadAttribute").bases("Node").build("argument").field("argument",def("Expression"));var JSXAttributes=[or(def("JSXAttribute"),def("JSXSpreadAttribute"))];def("JSXExpressionContainer").bases("Expression").build("expression").field("expression",def("Expression"));def("JSXElement").bases("Expression").build("openingElement","closingElement","children").field("openingElement",def("JSXOpeningElement")).field("closingElement",or(def("JSXClosingElement"),null),defaults["null"]).field("children",[or(def("JSXElement"),def("JSXExpressionContainer"),def("JSXText"),def("Literal"))],defaults.emptyArray).field("name",JSXElementName,function(){return this.openingElement.name},true).field("selfClosing",Boolean,function(){return this.openingElement.selfClosing},true).field("attributes",JSXAttributes,function(){return this.openingElement.attributes},true);def("JSXOpeningElement").bases("Node").build("name","attributes","selfClosing").field("name",JSXElementName).field("attributes",JSXAttributes,defaults.emptyArray).field("selfClosing",Boolean,defaults["false"]);def("JSXClosingElement").bases("Node").build("name").field("name",JSXElementName);def("JSXText").bases("Literal").build("value").field("value",String);def("JSXEmptyExpression").bases("Expression").build();def("JSXSpreadChild").bases("Expression").build("expression").field("expression",def("Expression"))}},{"../lib/shared":50,"../lib/types":51,"./es7":39}],43:[function(require,module,exports){module.exports=function(fork){fork.use(require("./core"));var types=fork.use(require("../lib/types"));var def=types.Type.def;var or=types.Type.or;var shared=fork.use(require("../lib/shared"));var geq=shared.geq;var defaults=shared.defaults;def("Function").field("body",or(def("BlockStatement"),def("Expression")));def("ForInStatement").build("left","right","body","each").field("each",Boolean,defaults["false"]);def("LetStatement").bases("Statement").build("head","body").field("head",[def("VariableDeclarator")]).field("body",def("Statement"));def("LetExpression").bases("Expression").build("head","body").field("head",[def("VariableDeclarator")]).field("body",def("Expression"));def("GraphExpression").bases("Expression").build("index","expression").field("index",geq(0)).field("expression",def("Literal"));def("GraphIndexExpression").bases("Expression").build("index").field("index",geq(0))}},{"../lib/shared":50,"../lib/types":51,"./core":36}],44:[function(require,module,exports){module.exports=function(defs){var used=[];var usedResult=[];var fork={};function use(plugin){var idx=used.indexOf(plugin);if(idx===-1){idx=used.length;used.push(plugin);usedResult[idx]=plugin(fork)}return usedResult[idx]}fork.use=use;var types=use(require("./lib/types"));defs.forEach(use);types.finalize();var exports={Type:types.Type,builtInTypes:types.builtInTypes,namedTypes:types.namedTypes,builders:types.builders,defineMethod:types.defineMethod,getFieldNames:types.getFieldNames,getFieldValue:types.getFieldValue,eachField:types.eachField,someField:types.someField,getSupertypeNames:types.getSupertypeNames,astNodesAreEquivalent:use(require("./lib/equiv")),finalize:types.finalize,Path:use(require("./lib/path")),NodePath:use(require("./lib/node-path")),PathVisitor:use(require("./lib/path-visitor")),use:use};exports.visit=exports.PathVisitor.visit;return exports}},{"./lib/equiv":45,"./lib/node-path":46,"./lib/path":48,"./lib/path-visitor":47,"./lib/types":51}],45:[function(require,module,exports){module.exports=function(fork){var types=fork.use(require("../lib/types"));var getFieldNames=types.getFieldNames;var getFieldValue=types.getFieldValue;var isArray=types.builtInTypes.array;var isObject=types.builtInTypes.object;var isDate=types.builtInTypes.Date;var isRegExp=types.builtInTypes.RegExp;var hasOwn=Object.prototype.hasOwnProperty;function astNodesAreEquivalent(a,b,problemPath){if(isArray.check(problemPath)){problemPath.length=0}else{problemPath=null}return areEquivalent(a,b,problemPath)}astNodesAreEquivalent.assert=function(a,b){var problemPath=[];if(!astNodesAreEquivalent(a,b,problemPath)){if(problemPath.length===0){if(a!==b){throw new Error("Nodes must be equal")}}else{throw new Error("Nodes differ in the following path: "+problemPath.map(subscriptForProperty).join(""))}}};function subscriptForProperty(property){if(/[_$a-z][_$a-z0-9]*/i.test(property)){return"."+property}return"["+JSON.stringify(property)+"]"}function areEquivalent(a,b,problemPath){if(a===b){return true}if(isArray.check(a)){return arraysAreEquivalent(a,b,problemPath)}if(isObject.check(a)){return objectsAreEquivalent(a,b,problemPath)}if(isDate.check(a)){return isDate.check(b)&&+a===+b}if(isRegExp.check(a)){return isRegExp.check(b)&&(a.source===b.source&&a.global===b.global&&a.multiline===b.multiline&&a.ignoreCase===b.ignoreCase)}return a==b}function arraysAreEquivalent(a,b,problemPath){isArray.assert(a);var aLength=a.length;if(!isArray.check(b)||b.length!==aLength){if(problemPath){problemPath.push("length")}return false}for(var i=0;i<aLength;++i){if(problemPath){problemPath.push(i)}if(i in a!==i in b){return false}if(!areEquivalent(a[i],b[i],problemPath)){return false}if(problemPath){var problemPathTail=problemPath.pop();if(problemPathTail!==i){throw new Error(""+problemPathTail)}}}return true}function objectsAreEquivalent(a,b,problemPath){isObject.assert(a);if(!isObject.check(b)){return false}if(a.type!==b.type){if(problemPath){problemPath.push("type")}return false}var aNames=getFieldNames(a);var aNameCount=aNames.length;var bNames=getFieldNames(b);var bNameCount=bNames.length;if(aNameCount===bNameCount){for(var i=0;i<aNameCount;++i){var name=aNames[i];var aChild=getFieldValue(a,name);var bChild=getFieldValue(b,name);if(problemPath){problemPath.push(name)}if(!areEquivalent(aChild,bChild,problemPath)){return false}if(problemPath){var problemPathTail=problemPath.pop();if(problemPathTail!==name){throw new Error(""+problemPathTail)}}}return true}if(!problemPath){return false}var seenNames=Object.create(null);for(i=0;i<aNameCount;++i){seenNames[aNames[i]]=true}for(i=0;i<bNameCount;++i){name=bNames[i];if(!hasOwn.call(seenNames,name)){problemPath.push(name);return false}delete seenNames[name]}for(name in seenNames){problemPath.push(name);break}return false}return astNodesAreEquivalent}},{"../lib/types":51}],46:[function(require,module,exports){module.exports=function(fork){var types=fork.use(require("./types"));var n=types.namedTypes;var b=types.builders;var isNumber=types.builtInTypes.number;var isArray=types.builtInTypes.array;var Path=fork.use(require("./path"));var Scope=fork.use(require("./scope"));function NodePath(value,parentPath,name){if(!(this instanceof NodePath)){throw new Error("NodePath constructor cannot be invoked without 'new'")}Path.call(this,value,parentPath,name)}var NPp=NodePath.prototype=Object.create(Path.prototype,{constructor:{value:NodePath,enumerable:false,writable:true,configurable:true}});Object.defineProperties(NPp,{node:{get:function(){Object.defineProperty(this,"node",{configurable:true,value:this._computeNode()});return this.node}},parent:{get:function(){Object.defineProperty(this,"parent",{configurable:true,value:this._computeParent()});return this.parent}},scope:{get:function(){Object.defineProperty(this,"scope",{configurable:true,value:this._computeScope()});return this.scope}}});NPp.replace=function(){delete this.node;delete this.parent;delete this.scope;return Path.prototype.replace.apply(this,arguments)};NPp.prune=function(){var remainingNodePath=this.parent;this.replace();return cleanUpNodesAfterPrune(remainingNodePath)};NPp._computeNode=function(){var value=this.value;if(n.Node.check(value)){return value}var pp=this.parentPath;return pp&&pp.node||null};NPp._computeParent=function(){var value=this.value;var pp=this.parentPath;if(!n.Node.check(value)){while(pp&&!n.Node.check(pp.value)){pp=pp.parentPath}if(pp){pp=pp.parentPath}}while(pp&&!n.Node.check(pp.value)){pp=pp.parentPath}return pp||null};NPp._computeScope=function(){var value=this.value;var pp=this.parentPath;var scope=pp&&pp.scope;if(n.Node.check(value)&&Scope.isEstablishedBy(value)){scope=new Scope(this,scope)}return scope||null};NPp.getValueProperty=function(name){return types.getFieldValue(this.value,name)};NPp.needsParens=function(assumeExpressionContext){var pp=this.parentPath;if(!pp){return false}var node=this.value;if(!n.Expression.check(node)){return false}if(node.type==="Identifier"){return false}while(!n.Node.check(pp.value)){pp=pp.parentPath;if(!pp){return false}}var parent=pp.value;switch(node.type){case"UnaryExpression":case"SpreadElement":case"SpreadProperty":return parent.type==="MemberExpression"&&this.name==="object"&&parent.object===node;case"BinaryExpression":case"LogicalExpression":switch(parent.type){case"CallExpression":return this.name==="callee"&&parent.callee===node;case"UnaryExpression":case"SpreadElement":case"SpreadProperty":return true;case"MemberExpression":return this.name==="object"&&parent.object===node;case"BinaryExpression":case"LogicalExpression":var po=parent.operator;var pp=PRECEDENCE[po];var no=node.operator;var np=PRECEDENCE[no];if(pp>np){return true}if(pp===np&&this.name==="right"){if(parent.right!==node){throw new Error("Nodes must be equal")}return true}default:return false}case"SequenceExpression":switch(parent.type){case"ForStatement":return false;case"ExpressionStatement":return this.name!=="expression";default:return true}case"YieldExpression":switch(parent.type){case"BinaryExpression":case"LogicalExpression":case"UnaryExpression":case"SpreadElement":case"SpreadProperty":case"CallExpression":case"MemberExpression":case"NewExpression":case"ConditionalExpression":case"YieldExpression":return true;default:return false}case"Literal":return parent.type==="MemberExpression"&&isNumber.check(node.value)&&this.name==="object"&&parent.object===node;case"AssignmentExpression":case"ConditionalExpression":switch(parent.type){case"UnaryExpression":case"SpreadElement":case"SpreadProperty":case"BinaryExpression":case"LogicalExpression":return true;case"CallExpression":return this.name==="callee"&&parent.callee===node;case"ConditionalExpression":return this.name==="test"&&parent.test===node;case"MemberExpression":return this.name==="object"&&parent.object===node;default:return false}default:if(parent.type==="NewExpression"&&this.name==="callee"&&parent.callee===node){return containsCallExpression(node)}}if(assumeExpressionContext!==true&&!this.canBeFirstInStatement()&&this.firstInStatement())return true;return false};function isBinary(node){return n.BinaryExpression.check(node)||n.LogicalExpression.check(node)}function isUnaryLike(node){return n.UnaryExpression.check(node)||n.SpreadElement&&n.SpreadElement.check(node)||n.SpreadProperty&&n.SpreadProperty.check(node)}var PRECEDENCE={};[["||"],["&&"],["|"],["^"],["&"],["==","===","!=","!=="],["<",">","<=",">=","in","instanceof"],[">>","<<",">>>"],["+","-"],["*","/","%"]].forEach(function(tier,i){tier.forEach(function(op){PRECEDENCE[op]=i})});function containsCallExpression(node){if(n.CallExpression.check(node)){return true}if(isArray.check(node)){return node.some(containsCallExpression)}if(n.Node.check(node)){return types.someField(node,function(name,child){return containsCallExpression(child)})}return false}NPp.canBeFirstInStatement=function(){var node=this.node;return!n.FunctionExpression.check(node)&&!n.ObjectExpression.check(node)};NPp.firstInStatement=function(){return firstInStatement(this)};function firstInStatement(path){for(var node,parent;path.parent;path=path.parent){node=path.node;parent=path.parent.node;if(n.BlockStatement.check(parent)&&path.parent.name==="body"&&path.name===0){if(parent.body[0]!==node){throw new Error("Nodes must be equal")}return true}if(n.ExpressionStatement.check(parent)&&path.name==="expression"){if(parent.expression!==node){throw new Error("Nodes must be equal")}return true}if(n.SequenceExpression.check(parent)&&path.parent.name==="expressions"&&path.name===0){if(parent.expressions[0]!==node){throw new Error("Nodes must be equal")}continue}if(n.CallExpression.check(parent)&&path.name==="callee"){if(parent.callee!==node){throw new Error("Nodes must be equal")}continue}if(n.MemberExpression.check(parent)&&path.name==="object"){if(parent.object!==node){throw new Error("Nodes must be equal")}continue}if(n.ConditionalExpression.check(parent)&&path.name==="test"){if(parent.test!==node){throw new Error("Nodes must be equal")}continue}if(isBinary(parent)&&path.name==="left"){if(parent.left!==node){throw new Error("Nodes must be equal")}continue}if(n.UnaryExpression.check(parent)&&!parent.prefix&&path.name==="argument"){if(parent.argument!==node){throw new Error("Nodes must be equal")}continue}return false}return true}function cleanUpNodesAfterPrune(remainingNodePath){if(n.VariableDeclaration.check(remainingNodePath.node)){var declarations=remainingNodePath.get("declarations").value;if(!declarations||declarations.length===0){return remainingNodePath.prune()}}else if(n.ExpressionStatement.check(remainingNodePath.node)){if(!remainingNodePath.get("expression").value){return remainingNodePath.prune()}}else if(n.IfStatement.check(remainingNodePath.node)){cleanUpIfStatementAfterPrune(remainingNodePath)}return remainingNodePath}function cleanUpIfStatementAfterPrune(ifStatement){var testExpression=ifStatement.get("test").value;var alternate=ifStatement.get("alternate").value;var consequent=ifStatement.get("consequent").value;if(!consequent&&!alternate){var testExpressionStatement=b.expressionStatement(testExpression);ifStatement.replace(testExpressionStatement)}else if(!consequent&&alternate){var negatedTestExpression=b.unaryExpression("!",testExpression,true);if(n.UnaryExpression.check(testExpression)&&testExpression.operator==="!"){negatedTestExpression=testExpression.argument}ifStatement.get("test").replace(negatedTestExpression);ifStatement.get("consequent").replace(alternate);ifStatement.get("alternate").replace()}}return NodePath}},{"./path":48,"./scope":49,"./types":51}],47:[function(require,module,exports){var hasOwn=Object.prototype.hasOwnProperty;module.exports=function(fork){var types=fork.use(require("./types"));var NodePath=fork.use(require("./node-path"));var Printable=types.namedTypes.Printable;var isArray=types.builtInTypes.array;var isObject=types.builtInTypes.object;var isFunction=types.builtInTypes.function;var undefined;function PathVisitor(){if(!(this instanceof PathVisitor)){throw new Error("PathVisitor constructor cannot be invoked without 'new'")}this._reusableContextStack=[];this._methodNameTable=computeMethodNameTable(this);this._shouldVisitComments=hasOwn.call(this._methodNameTable,"Block")||hasOwn.call(this._methodNameTable,"Line");this.Context=makeContextConstructor(this);this._visiting=false;this._changeReported=false}function computeMethodNameTable(visitor){var typeNames=Object.create(null);for(var methodName in visitor){if(/^visit[A-Z]/.test(methodName)){typeNames[methodName.slice("visit".length)]=true}}var supertypeTable=types.computeSupertypeLookupTable(typeNames);var methodNameTable=Object.create(null);var typeNames=Object.keys(supertypeTable);var typeNameCount=typeNames.length;for(var i=0;i<typeNameCount;++i){var typeName=typeNames[i];methodName="visit"+supertypeTable[typeName];if(isFunction.check(visitor[methodName])){methodNameTable[typeName]=methodName}}return methodNameTable}PathVisitor.fromMethodsObject=function fromMethodsObject(methods){if(methods instanceof PathVisitor){return methods}if(!isObject.check(methods)){return new PathVisitor}function Visitor(){if(!(this instanceof Visitor)){throw new Error("Visitor constructor cannot be invoked without 'new'")}PathVisitor.call(this)}var Vp=Visitor.prototype=Object.create(PVp);Vp.constructor=Visitor;extend(Vp,methods);extend(Visitor,PathVisitor);isFunction.assert(Visitor.fromMethodsObject);isFunction.assert(Visitor.visit);return new Visitor};function extend(target,source){for(var property in source){if(hasOwn.call(source,property)){target[property]=source[property]}}return target}PathVisitor.visit=function visit(node,methods){return PathVisitor.fromMethodsObject(methods).visit(node)};var PVp=PathVisitor.prototype;PVp.visit=function(){if(this._visiting){throw new Error("Recursively calling visitor.visit(path) resets visitor state. "+"Try this.visit(path) or this.traverse(path) instead.")}this._visiting=true;this._changeReported=false;this._abortRequested=false;var argc=arguments.length;var args=new Array(argc);for(var i=0;i<argc;++i){args[i]=arguments[i]}if(!(args[0]instanceof NodePath)){args[0]=new NodePath({root:args[0]}).get("root")}this.reset.apply(this,args);try{var root=this.visitWithoutReset(args[0]);var didNotThrow=true}finally{this._visiting=false;if(!didNotThrow&&this._abortRequested){return args[0].value}}return root};PVp.AbortRequest=function AbortRequest(){};PVp.abort=function(){var visitor=this;visitor._abortRequested=true;var request=new visitor.AbortRequest;request.cancel=function(){visitor._abortRequested=false};throw request};PVp.reset=function(path){};PVp.visitWithoutReset=function(path){if(this instanceof this.Context){return this.visitor.visitWithoutReset(path)}if(!(path instanceof NodePath)){throw new Error("")}var value=path.value;var methodName=value&&typeof value==="object"&&typeof value.type==="string"&&this._methodNameTable[value.type];if(methodName){var context=this.acquireContext(path);try{return context.invokeVisitorMethod(methodName)}finally{this.releaseContext(context)}}else{return visitChildren(path,this)}};function visitChildren(path,visitor){if(!(path instanceof NodePath)){throw new Error("")}if(!(visitor instanceof PathVisitor)){throw new Error("")}var value=path.value;if(isArray.check(value)){path.each(visitor.visitWithoutReset,visitor)}else if(!isObject.check(value)){}else{var childNames=types.getFieldNames(value);if(visitor._shouldVisitComments&&value.comments&&childNames.indexOf("comments")<0){childNames.push("comments")}var childCount=childNames.length;var childPaths=[];for(var i=0;i<childCount;++i){var childName=childNames[i];if(!hasOwn.call(value,childName)){value[childName]=types.getFieldValue(value,childName)}childPaths.push(path.get(childName))}for(var i=0;i<childCount;++i){visitor.visitWithoutReset(childPaths[i])}}return path.value}PVp.acquireContext=function(path){if(this._reusableContextStack.length===0){return new this.Context(path)}return this._reusableContextStack.pop().reset(path)};PVp.releaseContext=function(context){if(!(context instanceof this.Context)){throw new Error("")}this._reusableContextStack.push(context);context.currentPath=null};PVp.reportChanged=function(){this._changeReported=true};PVp.wasChangeReported=function(){return this._changeReported};function makeContextConstructor(visitor){function Context(path){if(!(this instanceof Context)){throw new Error("")}if(!(this instanceof PathVisitor)){throw new Error("")}if(!(path instanceof NodePath)){throw new Error("")}Object.defineProperty(this,"visitor",{value:visitor,writable:false,enumerable:true,configurable:false});this.currentPath=path;this.needToCallTraverse=true;Object.seal(this)}if(!(visitor instanceof PathVisitor)){throw new Error("")}var Cp=Context.prototype=Object.create(visitor);Cp.constructor=Context;extend(Cp,sharedContextProtoMethods);return Context}var sharedContextProtoMethods=Object.create(null);sharedContextProtoMethods.reset=function reset(path){if(!(this instanceof this.Context)){throw new Error("")}if(!(path instanceof NodePath)){throw new Error("")}this.currentPath=path;this.needToCallTraverse=true;return this};sharedContextProtoMethods.invokeVisitorMethod=function invokeVisitorMethod(methodName){if(!(this instanceof this.Context)){throw new Error("")}if(!(this.currentPath instanceof NodePath)){throw new Error("")}var result=this.visitor[methodName].call(this,this.currentPath);if(result===false){this.needToCallTraverse=false}else if(result!==undefined){this.currentPath=this.currentPath.replace(result)[0];if(this.needToCallTraverse){this.traverse(this.currentPath)}}if(this.needToCallTraverse!==false){throw new Error("Must either call this.traverse or return false in "+methodName)}var path=this.currentPath;return path&&path.value};sharedContextProtoMethods.traverse=function traverse(path,newVisitor){if(!(this instanceof this.Context)){throw new Error("")}if(!(path instanceof NodePath)){throw new Error("")}if(!(this.currentPath instanceof NodePath)){throw new Error("")}this.needToCallTraverse=false;return visitChildren(path,PathVisitor.fromMethodsObject(newVisitor||this.visitor))};sharedContextProtoMethods.visit=function visit(path,newVisitor){if(!(this instanceof this.Context)){throw new Error("")}if(!(path instanceof NodePath)){throw new Error("")}if(!(this.currentPath instanceof NodePath)){throw new Error("")}this.needToCallTraverse=false;return PathVisitor.fromMethodsObject(newVisitor||this.visitor).visitWithoutReset(path)};sharedContextProtoMethods.reportChanged=function reportChanged(){this.visitor.reportChanged()};sharedContextProtoMethods.abort=function abort(){this.needToCallTraverse=false;this.visitor.abort()};return PathVisitor}},{"./node-path":46,"./types":51}],48:[function(require,module,exports){var Ap=Array.prototype;var slice=Ap.slice;var map=Ap.map;var Op=Object.prototype;var hasOwn=Op.hasOwnProperty;module.exports=function(fork){var types=fork.use(require("./types"));var isArray=types.builtInTypes.array;var isNumber=types.builtInTypes.number;function Path(value,parentPath,name){if(!(this instanceof Path)){throw new Error("Path constructor cannot be invoked without 'new'")}if(parentPath){if(!(parentPath instanceof Path)){throw new Error("")}}else{parentPath=null;name=null}this.value=value;this.parentPath=parentPath;this.name=name;this.__childCache=null}var Pp=Path.prototype;function getChildCache(path){return path.__childCache||(path.__childCache=Object.create(null))}function getChildPath(path,name){var cache=getChildCache(path);var actualChildValue=path.getValueProperty(name);var childPath=cache[name];if(!hasOwn.call(cache,name)||childPath.value!==actualChildValue){childPath=cache[name]=new path.constructor(actualChildValue,path,name)}return childPath}Pp.getValueProperty=function getValueProperty(name){return this.value[name]};Pp.get=function get(name){var path=this;var names=arguments;var count=names.length;for(var i=0;i<count;++i){path=getChildPath(path,names[i])}return path};Pp.each=function each(callback,context){var childPaths=[];var len=this.value.length;var i=0;for(var i=0;i<len;++i){if(hasOwn.call(this.value,i)){childPaths[i]=this.get(i)}}context=context||this;for(i=0;i<len;++i){if(hasOwn.call(childPaths,i)){callback.call(context,childPaths[i])}}};Pp.map=function map(callback,context){var result=[];this.each(function(childPath){result.push(callback.call(this,childPath))},context);return result};Pp.filter=function filter(callback,context){var result=[];this.each(function(childPath){if(callback.call(this,childPath)){result.push(childPath)}},context);return result};function emptyMoves(){}function getMoves(path,offset,start,end){isArray.assert(path.value);if(offset===0){return emptyMoves}var length=path.value.length;if(length<1){return emptyMoves}var argc=arguments.length;if(argc===2){start=0;end=length}else if(argc===3){start=Math.max(start,0);end=length}else{start=Math.max(start,0);end=Math.min(end,length)}isNumber.assert(start);isNumber.assert(end);var moves=Object.create(null);var cache=getChildCache(path);for(var i=start;i<end;++i){if(hasOwn.call(path.value,i)){var childPath=path.get(i);if(childPath.name!==i){throw new Error("")}var newIndex=i+offset;childPath.name=newIndex;moves[newIndex]=childPath;delete cache[i]}}delete cache.length;return function(){for(var newIndex in moves){var childPath=moves[newIndex];if(childPath.name!==+newIndex){throw new Error("")}cache[newIndex]=childPath;path.value[newIndex]=childPath.value}}}Pp.shift=function shift(){var move=getMoves(this,-1);var result=this.value.shift();move();return result};Pp.unshift=function unshift(node){var move=getMoves(this,arguments.length);var result=this.value.unshift.apply(this.value,arguments);move();return result};Pp.push=function push(node){isArray.assert(this.value);delete getChildCache(this).length;return this.value.push.apply(this.value,arguments)};Pp.pop=function pop(){isArray.assert(this.value);var cache=getChildCache(this);delete cache[this.value.length-1];delete cache.length;return this.value.pop()};Pp.insertAt=function insertAt(index,node){var argc=arguments.length;var move=getMoves(this,argc-1,index);if(move===emptyMoves){return this}index=Math.max(index,0);for(var i=1;i<argc;++i){this.value[index+i-1]=arguments[i]}move();return this};Pp.insertBefore=function insertBefore(node){var pp=this.parentPath;var argc=arguments.length;var insertAtArgs=[this.name];for(var i=0;i<argc;++i){insertAtArgs.push(arguments[i])}return pp.insertAt.apply(pp,insertAtArgs)};Pp.insertAfter=function insertAfter(node){var pp=this.parentPath;var argc=arguments.length;var insertAtArgs=[this.name+1];for(var i=0;i<argc;++i){insertAtArgs.push(arguments[i])}return pp.insertAt.apply(pp,insertAtArgs)};function repairRelationshipWithParent(path){if(!(path instanceof Path)){throw new Error("")}var pp=path.parentPath;if(!pp){return path}var parentValue=pp.value;var parentCache=getChildCache(pp);if(parentValue[path.name]===path.value){parentCache[path.name]=path}else if(isArray.check(parentValue)){var i=parentValue.indexOf(path.value);if(i>=0){parentCache[path.name=i]=path}}else{parentValue[path.name]=path.value;parentCache[path.name]=path}if(parentValue[path.name]!==path.value){throw new Error("")}if(path.parentPath.get(path.name)!==path){throw new Error("")}return path}Pp.replace=function replace(replacement){var results=[];var parentValue=this.parentPath.value;var parentCache=getChildCache(this.parentPath);var count=arguments.length;repairRelationshipWithParent(this);if(isArray.check(parentValue)){var originalLength=parentValue.length;var move=getMoves(this.parentPath,count-1,this.name+1);var spliceArgs=[this.name,1];for(var i=0;i<count;++i){spliceArgs.push(arguments[i])}var splicedOut=parentValue.splice.apply(parentValue,spliceArgs);if(splicedOut[0]!==this.value){throw new Error("")}if(parentValue.length!==originalLength-1+count){throw new Error("")}move();if(count===0){delete this.value;delete parentCache[this.name];this.__childCache=null}else{if(parentValue[this.name]!==replacement){throw new Error("")}if(this.value!==replacement){this.value=replacement;this.__childCache=null}for(i=0;i<count;++i){results.push(this.parentPath.get(this.name+i))}if(results[0]!==this){throw new Error("")}}}else if(count===1){if(this.value!==replacement){this.__childCache=null}this.value=parentValue[this.name]=replacement;results.push(this)}else if(count===0){delete parentValue[this.name];delete this.value;this.__childCache=null}else{throw new Error("Could not replace path")}return results};return Path}},{"./types":51}],49:[function(require,module,exports){var hasOwn=Object.prototype.hasOwnProperty;module.exports=function(fork){var types=fork.use(require("./types"));var Type=types.Type;var namedTypes=types.namedTypes;var Node=namedTypes.Node;var Expression=namedTypes.Expression;var isArray=types.builtInTypes.array;var b=types.builders;function Scope(path,parentScope){if(!(this instanceof Scope)){throw new Error("Scope constructor cannot be invoked without 'new'")}if(!(path instanceof fork.use(require("./node-path")))){throw new Error("")}ScopeType.assert(path.value);var depth;if(parentScope){if(!(parentScope instanceof Scope)){throw new Error("")}depth=parentScope.depth+1}else{parentScope=null;depth=0}Object.defineProperties(this,{path:{value:path},node:{value:path.value},isGlobal:{value:!parentScope,enumerable:true},depth:{value:depth},parent:{value:parentScope},bindings:{value:{}},types:{value:{}}})}var scopeTypes=[namedTypes.Program,namedTypes.Function,namedTypes.CatchClause];var ScopeType=Type.or.apply(Type,scopeTypes);Scope.isEstablishedBy=function(node){return ScopeType.check(node)};var Sp=Scope.prototype;Sp.didScan=false;Sp.declares=function(name){this.scan();return hasOwn.call(this.bindings,name)};Sp.declaresType=function(name){this.scan();return hasOwn.call(this.types,name)};Sp.declareTemporary=function(prefix){if(prefix){if(!/^[a-z$_]/i.test(prefix)){throw new Error("")}}else{prefix="t$"}prefix+=this.depth.toString(36)+"$";this.scan();var index=0;while(this.declares(prefix+index)){++index}var name=prefix+index;return this.bindings[name]=types.builders.identifier(name)};Sp.injectTemporary=function(identifier,init){identifier||(identifier=this.declareTemporary());var bodyPath=this.path.get("body");if(namedTypes.BlockStatement.check(bodyPath.value)){bodyPath=bodyPath.get("body")}bodyPath.unshift(b.variableDeclaration("var",[b.variableDeclarator(identifier,init||null)]));return identifier};Sp.scan=function(force){if(force||!this.didScan){for(var name in this.bindings){delete this.bindings[name]}scanScope(this.path,this.bindings,this.types);this.didScan=true}};Sp.getBindings=function(){this.scan();return this.bindings};Sp.getTypes=function(){this.scan();return this.types};function scanScope(path,bindings,scopeTypes){var node=path.value;ScopeType.assert(node);if(namedTypes.CatchClause.check(node)){addPattern(path.get("param"),bindings)}else{recursiveScanScope(path,bindings,scopeTypes)}}function recursiveScanScope(path,bindings,scopeTypes){var node=path.value;if(path.parent&&namedTypes.FunctionExpression.check(path.parent.node)&&path.parent.node.id){addPattern(path.parent.get("id"),bindings)}if(!node){}else if(isArray.check(node)){path.each(function(childPath){recursiveScanChild(childPath,bindings,scopeTypes)})}else if(namedTypes.Function.check(node)){path.get("params").each(function(paramPath){addPattern(paramPath,bindings)});recursiveScanChild(path.get("body"),bindings,scopeTypes)}else if(namedTypes.TypeAlias&&namedTypes.TypeAlias.check(node)){addTypePattern(path.get("id"),scopeTypes)}else if(namedTypes.VariableDeclarator.check(node)){addPattern(path.get("id"),bindings);recursiveScanChild(path.get("init"),bindings,scopeTypes)}else if(node.type==="ImportSpecifier"||node.type==="ImportNamespaceSpecifier"||node.type==="ImportDefaultSpecifier"){addPattern(path.get(node.local?"local":node.name?"name":"id"),bindings)}else if(Node.check(node)&&!Expression.check(node)){types.eachField(node,function(name,child){var childPath=path.get(name);if(!pathHasValue(childPath,child)){throw new Error("")}recursiveScanChild(childPath,bindings,scopeTypes)})}}function pathHasValue(path,value){if(path.value===value){return true}if(Array.isArray(path.value)&&path.value.length===0&&Array.isArray(value)&&value.length===0){return true}return false}function recursiveScanChild(path,bindings,scopeTypes){var node=path.value;if(!node||Expression.check(node)){}else if(namedTypes.FunctionDeclaration.check(node)&&node.id!==null){addPattern(path.get("id"),bindings)}else if(namedTypes.ClassDeclaration&&namedTypes.ClassDeclaration.check(node)){addPattern(path.get("id"),bindings)}else if(ScopeType.check(node)){if(namedTypes.CatchClause.check(node)){var catchParamName=node.param.name;var hadBinding=hasOwn.call(bindings,catchParamName);recursiveScanScope(path.get("body"),bindings,scopeTypes);if(!hadBinding){delete bindings[catchParamName]}}}else{recursiveScanScope(path,bindings,scopeTypes)}}function addPattern(patternPath,bindings){var pattern=patternPath.value;namedTypes.Pattern.assert(pattern);if(namedTypes.Identifier.check(pattern)){if(hasOwn.call(bindings,pattern.name)){bindings[pattern.name].push(patternPath)}else{bindings[pattern.name]=[patternPath]}}else if(namedTypes.ObjectPattern&&namedTypes.ObjectPattern.check(pattern)){patternPath.get("properties").each(function(propertyPath){var property=propertyPath.value;if(namedTypes.Pattern.check(property)){addPattern(propertyPath,bindings)}else if(namedTypes.Property.check(property)){addPattern(propertyPath.get("value"),bindings)}else if(namedTypes.SpreadProperty&&namedTypes.SpreadProperty.check(property)){addPattern(propertyPath.get("argument"),bindings)}})}else if(namedTypes.ArrayPattern&&namedTypes.ArrayPattern.check(pattern)){patternPath.get("elements").each(function(elementPath){var element=elementPath.value;if(namedTypes.Pattern.check(element)){addPattern(elementPath,bindings)}else if(namedTypes.SpreadElement&&namedTypes.SpreadElement.check(element)){addPattern(elementPath.get("argument"),bindings)}})}else if(namedTypes.PropertyPattern&&namedTypes.PropertyPattern.check(pattern)){addPattern(patternPath.get("pattern"),bindings)}else if(namedTypes.SpreadElementPattern&&namedTypes.SpreadElementPattern.check(pattern)||namedTypes.SpreadPropertyPattern&&namedTypes.SpreadPropertyPattern.check(pattern)){addPattern(patternPath.get("argument"),bindings)}}function addTypePattern(patternPath,types){var pattern=patternPath.value;namedTypes.Pattern.assert(pattern);if(namedTypes.Identifier.check(pattern)){if(hasOwn.call(types,pattern.name)){types[pattern.name].push(patternPath)}else{types[pattern.name]=[patternPath]}}}Sp.lookup=function(name){for(var scope=this;scope;scope=scope.parent)if(scope.declares(name))break;return scope};Sp.lookupType=function(name){for(var scope=this;scope;scope=scope.parent)if(scope.declaresType(name))break;return scope};Sp.getGlobalScope=function(){var scope=this;while(!scope.isGlobal)scope=scope.parent;return scope};return Scope}},{"./node-path":46,"./types":51}],50:[function(require,module,exports){module.exports=function(fork){var exports={};var types=fork.use(require("../lib/types"));var Type=types.Type;var builtin=types.builtInTypes;var isNumber=builtin.number;exports.geq=function(than){return new Type(function(value){return isNumber.check(value)&&value>=than},isNumber+" >= "+than)};exports.defaults={null:function(){return null},emptyArray:function(){return[]},false:function(){return false},true:function(){return true},undefined:function(){}};var naiveIsPrimitive=Type.or(builtin.string,builtin.number,builtin.boolean,builtin.null,builtin.undefined);exports.isPrimitive=new Type(function(value){if(value===null)return true;var type=typeof value;return!(type==="object"||type==="function")},naiveIsPrimitive.toString());return exports}},{"../lib/types":51}],51:[function(require,module,exports){var Ap=Array.prototype;var slice=Ap.slice;var map=Ap.map;var each=Ap.forEach;var Op=Object.prototype;var objToStr=Op.toString;var funObjStr=objToStr.call(function(){});var strObjStr=objToStr.call("");var hasOwn=Op.hasOwnProperty;module.exports=function(){var exports={};function Type(check,name){var self=this;if(!(self instanceof Type)){throw new Error("Type constructor cannot be invoked without 'new'")}if(objToStr.call(check)!==funObjStr){throw new Error(check+" is not a function")}var nameObjStr=objToStr.call(name);if(!(nameObjStr===funObjStr||nameObjStr===strObjStr)){throw new Error(name+" is neither a function nor a string")}Object.defineProperties(self,{name:{value:name},check:{value:function(value,deep){var result=check.call(self,value,deep);if(!result&&deep&&objToStr.call(deep)===funObjStr)deep(self,value);return result}}})}var Tp=Type.prototype;exports.Type=Type;Tp.assert=function(value,deep){if(!this.check(value,deep)){var str=shallowStringify(value);throw new Error(str+" does not match type "+this)}return true};function shallowStringify(value){if(isObject.check(value))return"{"+Object.keys(value).map(function(key){return key+": "+value[key]}).join(", ")+"}";if(isArray.check(value))return"["+value.map(shallowStringify).join(", ")+"]";return JSON.stringify(value)}Tp.toString=function(){var name=this.name;if(isString.check(name))return name;if(isFunction.check(name))return name.call(this)+"";return name+" type"};var builtInCtorFns=[];var builtInCtorTypes=[];var builtInTypes={};exports.builtInTypes=builtInTypes;function defBuiltInType(example,name){var objStr=objToStr.call(example);var type=new Type(function(value){return objToStr.call(value)===objStr},name);builtInTypes[name]=type;if(example&&typeof example.constructor==="function"){builtInCtorFns.push(example.constructor);builtInCtorTypes.push(type)}return type}var isString=defBuiltInType("truthy","string");var isFunction=defBuiltInType(function(){},"function");var isArray=defBuiltInType([],"array");var isObject=defBuiltInType({},"object");var isRegExp=defBuiltInType(/./,"RegExp");var isDate=defBuiltInType(new Date,"Date");var isNumber=defBuiltInType(3,"number");var isBoolean=defBuiltInType(true,"boolean");var isNull=defBuiltInType(null,"null");var isUndefined=defBuiltInType(void 0,"undefined");function toType(from,name){if(from instanceof Type)return from;if(from instanceof Def)return from.type;if(isArray.check(from))return Type.fromArray(from);if(isObject.check(from))return Type.fromObject(from);if(isFunction.check(from)){var bicfIndex=builtInCtorFns.indexOf(from);if(bicfIndex>=0){return builtInCtorTypes[bicfIndex]}return new Type(from,name)}return new Type(function(value){return value===from},isUndefined.check(name)?function(){return from+""}:name)}Type.or=function(){var types=[];var len=arguments.length;for(var i=0;i<len;++i)types.push(toType(arguments[i]));return new Type(function(value,deep){for(var i=0;i<len;++i)if(types[i].check(value,deep))return true;return false},function(){return types.join(" | ")})};Type.fromArray=function(arr){if(!isArray.check(arr)){throw new Error("")}if(arr.length!==1){throw new Error("only one element type is permitted for typed arrays")}return toType(arr[0]).arrayOf()};Tp.arrayOf=function(){var elemType=this;return new Type(function(value,deep){return isArray.check(value)&&value.every(function(elem){return elemType.check(elem,deep)})},function(){return"["+elemType+"]"})};Type.fromObject=function(obj){var fields=Object.keys(obj).map(function(name){return new Field(name,obj[name])});return new Type(function(value,deep){return isObject.check(value)&&fields.every(function(field){return field.type.check(value[field.name],deep)})},function(){return"{ "+fields.join(", ")+" }"})};function Field(name,type,defaultFn,hidden){var self=this;if(!(self instanceof Field)){throw new Error("Field constructor cannot be invoked without 'new'")}isString.assert(name);type=toType(type);var properties={name:{value:name},type:{value:type},hidden:{value:!!hidden}};if(isFunction.check(defaultFn)){properties.defaultFn={value:defaultFn}}Object.defineProperties(self,properties)}var Fp=Field.prototype;Fp.toString=function(){return JSON.stringify(this.name)+": "+this.type};Fp.getValue=function(obj){var value=obj[this.name];if(!isUndefined.check(value))return value;if(this.defaultFn)value=this.defaultFn.call(obj);return value};Type.def=function(typeName){isString.assert(typeName);return hasOwn.call(defCache,typeName)?defCache[typeName]:defCache[typeName]=new Def(typeName)};var defCache=Object.create(null);function Def(typeName){var self=this;if(!(self instanceof Def)){throw new Error("Def constructor cannot be invoked without 'new'")}Object.defineProperties(self,{typeName:{value:typeName},baseNames:{value:[]},ownFields:{value:Object.create(null)},allSupertypes:{value:Object.create(null)},supertypeList:{value:[]},allFields:{value:Object.create(null)},fieldNames:{value:[]},type:{value:new Type(function(value,deep){return self.check(value,deep)},typeName)}})}Def.fromValue=function(value){if(value&&typeof value==="object"){var type=value.type;if(typeof type==="string"&&hasOwn.call(defCache,type)){var d=defCache[type];if(d.finalized){return d}}}return null};var Dp=Def.prototype;Dp.isSupertypeOf=function(that){if(that instanceof Def){if(this.finalized!==true||that.finalized!==true){throw new Error("")}return hasOwn.call(that.allSupertypes,this.typeName)}else{throw new Error(that+" is not a Def")}};exports.getSupertypeNames=function(typeName){if(!hasOwn.call(defCache,typeName)){throw new Error("")}var d=defCache[typeName];if(d.finalized!==true){throw new Error("")}return d.supertypeList.slice(1)};exports.computeSupertypeLookupTable=function(candidates){var table={};var typeNames=Object.keys(defCache);var typeNameCount=typeNames.length;for(var i=0;i<typeNameCount;++i){var typeName=typeNames[i];var d=defCache[typeName];if(d.finalized!==true){throw new Error(""+typeName)}for(var j=0;j<d.supertypeList.length;++j){var superTypeName=d.supertypeList[j];if(hasOwn.call(candidates,superTypeName)){table[typeName]=superTypeName;break}}}return table};Dp.checkAllFields=function(value,deep){var allFields=this.allFields;if(this.finalized!==true){throw new Error(""+this.typeName)}function checkFieldByName(name){var field=allFields[name];var type=field.type;var child=field.getValue(value);return type.check(child,deep)}return isObject.check(value)&&Object.keys(allFields).every(checkFieldByName)};Dp.check=function(value,deep){if(this.finalized!==true){throw new Error("prematurely checking unfinalized type "+this.typeName)}if(!isObject.check(value))return false;var vDef=Def.fromValue(value);if(!vDef){if(this.typeName==="SourceLocation"||this.typeName==="Position"){return this.checkAllFields(value,deep)}return false}if(deep&&vDef===this)return this.checkAllFields(value,deep);if(!this.isSupertypeOf(vDef))return false;if(!deep)return true;return vDef.checkAllFields(value,deep)&&this.checkAllFields(value,false)};Dp.bases=function(){var args=slice.call(arguments);var bases=this.baseNames;if(this.finalized){if(args.length!==bases.length){throw new Error("")}for(var i=0;i<args.length;i++){if(args[i]!==bases[i]){throw new Error("")}}return this}args.forEach(function(baseName){isString.assert(baseName);if(bases.indexOf(baseName)<0)bases.push(baseName)});return this};Object.defineProperty(Dp,"buildable",{value:false});var builders={};exports.builders=builders;var nodePrototype={};exports.defineMethod=function(name,func){var old=nodePrototype[name];if(isUndefined.check(func)){delete nodePrototype[name]}else{isFunction.assert(func);Object.defineProperty(nodePrototype,name,{enumerable:true,configurable:true,value:func})}return old};var isArrayOfString=isString.arrayOf();Dp.build=function(){var self=this;var newBuildParams=slice.call(arguments);isArrayOfString.assert(newBuildParams);Object.defineProperty(self,"buildParams",{value:newBuildParams,writable:false,enumerable:false,configurable:true});if(self.buildable){return self}self.field("type",String,function(){return self.typeName});Object.defineProperty(self,"buildable",{value:true});Object.defineProperty(builders,getBuilderName(self.typeName),{enumerable:true,value:function(){var args=arguments;var argc=args.length;var built=Object.create(nodePrototype);if(!self.finalized){throw new Error("attempting to instantiate unfinalized type "+self.typeName)}function add(param,i){if(hasOwn.call(built,param))return;var all=self.allFields;if(!hasOwn.call(all,param)){throw new Error(""+param)}var field=all[param];var type=field.type;var value;if(isNumber.check(i)&&i<argc){value=args[i]}else if(field.defaultFn){value=field.defaultFn.call(built)}else{var message="no value or default function given for field "+JSON.stringify(param)+" of "+self.typeName+"("+self.buildParams.map(function(name){return all[name]}).join(", ")+")";throw new Error(message)}if(!type.check(value)){throw new Error(shallowStringify(value)+" does not match field "+field+" of type "+self.typeName)}built[param]=value}self.buildParams.forEach(function(param,i){add(param,i)});Object.keys(self.allFields).forEach(function(param){add(param)});if(built.type!==self.typeName){throw new Error("")}return built}});return self};function getBuilderName(typeName){return typeName.replace(/^[A-Z]+/,function(upperCasePrefix){var len=upperCasePrefix.length;switch(len){case 0:return"";case 1:return upperCasePrefix.toLowerCase();default:return upperCasePrefix.slice(0,len-1).toLowerCase()+upperCasePrefix.charAt(len-1)}})}exports.getBuilderName=getBuilderName;function getStatementBuilderName(typeName){typeName=getBuilderName(typeName);return typeName.replace(/(Expression)?$/,"Statement")}exports.getStatementBuilderName=getStatementBuilderName;Dp.field=function(name,type,defaultFn,hidden){if(this.finalized){console.error("Ignoring attempt to redefine field "+JSON.stringify(name)+" of finalized type "+JSON.stringify(this.typeName));return this}this.ownFields[name]=new Field(name,type,defaultFn,hidden);return this};var namedTypes={};exports.namedTypes=namedTypes;function getFieldNames(object){var d=Def.fromValue(object);if(d){return d.fieldNames.slice(0)}if("type"in object){throw new Error("did not recognize object of type "+JSON.stringify(object.type))}return Object.keys(object)}exports.getFieldNames=getFieldNames;function getFieldValue(object,fieldName){var d=Def.fromValue(object);if(d){var field=d.allFields[fieldName];if(field){return field.getValue(object)}}return object&&object[fieldName]}exports.getFieldValue=getFieldValue;exports.eachField=function(object,callback,context){getFieldNames(object).forEach(function(name){callback.call(this,name,getFieldValue(object,name))},context)};exports.someField=function(object,callback,context){return getFieldNames(object).some(function(name){return callback.call(this,name,getFieldValue(object,name))},context)};Object.defineProperty(Dp,"finalized",{value:false});Dp.finalize=function(){var self=this;if(!self.finalized){var allFields=self.allFields;var allSupertypes=self.allSupertypes;self.baseNames.forEach(function(name){var def=defCache[name];if(def instanceof Def){def.finalize();extend(allFields,def.allFields);extend(allSupertypes,def.allSupertypes)}else{var message="unknown supertype name "+JSON.stringify(name)+" for subtype "+JSON.stringify(self.typeName);throw new Error(message)}});extend(allFields,self.ownFields);allSupertypes[self.typeName]=self;self.fieldNames.length=0;for(var fieldName in allFields){if(hasOwn.call(allFields,fieldName)&&!allFields[fieldName].hidden){self.fieldNames.push(fieldName)}}Object.defineProperty(namedTypes,self.typeName,{enumerable:true,value:self.type});Object.defineProperty(self,"finalized",{value:true});populateSupertypeList(self.typeName,self.supertypeList);if(self.buildable&&self.supertypeList.lastIndexOf("Expression")>=0){wrapExpressionBuilderWithStatement(self.typeName)}}};function wrapExpressionBuilderWithStatement(typeName){var wrapperName=getStatementBuilderName(typeName);if(builders[wrapperName])return;var wrapped=builders[getBuilderName(typeName)];if(!wrapped)return;builders[wrapperName]=function(){return builders.expressionStatement(wrapped.apply(builders,arguments))}}function populateSupertypeList(typeName,list){list.length=0;list.push(typeName);var lastSeen=Object.create(null);for(var pos=0;pos<list.length;++pos){typeName=list[pos];var d=defCache[typeName];if(d.finalized!==true){throw new Error("")}if(hasOwn.call(lastSeen,typeName)){delete list[lastSeen[typeName]]}lastSeen[typeName]=pos;list.push.apply(list,d.baseNames)}for(var to=0,from=to,len=list.length;from<len;++from){if(hasOwn.call(list,from)){list[to++]=list[from]}}list.length=to}function extend(into,from){Object.keys(from).forEach(function(name){into[name]=from[name]});return into}exports.finalize=function(){Object.keys(defCache).forEach(function(name){defCache[name].finalize()})};return exports}},{}],52:[function(require,module,exports){module.exports=require("./fork")([require("./def/core"),require("./def/es6"),require("./def/es7"),require("./def/mozilla"),require("./def/e4x"),require("./def/jsx"),require("./def/flow"),require("./def/esprima"),require("./def/babel"),require("./def/babel6")])},{"./def/babel":33,"./def/babel6":35,"./def/core":36,"./def/e4x":37,"./def/es6":38,"./def/es7":39,"./def/esprima":40,"./def/flow":41,"./def/jsx":42,"./def/mozilla":43,"./fork":44}],53:[function(require,module,exports){(function(global){(function(){"use strict";var Syntax,Precedence,BinaryPrecedence,SourceNode,estraverse,esutils,base,indent,json,renumber,hexadecimal,quotes,escapeless,newline,space,parentheses,semicolons,safeConcatenation,directive,extra,parse,sourceMap,sourceCode,preserveBlankLines,FORMAT_MINIFY,FORMAT_DEFAULTS;estraverse=require("estraverse");esutils=require("esutils");Syntax=estraverse.Syntax;function isExpression(node){return CodeGenerator.Expression.hasOwnProperty(node.type)}function isStatement(node){return CodeGenerator.Statement.hasOwnProperty(node.type)}Precedence={Sequence:0,Yield:1,Await:1,Assignment:1,Conditional:2,ArrowFunction:2,LogicalOR:3,LogicalAND:4,BitwiseOR:5,BitwiseXOR:6,BitwiseAND:7,Equality:8,Relational:9,BitwiseSHIFT:10,Additive:11,Multiplicative:12,Unary:13,Postfix:14,Call:15,New:16,TaggedTemplate:17,Member:18,Primary:19};BinaryPrecedence={"||":Precedence.LogicalOR,"&&":Precedence.LogicalAND,"|":Precedence.BitwiseOR,"^":Precedence.BitwiseXOR,"&":Precedence.BitwiseAND,"==":Precedence.Equality,"!=":Precedence.Equality,"===":Precedence.Equality,"!==":Precedence.Equality,is:Precedence.Equality,isnt:Precedence.Equality,"<":Precedence.Relational,">":Precedence.Relational,"<=":Precedence.Relational,">=":Precedence.Relational,in:Precedence.Relational,instanceof:Precedence.Relational,"<<":Precedence.BitwiseSHIFT,">>":Precedence.BitwiseSHIFT,">>>":Precedence.BitwiseSHIFT,"+":Precedence.Additive,"-":Precedence.Additive,"*":Precedence.Multiplicative,"%":Precedence.Multiplicative,"/":Precedence.Multiplicative};var F_ALLOW_IN=1,F_ALLOW_CALL=1<<1,F_ALLOW_UNPARATH_NEW=1<<2,F_FUNC_BODY=1<<3,F_DIRECTIVE_CTX=1<<4,F_SEMICOLON_OPT=1<<5;var E_FTT=F_ALLOW_CALL|F_ALLOW_UNPARATH_NEW,E_TTF=F_ALLOW_IN|F_ALLOW_CALL,E_TTT=F_ALLOW_IN|F_ALLOW_CALL|F_ALLOW_UNPARATH_NEW,E_TFF=F_ALLOW_IN,E_FFT=F_ALLOW_UNPARATH_NEW,E_TFT=F_ALLOW_IN|F_ALLOW_UNPARATH_NEW;var S_TFFF=F_ALLOW_IN,S_TFFT=F_ALLOW_IN|F_SEMICOLON_OPT,S_FFFF=0,S_TFTF=F_ALLOW_IN|F_DIRECTIVE_CTX,S_TTFF=F_ALLOW_IN|F_FUNC_BODY;function getDefaultOptions(){return{indent:null,base:null,parse:null,comment:false,format:{indent:{style:"    ",base:0,adjustMultilineComment:false},newline:"\n",space:" ",json:false,renumber:false,hexadecimal:false,quotes:"single",escapeless:false,compact:false,parentheses:true,semicolons:true,safeConcatenation:false,preserveBlankLines:false},moz:{comprehensionExpressionStartsWithAssignment:false,starlessGenerator:false},sourceMap:null,sourceMapRoot:null,sourceMapWithCode:false,directive:false,raw:true,verbatim:null,sourceCode:null}}function stringRepeat(str,num){var result="";for(num|=0;num>0;num>>>=1,str+=str){if(num&1){result+=str}}return result}function hasLineTerminator(str){return/[\r\n]/g.test(str)}function endsWithLineTerminator(str){var len=str.length;return len&&esutils.code.isLineTerminator(str.charCodeAt(len-1))}function merge(target,override){var key;for(key in override){if(override.hasOwnProperty(key)){target[key]=override[key]}}return target}function updateDeeply(target,override){var key,val;function isHashObject(target){return typeof target==="object"&&target instanceof Object&&!(target instanceof RegExp)}for(key in override){if(override.hasOwnProperty(key)){val=override[key];if(isHashObject(val)){if(isHashObject(target[key])){updateDeeply(target[key],val)}else{target[key]=updateDeeply({},val)}}else{target[key]=val}}}return target}function generateNumber(value){var result,point,temp,exponent,pos;if(value!==value){throw new Error("Numeric literal whose value is NaN")}if(value<0||value===0&&1/value<0){throw new Error("Numeric literal whose value is negative")}if(value===1/0){return json?"null":renumber?"1e400":"1e+400"}result=""+value;if(!renumber||result.length<3){return result}point=result.indexOf(".");if(!json&&result.charCodeAt(0)===48&&point===1){point=0;result=result.slice(1)}temp=result;result=result.replace("e+","e");exponent=0;if((pos=temp.indexOf("e"))>0){exponent=+temp.slice(pos+1);temp=temp.slice(0,pos)}if(point>=0){exponent-=temp.length-point-1;temp=+(temp.slice(0,point)+temp.slice(point+1))+""}pos=0;while(temp.charCodeAt(temp.length+pos-1)===48){--pos}if(pos!==0){exponent-=pos;temp=temp.slice(0,pos)}if(exponent!==0){temp+="e"+exponent}if((temp.length<result.length||hexadecimal&&value>1e12&&Math.floor(value)===value&&(temp="0x"+value.toString(16)).length<result.length)&&+temp===value){result=temp}return result}function escapeRegExpCharacter(ch,previousIsBackslash){if((ch&~1)===8232){return(previousIsBackslash?"u":"\\u")+(ch===8232?"2028":"2029")}else if(ch===10||ch===13){return(previousIsBackslash?"":"\\")+(ch===10?"n":"r")}return String.fromCharCode(ch)}function generateRegExp(reg){var match,result,flags,i,iz,ch,characterInBrack,previousIsBackslash;result=reg.toString();if(reg.source){match=result.match(/\/([^/]*)$/);if(!match){return result}flags=match[1];result="";characterInBrack=false;previousIsBackslash=false;for(i=0,iz=reg.source.length;i<iz;++i){ch=reg.source.charCodeAt(i);if(!previousIsBackslash){if(characterInBrack){if(ch===93){characterInBrack=false}}else{if(ch===47){result+="\\"}else if(ch===91){characterInBrack=true}}result+=escapeRegExpCharacter(ch,previousIsBackslash);previousIsBackslash=ch===92}else{result+=escapeRegExpCharacter(ch,previousIsBackslash);previousIsBackslash=false}}return"/"+result+"/"+flags}return result}function escapeAllowedCharacter(code,next){var hex;if(code===8){return"\\b"}if(code===12){return"\\f"}if(code===9){return"\\t"}hex=code.toString(16).toUpperCase();if(json||code>255){return"\\u"+"0000".slice(hex.length)+hex}else if(code===0&&!esutils.code.isDecimalDigit(next)){return"\\0"}else if(code===11){return"\\x0B"}else{return"\\x"+"00".slice(hex.length)+hex}}function escapeDisallowedCharacter(code){if(code===92){return"\\\\"}if(code===10){return"\\n"}if(code===13){return"\\r"}if(code===8232){return"\\u2028"}if(code===8233){return"\\u2029"}throw new Error("Incorrectly classified character")}function escapeDirective(str){var i,iz,code,quote;quote=quotes==="double"?'"':"'";for(i=0,iz=str.length;i<iz;++i){code=str.charCodeAt(i);if(code===39){quote='"';break}else if(code===34){quote="'";break}else if(code===92){++i}}return quote+str+quote}function escapeString(str){var result="",i,len,code,singleQuotes=0,doubleQuotes=0,single,quote;for(i=0,len=str.length;i<len;++i){code=str.charCodeAt(i);if(code===39){++singleQuotes}else if(code===34){++doubleQuotes}else if(code===47&&json){result+="\\"}else if(esutils.code.isLineTerminator(code)||code===92){result+=escapeDisallowedCharacter(code);continue}else if(!esutils.code.isIdentifierPartES5(code)&&(json&&code<32||!json&&!escapeless&&(code<32||code>126))){result+=escapeAllowedCharacter(code,str.charCodeAt(i+1));continue}result+=String.fromCharCode(code)}single=!(quotes==="double"||quotes==="auto"&&doubleQuotes<singleQuotes);quote=single?"'":'"';if(!(single?singleQuotes:doubleQuotes)){return quote+result+quote}str=result;result=quote;for(i=0,len=str.length;i<len;++i){code=str.charCodeAt(i);if(code===39&&single||code===34&&!single){result+="\\"}result+=String.fromCharCode(code)}return result+quote}function flattenToString(arr){var i,iz,elem,result="";for(i=0,iz=arr.length;i<iz;++i){elem=arr[i];result+=Array.isArray(elem)?flattenToString(elem):elem}return result}function toSourceNodeWhenNeeded(generated,node){if(!sourceMap){if(Array.isArray(generated)){return flattenToString(generated)}else{return generated}}if(node==null){if(generated instanceof SourceNode){return generated}else{node={}}}if(node.loc==null){return new SourceNode(null,null,sourceMap,generated,node.name||null)}return new SourceNode(node.loc.start.line,node.loc.start.column,sourceMap===true?node.loc.source||null:sourceMap,generated,node.name||null)}function noEmptySpace(){return space?space:" "}function join(left,right){var leftSource,rightSource,leftCharCode,rightCharCode;leftSource=toSourceNodeWhenNeeded(left).toString();if(leftSource.length===0){return[right]}rightSource=toSourceNodeWhenNeeded(right).toString();if(rightSource.length===0){return[left]}leftCharCode=leftSource.charCodeAt(leftSource.length-1);rightCharCode=rightSource.charCodeAt(0);if((leftCharCode===43||leftCharCode===45)&&leftCharCode===rightCharCode||esutils.code.isIdentifierPartES5(leftCharCode)&&esutils.code.isIdentifierPartES5(rightCharCode)||leftCharCode===47&&rightCharCode===105){return[left,noEmptySpace(),right]}else if(esutils.code.isWhiteSpace(leftCharCode)||esutils.code.isLineTerminator(leftCharCode)||esutils.code.isWhiteSpace(rightCharCode)||esutils.code.isLineTerminator(rightCharCode)){return[left,right]}return[left,space,right]}function addIndent(stmt){return[base,stmt]}function withIndent(fn){var previousBase;previousBase=base;base+=indent;fn(base);base=previousBase}function calculateSpaces(str){var i;for(i=str.length-1;i>=0;--i){if(esutils.code.isLineTerminator(str.charCodeAt(i))){break}}return str.length-1-i}function adjustMultilineComment(value,specialBase){var array,i,len,line,j,spaces,previousBase,sn;array=value.split(/\r\n|[\r\n]/);spaces=Number.MAX_VALUE;for(i=1,len=array.length;i<len;++i){line=array[i];j=0;while(j<line.length&&esutils.code.isWhiteSpace(line.charCodeAt(j))){++j}if(spaces>j){spaces=j}}if(typeof specialBase!=="undefined"){previousBase=base;if(array[1][spaces]==="*"){specialBase+=" "}base=specialBase}else{if(spaces&1){--spaces}previousBase=base}for(i=1,len=array.length;i<len;++i){sn=toSourceNodeWhenNeeded(addIndent(array[i].slice(spaces)));array[i]=sourceMap?sn.join(""):sn}base=previousBase;return array.join("\n")}function generateComment(comment,specialBase){if(comment.type==="Line"){if(endsWithLineTerminator(comment.value)){return"//"+comment.value}else{var result="//"+comment.value;if(!preserveBlankLines){result+="\n"}return result}}if(extra.format.indent.adjustMultilineComment&&/[\n\r]/.test(comment.value)){return adjustMultilineComment("/*"+comment.value+"*/",specialBase)}return"/*"+comment.value+"*/"}function addComments(stmt,result){var i,len,comment,save,tailingToStatement,specialBase,fragment,extRange,range,prevRange,prefix,infix,suffix,count;if(stmt.leadingComments&&stmt.leadingComments.length>0){save=result;if(preserveBlankLines){comment=stmt.leadingComments[0];result=[];extRange=comment.extendedRange;range=comment.range;prefix=sourceCode.substring(extRange[0],range[0]);count=(prefix.match(/\n/g)||[]).length;if(count>0){result.push(stringRepeat("\n",count));result.push(addIndent(generateComment(comment)))}else{result.push(prefix);result.push(generateComment(comment))}prevRange=range;for(i=1,len=stmt.leadingComments.length;i<len;i++){comment=stmt.leadingComments[i];range=comment.range;infix=sourceCode.substring(prevRange[1],range[0]);count=(infix.match(/\n/g)||[]).length;result.push(stringRepeat("\n",count));result.push(addIndent(generateComment(comment)));prevRange=range}suffix=sourceCode.substring(range[1],extRange[1]);count=(suffix.match(/\n/g)||[]).length;result.push(stringRepeat("\n",count))}else{comment=stmt.leadingComments[0];result=[];if(safeConcatenation&&stmt.type===Syntax.Program&&stmt.body.length===0){result.push("\n")}result.push(generateComment(comment));if(!endsWithLineTerminator(toSourceNodeWhenNeeded(result).toString())){result.push("\n")}for(i=1,len=stmt.leadingComments.length;i<len;++i){comment=stmt.leadingComments[i];fragment=[generateComment(comment)];if(!endsWithLineTerminator(toSourceNodeWhenNeeded(fragment).toString())){fragment.push("\n")}result.push(addIndent(fragment))}}result.push(addIndent(save))}if(stmt.trailingComments){if(preserveBlankLines){comment=stmt.trailingComments[0];extRange=comment.extendedRange;range=comment.range;prefix=sourceCode.substring(extRange[0],range[0]);count=(prefix.match(/\n/g)||[]).length;if(count>0){result.push(stringRepeat("\n",count));result.push(addIndent(generateComment(comment)))}else{result.push(prefix);result.push(generateComment(comment))}}else{tailingToStatement=!endsWithLineTerminator(toSourceNodeWhenNeeded(result).toString());specialBase=stringRepeat(" ",calculateSpaces(toSourceNodeWhenNeeded([base,result,indent]).toString()));for(i=0,len=stmt.trailingComments.length;i<len;++i){comment=stmt.trailingComments[i];if(tailingToStatement){if(i===0){result=[result,indent]}else{result=[result,specialBase]}result.push(generateComment(comment,specialBase))}else{result=[result,addIndent(generateComment(comment))]}if(i!==len-1&&!endsWithLineTerminator(toSourceNodeWhenNeeded(result).toString())){result=[result,"\n"]}}}}return result}function generateBlankLines(start,end,result){var j,newlineCount=0;for(j=start;j<end;j++){if(sourceCode[j]==="\n"){newlineCount++}}for(j=1;j<newlineCount;j++){result.push(newline)}}function parenthesize(text,current,should){if(current<should){return["(",text,")"]}return text}function generateVerbatimString(string){var i,iz,result;result=string.split(/\r\n|\n/);for(i=1,iz=result.length;i<iz;i++){result[i]=newline+base+result[i]}return result}function generateVerbatim(expr,precedence){var verbatim,result,prec;verbatim=expr[extra.verbatim];if(typeof verbatim==="string"){result=parenthesize(generateVerbatimString(verbatim),Precedence.Sequence,precedence)}else{result=generateVerbatimString(verbatim.content);prec=verbatim.precedence!=null?verbatim.precedence:Precedence.Sequence;result=parenthesize(result,prec,precedence)}return toSourceNodeWhenNeeded(result,expr)}function CodeGenerator(){}CodeGenerator.prototype.maybeBlock=function(stmt,flags){var result,noLeadingComment,that=this;noLeadingComment=!extra.comment||!stmt.leadingComments;if(stmt.type===Syntax.BlockStatement&&noLeadingComment){return[space,this.generateStatement(stmt,flags)]}if(stmt.type===Syntax.EmptyStatement&&noLeadingComment){return";"}withIndent(function(){result=[newline,addIndent(that.generateStatement(stmt,flags))]});return result};CodeGenerator.prototype.maybeBlockSuffix=function(stmt,result){var ends=endsWithLineTerminator(toSourceNodeWhenNeeded(result).toString());if(stmt.type===Syntax.BlockStatement&&(!extra.comment||!stmt.leadingComments)&&!ends){return[result,space]}if(ends){return[result,base]}return[result,newline,base]};function generateIdentifier(node){return toSourceNodeWhenNeeded(node.name,node)}function generateAsyncPrefix(node,spaceRequired){return node.async?"async"+(spaceRequired?noEmptySpace():space):""}function generateStarSuffix(node){var isGenerator=node.generator&&!extra.moz.starlessGenerator;return isGenerator?"*"+space:""}function generateMethodPrefix(prop){var func=prop.value;if(func.async){return generateAsyncPrefix(func,!prop.computed)}else{return generateStarSuffix(func)?"*":""}}CodeGenerator.prototype.generatePattern=function(node,precedence,flags){if(node.type===Syntax.Identifier){return generateIdentifier(node)}return this.generateExpression(node,precedence,flags)};CodeGenerator.prototype.generateFunctionParams=function(node){var i,iz,result,hasDefault;hasDefault=false;if(node.type===Syntax.ArrowFunctionExpression&&!node.rest&&(!node.defaults||node.defaults.length===0)&&node.params.length===1&&node.params[0].type===Syntax.Identifier){result=[generateAsyncPrefix(node,true),generateIdentifier(node.params[0])]}else{result=node.type===Syntax.ArrowFunctionExpression?[generateAsyncPrefix(node,false)]:[];result.push("(");if(node.defaults){hasDefault=true}for(i=0,iz=node.params.length;i<iz;++i){if(hasDefault&&node.defaults[i]){result.push(this.generateAssignment(node.params[i],node.defaults[i],"=",Precedence.Assignment,E_TTT))}else{result.push(this.generatePattern(node.params[i],Precedence.Assignment,E_TTT))}if(i+1<iz){result.push(","+space)}}if(node.rest){if(node.params.length){result.push(","+space)}result.push("...");result.push(generateIdentifier(node.rest))}result.push(")")}return result};CodeGenerator.prototype.generateFunctionBody=function(node){var result,expr;result=this.generateFunctionParams(node);if(node.type===Syntax.ArrowFunctionExpression){result.push(space);result.push("=>")}if(node.expression){result.push(space);expr=this.generateExpression(node.body,Precedence.Assignment,E_TTT);if(expr.toString().charAt(0)==="{"){expr=["(",expr,")"]}result.push(expr)}else{result.push(this.maybeBlock(node.body,S_TTFF))}return result};CodeGenerator.prototype.generateIterationForStatement=function(operator,stmt,flags){var result=["for"+space+"("],that=this;withIndent(function(){if(stmt.left.type===Syntax.VariableDeclaration){withIndent(function(){result.push(stmt.left.kind+noEmptySpace());result.push(that.generateStatement(stmt.left.declarations[0],S_FFFF))})}else{result.push(that.generateExpression(stmt.left,Precedence.Call,E_TTT))}result=join(result,operator);result=[join(result,that.generateExpression(stmt.right,Precedence.Sequence,E_TTT)),")"]});result.push(this.maybeBlock(stmt.body,flags));return result};CodeGenerator.prototype.generatePropertyKey=function(expr,computed){var result=[];if(computed){result.push("[")}result.push(this.generateExpression(expr,Precedence.Sequence,E_TTT));if(computed){result.push("]")}return result};CodeGenerator.prototype.generateAssignment=function(left,right,operator,precedence,flags){if(Precedence.Assignment<precedence){flags|=F_ALLOW_IN}return parenthesize([this.generateExpression(left,Precedence.Call,flags),space+operator+space,this.generateExpression(right,Precedence.Assignment,flags)],Precedence.Assignment,precedence)};CodeGenerator.prototype.semicolon=function(flags){if(!semicolons&&flags&F_SEMICOLON_OPT){return""}return";"};CodeGenerator.Statement={BlockStatement:function(stmt,flags){var range,content,result=["{",newline],that=this;withIndent(function(){if(stmt.body.length===0&&preserveBlankLines){range=stmt.range;if(range[1]-range[0]>2){content=sourceCode.substring(range[0]+1,range[1]-1);if(content[0]==="\n"){result=["{"]}result.push(content)}}var i,iz,fragment,bodyFlags;bodyFlags=S_TFFF;if(flags&F_FUNC_BODY){bodyFlags|=F_DIRECTIVE_CTX}for(i=0,iz=stmt.body.length;i<iz;++i){if(preserveBlankLines){if(i===0){if(stmt.body[0].leadingComments){range=stmt.body[0].leadingComments[0].extendedRange;content=sourceCode.substring(range[0],range[1]);if(content[0]==="\n"){result=["{"]}}if(!stmt.body[0].leadingComments){generateBlankLines(stmt.range[0],stmt.body[0].range[0],result)}}if(i>0){if(!stmt.body[i-1].trailingComments&&!stmt.body[i].leadingComments){generateBlankLines(stmt.body[i-1].range[1],stmt.body[i].range[0],result)}}}if(i===iz-1){bodyFlags|=F_SEMICOLON_OPT}if(stmt.body[i].leadingComments&&preserveBlankLines){fragment=that.generateStatement(stmt.body[i],bodyFlags)}else{fragment=addIndent(that.generateStatement(stmt.body[i],bodyFlags))}result.push(fragment);if(!endsWithLineTerminator(toSourceNodeWhenNeeded(fragment).toString())){if(preserveBlankLines&&i<iz-1){if(!stmt.body[i+1].leadingComments){result.push(newline)}}else{result.push(newline)}}if(preserveBlankLines){if(i===iz-1){if(!stmt.body[i].trailingComments){generateBlankLines(stmt.body[i].range[1],stmt.range[1],result)}}}}});result.push(addIndent("}"));return result},BreakStatement:function(stmt,flags){if(stmt.label){return"break "+stmt.label.name+this.semicolon(flags)}return"break"+this.semicolon(flags)},ContinueStatement:function(stmt,flags){if(stmt.label){return"continue "+stmt.label.name+this.semicolon(flags)}return"continue"+this.semicolon(flags)},ClassBody:function(stmt,flags){var result=["{",newline],that=this;withIndent(function(indent){var i,iz;for(i=0,iz=stmt.body.length;i<iz;++i){result.push(indent);result.push(that.generateExpression(stmt.body[i],Precedence.Sequence,E_TTT));if(i+1<iz){result.push(newline)}}});if(!endsWithLineTerminator(toSourceNodeWhenNeeded(result).toString())){result.push(newline)}result.push(base);result.push("}");return result},ClassDeclaration:function(stmt,flags){var result,fragment;result=["class"];if(stmt.id){result=join(result,this.generateExpression(stmt.id,Precedence.Sequence,E_TTT))}if(stmt.superClass){fragment=join("extends",this.generateExpression(stmt.superClass,Precedence.Assignment,E_TTT));result=join(result,fragment)}result.push(space);result.push(this.generateStatement(stmt.body,S_TFFT));return result},DirectiveStatement:function(stmt,flags){if(extra.raw&&stmt.raw){return stmt.raw+this.semicolon(flags)}return escapeDirective(stmt.directive)+this.semicolon(flags)},DoWhileStatement:function(stmt,flags){var result=join("do",this.maybeBlock(stmt.body,S_TFFF));result=this.maybeBlockSuffix(stmt.body,result);return join(result,["while"+space+"(",this.generateExpression(stmt.test,Precedence.Sequence,E_TTT),")"+this.semicolon(flags)])},CatchClause:function(stmt,flags){var result,that=this;withIndent(function(){var guard;result=["catch"+space+"(",that.generateExpression(stmt.param,Precedence.Sequence,E_TTT),")"];if(stmt.guard){guard=that.generateExpression(stmt.guard,Precedence.Sequence,E_TTT);result.splice(2,0," if ",guard)}});result.push(this.maybeBlock(stmt.body,S_TFFF));return result},DebuggerStatement:function(stmt,flags){return"debugger"+this.semicolon(flags)},EmptyStatement:function(stmt,flags){return";"},ExportDefaultDeclaration:function(stmt,flags){var result=["export"],bodyFlags;bodyFlags=flags&F_SEMICOLON_OPT?S_TFFT:S_TFFF;result=join(result,"default");if(isStatement(stmt.declaration)){result=join(result,this.generateStatement(stmt.declaration,bodyFlags))}else{result=join(result,this.generateExpression(stmt.declaration,Precedence.Assignment,E_TTT)+this.semicolon(flags))}return result},ExportNamedDeclaration:function(stmt,flags){var result=["export"],bodyFlags,that=this;bodyFlags=flags&F_SEMICOLON_OPT?S_TFFT:S_TFFF;if(stmt.declaration){return join(result,this.generateStatement(stmt.declaration,bodyFlags))}if(stmt.specifiers){if(stmt.specifiers.length===0){result=join(result,"{"+space+"}")}else if(stmt.specifiers[0].type===Syntax.ExportBatchSpecifier){result=join(result,this.generateExpression(stmt.specifiers[0],Precedence.Sequence,E_TTT))}else{result=join(result,"{");withIndent(function(indent){var i,iz;result.push(newline);for(i=0,iz=stmt.specifiers.length;i<iz;++i){result.push(indent);result.push(that.generateExpression(stmt.specifiers[i],Precedence.Sequence,E_TTT));if(i+1<iz){result.push(","+newline)}}});if(!endsWithLineTerminator(toSourceNodeWhenNeeded(result).toString())){result.push(newline)}result.push(base+"}")}if(stmt.source){result=join(result,["from"+space,this.generateExpression(stmt.source,Precedence.Sequence,E_TTT),this.semicolon(flags)])}else{result.push(this.semicolon(flags))}}return result},ExportAllDeclaration:function(stmt,flags){return["export"+space,"*"+space,"from"+space,this.generateExpression(stmt.source,Precedence.Sequence,E_TTT),this.semicolon(flags)]},ExpressionStatement:function(stmt,flags){var result,fragment;function isClassPrefixed(fragment){var code;if(fragment.slice(0,5)!=="class"){return false}code=fragment.charCodeAt(5);return code===123||esutils.code.isWhiteSpace(code)||esutils.code.isLineTerminator(code)}function isFunctionPrefixed(fragment){var code;if(fragment.slice(0,8)!=="function"){return false}code=fragment.charCodeAt(8);return code===40||esutils.code.isWhiteSpace(code)||code===42||esutils.code.isLineTerminator(code)}function isAsyncPrefixed(fragment){var code,i,iz;if(fragment.slice(0,5)!=="async"){return false}if(!esutils.code.isWhiteSpace(fragment.charCodeAt(5))){return false}for(i=6,iz=fragment.length;i<iz;++i){if(!esutils.code.isWhiteSpace(fragment.charCodeAt(i))){break}}if(i===iz){return false}if(fragment.slice(i,i+8)!=="function"){return false}code=fragment.charCodeAt(i+8);return code===40||esutils.code.isWhiteSpace(code)||code===42||esutils.code.isLineTerminator(code)}result=[this.generateExpression(stmt.expression,Precedence.Sequence,E_TTT)];fragment=toSourceNodeWhenNeeded(result).toString();if(fragment.charCodeAt(0)===123||isClassPrefixed(fragment)||isFunctionPrefixed(fragment)||isAsyncPrefixed(fragment)||directive&&flags&F_DIRECTIVE_CTX&&stmt.expression.type===Syntax.Literal&&typeof stmt.expression.value==="string"){result=["(",result,")"+this.semicolon(flags)]}else{result.push(this.semicolon(flags))}return result},ImportDeclaration:function(stmt,flags){var result,cursor,that=this;if(stmt.specifiers.length===0){return["import",space,this.generateExpression(stmt.source,Precedence.Sequence,E_TTT),this.semicolon(flags)]}result=["import"];cursor=0;if(stmt.specifiers[cursor].type===Syntax.ImportDefaultSpecifier){result=join(result,[this.generateExpression(stmt.specifiers[cursor],Precedence.Sequence,E_TTT)]);++cursor}if(stmt.specifiers[cursor]){if(cursor!==0){result.push(",")}if(stmt.specifiers[cursor].type===Syntax.ImportNamespaceSpecifier){result=join(result,[space,this.generateExpression(stmt.specifiers[cursor],Precedence.Sequence,E_TTT)])}else{result.push(space+"{");if(stmt.specifiers.length-cursor===1){result.push(space);result.push(this.generateExpression(stmt.specifiers[cursor],Precedence.Sequence,E_TTT));result.push(space+"}"+space)}else{withIndent(function(indent){var i,iz;result.push(newline);for(i=cursor,iz=stmt.specifiers.length;i<iz;++i){result.push(indent);result.push(that.generateExpression(stmt.specifiers[i],Precedence.Sequence,E_TTT));if(i+1<iz){result.push(","+newline)}}});if(!endsWithLineTerminator(toSourceNodeWhenNeeded(result).toString())){result.push(newline)}result.push(base+"}"+space)}}}result=join(result,["from"+space,this.generateExpression(stmt.source,Precedence.Sequence,E_TTT),this.semicolon(flags)]);return result},VariableDeclarator:function(stmt,flags){var itemFlags=flags&F_ALLOW_IN?E_TTT:E_FTT;if(stmt.init){return[this.generateExpression(stmt.id,Precedence.Assignment,itemFlags),space,"=",space,this.generateExpression(stmt.init,Precedence.Assignment,itemFlags)]}return this.generatePattern(stmt.id,Precedence.Assignment,itemFlags)},VariableDeclaration:function(stmt,flags){var result,i,iz,node,bodyFlags,that=this;result=[stmt.kind];bodyFlags=flags&F_ALLOW_IN?S_TFFF:S_FFFF;function block(){node=stmt.declarations[0];if(extra.comment&&node.leadingComments){result.push("\n");result.push(addIndent(that.generateStatement(node,bodyFlags)))}else{result.push(noEmptySpace());result.push(that.generateStatement(node,bodyFlags))}for(i=1,iz=stmt.declarations.length;i<iz;++i){node=stmt.declarations[i];if(extra.comment&&node.leadingComments){result.push(","+newline);result.push(addIndent(that.generateStatement(node,bodyFlags)))}else{result.push(","+space);result.push(that.generateStatement(node,bodyFlags))}}}if(stmt.declarations.length>1){withIndent(block)}else{block()}result.push(this.semicolon(flags));return result},ThrowStatement:function(stmt,flags){return[join("throw",this.generateExpression(stmt.argument,Precedence.Sequence,E_TTT)),this.semicolon(flags)]},TryStatement:function(stmt,flags){var result,i,iz,guardedHandlers;result=["try",this.maybeBlock(stmt.block,S_TFFF)];result=this.maybeBlockSuffix(stmt.block,result);if(stmt.handlers){for(i=0,iz=stmt.handlers.length;i<iz;++i){result=join(result,this.generateStatement(stmt.handlers[i],S_TFFF));if(stmt.finalizer||i+1!==iz){result=this.maybeBlockSuffix(stmt.handlers[i].body,result)}}}else{guardedHandlers=stmt.guardedHandlers||[];for(i=0,iz=guardedHandlers.length;i<iz;++i){result=join(result,this.generateStatement(guardedHandlers[i],S_TFFF));if(stmt.finalizer||i+1!==iz){result=this.maybeBlockSuffix(guardedHandlers[i].body,result)}}if(stmt.handler){if(Array.isArray(stmt.handler)){for(i=0,iz=stmt.handler.length;i<iz;++i){result=join(result,this.generateStatement(stmt.handler[i],S_TFFF));if(stmt.finalizer||i+1!==iz){result=this.maybeBlockSuffix(stmt.handler[i].body,result)}}}else{result=join(result,this.generateStatement(stmt.handler,S_TFFF));if(stmt.finalizer){result=this.maybeBlockSuffix(stmt.handler.body,result)}}}}if(stmt.finalizer){result=join(result,["finally",this.maybeBlock(stmt.finalizer,S_TFFF)])}return result},SwitchStatement:function(stmt,flags){var result,fragment,i,iz,bodyFlags,that=this;withIndent(function(){result=["switch"+space+"(",that.generateExpression(stmt.discriminant,Precedence.Sequence,E_TTT),")"+space+"{"+newline]});if(stmt.cases){bodyFlags=S_TFFF;for(i=0,iz=stmt.cases.length;i<iz;++i){if(i===iz-1){bodyFlags|=F_SEMICOLON_OPT}fragment=addIndent(this.generateStatement(stmt.cases[i],bodyFlags));result.push(fragment);if(!endsWithLineTerminator(toSourceNodeWhenNeeded(fragment).toString())){result.push(newline)}}}result.push(addIndent("}"));return result},SwitchCase:function(stmt,flags){var result,fragment,i,iz,bodyFlags,that=this;withIndent(function(){if(stmt.test){result=[join("case",that.generateExpression(stmt.test,Precedence.Sequence,E_TTT)),":"]}else{result=["default:"]}i=0;iz=stmt.consequent.length;if(iz&&stmt.consequent[0].type===Syntax.BlockStatement){fragment=that.maybeBlock(stmt.consequent[0],S_TFFF);result.push(fragment);i=1}if(i!==iz&&!endsWithLineTerminator(toSourceNodeWhenNeeded(result).toString())){result.push(newline)}bodyFlags=S_TFFF;for(;i<iz;++i){if(i===iz-1&&flags&F_SEMICOLON_OPT){bodyFlags|=F_SEMICOLON_OPT}fragment=addIndent(that.generateStatement(stmt.consequent[i],bodyFlags));result.push(fragment);if(i+1!==iz&&!endsWithLineTerminator(toSourceNodeWhenNeeded(fragment).toString())){result.push(newline)}}});return result},IfStatement:function(stmt,flags){var result,bodyFlags,semicolonOptional,that=this;withIndent(function(){result=["if"+space+"(",that.generateExpression(stmt.test,Precedence.Sequence,E_TTT),")"]});semicolonOptional=flags&F_SEMICOLON_OPT;bodyFlags=S_TFFF;if(semicolonOptional){bodyFlags|=F_SEMICOLON_OPT}if(stmt.alternate){result.push(this.maybeBlock(stmt.consequent,S_TFFF));result=this.maybeBlockSuffix(stmt.consequent,result);if(stmt.alternate.type===Syntax.IfStatement){result=join(result,["else ",this.generateStatement(stmt.alternate,bodyFlags)])}else{result=join(result,join("else",this.maybeBlock(stmt.alternate,bodyFlags)))}}else{result.push(this.maybeBlock(stmt.consequent,bodyFlags))}return result},ForStatement:function(stmt,flags){var result,that=this;withIndent(function(){result=["for"+space+"("];if(stmt.init){if(stmt.init.type===Syntax.VariableDeclaration){result.push(that.generateStatement(stmt.init,S_FFFF))}else{result.push(that.generateExpression(stmt.init,Precedence.Sequence,E_FTT));result.push(";")}}else{result.push(";")}if(stmt.test){result.push(space);result.push(that.generateExpression(stmt.test,Precedence.Sequence,E_TTT));result.push(";")}else{result.push(";")}if(stmt.update){result.push(space);result.push(that.generateExpression(stmt.update,Precedence.Sequence,E_TTT));result.push(")")}else{result.push(")")}});result.push(this.maybeBlock(stmt.body,flags&F_SEMICOLON_OPT?S_TFFT:S_TFFF));return result},ForInStatement:function(stmt,flags){return this.generateIterationForStatement("in",stmt,flags&F_SEMICOLON_OPT?S_TFFT:S_TFFF)},ForOfStatement:function(stmt,flags){return this.generateIterationForStatement("of",stmt,flags&F_SEMICOLON_OPT?S_TFFT:S_TFFF)},LabeledStatement:function(stmt,flags){return[stmt.label.name+":",this.maybeBlock(stmt.body,flags&F_SEMICOLON_OPT?S_TFFT:S_TFFF)]},Program:function(stmt,flags){var result,fragment,i,iz,bodyFlags;iz=stmt.body.length;result=[safeConcatenation&&iz>0?"\n":""];bodyFlags=S_TFTF;for(i=0;i<iz;++i){if(!safeConcatenation&&i===iz-1){bodyFlags|=F_SEMICOLON_OPT}if(preserveBlankLines){if(i===0){if(!stmt.body[0].leadingComments){generateBlankLines(stmt.range[0],stmt.body[i].range[0],result)}}if(i>0){if(!stmt.body[i-1].trailingComments&&!stmt.body[i].leadingComments){generateBlankLines(stmt.body[i-1].range[1],stmt.body[i].range[0],result)}}}fragment=addIndent(this.generateStatement(stmt.body[i],bodyFlags));result.push(fragment);if(i+1<iz&&!endsWithLineTerminator(toSourceNodeWhenNeeded(fragment).toString())){if(preserveBlankLines){if(!stmt.body[i+1].leadingComments){result.push(newline)}}else{result.push(newline)}}if(preserveBlankLines){if(i===iz-1){if(!stmt.body[i].trailingComments){generateBlankLines(stmt.body[i].range[1],stmt.range[1],result)}}}}return result},FunctionDeclaration:function(stmt,flags){return[generateAsyncPrefix(stmt,true),"function",generateStarSuffix(stmt)||noEmptySpace(),stmt.id?generateIdentifier(stmt.id):"",this.generateFunctionBody(stmt)]},ReturnStatement:function(stmt,flags){if(stmt.argument){return[join("return",this.generateExpression(stmt.argument,Precedence.Sequence,E_TTT)),this.semicolon(flags)]}return["return"+this.semicolon(flags)]},WhileStatement:function(stmt,flags){var result,that=this;withIndent(function(){result=["while"+space+"(",that.generateExpression(stmt.test,Precedence.Sequence,E_TTT),")"]});result.push(this.maybeBlock(stmt.body,flags&F_SEMICOLON_OPT?S_TFFT:S_TFFF));return result},WithStatement:function(stmt,flags){var result,that=this;withIndent(function(){result=["with"+space+"(",that.generateExpression(stmt.object,Precedence.Sequence,E_TTT),")"]});result.push(this.maybeBlock(stmt.body,flags&F_SEMICOLON_OPT?S_TFFT:S_TFFF));return result}};merge(CodeGenerator.prototype,CodeGenerator.Statement);CodeGenerator.Expression={SequenceExpression:function(expr,precedence,flags){var result,i,iz;if(Precedence.Sequence<precedence){flags|=F_ALLOW_IN}result=[];for(i=0,iz=expr.expressions.length;i<iz;++i){result.push(this.generateExpression(expr.expressions[i],Precedence.Assignment,flags));if(i+1<iz){result.push(","+space)}}return parenthesize(result,Precedence.Sequence,precedence)},AssignmentExpression:function(expr,precedence,flags){return this.generateAssignment(expr.left,expr.right,expr.operator,precedence,flags)},ArrowFunctionExpression:function(expr,precedence,flags){return parenthesize(this.generateFunctionBody(expr),Precedence.ArrowFunction,precedence)},ConditionalExpression:function(expr,precedence,flags){if(Precedence.Conditional<precedence){flags|=F_ALLOW_IN}return parenthesize([this.generateExpression(expr.test,Precedence.LogicalOR,flags),space+"?"+space,this.generateExpression(expr.consequent,Precedence.Assignment,flags),space+":"+space,this.generateExpression(expr.alternate,Precedence.Assignment,flags)],Precedence.Conditional,precedence)},LogicalExpression:function(expr,precedence,flags){return this.BinaryExpression(expr,precedence,flags)},BinaryExpression:function(expr,precedence,flags){var result,currentPrecedence,fragment,leftSource;currentPrecedence=BinaryPrecedence[expr.operator];if(currentPrecedence<precedence){flags|=F_ALLOW_IN}fragment=this.generateExpression(expr.left,currentPrecedence,flags);leftSource=fragment.toString();if(leftSource.charCodeAt(leftSource.length-1)===47&&esutils.code.isIdentifierPartES5(expr.operator.charCodeAt(0))){result=[fragment,noEmptySpace(),expr.operator]}else{result=join(fragment,expr.operator)}fragment=this.generateExpression(expr.right,currentPrecedence+1,flags);if(expr.operator==="/"&&fragment.toString().charAt(0)==="/"||expr.operator.slice(-1)==="<"&&fragment.toString().slice(0,3)==="!--"){result.push(noEmptySpace());result.push(fragment)}else{result=join(result,fragment)}if(expr.operator==="in"&&!(flags&F_ALLOW_IN)){return["(",result,")"]}return parenthesize(result,currentPrecedence,precedence)},CallExpression:function(expr,precedence,flags){var result,i,iz;result=[this.generateExpression(expr.callee,Precedence.Call,E_TTF)];result.push("(");for(i=0,iz=expr["arguments"].length;i<iz;++i){result.push(this.generateExpression(expr["arguments"][i],Precedence.Assignment,E_TTT));if(i+1<iz){result.push(","+space)}}result.push(")");if(!(flags&F_ALLOW_CALL)){return["(",result,")"]}return parenthesize(result,Precedence.Call,precedence)},NewExpression:function(expr,precedence,flags){var result,length,i,iz,itemFlags;length=expr["arguments"].length;itemFlags=flags&F_ALLOW_UNPARATH_NEW&&!parentheses&&length===0?E_TFT:E_TFF;result=join("new",this.generateExpression(expr.callee,Precedence.New,itemFlags));if(!(flags&F_ALLOW_UNPARATH_NEW)||parentheses||length>0){result.push("(");for(i=0,iz=length;i<iz;++i){result.push(this.generateExpression(expr["arguments"][i],Precedence.Assignment,E_TTT));if(i+1<iz){result.push(","+space)}}result.push(")")}return parenthesize(result,Precedence.New,precedence)},MemberExpression:function(expr,precedence,flags){var result,fragment;result=[this.generateExpression(expr.object,Precedence.Call,flags&F_ALLOW_CALL?E_TTF:E_TFF)];if(expr.computed){result.push("[");result.push(this.generateExpression(expr.property,Precedence.Sequence,flags&F_ALLOW_CALL?E_TTT:E_TFT));result.push("]")}else{if(expr.object.type===Syntax.Literal&&typeof expr.object.value==="number"){fragment=toSourceNodeWhenNeeded(result).toString();if(fragment.indexOf(".")<0&&!/[eExX]/.test(fragment)&&esutils.code.isDecimalDigit(fragment.charCodeAt(fragment.length-1))&&!(fragment.length>=2&&fragment.charCodeAt(0)===48)){result.push(" ")}}result.push(".");result.push(generateIdentifier(expr.property))}return parenthesize(result,Precedence.Member,precedence)},MetaProperty:function(expr,precedence,flags){var result;result=[];result.push(expr.meta);result.push(".");result.push(expr.property);return parenthesize(result,Precedence.Member,precedence)},UnaryExpression:function(expr,precedence,flags){var result,fragment,rightCharCode,leftSource,leftCharCode;fragment=this.generateExpression(expr.argument,Precedence.Unary,E_TTT);if(space===""){result=join(expr.operator,fragment)}else{result=[expr.operator];if(expr.operator.length>2){result=join(result,fragment)}else{leftSource=toSourceNodeWhenNeeded(result).toString();leftCharCode=leftSource.charCodeAt(leftSource.length-1);rightCharCode=fragment.toString().charCodeAt(0);if((leftCharCode===43||leftCharCode===45)&&leftCharCode===rightCharCode||esutils.code.isIdentifierPartES5(leftCharCode)&&esutils.code.isIdentifierPartES5(rightCharCode)){result.push(noEmptySpace());result.push(fragment)}else{result.push(fragment)}}}return parenthesize(result,Precedence.Unary,precedence)},YieldExpression:function(expr,precedence,flags){var result;if(expr.delegate){result="yield*"}else{result="yield"}if(expr.argument){result=join(result,this.generateExpression(expr.argument,Precedence.Yield,E_TTT))}return parenthesize(result,Precedence.Yield,precedence)},AwaitExpression:function(expr,precedence,flags){var result=join(expr.all?"await*":"await",this.generateExpression(expr.argument,Precedence.Await,E_TTT));return parenthesize(result,Precedence.Await,precedence)},UpdateExpression:function(expr,precedence,flags){if(expr.prefix){return parenthesize([expr.operator,this.generateExpression(expr.argument,Precedence.Unary,E_TTT)],Precedence.Unary,precedence)}return parenthesize([this.generateExpression(expr.argument,Precedence.Postfix,E_TTT),expr.operator],Precedence.Postfix,precedence)},FunctionExpression:function(expr,precedence,flags){var result=[generateAsyncPrefix(expr,true),"function"];if(expr.id){result.push(generateStarSuffix(expr)||noEmptySpace());result.push(generateIdentifier(expr.id))}else{result.push(generateStarSuffix(expr)||space)}result.push(this.generateFunctionBody(expr));return result},ArrayPattern:function(expr,precedence,flags){return this.ArrayExpression(expr,precedence,flags,true)},ArrayExpression:function(expr,precedence,flags,isPattern){var result,multiline,that=this;if(!expr.elements.length){return"[]"}multiline=isPattern?false:expr.elements.length>1;result=["[",multiline?newline:""];withIndent(function(indent){var i,iz;for(i=0,iz=expr.elements.length;i<iz;++i){if(!expr.elements[i]){if(multiline){result.push(indent)}if(i+1===iz){result.push(",")}}else{result.push(multiline?indent:"");result.push(that.generateExpression(expr.elements[i],Precedence.Assignment,E_TTT))}if(i+1<iz){result.push(","+(multiline?newline:space))}}});if(multiline&&!endsWithLineTerminator(toSourceNodeWhenNeeded(result).toString())){result.push(newline)}result.push(multiline?base:"");result.push("]");return result},RestElement:function(expr,precedence,flags){return"..."+this.generatePattern(expr.argument)},ClassExpression:function(expr,precedence,flags){var result,fragment;result=["class"];if(expr.id){result=join(result,this.generateExpression(expr.id,Precedence.Sequence,E_TTT))}if(expr.superClass){fragment=join("extends",this.generateExpression(expr.superClass,Precedence.Assignment,E_TTT));result=join(result,fragment)}result.push(space);result.push(this.generateStatement(expr.body,S_TFFT));return result},MethodDefinition:function(expr,precedence,flags){var result,fragment;if(expr["static"]){result=["static"+space]}else{result=[]}if(expr.kind==="get"||expr.kind==="set"){fragment=[join(expr.kind,this.generatePropertyKey(expr.key,expr.computed)),this.generateFunctionBody(expr.value)]}else{fragment=[generateMethodPrefix(expr),this.generatePropertyKey(expr.key,expr.computed),this.generateFunctionBody(expr.value)]}return join(result,fragment)},Property:function(expr,precedence,flags){if(expr.kind==="get"||expr.kind==="set"){return[expr.kind,noEmptySpace(),this.generatePropertyKey(expr.key,expr.computed),this.generateFunctionBody(expr.value)]}if(expr.shorthand){if(expr.value.type==="AssignmentPattern"){return this.AssignmentPattern(expr.value,Precedence.Sequence,E_TTT)}return this.generatePropertyKey(expr.key,expr.computed)}if(expr.method){return[generateMethodPrefix(expr),this.generatePropertyKey(expr.key,expr.computed),this.generateFunctionBody(expr.value)]}return[this.generatePropertyKey(expr.key,expr.computed),":"+space,this.generateExpression(expr.value,Precedence.Assignment,E_TTT)]},ObjectExpression:function(expr,precedence,flags){var multiline,result,fragment,that=this;if(!expr.properties.length){return"{}"}multiline=expr.properties.length>1;withIndent(function(){fragment=that.generateExpression(expr.properties[0],Precedence.Sequence,E_TTT)});if(!multiline){if(!hasLineTerminator(toSourceNodeWhenNeeded(fragment).toString())){return["{",space,fragment,space,"}"]}}withIndent(function(indent){var i,iz;result=["{",newline,indent,fragment];if(multiline){result.push(","+newline);for(i=1,iz=expr.properties.length;i<iz;++i){result.push(indent);result.push(that.generateExpression(expr.properties[i],Precedence.Sequence,E_TTT));if(i+1<iz){result.push(","+newline)}}}});if(!endsWithLineTerminator(toSourceNodeWhenNeeded(result).toString())){result.push(newline)}result.push(base);result.push("}");return result},AssignmentPattern:function(expr,precedence,flags){return this.generateAssignment(expr.left,expr.right,"=",precedence,flags)},ObjectPattern:function(expr,precedence,flags){var result,i,iz,multiline,property,that=this;if(!expr.properties.length){return"{}"}multiline=false;if(expr.properties.length===1){property=expr.properties[0];if(property.value.type!==Syntax.Identifier){multiline=true}}else{for(i=0,iz=expr.properties.length;i<iz;++i){property=expr.properties[i];if(!property.shorthand){multiline=true;break}}}result=["{",multiline?newline:""];withIndent(function(indent){var i,iz;for(i=0,iz=expr.properties.length;i<iz;++i){result.push(multiline?indent:"");result.push(that.generateExpression(expr.properties[i],Precedence.Sequence,E_TTT));if(i+1<iz){result.push(","+(multiline?newline:space))}}});if(multiline&&!endsWithLineTerminator(toSourceNodeWhenNeeded(result).toString())){result.push(newline)}result.push(multiline?base:"");result.push("}");return result},ThisExpression:function(expr,precedence,flags){return"this"},Super:function(expr,precedence,flags){return"super"},Identifier:function(expr,precedence,flags){return generateIdentifier(expr)},ImportDefaultSpecifier:function(expr,precedence,flags){return generateIdentifier(expr.id||expr.local)},ImportNamespaceSpecifier:function(expr,precedence,flags){var result=["*"];var id=expr.id||expr.local;if(id){result.push(space+"as"+noEmptySpace()+generateIdentifier(id))}return result},ImportSpecifier:function(expr,precedence,flags){var imported=expr.imported;var result=[imported.name];var local=expr.local;if(local&&local.name!==imported.name){result.push(noEmptySpace()+"as"+noEmptySpace()+generateIdentifier(local))}return result},ExportSpecifier:function(expr,precedence,flags){var local=expr.local;var result=[local.name];var exported=expr.exported;if(exported&&exported.name!==local.name){result.push(noEmptySpace()+"as"+noEmptySpace()+generateIdentifier(exported))}return result},Literal:function(expr,precedence,flags){var raw;if(expr.hasOwnProperty("raw")&&parse&&extra.raw){try{raw=parse(expr.raw).body[0].expression;if(raw.type===Syntax.Literal){if(raw.value===expr.value){return expr.raw}}}catch(e){}}if(expr.value===null){return"null"}if(typeof expr.value==="string"){return escapeString(expr.value)}if(typeof expr.value==="number"){return generateNumber(expr.value)}if(typeof expr.value==="boolean"){return expr.value?"true":"false"}if(expr.regex){return"/"+expr.regex.pattern+"/"+expr.regex.flags}return generateRegExp(expr.value)},GeneratorExpression:function(expr,precedence,flags){return this.ComprehensionExpression(expr,precedence,flags)},ComprehensionExpression:function(expr,precedence,flags){var result,i,iz,fragment,that=this;result=expr.type===Syntax.GeneratorExpression?["("]:["["];if(extra.moz.comprehensionExpressionStartsWithAssignment){fragment=this.generateExpression(expr.body,Precedence.Assignment,E_TTT);result.push(fragment)}if(expr.blocks){withIndent(function(){for(i=0,iz=expr.blocks.length;i<iz;++i){fragment=that.generateExpression(expr.blocks[i],Precedence.Sequence,E_TTT);if(i>0||extra.moz.comprehensionExpressionStartsWithAssignment){result=join(result,fragment)}else{result.push(fragment)}}})}if(expr.filter){result=join(result,"if"+space);fragment=this.generateExpression(expr.filter,Precedence.Sequence,E_TTT);result=join(result,["(",fragment,")"])}if(!extra.moz.comprehensionExpressionStartsWithAssignment){fragment=this.generateExpression(expr.body,Precedence.Assignment,E_TTT);result=join(result,fragment)}result.push(expr.type===Syntax.GeneratorExpression?")":"]");return result},ComprehensionBlock:function(expr,precedence,flags){var fragment;if(expr.left.type===Syntax.VariableDeclaration){fragment=[expr.left.kind,noEmptySpace(),this.generateStatement(expr.left.declarations[0],S_FFFF)]}else{fragment=this.generateExpression(expr.left,Precedence.Call,E_TTT)}fragment=join(fragment,expr.of?"of":"in");fragment=join(fragment,this.generateExpression(expr.right,Precedence.Sequence,E_TTT));return["for"+space+"(",fragment,")"]},SpreadElement:function(expr,precedence,flags){return["...",this.generateExpression(expr.argument,Precedence.Assignment,E_TTT)]},TaggedTemplateExpression:function(expr,precedence,flags){var itemFlags=E_TTF;if(!(flags&F_ALLOW_CALL)){itemFlags=E_TFF}var result=[this.generateExpression(expr.tag,Precedence.Call,itemFlags),this.generateExpression(expr.quasi,Precedence.Primary,E_FFT)];return parenthesize(result,Precedence.TaggedTemplate,precedence)},TemplateElement:function(expr,precedence,flags){return expr.value.raw},TemplateLiteral:function(expr,precedence,flags){var result,i,iz;result=["`"];for(i=0,iz=expr.quasis.length;i<iz;++i){result.push(this.generateExpression(expr.quasis[i],Precedence.Primary,E_TTT));if(i+1<iz){result.push("${"+space);result.push(this.generateExpression(expr.expressions[i],Precedence.Sequence,E_TTT));result.push(space+"}")}}result.push("`");return result},ModuleSpecifier:function(expr,precedence,flags){return this.Literal(expr,precedence,flags)}};merge(CodeGenerator.prototype,CodeGenerator.Expression);CodeGenerator.prototype.generateExpression=function(expr,precedence,flags){var result,type;type=expr.type||Syntax.Property;if(extra.verbatim&&expr.hasOwnProperty(extra.verbatim)){return generateVerbatim(expr,precedence)}result=this[type](expr,precedence,flags);if(extra.comment){result=addComments(expr,result)}return toSourceNodeWhenNeeded(result,expr)};CodeGenerator.prototype.generateStatement=function(stmt,flags){var result,fragment;result=this[stmt.type](stmt,flags);if(extra.comment){result=addComments(stmt,result)}fragment=toSourceNodeWhenNeeded(result).toString();if(stmt.type===Syntax.Program&&!safeConcatenation&&newline===""&&fragment.charAt(fragment.length-1)==="\n"){result=sourceMap?toSourceNodeWhenNeeded(result).replaceRight(/\s+$/,""):fragment.replace(/\s+$/,"")}return toSourceNodeWhenNeeded(result,stmt)};function generateInternal(node){var codegen;codegen=new CodeGenerator;if(isStatement(node)){return codegen.generateStatement(node,S_TFFF)}if(isExpression(node)){return codegen.generateExpression(node,Precedence.Sequence,E_TTT)}throw new Error("Unknown node type: "+node.type)}function generate(node,options){var defaultOptions=getDefaultOptions(),result,pair;if(options!=null){if(typeof options.indent==="string"){defaultOptions.format.indent.style=options.indent}if(typeof options.base==="number"){defaultOptions.format.indent.base=options.base}options=updateDeeply(defaultOptions,options);indent=options.format.indent.style;if(typeof options.base==="string"){base=options.base}else{base=stringRepeat(indent,options.format.indent.base)}}else{options=defaultOptions;indent=options.format.indent.style;base=stringRepeat(indent,options.format.indent.base)}json=options.format.json;renumber=options.format.renumber;hexadecimal=json?false:options.format.hexadecimal;quotes=json?"double":options.format.quotes;escapeless=options.format.escapeless;newline=options.format.newline;space=options.format.space;if(options.format.compact){newline=space=indent=base=""}parentheses=options.format.parentheses;semicolons=options.format.semicolons;safeConcatenation=options.format.safeConcatenation;directive=options.directive;parse=json?null:options.parse;sourceMap=options.sourceMap;sourceCode=options.sourceCode;preserveBlankLines=options.format.preserveBlankLines&&sourceCode!==null;extra=options;if(sourceMap){if(!exports.browser){SourceNode=require("source-map").SourceNode}else{SourceNode=global.sourceMap.SourceNode}}result=generateInternal(node);if(!sourceMap){pair={code:result.toString(),map:null};return options.sourceMapWithCode?pair:pair.code}pair=result.toStringWithSourceMap({file:options.file,sourceRoot:options.sourceMapRoot});if(options.sourceContent){pair.map.setSourceContent(options.sourceMap,options.sourceContent)}if(options.sourceMapWithCode){return pair}return pair.map.toString()}FORMAT_MINIFY={indent:{style:"",base:0},renumber:true,hexadecimal:true,quotes:"auto",escapeless:true,compact:true,parentheses:false,semicolons:false};FORMAT_DEFAULTS=getDefaultOptions().format;exports.version=require("./package.json").version;exports.generate=generate;exports.attachComments=estraverse.attachComments;exports.Precedence=updateDeeply({},Precedence);exports.browser=false;exports.FORMAT_MINIFY=FORMAT_MINIFY;exports.FORMAT_DEFAULTS=FORMAT_DEFAULTS})()}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./package.json":65,estraverse:118,esutils:123,"source-map":64}],54:[function(require,module,exports){var util=require("./util");var has=Object.prototype.hasOwnProperty;var hasNativeMap=typeof Map!=="undefined";function ArraySet(){this._array=[];this._set=hasNativeMap?new Map:Object.create(null)}ArraySet.fromArray=function ArraySet_fromArray(aArray,aAllowDuplicates){var set=new ArraySet;for(var i=0,len=aArray.length;i<len;i++){set.add(aArray[i],aAllowDuplicates)}return set};ArraySet.prototype.size=function ArraySet_size(){return hasNativeMap?this._set.size:Object.getOwnPropertyNames(this._set).length};ArraySet.prototype.add=function ArraySet_add(aStr,aAllowDuplicates){var sStr=hasNativeMap?aStr:util.toSetString(aStr);var isDuplicate=hasNativeMap?this.has(aStr):has.call(this._set,sStr);var idx=this._array.length;if(!isDuplicate||aAllowDuplicates){this._array.push(aStr)}if(!isDuplicate){if(hasNativeMap){this._set.set(aStr,idx)}else{this._set[sStr]=idx}}};ArraySet.prototype.has=function ArraySet_has(aStr){if(hasNativeMap){return this._set.has(aStr)}else{var sStr=util.toSetString(aStr);return has.call(this._set,sStr)}};ArraySet.prototype.indexOf=function ArraySet_indexOf(aStr){if(hasNativeMap){var idx=this._set.get(aStr);if(idx>=0){return idx}}else{var sStr=util.toSetString(aStr);if(has.call(this._set,sStr)){return this._set[sStr]}}throw new Error('"'+aStr+'" is not in the set.')};ArraySet.prototype.at=function ArraySet_at(aIdx){if(aIdx>=0&&aIdx<this._array.length){return this._array[aIdx]}throw new Error("No element indexed by "+aIdx)};ArraySet.prototype.toArray=function ArraySet_toArray(){return this._array.slice()};exports.ArraySet=ArraySet},{"./util":63}],55:[function(require,module,exports){var base64=require("./base64");var VLQ_BASE_SHIFT=5;var VLQ_BASE=1<<VLQ_BASE_SHIFT;var VLQ_BASE_MASK=VLQ_BASE-1;var VLQ_CONTINUATION_BIT=VLQ_BASE;function toVLQSigned(aValue){return aValue<0?(-aValue<<1)+1:(aValue<<1)+0}function fromVLQSigned(aValue){var isNegative=(aValue&1)===1;var shifted=aValue>>1;return isNegative?-shifted:shifted}exports.encode=function base64VLQ_encode(aValue){var encoded="";var digit;var vlq=toVLQSigned(aValue);do{digit=vlq&VLQ_BASE_MASK;vlq>>>=VLQ_BASE_SHIFT;if(vlq>0){digit|=VLQ_CONTINUATION_BIT}encoded+=base64.encode(digit)}while(vlq>0);return encoded};exports.decode=function base64VLQ_decode(aStr,aIndex,aOutParam){var strLen=aStr.length;var result=0;var shift=0;var continuation,digit;do{if(aIndex>=strLen){throw new Error("Expected more digits in base 64 VLQ value.")}digit=base64.decode(aStr.charCodeAt(aIndex++));if(digit===-1){throw new Error("Invalid base64 digit: "+aStr.charAt(aIndex-1))}continuation=!!(digit&VLQ_CONTINUATION_BIT);digit&=VLQ_BASE_MASK;result=result+(digit<<shift);shift+=VLQ_BASE_SHIFT}while(continuation);aOutParam.value=fromVLQSigned(result);aOutParam.rest=aIndex}},{"./base64":56}],56:[function(require,module,exports){var intToCharMap="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");exports.encode=function(number){if(0<=number&&number<intToCharMap.length){return intToCharMap[number]}throw new TypeError("Must be between 0 and 63: "+number)};exports.decode=function(charCode){var bigA=65;var bigZ=90;var littleA=97;var littleZ=122;var zero=48;var nine=57;var plus=43;var slash=47;var littleOffset=26;var numberOffset=52;if(bigA<=charCode&&charCode<=bigZ){return charCode-bigA}if(littleA<=charCode&&charCode<=littleZ){return charCode-littleA+littleOffset}if(zero<=charCode&&charCode<=nine){return charCode-zero+numberOffset}if(charCode==plus){return 62}if(charCode==slash){return 63}return-1}},{}],57:[function(require,module,exports){exports.GREATEST_LOWER_BOUND=1;exports.LEAST_UPPER_BOUND=2;function recursiveSearch(aLow,aHigh,aNeedle,aHaystack,aCompare,aBias){var mid=Math.floor((aHigh-aLow)/2)+aLow;var cmp=aCompare(aNeedle,aHaystack[mid],true);if(cmp===0){return mid}else if(cmp>0){if(aHigh-mid>1){return recursiveSearch(mid,aHigh,aNeedle,aHaystack,aCompare,aBias)}if(aBias==exports.LEAST_UPPER_BOUND){return aHigh<aHaystack.length?aHigh:-1}else{return mid}}else{if(mid-aLow>1){return recursiveSearch(aLow,mid,aNeedle,aHaystack,aCompare,aBias)}if(aBias==exports.LEAST_UPPER_BOUND){return mid}else{return aLow<0?-1:aLow}}}exports.search=function search(aNeedle,aHaystack,aCompare,aBias){if(aHaystack.length===0){return-1}var index=recursiveSearch(-1,aHaystack.length,aNeedle,aHaystack,aCompare,aBias||exports.GREATEST_LOWER_BOUND);if(index<0){return-1}while(index-1>=0){if(aCompare(aHaystack[index],aHaystack[index-1],true)!==0){break}--index}return index}},{}],58:[function(require,module,exports){var util=require("./util");function generatedPositionAfter(mappingA,mappingB){var lineA=mappingA.generatedLine;var lineB=mappingB.generatedLine;var columnA=mappingA.generatedColumn;var columnB=mappingB.generatedColumn;return lineB>lineA||lineB==lineA&&columnB>=columnA||util.compareByGeneratedPositionsInflated(mappingA,mappingB)<=0}function MappingList(){this._array=[];this._sorted=true;this._last={generatedLine:-1,generatedColumn:0}}MappingList.prototype.unsortedForEach=function MappingList_forEach(aCallback,aThisArg){this._array.forEach(aCallback,aThisArg)};MappingList.prototype.add=function MappingList_add(aMapping){if(generatedPositionAfter(this._last,aMapping)){this._last=aMapping;this._array.push(aMapping)}else{this._sorted=false;this._array.push(aMapping)}};MappingList.prototype.toArray=function MappingList_toArray(){if(!this._sorted){this._array.sort(util.compareByGeneratedPositionsInflated);this._sorted=true}return this._array};exports.MappingList=MappingList},{"./util":63}],59:[function(require,module,exports){function swap(ary,x,y){var temp=ary[x];ary[x]=ary[y];ary[y]=temp}function randomIntInRange(low,high){return Math.round(low+Math.random()*(high-low))}function doQuickSort(ary,comparator,p,r){if(p<r){var pivotIndex=randomIntInRange(p,r);var i=p-1;swap(ary,pivotIndex,r);var pivot=ary[r];for(var j=p;j<r;j++){if(comparator(ary[j],pivot)<=0){i+=1;swap(ary,i,j)}}swap(ary,i+1,j);var q=i+1;doQuickSort(ary,comparator,p,q-1);doQuickSort(ary,comparator,q+1,r)}}exports.quickSort=function(ary,comparator){doQuickSort(ary,comparator,0,ary.length-1)}},{}],60:[function(require,module,exports){var util=require("./util");var binarySearch=require("./binary-search");var ArraySet=require("./array-set").ArraySet;var base64VLQ=require("./base64-vlq");var quickSort=require("./quick-sort").quickSort;function SourceMapConsumer(aSourceMap,aSourceMapURL){var sourceMap=aSourceMap;if(typeof aSourceMap==="string"){sourceMap=util.parseSourceMapInput(aSourceMap)}return sourceMap.sections!=null?new IndexedSourceMapConsumer(sourceMap,aSourceMapURL):new BasicSourceMapConsumer(sourceMap,aSourceMapURL)}SourceMapConsumer.fromSourceMap=function(aSourceMap,aSourceMapURL){return BasicSourceMapConsumer.fromSourceMap(aSourceMap,aSourceMapURL)};SourceMapConsumer.prototype._version=3;SourceMapConsumer.prototype.__generatedMappings=null;Object.defineProperty(SourceMapConsumer.prototype,"_generatedMappings",{configurable:true,enumerable:true,get:function(){if(!this.__generatedMappings){this._parseMappings(this._mappings,this.sourceRoot)}return this.__generatedMappings}});SourceMapConsumer.prototype.__originalMappings=null;Object.defineProperty(SourceMapConsumer.prototype,"_originalMappings",{configurable:true,enumerable:true,get:function(){if(!this.__originalMappings){this._parseMappings(this._mappings,this.sourceRoot)}return this.__originalMappings}});SourceMapConsumer.prototype._charIsMappingSeparator=function SourceMapConsumer_charIsMappingSeparator(aStr,index){var c=aStr.charAt(index);return c===";"||c===","};SourceMapConsumer.prototype._parseMappings=function SourceMapConsumer_parseMappings(aStr,aSourceRoot){throw new Error("Subclasses must implement _parseMappings")};SourceMapConsumer.GENERATED_ORDER=1;SourceMapConsumer.ORIGINAL_ORDER=2;SourceMapConsumer.GREATEST_LOWER_BOUND=1;SourceMapConsumer.LEAST_UPPER_BOUND=2;SourceMapConsumer.prototype.eachMapping=function SourceMapConsumer_eachMapping(aCallback,aContext,aOrder){var context=aContext||null;var order=aOrder||SourceMapConsumer.GENERATED_ORDER;var mappings;switch(order){case SourceMapConsumer.GENERATED_ORDER:mappings=this._generatedMappings;break;case SourceMapConsumer.ORIGINAL_ORDER:mappings=this._originalMappings;break;default:throw new Error("Unknown order of iteration.")}var sourceRoot=this.sourceRoot;mappings.map(function(mapping){var source=mapping.source===null?null:this._sources.at(mapping.source);source=util.computeSourceURL(sourceRoot,source,this._sourceMapURL);return{source:source,generatedLine:mapping.generatedLine,generatedColumn:mapping.generatedColumn,originalLine:mapping.originalLine,originalColumn:mapping.originalColumn,name:mapping.name===null?null:this._names.at(mapping.name)}},this).forEach(aCallback,context)};SourceMapConsumer.prototype.allGeneratedPositionsFor=function SourceMapConsumer_allGeneratedPositionsFor(aArgs){var line=util.getArg(aArgs,"line");var needle={source:util.getArg(aArgs,"source"),originalLine:line,originalColumn:util.getArg(aArgs,"column",0)};needle.source=this._findSourceIndex(needle.source);if(needle.source<0){return[]}var mappings=[];var index=this._findMapping(needle,this._originalMappings,"originalLine","originalColumn",util.compareByOriginalPositions,binarySearch.LEAST_UPPER_BOUND);if(index>=0){var mapping=this._originalMappings[index];if(aArgs.column===undefined){var originalLine=mapping.originalLine;while(mapping&&mapping.originalLine===originalLine){mappings.push({line:util.getArg(mapping,"generatedLine",null),column:util.getArg(mapping,"generatedColumn",null),lastColumn:util.getArg(mapping,"lastGeneratedColumn",null)});mapping=this._originalMappings[++index]}}else{var originalColumn=mapping.originalColumn;while(mapping&&mapping.originalLine===line&&mapping.originalColumn==originalColumn){mappings.push({line:util.getArg(mapping,"generatedLine",null),column:util.getArg(mapping,"generatedColumn",null),lastColumn:util.getArg(mapping,"lastGeneratedColumn",null)});mapping=this._originalMappings[++index]}}}return mappings};exports.SourceMapConsumer=SourceMapConsumer;function BasicSourceMapConsumer(aSourceMap,aSourceMapURL){var sourceMap=aSourceMap;if(typeof aSourceMap==="string"){sourceMap=util.parseSourceMapInput(aSourceMap)}var version=util.getArg(sourceMap,"version");var sources=util.getArg(sourceMap,"sources");var names=util.getArg(sourceMap,"names",[]);var sourceRoot=util.getArg(sourceMap,"sourceRoot",null);var sourcesContent=util.getArg(sourceMap,"sourcesContent",null);var mappings=util.getArg(sourceMap,"mappings");var file=util.getArg(sourceMap,"file",null);if(version!=this._version){throw new Error("Unsupported version: "+version)}if(sourceRoot){sourceRoot=util.normalize(sourceRoot)}sources=sources.map(String).map(util.normalize).map(function(source){return sourceRoot&&util.isAbsolute(sourceRoot)&&util.isAbsolute(source)?util.relative(sourceRoot,source):source});this._names=ArraySet.fromArray(names.map(String),true);this._sources=ArraySet.fromArray(sources,true);this._absoluteSources=this._sources.toArray().map(function(s){return util.computeSourceURL(sourceRoot,s,aSourceMapURL)});this.sourceRoot=sourceRoot;this.sourcesContent=sourcesContent;this._mappings=mappings;this._sourceMapURL=aSourceMapURL;this.file=file}BasicSourceMapConsumer.prototype=Object.create(SourceMapConsumer.prototype);BasicSourceMapConsumer.prototype.consumer=SourceMapConsumer;BasicSourceMapConsumer.prototype._findSourceIndex=function(aSource){var relativeSource=aSource;if(this.sourceRoot!=null){relativeSource=util.relative(this.sourceRoot,relativeSource)}if(this._sources.has(relativeSource)){return this._sources.indexOf(relativeSource)}var i;for(i=0;i<this._absoluteSources.length;++i){if(this._absoluteSources[i]==aSource){return i}}return-1};BasicSourceMapConsumer.fromSourceMap=function SourceMapConsumer_fromSourceMap(aSourceMap,aSourceMapURL){var smc=Object.create(BasicSourceMapConsumer.prototype);var names=smc._names=ArraySet.fromArray(aSourceMap._names.toArray(),true);var sources=smc._sources=ArraySet.fromArray(aSourceMap._sources.toArray(),true);smc.sourceRoot=aSourceMap._sourceRoot;smc.sourcesContent=aSourceMap._generateSourcesContent(smc._sources.toArray(),smc.sourceRoot);smc.file=aSourceMap._file;smc._sourceMapURL=aSourceMapURL;smc._absoluteSources=smc._sources.toArray().map(function(s){return util.computeSourceURL(smc.sourceRoot,s,aSourceMapURL)});var generatedMappings=aSourceMap._mappings.toArray().slice();var destGeneratedMappings=smc.__generatedMappings=[];var destOriginalMappings=smc.__originalMappings=[];for(var i=0,length=generatedMappings.length;i<length;i++){var srcMapping=generatedMappings[i];var destMapping=new Mapping;destMapping.generatedLine=srcMapping.generatedLine;destMapping.generatedColumn=srcMapping.generatedColumn;if(srcMapping.source){destMapping.source=sources.indexOf(srcMapping.source);destMapping.originalLine=srcMapping.originalLine;destMapping.originalColumn=srcMapping.originalColumn;if(srcMapping.name){destMapping.name=names.indexOf(srcMapping.name)}destOriginalMappings.push(destMapping)}destGeneratedMappings.push(destMapping)}quickSort(smc.__originalMappings,util.compareByOriginalPositions);return smc};BasicSourceMapConsumer.prototype._version=3;Object.defineProperty(BasicSourceMapConsumer.prototype,"sources",{get:function(){return this._absoluteSources.slice()}});function Mapping(){this.generatedLine=0;this.generatedColumn=0;this.source=null;this.originalLine=null;this.originalColumn=null;this.name=null}BasicSourceMapConsumer.prototype._parseMappings=function SourceMapConsumer_parseMappings(aStr,aSourceRoot){var generatedLine=1;var previousGeneratedColumn=0;var previousOriginalLine=0;var previousOriginalColumn=0;var previousSource=0;var previousName=0;var length=aStr.length;var index=0;var cachedSegments={};var temp={};var originalMappings=[];var generatedMappings=[];var mapping,str,segment,end,value;while(index<length){if(aStr.charAt(index)===";"){generatedLine++;index++;previousGeneratedColumn=0}else if(aStr.charAt(index)===","){index++}else{mapping=new Mapping;mapping.generatedLine=generatedLine;for(end=index;end<length;end++){if(this._charIsMappingSeparator(aStr,end)){break}}str=aStr.slice(index,end);segment=cachedSegments[str];if(segment){index+=str.length}else{segment=[];while(index<end){base64VLQ.decode(aStr,index,temp);value=temp.value;index=temp.rest;segment.push(value)}if(segment.length===2){throw new Error("Found a source, but no line and column")}if(segment.length===3){throw new Error("Found a source and line, but no column")}cachedSegments[str]=segment}mapping.generatedColumn=previousGeneratedColumn+segment[0];previousGeneratedColumn=mapping.generatedColumn;if(segment.length>1){mapping.source=previousSource+segment[1];previousSource+=segment[1];mapping.originalLine=previousOriginalLine+segment[2];previousOriginalLine=mapping.originalLine;mapping.originalLine+=1;mapping.originalColumn=previousOriginalColumn+segment[3];previousOriginalColumn=mapping.originalColumn;if(segment.length>4){mapping.name=previousName+segment[4];previousName+=segment[4]}}generatedMappings.push(mapping);if(typeof mapping.originalLine==="number"){originalMappings.push(mapping)}}}quickSort(generatedMappings,util.compareByGeneratedPositionsDeflated);this.__generatedMappings=generatedMappings;quickSort(originalMappings,util.compareByOriginalPositions);this.__originalMappings=originalMappings};BasicSourceMapConsumer.prototype._findMapping=function SourceMapConsumer_findMapping(aNeedle,aMappings,aLineName,aColumnName,aComparator,aBias){if(aNeedle[aLineName]<=0){throw new TypeError("Line must be greater than or equal to 1, got "+aNeedle[aLineName])}if(aNeedle[aColumnName]<0){throw new TypeError("Column must be greater than or equal to 0, got "+aNeedle[aColumnName])}return binarySearch.search(aNeedle,aMappings,aComparator,aBias)};BasicSourceMapConsumer.prototype.computeColumnSpans=function SourceMapConsumer_computeColumnSpans(){for(var index=0;index<this._generatedMappings.length;++index){var mapping=this._generatedMappings[index];if(index+1<this._generatedMappings.length){var nextMapping=this._generatedMappings[index+1];if(mapping.generatedLine===nextMapping.generatedLine){mapping.lastGeneratedColumn=nextMapping.generatedColumn-1;continue}}mapping.lastGeneratedColumn=Infinity}};BasicSourceMapConsumer.prototype.originalPositionFor=function SourceMapConsumer_originalPositionFor(aArgs){var needle={generatedLine:util.getArg(aArgs,"line"),generatedColumn:util.getArg(aArgs,"column")};var index=this._findMapping(needle,this._generatedMappings,"generatedLine","generatedColumn",util.compareByGeneratedPositionsDeflated,util.getArg(aArgs,"bias",SourceMapConsumer.GREATEST_LOWER_BOUND));if(index>=0){var mapping=this._generatedMappings[index];if(mapping.generatedLine===needle.generatedLine){var source=util.getArg(mapping,"source",null);if(source!==null){source=this._sources.at(source);source=util.computeSourceURL(this.sourceRoot,source,this._sourceMapURL)}var name=util.getArg(mapping,"name",null);if(name!==null){name=this._names.at(name)}return{source:source,line:util.getArg(mapping,"originalLine",null),column:util.getArg(mapping,"originalColumn",null),name:name}}}return{source:null,line:null,column:null,name:null}};BasicSourceMapConsumer.prototype.hasContentsOfAllSources=function BasicSourceMapConsumer_hasContentsOfAllSources(){if(!this.sourcesContent){return false}return this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some(function(sc){return sc==null})};BasicSourceMapConsumer.prototype.sourceContentFor=function SourceMapConsumer_sourceContentFor(aSource,nullOnMissing){if(!this.sourcesContent){return null}var index=this._findSourceIndex(aSource);if(index>=0){return this.sourcesContent[index]}var relativeSource=aSource;if(this.sourceRoot!=null){relativeSource=util.relative(this.sourceRoot,relativeSource)}var url;if(this.sourceRoot!=null&&(url=util.urlParse(this.sourceRoot))){var fileUriAbsPath=relativeSource.replace(/^file:\/\//,"");if(url.scheme=="file"&&this._sources.has(fileUriAbsPath)){return this.sourcesContent[this._sources.indexOf(fileUriAbsPath)]}if((!url.path||url.path=="/")&&this._sources.has("/"+relativeSource)){return this.sourcesContent[this._sources.indexOf("/"+relativeSource)]}}if(nullOnMissing){return null}else{throw new Error('"'+relativeSource+'" is not in the SourceMap.')}};BasicSourceMapConsumer.prototype.generatedPositionFor=function SourceMapConsumer_generatedPositionFor(aArgs){var source=util.getArg(aArgs,"source");source=this._findSourceIndex(source);if(source<0){return{line:null,column:null,lastColumn:null}}var needle={source:source,originalLine:util.getArg(aArgs,"line"),originalColumn:util.getArg(aArgs,"column")};var index=this._findMapping(needle,this._originalMappings,"originalLine","originalColumn",util.compareByOriginalPositions,util.getArg(aArgs,"bias",SourceMapConsumer.GREATEST_LOWER_BOUND));if(index>=0){var mapping=this._originalMappings[index];if(mapping.source===needle.source){return{line:util.getArg(mapping,"generatedLine",null),column:util.getArg(mapping,"generatedColumn",null),lastColumn:util.getArg(mapping,"lastGeneratedColumn",null)}}}return{line:null,column:null,lastColumn:null}};exports.BasicSourceMapConsumer=BasicSourceMapConsumer;function IndexedSourceMapConsumer(aSourceMap,aSourceMapURL){var sourceMap=aSourceMap;if(typeof aSourceMap==="string"){sourceMap=util.parseSourceMapInput(aSourceMap)}var version=util.getArg(sourceMap,"version");var sections=util.getArg(sourceMap,"sections");if(version!=this._version){throw new Error("Unsupported version: "+version)}this._sources=new ArraySet;this._names=new ArraySet;var lastOffset={line:-1,column:0};this._sections=sections.map(function(s){if(s.url){throw new Error("Support for url field in sections not implemented.")}var offset=util.getArg(s,"offset");var offsetLine=util.getArg(offset,"line");var offsetColumn=util.getArg(offset,"column");if(offsetLine<lastOffset.line||offsetLine===lastOffset.line&&offsetColumn<lastOffset.column){throw new Error("Section offsets must be ordered and non-overlapping.")}lastOffset=offset;return{generatedOffset:{generatedLine:offsetLine+1,generatedColumn:offsetColumn+1},consumer:new SourceMapConsumer(util.getArg(s,"map"),aSourceMapURL)}})}IndexedSourceMapConsumer.prototype=Object.create(SourceMapConsumer.prototype);IndexedSourceMapConsumer.prototype.constructor=SourceMapConsumer;IndexedSourceMapConsumer.prototype._version=3;Object.defineProperty(IndexedSourceMapConsumer.prototype,"sources",{get:function(){var sources=[];for(var i=0;i<this._sections.length;i++){for(var j=0;j<this._sections[i].consumer.sources.length;j++){sources.push(this._sections[i].consumer.sources[j])}}return sources}});IndexedSourceMapConsumer.prototype.originalPositionFor=function IndexedSourceMapConsumer_originalPositionFor(aArgs){var needle={generatedLine:util.getArg(aArgs,"line"),generatedColumn:util.getArg(aArgs,"column")};var sectionIndex=binarySearch.search(needle,this._sections,function(needle,section){var cmp=needle.generatedLine-section.generatedOffset.generatedLine;if(cmp){return cmp}return needle.generatedColumn-section.generatedOffset.generatedColumn});var section=this._sections[sectionIndex];if(!section){return{source:null,line:null,column:null,name:null}}return section.consumer.originalPositionFor({line:needle.generatedLine-(section.generatedOffset.generatedLine-1),column:needle.generatedColumn-(section.generatedOffset.generatedLine===needle.generatedLine?section.generatedOffset.generatedColumn-1:0),bias:aArgs.bias})};IndexedSourceMapConsumer.prototype.hasContentsOfAllSources=function IndexedSourceMapConsumer_hasContentsOfAllSources(){return this._sections.every(function(s){return s.consumer.hasContentsOfAllSources()})};IndexedSourceMapConsumer.prototype.sourceContentFor=function IndexedSourceMapConsumer_sourceContentFor(aSource,nullOnMissing){for(var i=0;i<this._sections.length;i++){var section=this._sections[i];var content=section.consumer.sourceContentFor(aSource,true);if(content){return content}}if(nullOnMissing){return null}else{throw new Error('"'+aSource+'" is not in the SourceMap.')}};IndexedSourceMapConsumer.prototype.generatedPositionFor=function IndexedSourceMapConsumer_generatedPositionFor(aArgs){for(var i=0;i<this._sections.length;i++){var section=this._sections[i];if(section.consumer._findSourceIndex(util.getArg(aArgs,"source"))===-1){continue}var generatedPosition=section.consumer.generatedPositionFor(aArgs);if(generatedPosition){var ret={line:generatedPosition.line+(section.generatedOffset.generatedLine-1),column:generatedPosition.column+(section.generatedOffset.generatedLine===generatedPosition.line?section.generatedOffset.generatedColumn-1:0)};return ret}}return{line:null,column:null}};IndexedSourceMapConsumer.prototype._parseMappings=function IndexedSourceMapConsumer_parseMappings(aStr,aSourceRoot){this.__generatedMappings=[];this.__originalMappings=[];for(var i=0;i<this._sections.length;i++){var section=this._sections[i];var sectionMappings=section.consumer._generatedMappings;for(var j=0;j<sectionMappings.length;j++){var mapping=sectionMappings[j];var source=section.consumer._sources.at(mapping.source);source=util.computeSourceURL(section.consumer.sourceRoot,source,this._sourceMapURL);this._sources.add(source);source=this._sources.indexOf(source);var name=null;if(mapping.name){name=section.consumer._names.at(mapping.name);this._names.add(name);name=this._names.indexOf(name)}var adjustedMapping={source:source,generatedLine:mapping.generatedLine+(section.generatedOffset.generatedLine-1),generatedColumn:mapping.generatedColumn+(section.generatedOffset.generatedLine===mapping.generatedLine?section.generatedOffset.generatedColumn-1:0),originalLine:mapping.originalLine,originalColumn:mapping.originalColumn,name:name};this.__generatedMappings.push(adjustedMapping);if(typeof adjustedMapping.originalLine==="number"){this.__originalMappings.push(adjustedMapping)}}}quickSort(this.__generatedMappings,util.compareByGeneratedPositionsDeflated);quickSort(this.__originalMappings,util.compareByOriginalPositions)};exports.IndexedSourceMapConsumer=IndexedSourceMapConsumer},{"./array-set":54,"./base64-vlq":55,"./binary-search":57,"./quick-sort":59,"./util":63}],61:[function(require,module,exports){var base64VLQ=require("./base64-vlq");var util=require("./util");var ArraySet=require("./array-set").ArraySet;var MappingList=require("./mapping-list").MappingList;function SourceMapGenerator(aArgs){if(!aArgs){aArgs={}}this._file=util.getArg(aArgs,"file",null);this._sourceRoot=util.getArg(aArgs,"sourceRoot",null);this._skipValidation=util.getArg(aArgs,"skipValidation",false);this._sources=new ArraySet;this._names=new ArraySet;this._mappings=new MappingList;this._sourcesContents=null}SourceMapGenerator.prototype._version=3;SourceMapGenerator.fromSourceMap=function SourceMapGenerator_fromSourceMap(aSourceMapConsumer){var sourceRoot=aSourceMapConsumer.sourceRoot;var generator=new SourceMapGenerator({file:aSourceMapConsumer.file,sourceRoot:sourceRoot});aSourceMapConsumer.eachMapping(function(mapping){var newMapping={generated:{line:mapping.generatedLine,column:mapping.generatedColumn}};if(mapping.source!=null){newMapping.source=mapping.source;if(sourceRoot!=null){newMapping.source=util.relative(sourceRoot,newMapping.source)}newMapping.original={line:mapping.originalLine,column:mapping.originalColumn};if(mapping.name!=null){newMapping.name=mapping.name}}generator.addMapping(newMapping)});aSourceMapConsumer.sources.forEach(function(sourceFile){var sourceRelative=sourceFile;if(sourceRoot!==null){sourceRelative=util.relative(sourceRoot,sourceFile)}if(!generator._sources.has(sourceRelative)){generator._sources.add(sourceRelative)}var content=aSourceMapConsumer.sourceContentFor(sourceFile);if(content!=null){generator.setSourceContent(sourceFile,content)}});return generator};SourceMapGenerator.prototype.addMapping=function SourceMapGenerator_addMapping(aArgs){var generated=util.getArg(aArgs,"generated");var original=util.getArg(aArgs,"original",null);var source=util.getArg(aArgs,"source",null);var name=util.getArg(aArgs,"name",null);if(!this._skipValidation){this._validateMapping(generated,original,source,name)}if(source!=null){source=String(source);if(!this._sources.has(source)){this._sources.add(source)}}if(name!=null){name=String(name);if(!this._names.has(name)){this._names.add(name)}}this._mappings.add({generatedLine:generated.line,generatedColumn:generated.column,originalLine:original!=null&&original.line,originalColumn:original!=null&&original.column,source:source,name:name})};SourceMapGenerator.prototype.setSourceContent=function SourceMapGenerator_setSourceContent(aSourceFile,aSourceContent){var source=aSourceFile;if(this._sourceRoot!=null){source=util.relative(this._sourceRoot,source)}if(aSourceContent!=null){if(!this._sourcesContents){this._sourcesContents=Object.create(null)}this._sourcesContents[util.toSetString(source)]=aSourceContent}else if(this._sourcesContents){delete this._sourcesContents[util.toSetString(source)];if(Object.keys(this._sourcesContents).length===0){this._sourcesContents=null}}};SourceMapGenerator.prototype.applySourceMap=function SourceMapGenerator_applySourceMap(aSourceMapConsumer,aSourceFile,aSourceMapPath){var sourceFile=aSourceFile;if(aSourceFile==null){if(aSourceMapConsumer.file==null){throw new Error("SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, "+'or the source map\'s "file" property. Both were omitted.')}sourceFile=aSourceMapConsumer.file}var sourceRoot=this._sourceRoot;if(sourceRoot!=null){sourceFile=util.relative(sourceRoot,sourceFile)}var newSources=new ArraySet;var newNames=new ArraySet;this._mappings.unsortedForEach(function(mapping){if(mapping.source===sourceFile&&mapping.originalLine!=null){var original=aSourceMapConsumer.originalPositionFor({line:mapping.originalLine,column:mapping.originalColumn});if(original.source!=null){mapping.source=original.source;if(aSourceMapPath!=null){mapping.source=util.join(aSourceMapPath,mapping.source)}if(sourceRoot!=null){mapping.source=util.relative(sourceRoot,mapping.source)}mapping.originalLine=original.line;mapping.originalColumn=original.column;if(original.name!=null){mapping.name=original.name}}}var source=mapping.source;if(source!=null&&!newSources.has(source)){newSources.add(source)}var name=mapping.name;if(name!=null&&!newNames.has(name)){newNames.add(name)}},this);this._sources=newSources;this._names=newNames;aSourceMapConsumer.sources.forEach(function(sourceFile){var content=aSourceMapConsumer.sourceContentFor(sourceFile);if(content!=null){if(aSourceMapPath!=null){sourceFile=util.join(aSourceMapPath,sourceFile)}if(sourceRoot!=null){sourceFile=util.relative(sourceRoot,sourceFile)}this.setSourceContent(sourceFile,content)}},this)};SourceMapGenerator.prototype._validateMapping=function SourceMapGenerator_validateMapping(aGenerated,aOriginal,aSource,aName){if(aOriginal&&typeof aOriginal.line!=="number"&&typeof aOriginal.column!=="number"){throw new Error("original.line and original.column are not numbers -- you probably meant to omit "+"the original mapping entirely and only map the generated position. If so, pass "+"null for the original mapping instead of an object with empty or null values.")}if(aGenerated&&"line"in aGenerated&&"column"in aGenerated&&aGenerated.line>0&&aGenerated.column>=0&&!aOriginal&&!aSource&&!aName){return}else if(aGenerated&&"line"in aGenerated&&"column"in aGenerated&&aOriginal&&"line"in aOriginal&&"column"in aOriginal&&aGenerated.line>0&&aGenerated.column>=0&&aOriginal.line>0&&aOriginal.column>=0&&aSource){return}else{throw new Error("Invalid mapping: "+JSON.stringify({generated:aGenerated,source:aSource,original:aOriginal,name:aName}))}};SourceMapGenerator.prototype._serializeMappings=function SourceMapGenerator_serializeMappings(){var previousGeneratedColumn=0;var previousGeneratedLine=1;var previousOriginalColumn=0;var previousOriginalLine=0;var previousName=0;var previousSource=0;var result="";var next;var mapping;var nameIdx;var sourceIdx;var mappings=this._mappings.toArray();for(var i=0,len=mappings.length;i<len;i++){mapping=mappings[i];next="";if(mapping.generatedLine!==previousGeneratedLine){previousGeneratedColumn=0;while(mapping.generatedLine!==previousGeneratedLine){next+=";";previousGeneratedLine++}}else{if(i>0){if(!util.compareByGeneratedPositionsInflated(mapping,mappings[i-1])){continue}next+=","}}next+=base64VLQ.encode(mapping.generatedColumn-previousGeneratedColumn);previousGeneratedColumn=mapping.generatedColumn;if(mapping.source!=null){sourceIdx=this._sources.indexOf(mapping.source);next+=base64VLQ.encode(sourceIdx-previousSource);previousSource=sourceIdx;next+=base64VLQ.encode(mapping.originalLine-1-previousOriginalLine);previousOriginalLine=mapping.originalLine-1;next+=base64VLQ.encode(mapping.originalColumn-previousOriginalColumn);previousOriginalColumn=mapping.originalColumn;if(mapping.name!=null){nameIdx=this._names.indexOf(mapping.name);next+=base64VLQ.encode(nameIdx-previousName);previousName=nameIdx}}result+=next}return result};SourceMapGenerator.prototype._generateSourcesContent=function SourceMapGenerator_generateSourcesContent(aSources,aSourceRoot){return aSources.map(function(source){if(!this._sourcesContents){return null}if(aSourceRoot!=null){source=util.relative(aSourceRoot,source)}var key=util.toSetString(source);return Object.prototype.hasOwnProperty.call(this._sourcesContents,key)?this._sourcesContents[key]:null},this)};SourceMapGenerator.prototype.toJSON=function SourceMapGenerator_toJSON(){var map={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};if(this._file!=null){map.file=this._file}if(this._sourceRoot!=null){map.sourceRoot=this._sourceRoot}if(this._sourcesContents){map.sourcesContent=this._generateSourcesContent(map.sources,map.sourceRoot)}return map};SourceMapGenerator.prototype.toString=function SourceMapGenerator_toString(){return JSON.stringify(this.toJSON())};exports.SourceMapGenerator=SourceMapGenerator},{"./array-set":54,"./base64-vlq":55,"./mapping-list":58,"./util":63}],62:[function(require,module,exports){var SourceMapGenerator=require("./source-map-generator").SourceMapGenerator;var util=require("./util");var REGEX_NEWLINE=/(\r?\n)/;var NEWLINE_CODE=10;var isSourceNode="$$$isSourceNode$$$";function SourceNode(aLine,aColumn,aSource,aChunks,aName){this.children=[];this.sourceContents={};this.line=aLine==null?null:aLine;this.column=aColumn==null?null:aColumn;this.source=aSource==null?null:aSource;this.name=aName==null?null:aName;this[isSourceNode]=true;if(aChunks!=null)this.add(aChunks)}SourceNode.fromStringWithSourceMap=function SourceNode_fromStringWithSourceMap(aGeneratedCode,aSourceMapConsumer,aRelativePath){var node=new SourceNode;var remainingLines=aGeneratedCode.split(REGEX_NEWLINE);var remainingLinesIndex=0;var shiftNextLine=function(){var lineContents=getNextLine();var newLine=getNextLine()||"";return lineContents+newLine;function getNextLine(){return remainingLinesIndex<remainingLines.length?remainingLines[remainingLinesIndex++]:undefined}};var lastGeneratedLine=1,lastGeneratedColumn=0;var lastMapping=null;aSourceMapConsumer.eachMapping(function(mapping){if(lastMapping!==null){if(lastGeneratedLine<mapping.generatedLine){addMappingWithCode(lastMapping,shiftNextLine());lastGeneratedLine++;lastGeneratedColumn=0}else{var nextLine=remainingLines[remainingLinesIndex]||"";var code=nextLine.substr(0,mapping.generatedColumn-lastGeneratedColumn);remainingLines[remainingLinesIndex]=nextLine.substr(mapping.generatedColumn-lastGeneratedColumn);lastGeneratedColumn=mapping.generatedColumn;addMappingWithCode(lastMapping,code);lastMapping=mapping;return}}while(lastGeneratedLine<mapping.generatedLine){node.add(shiftNextLine());lastGeneratedLine++}if(lastGeneratedColumn<mapping.generatedColumn){var nextLine=remainingLines[remainingLinesIndex]||"";node.add(nextLine.substr(0,mapping.generatedColumn));remainingLines[remainingLinesIndex]=nextLine.substr(mapping.generatedColumn);lastGeneratedColumn=mapping.generatedColumn}lastMapping=mapping},this);if(remainingLinesIndex<remainingLines.length){if(lastMapping){addMappingWithCode(lastMapping,shiftNextLine())}node.add(remainingLines.splice(remainingLinesIndex).join(""))}aSourceMapConsumer.sources.forEach(function(sourceFile){var content=aSourceMapConsumer.sourceContentFor(sourceFile);if(content!=null){if(aRelativePath!=null){sourceFile=util.join(aRelativePath,sourceFile)}node.setSourceContent(sourceFile,content)}});return node;function addMappingWithCode(mapping,code){if(mapping===null||mapping.source===undefined){node.add(code)}else{var source=aRelativePath?util.join(aRelativePath,mapping.source):mapping.source;node.add(new SourceNode(mapping.originalLine,mapping.originalColumn,source,code,mapping.name))}}};SourceNode.prototype.add=function SourceNode_add(aChunk){if(Array.isArray(aChunk)){aChunk.forEach(function(chunk){this.add(chunk)},this)}else if(aChunk[isSourceNode]||typeof aChunk==="string"){if(aChunk){this.children.push(aChunk)}}else{throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+aChunk)}return this};SourceNode.prototype.prepend=function SourceNode_prepend(aChunk){if(Array.isArray(aChunk)){for(var i=aChunk.length-1;i>=0;i--){this.prepend(aChunk[i])}}else if(aChunk[isSourceNode]||typeof aChunk==="string"){this.children.unshift(aChunk)}else{throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+aChunk)}return this};SourceNode.prototype.walk=function SourceNode_walk(aFn){var chunk;for(var i=0,len=this.children.length;i<len;i++){chunk=this.children[i];if(chunk[isSourceNode]){chunk.walk(aFn)}else{if(chunk!==""){aFn(chunk,{source:this.source,line:this.line,column:this.column,name:this.name})}}}};SourceNode.prototype.join=function SourceNode_join(aSep){var newChildren;var i;var len=this.children.length;if(len>0){newChildren=[];for(i=0;i<len-1;i++){newChildren.push(this.children[i]);newChildren.push(aSep)}newChildren.push(this.children[i]);this.children=newChildren}return this};SourceNode.prototype.replaceRight=function SourceNode_replaceRight(aPattern,aReplacement){var lastChild=this.children[this.children.length-1];if(lastChild[isSourceNode]){lastChild.replaceRight(aPattern,aReplacement)}else if(typeof lastChild==="string"){this.children[this.children.length-1]=lastChild.replace(aPattern,aReplacement)}else{this.children.push("".replace(aPattern,aReplacement))}return this};SourceNode.prototype.setSourceContent=function SourceNode_setSourceContent(aSourceFile,aSourceContent){this.sourceContents[util.toSetString(aSourceFile)]=aSourceContent};SourceNode.prototype.walkSourceContents=function SourceNode_walkSourceContents(aFn){for(var i=0,len=this.children.length;i<len;i++){if(this.children[i][isSourceNode]){this.children[i].walkSourceContents(aFn)}}var sources=Object.keys(this.sourceContents);for(var i=0,len=sources.length;i<len;i++){aFn(util.fromSetString(sources[i]),this.sourceContents[sources[i]])}};SourceNode.prototype.toString=function SourceNode_toString(){var str="";this.walk(function(chunk){str+=chunk});return str};SourceNode.prototype.toStringWithSourceMap=function SourceNode_toStringWithSourceMap(aArgs){var generated={code:"",line:1,column:0};var map=new SourceMapGenerator(aArgs);var sourceMappingActive=false;var lastOriginalSource=null;var lastOriginalLine=null;var lastOriginalColumn=null;var lastOriginalName=null;this.walk(function(chunk,original){generated.code+=chunk;if(original.source!==null&&original.line!==null&&original.column!==null){if(lastOriginalSource!==original.source||lastOriginalLine!==original.line||lastOriginalColumn!==original.column||lastOriginalName!==original.name){map.addMapping({source:original.source,original:{line:original.line,column:original.column},generated:{line:generated.line,column:generated.column},name:original.name})}lastOriginalSource=original.source;lastOriginalLine=original.line;lastOriginalColumn=original.column;lastOriginalName=original.name;sourceMappingActive=true}else if(sourceMappingActive){map.addMapping({generated:{line:generated.line,column:generated.column}});lastOriginalSource=null;sourceMappingActive=false}for(var idx=0,length=chunk.length;idx<length;idx++){if(chunk.charCodeAt(idx)===NEWLINE_CODE){generated.line++;generated.column=0;if(idx+1===length){lastOriginalSource=null;sourceMappingActive=false}else if(sourceMappingActive){map.addMapping({source:original.source,original:{line:original.line,column:original.column},generated:{line:generated.line,column:generated.column},name:original.name})}}else{generated.column++}}});this.walkSourceContents(function(sourceFile,sourceContent){map.setSourceContent(sourceFile,sourceContent)});return{code:generated.code,map:map}};exports.SourceNode=SourceNode},{"./source-map-generator":61,"./util":63}],63:[function(require,module,exports){function getArg(aArgs,aName,aDefaultValue){if(aName in aArgs){return aArgs[aName]}else if(arguments.length===3){return aDefaultValue}else{throw new Error('"'+aName+'" is a required argument.')}}exports.getArg=getArg;var urlRegexp=/^(?:([\w+\-.]+):)?\/\/(?:(\w+:\w+)@)?([\w.-]*)(?::(\d+))?(.*)$/;var dataUrlRegexp=/^data:.+\,.+$/;function urlParse(aUrl){var match=aUrl.match(urlRegexp);if(!match){return null}return{scheme:match[1],auth:match[2],host:match[3],port:match[4],path:match[5]}}exports.urlParse=urlParse;function urlGenerate(aParsedUrl){var url="";if(aParsedUrl.scheme){url+=aParsedUrl.scheme+":"}url+="//";if(aParsedUrl.auth){url+=aParsedUrl.auth+"@"}if(aParsedUrl.host){url+=aParsedUrl.host}if(aParsedUrl.port){url+=":"+aParsedUrl.port}if(aParsedUrl.path){url+=aParsedUrl.path}return url}exports.urlGenerate=urlGenerate;function normalize(aPath){var path=aPath;var url=urlParse(aPath);if(url){if(!url.path){return aPath}path=url.path}var isAbsolute=exports.isAbsolute(path);var parts=path.split(/\/+/);for(var part,up=0,i=parts.length-1;i>=0;i--){part=parts[i];if(part==="."){parts.splice(i,1)}else if(part===".."){up++}else if(up>0){if(part===""){parts.splice(i+1,up);up=0}else{parts.splice(i,2);up--}}}path=parts.join("/");if(path===""){path=isAbsolute?"/":"."}if(url){url.path=path;return urlGenerate(url)}return path}exports.normalize=normalize;function join(aRoot,aPath){if(aRoot===""){aRoot="."}if(aPath===""){aPath="."}var aPathUrl=urlParse(aPath);var aRootUrl=urlParse(aRoot);if(aRootUrl){aRoot=aRootUrl.path||"/"}if(aPathUrl&&!aPathUrl.scheme){if(aRootUrl){aPathUrl.scheme=aRootUrl.scheme}return urlGenerate(aPathUrl)}if(aPathUrl||aPath.match(dataUrlRegexp)){return aPath}if(aRootUrl&&!aRootUrl.host&&!aRootUrl.path){aRootUrl.host=aPath;return urlGenerate(aRootUrl)}var joined=aPath.charAt(0)==="/"?aPath:normalize(aRoot.replace(/\/+$/,"")+"/"+aPath);if(aRootUrl){aRootUrl.path=joined;return urlGenerate(aRootUrl)}return joined}exports.join=join;exports.isAbsolute=function(aPath){return aPath.charAt(0)==="/"||urlRegexp.test(aPath)};function relative(aRoot,aPath){if(aRoot===""){aRoot="."}aRoot=aRoot.replace(/\/$/,"");var level=0;while(aPath.indexOf(aRoot+"/")!==0){var index=aRoot.lastIndexOf("/");if(index<0){return aPath}aRoot=aRoot.slice(0,index);if(aRoot.match(/^([^\/]+:\/)?\/*$/)){return aPath}++level}return Array(level+1).join("../")+aPath.substr(aRoot.length+1)}exports.relative=relative;var supportsNullProto=function(){var obj=Object.create(null);return!("__proto__"in obj)}();function identity(s){return s}function toSetString(aStr){if(isProtoString(aStr)){return"$"+aStr}return aStr}exports.toSetString=supportsNullProto?identity:toSetString;function fromSetString(aStr){if(isProtoString(aStr)){return aStr.slice(1)}return aStr}exports.fromSetString=supportsNullProto?identity:fromSetString;function isProtoString(s){if(!s){return false}var length=s.length;if(length<9){return false}if(s.charCodeAt(length-1)!==95||s.charCodeAt(length-2)!==95||s.charCodeAt(length-3)!==111||s.charCodeAt(length-4)!==116||s.charCodeAt(length-5)!==111||s.charCodeAt(length-6)!==114||s.charCodeAt(length-7)!==112||s.charCodeAt(length-8)!==95||s.charCodeAt(length-9)!==95){return false}for(var i=length-10;i>=0;i--){if(s.charCodeAt(i)!==36){return false}}return true}function compareByOriginalPositions(mappingA,mappingB,onlyCompareOriginal){var cmp=strcmp(mappingA.source,mappingB.source);if(cmp!==0){return cmp}cmp=mappingA.originalLine-mappingB.originalLine;if(cmp!==0){return cmp}cmp=mappingA.originalColumn-mappingB.originalColumn;if(cmp!==0||onlyCompareOriginal){return cmp}cmp=mappingA.generatedColumn-mappingB.generatedColumn;if(cmp!==0){return cmp}cmp=mappingA.generatedLine-mappingB.generatedLine;if(cmp!==0){return cmp}return strcmp(mappingA.name,mappingB.name)}exports.compareByOriginalPositions=compareByOriginalPositions;function compareByGeneratedPositionsDeflated(mappingA,mappingB,onlyCompareGenerated){var cmp=mappingA.generatedLine-mappingB.generatedLine;if(cmp!==0){return cmp}cmp=mappingA.generatedColumn-mappingB.generatedColumn;if(cmp!==0||onlyCompareGenerated){return cmp}cmp=strcmp(mappingA.source,mappingB.source);if(cmp!==0){return cmp}cmp=mappingA.originalLine-mappingB.originalLine;if(cmp!==0){return cmp}cmp=mappingA.originalColumn-mappingB.originalColumn;if(cmp!==0){return cmp}return strcmp(mappingA.name,mappingB.name)}exports.compareByGeneratedPositionsDeflated=compareByGeneratedPositionsDeflated;function strcmp(aStr1,aStr2){if(aStr1===aStr2){return 0}if(aStr1===null){return 1}if(aStr2===null){return-1}if(aStr1>aStr2){return 1}return-1}function compareByGeneratedPositionsInflated(mappingA,mappingB){var cmp=mappingA.generatedLine-mappingB.generatedLine;if(cmp!==0){return cmp}cmp=mappingA.generatedColumn-mappingB.generatedColumn;if(cmp!==0){return cmp}cmp=strcmp(mappingA.source,mappingB.source);if(cmp!==0){return cmp}cmp=mappingA.originalLine-mappingB.originalLine;if(cmp!==0){return cmp}cmp=mappingA.originalColumn-mappingB.originalColumn;if(cmp!==0){return cmp}return strcmp(mappingA.name,mappingB.name)}exports.compareByGeneratedPositionsInflated=compareByGeneratedPositionsInflated;function parseSourceMapInput(str){return JSON.parse(str.replace(/^\)]}'[^\n]*\n/,""))}exports.parseSourceMapInput=parseSourceMapInput;function computeSourceURL(sourceRoot,sourceURL,sourceMapURL){sourceURL=sourceURL||"";if(sourceRoot){if(sourceRoot[sourceRoot.length-1]!=="/"&&sourceURL[0]!=="/"){sourceRoot+="/"}sourceURL=sourceRoot+sourceURL}if(sourceMapURL){var parsed=urlParse(sourceMapURL);if(!parsed){throw new Error("sourceMapURL could not be parsed")}if(parsed.path){var index=parsed.path.lastIndexOf("/");if(index>=0){parsed.path=parsed.path.substring(0,index+1)}}sourceURL=join(urlGenerate(parsed),sourceURL)}return normalize(sourceURL)}exports.computeSourceURL=computeSourceURL},{}],64:[function(require,module,exports){exports.SourceMapGenerator=require("./lib/source-map-generator").SourceMapGenerator;exports.SourceMapConsumer=require("./lib/source-map-consumer").SourceMapConsumer;exports.SourceNode=require("./lib/source-node").SourceNode},{"./lib/source-map-consumer":60,"./lib/source-map-generator":61,"./lib/source-node":62}],65:[function(require,module,exports){module.exports={_from:"escodegen@^1.7.0",_id:"escodegen@1.9.1",_inBundle:false,_integrity:"sha512-6hTjO1NAWkHnDk3OqQ4YrCuwwmGHL9S3nPlzBOUG/R44rda3wLNrfvQ5fkSGjyhHFKM7ALPKcKGrwvCLe0lC7Q==",_location:"/escodegen",_phantomChildren:{},_requested:{type:"range",registry:true,raw:"escodegen@^1.7.0",name:"escodegen",escapedName:"escodegen",rawSpec:"^1.7.0",saveSpec:null,fetchSpec:"^1.7.0"},_requiredBy:["/","/static-eval","/static-module"],_resolved:"https://registry.npmjs.org/escodegen/-/escodegen-1.9.1.tgz",_shasum:"dbae17ef96c8e4bedb1356f4504fa4cc2f7cb7e2",_spec:"escodegen@^1.7.0",_where:"/Users/jkhartshorne/Documents/Teaching/probmods2/node_modules/webppl",bin:{esgenerate:"./bin/esgenerate.js",escodegen:"./bin/escodegen.js"},bugs:{url:"https://github.com/estools/escodegen/issues"},bundleDependencies:false,dependencies:{esprima:"^3.1.3",estraverse:"^4.2.0",esutils:"^2.0.2",optionator:"^0.8.1","source-map":"~0.6.1"},deprecated:false,description:"ECMAScript code generator",devDependencies:{acorn:"^4.0.4",bluebird:"^3.4.7","bower-registry-client":"^1.0.0",chai:"^3.5.0","commonjs-everywhere":"^0.9.7",gulp:"^3.8.10","gulp-eslint":"^3.0.1","gulp-mocha":"^3.0.1",semver:"^5.1.0"},engines:{node:">=4.0"},files:["LICENSE.BSD","README.md","bin","escodegen.js","package.json"],homepage:"http://github.com/estools/escodegen",license:"BSD-2-Clause",main:"escodegen.js",maintainers:[{name:"Yusuke Suzuki",email:"utatane.tea@gmail.com",url:"http://github.com/Constellation"}],name:"escodegen",optionalDependencies:{"source-map":"~0.6.1"},repository:{type:"git",url:"git+ssh://git@github.com/estools/escodegen.git"},scripts:{build:"cjsify -a path: tools/entry-point.js > escodegen.browser.js","build-min":"cjsify -ma path: tools/entry-point.js > escodegen.browser.min.js",lint:"gulp lint",release:"node tools/release.js",test:"gulp travis","unit-test":"gulp test"},version:"1.9.1"}},{}],66:[function(require,module,exports){(function(factory,global){"use strict";function namespace(str,obj){var i,iz,names,name;names=str.split(".");for(i=0,iz=names.length;i<iz;++i){name=names[i];if(obj.hasOwnProperty(name)){obj=obj[name]}else{obj=obj[name]={}}}return obj}if(typeof define==="function"&&define.amd){define("escope",["exports","estraverse"],function(exports,estraverse){factory(exports,global,estraverse)})}else if(typeof exports!=="undefined"){factory(exports,global,require("estraverse"))}else{factory(namespace("escope",global),global,global.estraverse)}})(function(exports,global,estraverse){"use strict";var Syntax,Map,currentScope,globalScope,scopes,options;Syntax=estraverse.Syntax;if(typeof global.Map!=="undefined"){Map=global.Map}else{Map=function Map(){this.__data={}};Map.prototype.get=function MapGet(key){key="$"+key;if(this.__data.hasOwnProperty(key)){return this.__data[key]}return undefined};Map.prototype.has=function MapHas(key){key="$"+key;return this.__data.hasOwnProperty(key)};Map.prototype.set=function MapSet(key,val){key="$"+key;this.__data[key]=val};Map.prototype["delete"]=function MapDelete(key){key="$"+key;return delete this.__data[key]}}function assert(cond,text){if(!cond){throw new Error(text)}}function defaultOptions(){return{optimistic:false,directive:false,ecmaVersion:5}}function updateDeeply(target,override){var key,val;function isHashObject(target){return typeof target==="object"&&target instanceof Object&&!(target instanceof RegExp)}for(key in override){if(override.hasOwnProperty(key)){val=override[key];if(isHashObject(val)){if(isHashObject(target[key])){updateDeeply(target[key],val)}else{target[key]=updateDeeply({},val)}}else{target[key]=val}}}return target}function Reference(ident,scope,flag,writeExpr,maybeImplicitGlobal){this.identifier=ident;this.from=scope;this.tainted=false;this.resolved=null;this.flag=flag;if(this.isWrite()){this.writeExpr=writeExpr}this.__maybeImplicitGlobal=maybeImplicitGlobal}Reference.READ=1;Reference.WRITE=2;Reference.RW=3;Reference.prototype.isStatic=function isStatic(){return!this.tainted&&this.resolved&&this.resolved.scope.isStatic()};Reference.prototype.isWrite=function isWrite(){return this.flag&Reference.WRITE};Reference.prototype.isRead=function isRead(){return this.flag&Reference.READ};Reference.prototype.isReadOnly=function isReadOnly(){return this.flag===Reference.READ};Reference.prototype.isWriteOnly=function isWriteOnly(){return this.flag===Reference.WRITE};Reference.prototype.isReadWrite=function isReadWrite(){return this.flag===Reference.RW};function Variable(name,scope){this.name=name;this.identifiers=[];this.references=[];this.defs=[];this.tainted=false;this.stack=true;this.scope=scope}Variable.CatchClause="CatchClause";Variable.Parameter="Parameter";Variable.FunctionName="FunctionName";Variable.Variable="Variable";Variable.ImplicitGlobalVariable="ImplicitGlobalVariable";function isStrictScope(scope,block){var body,i,iz,stmt,expr;if(scope.upper&&scope.upper.isStrict){return true}if(scope.type==="function"){body=block.body}else if(scope.type==="global"){body=block}else{return false}if(options.directive){for(i=0,iz=body.body.length;i<iz;++i){stmt=body.body[i];if(stmt.type!=="DirectiveStatement"){break}if(stmt.raw==='"use strict"'||stmt.raw==="'use strict'"){return true}}}else{for(i=0,iz=body.body.length;i<iz;++i){stmt=body.body[i];if(stmt.type!==Syntax.ExpressionStatement){break}expr=stmt.expression;if(expr.type!==Syntax.Literal||typeof expr.value!=="string"){break}if(expr.raw!=null){if(expr.raw==='"use strict"'||expr.raw==="'use strict'"){return true}}else{if(expr.value==="use strict"){return true}}}}return false}function Scope(block,opt){var variable,body;this.type=block.type===Syntax.CatchClause?"catch":block.type===Syntax.WithStatement?"with":block.type===Syntax.Program?"global":"function";this.set=new Map;this.taints=new Map;this.dynamic=this.type==="global"||this.type==="with";this.block=block;this.through=[];this.variables=[];this.references=[];this.left=[];this.variableScope=this.type==="global"||this.type==="function"?this:currentScope.variableScope;this.functionExpressionScope=false;this.directCallToEvalScope=false;this.thisFound=false;body=this.type==="function"?block.body:block;if(opt.naming){this.__define(block.id,{type:Variable.FunctionName,name:block.id,node:block});this.functionExpressionScope=true}else{if(this.type==="function"){variable=new Variable("arguments",this);this.taints.set("arguments",true);this.set.set("arguments",variable);this.variables.push(variable)}if(block.type===Syntax.FunctionExpression&&block.id){new Scope(block,{naming:true})}}this.upper=currentScope;this.isStrict=isStrictScope(this,block);this.childScopes=[];if(currentScope){currentScope.childScopes.push(this)}currentScope=this;if(this.type==="global"){globalScope=this;globalScope.implicit={set:new Map,variables:[]}}scopes.push(this)}Scope.prototype.__close=function __close(){var i,iz,ref,current,node,implicit;if(!this.dynamic||options.optimistic){for(i=0,iz=this.left.length;i<iz;++i){ref=this.left[i];if(!this.__resolve(ref)){this.__delegateToUpperScope(ref)}}}else{if(this.type==="with"){for(i=0,iz=this.left.length;i<iz;++i){ref=this.left[i];ref.tainted=true;this.__delegateToUpperScope(ref)}}else{for(i=0,iz=this.left.length;i<iz;++i){ref=this.left[i];current=this;do{current.through.push(ref);current=current.upper}while(current)}}}if(this.type==="global"){implicit=[];for(i=0,iz=this.left.length;i<iz;++i){ref=this.left[i];if(ref.__maybeImplicitGlobal&&!this.set.has(ref.identifier.name)){implicit.push(ref.__maybeImplicitGlobal)}}for(i=0,iz=implicit.length;i<iz;++i){node=implicit[i];this.__defineImplicit(node.left,{type:Variable.ImplicitGlobalVariable,name:node.left,node:node})}}this.left=null;currentScope=this.upper};Scope.prototype.__resolve=function __resolve(ref){var variable,name;name=ref.identifier.name;if(this.set.has(name)){variable=this.set.get(name);variable.references.push(ref);variable.stack=variable.stack&&ref.from.variableScope===this.variableScope;if(ref.tainted){variable.tainted=true;this.taints.set(variable.name,true)}ref.resolved=variable;return true}return false};Scope.prototype.__delegateToUpperScope=function __delegateToUpperScope(ref){if(this.upper){this.upper.left.push(ref)}this.through.push(ref)};Scope.prototype.__defineImplicit=function __defineImplicit(node,info){var name,variable;if(node&&node.type===Syntax.Identifier){name=node.name;if(!this.implicit.set.has(name)){variable=new Variable(name,this);variable.identifiers.push(node);variable.defs.push(info);this.implicit.set.set(name,variable);this.implicit.variables.push(variable)}else{variable=this.implicit.set.get(name);variable.identifiers.push(node);variable.defs.push(info)}}};Scope.prototype.__define=function __define(node,info){var name,variable;if(node&&node.type===Syntax.Identifier){name=node.name;if(!this.set.has(name)){variable=new Variable(name,this);variable.identifiers.push(node);variable.defs.push(info);this.set.set(name,variable);this.variables.push(variable)}else{variable=this.set.get(name);variable.identifiers.push(node);variable.defs.push(info)}}};Scope.prototype.__referencing=function __referencing(node,assign,writeExpr,maybeImplicitGlobal){var ref;if(node&&node.type===Syntax.Identifier){ref=new Reference(node,this,assign||Reference.READ,writeExpr,maybeImplicitGlobal);this.references.push(ref);this.left.push(ref)}};Scope.prototype.__detectEval=function __detectEval(){var current;current=this;this.directCallToEvalScope=true;do{current.dynamic=true;current=current.upper}while(current)};Scope.prototype.__detectThis=function __detectThis(){this.thisFound=true};Scope.prototype.__isClosed=function isClosed(){return this.left===null};Scope.prototype.resolve=function resolve(ident){var ref,i,iz;assert(this.__isClosed(),"scope should be closed");assert(ident.type===Syntax.Identifier,"target should be identifier");for(i=0,iz=this.references.length;i<iz;++i){ref=this.references[i];if(ref.identifier===ident){return ref}}return null};Scope.prototype.isStatic=function isStatic(){return!this.dynamic};Scope.prototype.isArgumentsMaterialized=function isArgumentsMaterialized(){var variable;if(this.type!=="function"){return true}if(!this.isStatic()){return true}variable=this.set.get("arguments");assert(variable,"always have arguments variable");return variable.tainted||variable.references.length!==0};Scope.prototype.isThisMaterialized=function isThisMaterialized(){if(this.type!=="function"){return true}if(!this.isStatic()){return true}return this.thisFound};Scope.mangledName="__$escope$__";Scope.prototype.attach=function attach(){if(!this.functionExpressionScope){this.block[Scope.mangledName]=this}};Scope.prototype.detach=function detach(){if(!this.functionExpressionScope){delete this.block[Scope.mangledName]}};Scope.prototype.isUsedName=function(name){if(this.set.has(name)){return true}for(var i=0,iz=this.through.length;i<iz;++i){if(this.through[i].identifier.name===name){return true}}return false};function ScopeManager(scopes){this.scopes=scopes;this.attached=false}ScopeManager.prototype.__get=function __get(node){var i,iz,scope;if(this.attached){return node[Scope.mangledName]||null}if(Scope.isScopeRequired(node)){for(i=0,iz=this.scopes.length;i<iz;++i){scope=this.scopes[i];if(!scope.functionExpressionScope){if(scope.block===node){return scope}}}}return null};ScopeManager.prototype.acquire=function acquire(node){return this.__get(node)};ScopeManager.prototype.release=function release(node){var scope=this.__get(node);if(scope){scope=scope.upper;while(scope){if(!scope.functionExpressionScope){return scope}scope=scope.upper}}return null};ScopeManager.prototype.attach=function attach(){var i,iz;for(i=0,iz=this.scopes.length;i<iz;++i){this.scopes[i].attach()}this.attached=true};ScopeManager.prototype.detach=function detach(){var i,iz;for(i=0,iz=this.scopes.length;i<iz;++i){this.scopes[i].detach()}this.attached=false};Scope.isScopeRequired=function isScopeRequired(node){return Scope.isVariableScopeRequired(node)||node.type===Syntax.WithStatement||node.type===Syntax.CatchClause};Scope.isVariableScopeRequired=function isVariableScopeRequired(node){return node.type===Syntax.Program||node.type===Syntax.FunctionExpression||node.type===Syntax.FunctionDeclaration};function analyze(tree,providedOptions){var resultScopes;options=updateDeeply(defaultOptions(),providedOptions);resultScopes=scopes=[];currentScope=null;globalScope=null;estraverse.traverse(tree,{enter:function enter(node){var i,iz,decl;if(Scope.isScopeRequired(node)){new Scope(node,{})}switch(node.type){case Syntax.AssignmentExpression:if(node.operator==="="){currentScope.__referencing(node.left,Reference.WRITE,node.right,!currentScope.isStrict&&node.left.name!=null&&node)}else{currentScope.__referencing(node.left,Reference.RW,node.right)}currentScope.__referencing(node.right);break;case Syntax.ArrayExpression:for(i=0,iz=node.elements.length;i<iz;++i){currentScope.__referencing(node.elements[i])}break;case Syntax.BlockStatement:break;case Syntax.BinaryExpression:currentScope.__referencing(node.left);currentScope.__referencing(node.right);break;case Syntax.BreakStatement:break;case Syntax.CallExpression:currentScope.__referencing(node.callee);for(i=0,iz=node["arguments"].length;i<iz;++i){currentScope.__referencing(node["arguments"][i])}if(!options.ignoreEval&&node.callee.type===Syntax.Identifier&&node.callee.name==="eval"){currentScope.variableScope.__detectEval()}break;case Syntax.CatchClause:currentScope.__define(node.param,{type:Variable.CatchClause,name:node.param,node:node});break;case Syntax.ConditionalExpression:currentScope.__referencing(node.test);currentScope.__referencing(node.consequent);currentScope.__referencing(node.alternate);break;case Syntax.ContinueStatement:break;case Syntax.DirectiveStatement:break;case Syntax.DoWhileStatement:currentScope.__referencing(node.test);break;case Syntax.DebuggerStatement:break;case Syntax.EmptyStatement:break;case Syntax.ExpressionStatement:currentScope.__referencing(node.expression);break;case Syntax.ForStatement:currentScope.__referencing(node.init);currentScope.__referencing(node.test);currentScope.__referencing(node.update);break;case Syntax.ForInStatement:if(node.left.type===Syntax.VariableDeclaration){currentScope.__referencing(node.left.declarations[0].id,Reference.WRITE,null,false)}else{currentScope.__referencing(node.left,Reference.WRITE,null,!currentScope.isStrict&&node.left.name!=null&&node)}currentScope.__referencing(node.right);break;case Syntax.FunctionDeclaration:currentScope.upper.__define(node.id,{type:Variable.FunctionName,name:node.id,node:node});for(i=0,iz=node.params.length;i<iz;++i){currentScope.__define(node.params[i],{type:Variable.Parameter,name:node.params[i],node:node,index:i})}break;case Syntax.FunctionExpression:for(i=0,iz=node.params.length;i<iz;++i){currentScope.__define(node.params[i],{type:Variable.Parameter,name:node.params[i],node:node,index:i})}break;case Syntax.Identifier:break;case Syntax.IfStatement:currentScope.__referencing(node.test);break;case Syntax.Literal:break;case Syntax.LabeledStatement:break;case Syntax.LogicalExpression:currentScope.__referencing(node.left);currentScope.__referencing(node.right);break;case Syntax.MemberExpression:currentScope.__referencing(node.object);if(node.computed){currentScope.__referencing(node.property)}break;case Syntax.NewExpression:currentScope.__referencing(node.callee);for(i=0,iz=node["arguments"].length;i<iz;++i){currentScope.__referencing(node["arguments"][i])}break;case Syntax.ObjectExpression:for(i=0;i<node.properties.length;i++){if(node.properties[i].kind==="init"){currentScope.__referencing(node.properties[i].value)}}break;case Syntax.Program:break;case Syntax.Property:break;case Syntax.ReturnStatement:currentScope.__referencing(node.argument);break;case Syntax.SequenceExpression:for(i=0,iz=node.expressions.length;i<iz;++i){currentScope.__referencing(node.expressions[i])}break;case Syntax.SwitchStatement:currentScope.__referencing(node.discriminant);break;case Syntax.SwitchCase:currentScope.__referencing(node.test);break;case Syntax.ThisExpression:currentScope.variableScope.__detectThis();break;case Syntax.ThrowStatement:currentScope.__referencing(node.argument);break;case Syntax.TryStatement:break;case Syntax.UnaryExpression:currentScope.__referencing(node.argument);break;case Syntax.UpdateExpression:currentScope.__referencing(node.argument,Reference.RW,null);break;case Syntax.VariableDeclaration:for(i=0,iz=node.declarations.length;i<iz;++i){decl=node.declarations[i];currentScope.variableScope.__define(decl.id,{type:Variable.Variable,name:decl.id,node:decl,index:i,parent:node});if(decl.init){currentScope.__referencing(decl.id,Reference.WRITE,decl.init,false);currentScope.__referencing(decl.init)}}break;case Syntax.VariableDeclarator:break;case Syntax.WhileStatement:currentScope.__referencing(node.test);break;case Syntax.WithStatement:currentScope.upper.__referencing(node.object);break}},leave:function leave(node){while(currentScope&&node===currentScope.block){currentScope.__close()}}});assert(currentScope===null);globalScope=null;scopes=null;options=null;return new ScopeManager(resultScopes)}exports.version="1.0.3";exports.Reference=Reference;exports.Variable=Variable;exports.Scope=Scope;exports.ScopeManager=ScopeManager;exports.analyze=analyze},this)},{estraverse:67}],67:[function(require,module,exports){(function clone(exports){"use strict";var Syntax,isArray,VisitorOption,VisitorKeys,objectCreate,objectKeys,BREAK,SKIP,REMOVE;function ignoreJSHintError(){}isArray=Array.isArray;if(!isArray){isArray=function isArray(array){return Object.prototype.toString.call(array)==="[object Array]"}}function deepCopy(obj){var ret={},key,val;for(key in obj){if(obj.hasOwnProperty(key)){val=obj[key];if(typeof val==="object"&&val!==null){ret[key]=deepCopy(val)}else{ret[key]=val}}}return ret}function shallowCopy(obj){var ret={},key;for(key in obj){if(obj.hasOwnProperty(key)){ret[key]=obj[key]}}return ret}ignoreJSHintError(shallowCopy);function upperBound(array,func){var diff,len,i,current;len=array.length;i=0;while(len){diff=len>>>1;current=i+diff;if(func(array[current])){len=diff}else{i=current+1;len-=diff+1}}return i}function lowerBound(array,func){var diff,len,i,current;len=array.length;i=0;while(len){diff=len>>>1;current=i+diff;if(func(array[current])){i=current+1;len-=diff+1}else{len=diff}}return i}ignoreJSHintError(lowerBound);objectCreate=Object.create||function(){function F(){}return function(o){F.prototype=o;return new F}}();objectKeys=Object.keys||function(o){var keys=[],key;for(key in o){keys.push(key)}return keys};function extend(to,from){var keys=objectKeys(from),key,i,len;for(i=0,len=keys.length;i<len;i+=1){key=keys[i];to[key]=from[key]}return to}Syntax={AssignmentExpression:"AssignmentExpression",AssignmentPattern:"AssignmentPattern",ArrayExpression:"ArrayExpression",ArrayPattern:"ArrayPattern",ArrowFunctionExpression:"ArrowFunctionExpression",AwaitExpression:"AwaitExpression",BlockStatement:"BlockStatement",BinaryExpression:"BinaryExpression",BreakStatement:"BreakStatement",CallExpression:"CallExpression",CatchClause:"CatchClause",ClassBody:"ClassBody",ClassDeclaration:"ClassDeclaration",ClassExpression:"ClassExpression",ComprehensionBlock:"ComprehensionBlock",ComprehensionExpression:"ComprehensionExpression",ConditionalExpression:"ConditionalExpression",ContinueStatement:"ContinueStatement",DebuggerStatement:"DebuggerStatement",DirectiveStatement:"DirectiveStatement",DoWhileStatement:"DoWhileStatement",EmptyStatement:"EmptyStatement",ExportAllDeclaration:"ExportAllDeclaration",ExportDefaultDeclaration:"ExportDefaultDeclaration",ExportNamedDeclaration:"ExportNamedDeclaration",ExportSpecifier:"ExportSpecifier",ExpressionStatement:"ExpressionStatement",ForStatement:"ForStatement",ForInStatement:"ForInStatement",ForOfStatement:"ForOfStatement",FunctionDeclaration:"FunctionDeclaration",FunctionExpression:"FunctionExpression",GeneratorExpression:"GeneratorExpression",Identifier:"Identifier",IfStatement:"IfStatement",ImportDeclaration:"ImportDeclaration",ImportDefaultSpecifier:"ImportDefaultSpecifier",ImportNamespaceSpecifier:"ImportNamespaceSpecifier",ImportSpecifier:"ImportSpecifier",Literal:"Literal",LabeledStatement:"LabeledStatement",LogicalExpression:"LogicalExpression",MemberExpression:"MemberExpression",MethodDefinition:"MethodDefinition",ModuleSpecifier:"ModuleSpecifier",NewExpression:"NewExpression",ObjectExpression:"ObjectExpression",ObjectPattern:"ObjectPattern",Program:"Program",Property:"Property",RestElement:"RestElement",ReturnStatement:"ReturnStatement",SequenceExpression:"SequenceExpression",SpreadElement:"SpreadElement",SwitchStatement:"SwitchStatement",SwitchCase:"SwitchCase",TaggedTemplateExpression:"TaggedTemplateExpression",TemplateElement:"TemplateElement",TemplateLiteral:"TemplateLiteral",ThisExpression:"ThisExpression",ThrowStatement:"ThrowStatement",TryStatement:"TryStatement",UnaryExpression:"UnaryExpression",UpdateExpression:"UpdateExpression",VariableDeclaration:"VariableDeclaration",VariableDeclarator:"VariableDeclarator",WhileStatement:"WhileStatement",WithStatement:"WithStatement",YieldExpression:"YieldExpression"};VisitorKeys={AssignmentExpression:["left","right"],AssignmentPattern:["left","right"],ArrayExpression:["elements"],ArrayPattern:["elements"],ArrowFunctionExpression:["params","defaults","rest","body"],AwaitExpression:["argument"],BlockStatement:["body"],BinaryExpression:["left","right"],BreakStatement:["label"],CallExpression:["callee","arguments"],CatchClause:["param","body"],ClassBody:["body"],ClassDeclaration:["id","superClass","body"],ClassExpression:["id","superClass","body"],ComprehensionBlock:["left","right"],ComprehensionExpression:["blocks","filter","body"],ConditionalExpression:["test","consequent","alternate"],ContinueStatement:["label"],DebuggerStatement:[],DirectiveStatement:[],DoWhileStatement:["body","test"],EmptyStatement:[],ExportAllDeclaration:["source"],ExportDefaultDeclaration:["declaration"],ExportNamedDeclaration:["declaration","specifiers","source"],ExportSpecifier:["exported","local"],ExpressionStatement:["expression"],ForStatement:["init","test","update","body"],ForInStatement:["left","right","body"],ForOfStatement:["left","right","body"],FunctionDeclaration:["id","params","defaults","rest","body"],FunctionExpression:["id","params","defaults","rest","body"],GeneratorExpression:["blocks","filter","body"],Identifier:[],IfStatement:["test","consequent","alternate"],ImportDeclaration:["specifiers","source"],ImportDefaultSpecifier:["local"],ImportNamespaceSpecifier:["local"],ImportSpecifier:["imported","local"],Literal:[],LabeledStatement:["label","body"],LogicalExpression:["left","right"],MemberExpression:["object","property"],MethodDefinition:["key","value"],ModuleSpecifier:[],NewExpression:["callee","arguments"],ObjectExpression:["properties"],ObjectPattern:["properties"],Program:["body"],Property:["key","value"],RestElement:["argument"],ReturnStatement:["argument"],SequenceExpression:["expressions"],SpreadElement:["argument"],SwitchStatement:["discriminant","cases"],SwitchCase:["test","consequent"],TaggedTemplateExpression:["tag","quasi"],TemplateElement:[],TemplateLiteral:["quasis","expressions"],ThisExpression:[],ThrowStatement:["argument"],TryStatement:["block","handlers","handler","guardedHandlers","finalizer"],UnaryExpression:["argument"],UpdateExpression:["argument"],VariableDeclaration:["declarations"],VariableDeclarator:["id","init"],WhileStatement:["test","body"],WithStatement:["object","body"],YieldExpression:["argument"]};BREAK={};SKIP={};REMOVE={};VisitorOption={Break:BREAK,Skip:SKIP,Remove:REMOVE};function Reference(parent,key){this.parent=parent;this.key=key}Reference.prototype.replace=function replace(node){this.parent[this.key]=node};Reference.prototype.remove=function remove(){if(isArray(this.parent)){this.parent.splice(this.key,1);return true}else{this.replace(null);return false}};function Element(node,path,wrap,ref){this.node=node;this.path=path;this.wrap=wrap;this.ref=ref}function Controller(){}Controller.prototype.path=function path(){var i,iz,j,jz,result,element;function addToPath(result,path){if(isArray(path)){for(j=0,jz=path.length;j<jz;++j){result.push(path[j])}}else{result.push(path)}}if(!this.__current.path){return null}result=[];for(i=2,iz=this.__leavelist.length;i<iz;++i){element=this.__leavelist[i];addToPath(result,element.path)}addToPath(result,this.__current.path);return result};Controller.prototype.type=function(){var node=this.current();return node.type||this.__current.wrap};Controller.prototype.parents=function parents(){var i,iz,result;result=[];for(i=1,iz=this.__leavelist.length;i<iz;++i){result.push(this.__leavelist[i].node)}return result};Controller.prototype.current=function current(){return this.__current.node};Controller.prototype.__execute=function __execute(callback,element){var previous,result;result=undefined;previous=this.__current;this.__current=element;this.__state=null;if(callback){result=callback.call(this,element.node,this.__leavelist[this.__leavelist.length-1].node)}this.__current=previous;return result};Controller.prototype.notify=function notify(flag){this.__state=flag};Controller.prototype.skip=function(){this.notify(SKIP)};Controller.prototype["break"]=function(){this.notify(BREAK)};Controller.prototype.remove=function(){this.notify(REMOVE)};Controller.prototype.__initialize=function(root,visitor){this.visitor=visitor;this.root=root;this.__worklist=[];this.__leavelist=[];this.__current=null;this.__state=null;this.__fallback=visitor.fallback==="iteration";this.__keys=VisitorKeys;if(visitor.keys){this.__keys=extend(objectCreate(this.__keys),visitor.keys)}};function isNode(node){if(node==null){return false}return typeof node==="object"&&typeof node.type==="string"}function isProperty(nodeType,key){return(nodeType===Syntax.ObjectExpression||nodeType===Syntax.ObjectPattern)&&"properties"===key}Controller.prototype.traverse=function traverse(root,visitor){var worklist,leavelist,element,node,nodeType,ret,key,current,current2,candidates,candidate,sentinel;this.__initialize(root,visitor);sentinel={};worklist=this.__worklist;leavelist=this.__leavelist;worklist.push(new Element(root,null,null,null));leavelist.push(new Element(null,null,null,null));while(worklist.length){element=worklist.pop();if(element===sentinel){element=leavelist.pop();ret=this.__execute(visitor.leave,element);if(this.__state===BREAK||ret===BREAK){return}continue}if(element.node){ret=this.__execute(visitor.enter,element);if(this.__state===BREAK||ret===BREAK){return}worklist.push(sentinel);leavelist.push(element);if(this.__state===SKIP||ret===SKIP){continue}node=element.node;nodeType=element.wrap||node.type;candidates=this.__keys[nodeType];if(!candidates){if(this.__fallback){candidates=objectKeys(node)}else{throw new Error("Unknown node type "+nodeType+".")}}current=candidates.length;while((current-=1)>=0){key=candidates[current];candidate=node[key];if(!candidate){continue}if(isArray(candidate)){current2=candidate.length;while((current2-=1)>=0){if(!candidate[current2]){continue}if(isProperty(nodeType,candidates[current])){element=new Element(candidate[current2],[key,current2],"Property",null)}else if(isNode(candidate[current2])){element=new Element(candidate[current2],[key,current2],null,null)}else{continue}worklist.push(element)}}else if(isNode(candidate)){worklist.push(new Element(candidate,key,null,null))}}}}};Controller.prototype.replace=function replace(root,visitor){function removeElem(element){var i,key,nextElem,parent;if(element.ref.remove()){key=element.ref.key;parent=element.ref.parent;i=worklist.length;while(i--){nextElem=worklist[i];if(nextElem.ref&&nextElem.ref.parent===parent){if(nextElem.ref.key<key){break}--nextElem.ref.key}}}}var worklist,leavelist,node,nodeType,target,element,current,current2,candidates,candidate,sentinel,outer,key;this.__initialize(root,visitor);sentinel={};worklist=this.__worklist;leavelist=this.__leavelist;outer={root:root};element=new Element(root,null,null,new Reference(outer,"root"));worklist.push(element);leavelist.push(element);while(worklist.length){element=worklist.pop();if(element===sentinel){element=leavelist.pop();target=this.__execute(visitor.leave,element);if(target!==undefined&&target!==BREAK&&target!==SKIP&&target!==REMOVE){element.ref.replace(target)}if(this.__state===REMOVE||target===REMOVE){removeElem(element)}if(this.__state===BREAK||target===BREAK){return outer.root}continue}target=this.__execute(visitor.enter,element);if(target!==undefined&&target!==BREAK&&target!==SKIP&&target!==REMOVE){element.ref.replace(target);element.node=target}if(this.__state===REMOVE||target===REMOVE){removeElem(element);element.node=null}if(this.__state===BREAK||target===BREAK){return outer.root}node=element.node;if(!node){continue}worklist.push(sentinel);leavelist.push(element);if(this.__state===SKIP||target===SKIP){continue}nodeType=element.wrap||node.type;candidates=this.__keys[nodeType];if(!candidates){if(this.__fallback){candidates=objectKeys(node)}else{throw new Error("Unknown node type "+nodeType+".")}}current=candidates.length;while((current-=1)>=0){key=candidates[current];candidate=node[key];if(!candidate){continue}if(isArray(candidate)){current2=candidate.length;while((current2-=1)>=0){if(!candidate[current2]){continue}if(isProperty(nodeType,candidates[current])){element=new Element(candidate[current2],[key,current2],"Property",new Reference(candidate,current2))}else if(isNode(candidate[current2])){element=new Element(candidate[current2],[key,current2],null,new Reference(candidate,current2))}else{continue}worklist.push(element)}}else if(isNode(candidate)){worklist.push(new Element(candidate,key,null,new Reference(node,key)))}}}return outer.root};function traverse(root,visitor){var controller=new Controller;return controller.traverse(root,visitor)}function replace(root,visitor){var controller=new Controller;return controller.replace(root,visitor)}function extendCommentRange(comment,tokens){var target;target=upperBound(tokens,function search(token){return token.range[0]>comment.range[0]});comment.extendedRange=[comment.range[0],comment.range[1]];if(target!==tokens.length){comment.extendedRange[1]=tokens[target].range[0]}target-=1;if(target>=0){comment.extendedRange[0]=tokens[target].range[1]}return comment}function attachComments(tree,providedComments,tokens){var comments=[],comment,len,i,cursor;if(!tree.range){throw new Error("attachComments needs range information")}if(!tokens.length){if(providedComments.length){for(i=0,len=providedComments.length;i<len;i+=1){comment=deepCopy(providedComments[i]);comment.extendedRange=[0,tree.range[0]];comments.push(comment)}tree.leadingComments=comments}return tree}for(i=0,len=providedComments.length;i<len;i+=1){comments.push(extendCommentRange(deepCopy(providedComments[i]),tokens))}cursor=0;traverse(tree,{enter:function(node){var comment;while(cursor<comments.length){comment=comments[cursor];if(comment.extendedRange[1]>node.range[0]){break}if(comment.extendedRange[1]===node.range[0]){if(!node.leadingComments){node.leadingComments=[]}node.leadingComments.push(comment);comments.splice(cursor,1)}else{cursor+=1}}if(cursor===comments.length){return VisitorOption.Break}if(comments[cursor].extendedRange[0]>node.range[1]){return VisitorOption.Skip}}});cursor=0;traverse(tree,{leave:function(node){var comment;while(cursor<comments.length){comment=comments[cursor];if(node.range[1]<comment.extendedRange[0]){break}if(node.range[1]===comment.extendedRange[0]){if(!node.trailingComments){node.trailingComments=[]}node.trailingComments.push(comment);comments.splice(cursor,1)}else{cursor+=1}}if(cursor===comments.length){return VisitorOption.Break}if(comments[cursor].extendedRange[0]>node.range[1]){return VisitorOption.Skip}}});return tree}exports.version=require("./package.json").version;exports.Syntax=Syntax;exports.traverse=traverse;exports.replace=replace;exports.attachComments=attachComments;exports.VisitorKeys=VisitorKeys;exports.VisitorOption=VisitorOption;exports.Controller=Controller;exports.cloneEnvironment=function(){return clone({})};return exports})(exports)},{"./package.json":68}],68:[function(require,module,exports){module.exports={_from:"estraverse@^2.0.0",_id:"estraverse@2.0.0",_inBundle:false,_integrity:"sha1-WuRpYyQ2ACBmdMyySgnhZnT83KE=",_location:"/escope/estraverse",_phantomChildren:{},_requested:{type:"range",registry:true,raw:"estraverse@^2.0.0",name:"estraverse",escapedName:"estraverse",rawSpec:"^2.0.0",saveSpec:null,fetchSpec:"^2.0.0"},_requiredBy:["/escope"],_resolved:"https://registry.npmjs.org/estraverse/-/estraverse-2.0.0.tgz",_shasum:"5ae46963243600206674ccb24a09e16674fcdca1",_spec:"estraverse@^2.0.0",_where:"/Users/jkhartshorne/Documents/Teaching/probmods2/node_modules/webppl/node_modules/escope",bugs:{url:"https://github.com/estools/estraverse/issues"},bundleDependencies:false,deprecated:false,description:"ECMAScript JS AST traversal functions",devDependencies:{chai:"^2.1.1","coffee-script":"^1.8.0",espree:"^1.11.0",gulp:"^3.8.10","gulp-bump":"^0.2.2","gulp-filter":"^2.0.0","gulp-git":"^1.0.1","gulp-tag-version":"^1.2.1",jshint:"^2.5.6",mocha:"^2.1.0"},engines:{node:">=0.10.0"},homepage:"https://github.com/estools/estraverse",licenses:[{type:"BSD",url:"http://github.com/estools/estraverse/raw/master/LICENSE.BSD"}],main:"estraverse.js",maintainers:[{name:"Yusuke Suzuki",email:"utatane.tea@gmail.com",url:"http://github.com/Constellation"}],name:"estraverse",repository:{type:"git",url:"git+ssh://git@github.com/estools/estraverse.git"},scripts:{lint:"jshint estraverse.js",test:"npm run-script lint && npm run-script unit-test","unit-test":"mocha --compilers coffee:coffee-script/register"},version:"2.0.0"}},{}],69:[function(require,module,exports){(function(){"use strict";var Name,Syntax,common;Name="annotate-directive";common=require("./common");Syntax=common.Syntax;function isDirective(stmt){var expr;if(stmt.type===Syntax.ExpressionStatement){expr=stmt.expression;if(expr.type===Syntax.Literal&&typeof expr.value==="string"){return true}}return false}function escapeAllowedCharacter(ch,next){var code=ch.charCodeAt(0),hex=code.toString(16),result="\\";switch(ch){case"\b":result+="b";break;case"\f":result+="f";break;case"\t":result+="t";break;default:if(code>255){result+="u"+"0000".slice(hex.length)+hex}else if(ch==="\0"&&"0123456789".indexOf(next)<0){result+="0"}else if(ch==="\v"){result+="v"}else{result+="x"+"00".slice(hex.length)+hex}break}return result}function escapeDisallowedCharacter(ch){var result="\\";switch(ch){case"\\":result+="\\";break;case"\n":result+="n";break;case"\r":result+="r";break;case"\u2028":result+="u2028";break;case"\u2029":result+="u2029";break;default:throw new Error("Incorrectly classified character")}return result}function escapeString(str){var result="",i,len,ch;if(typeof str[0]==="undefined"){str=common.stringToArray(str)}for(i=0,len=str.length;i<len;i+=1){ch=str[i];if(ch==="'"){result+="\\'";continue}else if("\\\n\r\u2028\u2029".indexOf(ch)>=0){result+=escapeDisallowedCharacter(ch);continue}else if(!(ch>=" "&&ch<="~")){result+=escapeAllowedCharacter(ch,str[i+1]);continue}result+=ch}return result}function annotateDirective(tree,options){var result;result=options.get("destructive",{pathName:Name})?tree:common.deepCopy(tree);common.traverse(result,{enter:function enter(node,parent){var stmt,i,iz;if(!(node.type===Syntax.Program||node.type===Syntax.BlockStatement&&(parent.type===Syntax.FunctionExpression||parent.type===Syntax.FunctionDeclaration))){return}for(i=0,iz=node.body.length;i<iz;++i){stmt=node.body[i];if(isDirective(stmt)){stmt.type=Syntax.DirectiveStatement;if(stmt.expression.raw){stmt.directive=stmt.expression.raw.substring(1,stmt.expression.raw.length-1);stmt.value=stmt.expression.value;stmt.raw=stmt.expression.raw}else{stmt.directive=escapeString(stmt.expression.value);stmt.value=stmt.expression.value;stmt.raw="'"+stmt.directive+"'"}delete stmt.expression}else{return}}}});return result}annotateDirective.passName=Name;module.exports=annotateDirective})()},{"./common":70}],70:[function(require,module,exports){(function(){"use strict";var Syntax,isArray,arrayFrom,arrayOf,has,sameValue,estraverse,escope,esutils;estraverse=require("estraverse");escope=require("escope");esutils=require("esutils");Syntax=estraverse.Syntax;isArray=Array.isArray;if(!isArray){isArray=function isArray(array){return Object.prototype.toString.call(array)==="[object Array]"}}function isObject(obj){return typeof obj==="object"&&obj!==null}has=function(){var method={}.hasOwnProperty;return function has(obj,prop){return method.call(obj,prop)}}();arrayFrom=function(){var slice=Array.prototype.slice;return function arrayFrom(array){return slice.call(array)}}();arrayOf=function(){var slice=Array.prototype.slice;return function arrayOf(){return slice.call(arguments)}}();function arrayLast(array){return array[array.length-1]}function arrayEmpty(array){return array.length===0}function stringRepeat(str,num){var result="";for(num|=0;num>0;num>>>=1,str+=str){if(num&1){result+=str}}return result}if(Object.is){sameValue=Object.is}else{sameValue=function sameValue(x,y){if(x===y){return x!==0||1/x===1/y}return x!==x&&y!==y}}function deepCopy(obj){function deepCopyInternal(obj,result){var key,val;for(key in obj){if(key.lastIndexOf("__",0)===0){continue}if(obj.hasOwnProperty(key)){val=obj[key];if(typeof val==="object"&&val!==null){if(val instanceof RegExp){val=new RegExp(val)}else{val=deepCopyInternal(val,isArray(val)?[]:{})}}result[key]=val}}return result}return deepCopyInternal(obj,isArray(obj)?[]:{})}function assert(cond,text){if(!cond){throw new Error(text)}}function unreachable(){throw new Error("Unreachable point. logically broken.")}function isIdentifier(name){if(esutils.keyword.isKeywordES5(name,true)||esutils.keyword.isRestrictedWord(name)){return false}return esutils.keyword.isIdentifierName(name)}function mayBeCompletionValue(node,ancestors){var i,ancestor;if(node.type!==Syntax.ExpressionStatement){return true}for(i=ancestors.length-1;i>=0;--i,node=ancestor){ancestor=ancestors[i];switch(ancestor.type){case Syntax.FunctionExpression:case Syntax.FunctionDeclaration:return false;case Syntax.BlockStatement:case Syntax.Program:if(arrayLast(ancestor.body)!==node){return false}break;case Syntax.SwitchCase:if(arrayLast(ancestor.consequent)!==node){return false}break}}return true}function moveLocation(from,to){if(from.loc==null){return to}to.loc=deepCopy(from.loc);return to}function deleteLocation(node){if(node.hasOwnProperty("loc")){return delete node.loc}return false}function convertToEmptyStatement(node){var i,iz,keys;keys=estraverse.VisitorKeys[node.type];for(i=0,iz=keys.length;i<iz;++i){delete node[keys[i]]}node.type=Syntax.EmptyStatement;return node}function isNegative(value){return value===value&&(value<0||value===0&&1/value<0)}function isFunctionBody(node,parent){return node.type===Syntax.BlockStatement&&(parent.type===Syntax.FunctionDeclaration||parent.type===Syntax.FunctionExpression)}function isNumberLiteral(node){return node.type===Syntax.Literal&&typeof node.value==="number"}function isOptimizedArgument(argument){return isNumberLiteral(argument)&&String(argument.value).length===1}function generateNegativeNode(value,node){var result;result={type:Syntax.UnaryExpression,operator:"-",argument:{type:Syntax.Literal,value:-value}};return node?moveLocation(node,result):result}function isNegativeNode(node){return node.type===Syntax.UnaryExpression&&node.operator==="-"&&isNumberLiteral(node.argument)}function generateUndefined(node){var result={type:Syntax.UnaryExpression,operator:"void",argument:{type:Syntax.Literal,value:0}};return node?moveLocation(node,result):result}function isUndefined(node){return node.type===Syntax.UnaryExpression&&node.operator==="void"&&isOptimizedArgument(node.argument)}function generateNaN(node){var result={type:Syntax.BinaryExpression,operator:"/",left:{type:Syntax.Literal,value:0},right:{type:Syntax.Literal,value:0}};return node?moveLocation(node,result):result}function isNaNNode(node){if(node.type===Syntax.BinaryExpression){if(isOptimizedArgument(node.left)&&isOptimizedArgument(node.right)){return node.left.value===0&&node.right.value===0}}return false}function generateFromValue(value){if(typeof value==="number"){if(isNaN(value)){return generateNaN()}if(isNegative(value)){return generateNegativeNode(value)}}if(value===undefined){return generateUndefined()}return{type:Syntax.Literal,value:value}}function isReference(node){var type=node.type;return type===Syntax.Identifier||type===Syntax.MemberExpression}function canExtractSequence(last,parent,scope){var ref;if(parent.type===Syntax.CallExpression){if(last.type===Syntax.Identifier){if(last.name==="eval"){return false}ref=scope.resolve(last);return ref&&ref.isStatic()}return last.type!==Syntax.MemberExpression}else if(parent.type===Syntax.UnaryExpression){if(parent.operator==="delete"){return!isReference(last)}else if(parent.operator==="typeof"){if(last.type===Syntax.Identifier){ref=scope.resolve(last);return ref&&ref.isStatic()}}}else if(parent.type===Syntax.UpdateExpression){return!isReference(last)}return true}function delegateVariableDeclarations(stmt,func){var decls,target;decls=[];estraverse.traverse(stmt,{enter:function(node){var i,iz,decl;if(node.type===Syntax.VariableDeclaration){if(node.kind==="let"||node.kind==="const"){return}for(i=0,iz=node.declarations.length;i<iz;++i){decl=node.declarations[i];delete decl.init;decls.push(decl)}return estraverse.VisitorOption.Skip}else if(escope.Scope.isVariableScopeRequired(node)){return estraverse.VisitorOption.Skip}}});if(!decls.length){return null}target=null;estraverse.traverse(func.body,{enter:function(node,parent){if(node===stmt){return estraverse.VisitorOption.Skip}else if(escope.Scope.isVariableScopeRequired(node)){return estraverse.VisitorOption.Skip}else if(node.type===Syntax.VariableDeclaration&&node.kind==="var"){if(parent.type!==Syntax.ForInStatement){target=node;return estraverse.VisitorOption.Break}}}});if(target){target.declarations=target.declarations.concat(decls);return null}else{return{type:Syntax.VariableDeclaration,kind:"var",declarations:decls}}}function isScopedDeclaration(node){if(node.type===Syntax.VariableDeclaration&&(node.kind==="let"||node.kind==="const")){return true}else if(node.type===Syntax.FunctionDeclaration){return true}return false}exports.deepCopy=deepCopy;exports.stringRepeat=stringRepeat;exports.sameValue=sameValue;exports.Array={isArray:isArray,from:arrayFrom,of:arrayOf,last:arrayLast,empty:arrayEmpty};exports.Object={isObject:isObject,has:has};exports.Syntax=Syntax;exports.traverse=estraverse.traverse;exports.replace=estraverse.replace;exports.VisitorKeys=estraverse.VisitorKeys;exports.VisitorOption=estraverse.VisitorOption;exports.assert=assert;exports.unreachable=unreachable;exports.isIdentifier=isIdentifier;exports.moveLocation=moveLocation;exports.deleteLocation=deleteLocation;exports.convertToEmptyStatement=convertToEmptyStatement;exports.mayBeCompletionValue=mayBeCompletionValue;exports.isNegative=isNegative;exports.isFunctionBody=isFunctionBody;exports.SpecialNode={generateNegative:generateNegativeNode,isNegative:isNegativeNode,generateUndefined:generateUndefined,isUndefined:isUndefined,generateNaN:generateNaN,isNaN:isNaNNode,isReference:isReference,canExtractSequence:canExtractSequence,generateFromValue:generateFromValue};exports.delegateVariableDeclarations=delegateVariableDeclarations;exports.isScopedDeclaration=isScopedDeclaration})()},{escope:66,estraverse:106,esutils:109}],71:[function(require,module,exports){(function(){"use strict";var esshorten,common,Options,Syntax,Pass,annotateDirective;esshorten=require("esshorten");common=require("./common");Options=require("./options");Pass=require("./pass");annotateDirective=require("./annotate-directive");Syntax=common.Syntax;function recover(tree,useDirectiveStatement){function trailingIf(node){while(true){switch(node.type){case Syntax.IfStatement:if(!node.alternate){return true}node=node.alternate;continue;case Syntax.LabeledStatement:case Syntax.ForStatement:case Syntax.ForInStatement:case Syntax.WhileStatement:case Syntax.WithStatement:node=node.body;continue}return false}}common.traverse(tree,{leave:function leave(node){if(node.type===Syntax.IfStatement&&node.alternate){if(node.consequent.type!==Syntax.BlockStatement){if(trailingIf(node.consequent)){node.consequent={type:Syntax.BlockStatement,body:[node.consequent]}}}}if(!useDirectiveStatement&&node.type===Syntax.DirectiveStatement){node.type=Syntax.ExpressionStatement;node.expression=common.moveLocation(node,{type:Syntax.Literal,value:node.value,raw:node.raw});delete node.directive;delete node.value;delete node.raw}}});return tree}function iteration(tree,p,options){var i,iz,pass,res,changed,statuses,passes,result;function addPass(pass){var name;if(typeof pass!=="function"){name=Object.keys(pass)[0];pass=pass[name]}if(pass.hasOwnProperty("passName")){name=pass.passName}else{name=pass.name}passes.push(pass);statuses.push(true)}function fillStatuses(bool){var i,iz;for(i=0,iz=statuses.length;i<iz;++i){statuses[i]=bool}}result=options.get("destructive")?tree:common.deepCopy(tree);statuses=[];passes=[];for(i=0,iz=p.length;i<iz;++i){addPass(p[i])}do{changed=false;for(i=0,iz=passes.length;i<iz;++i){pass=passes[i];if(statuses[i]){res=pass(result,options);if(res.modified){changed=true;fillStatuses(true)}else{statuses[i]=false}result=res.result}}}while(changed);return result}function optimize(tree,pipeline,options){var i,iz,j,jz,section,pass;tree=annotateDirective(tree,new Options({destructive:false}));if(null==pipeline){pipeline=Pass.__defaultPipeline}options=new Options(options);for(i=0,iz=pipeline.length;i<iz;++i){section=pipeline[i];if(common.Array.isArray(section)){tree=iteration(tree,section,options)}else if(section.once){pass=section.pass;for(j=0,jz=pass.length;j<jz;++j){tree=pass[j](tree,options).result}}}return recover(tree,options.get("directive"))}exports.version=require("../package.json").version;exports.mangle=esshorten.mangle;exports.optimize=optimize;exports.pass=Pass})()},{"../package.json":110,"./annotate-directive":69,"./common":70,"./options":74,"./pass":75,esshorten:112}],72:[function(require,module,exports){(function(){"use strict";var Syntax,common;common=require("./common");Syntax=common.Syntax;function isConstant(node,allowRegExp){if(node.type===Syntax.Literal){if(typeof node.value==="object"&&node.value!==null){return allowRegExp}return true}if(node.type===Syntax.UnaryExpression){if(node.operator==="void"||node.operator==="delete"||node.operator==="!"){return isConstant(node.argument,true)}return isConstant(node.argument,false)}if(node.type===Syntax.BinaryExpression){if(node.operator==="in"||node.operator==="instanceof"){return false}return isConstant(node.left,false)&&isConstant(node.right,false)}if(node.type===Syntax.LogicalExpression){return isConstant(node.left,true)&&isConstant(node.right,true)}return false}function getConstant(node){if(node.type===Syntax.Literal){return node.value}if(node.type===Syntax.UnaryExpression){return doUnary(node.operator,getConstant(node.argument))}if(node.type===Syntax.BinaryExpression){return doBinary(node.operator,getConstant(node.left),getConstant(node.right))}if(node.type===Syntax.LogicalExpression){return doLogical(node.operator,getConstant(node.left),getConstant(node.right))}common.unreachable()}function doLogical(operator,left,right){if(operator==="||"){return left||right}if(operator==="&&"){return left&&right}common.unreachable()}function doUnary(operator,argument){switch(operator){case"+":return+argument;case"-":return-argument;case"~":return~argument;case"!":return!argument;case"delete":return true;case"void":return undefined;case"typeof":return typeof argument}common.unreachable()}function doBinary(operator,left,right){switch(operator){case"|":return left|right;case"^":return left^right;case"&":return left&right;case"==":return left==right;case"!=":return left!=right;case"===":return left===right;case"!==":return left!==right;case"<":return left<right;case">":return left>right;case"<=":return left<=right;case">=":return left>=right;case"<<":return left<<right;case">>":return left>>right;case">>>":return left>>>right;case"+":return left+right;case"-":return left-right;case"*":return left*right;case"/":return left/right;case"%":return left%right}common.unreachable()}exports.constant={doBinary:doBinary,doUnary:doUnary,doLogical:doLogical,evaluate:getConstant,isConstant:isConstant};function hasSideEffect(expr,scope){function visit(expr){var i,iz,ref;switch(expr.type){case Syntax.AssignmentExpression:return true;case Syntax.ArrayExpression:for(i=0,iz=expr.elements.length;i<iz;++i){if(expr.elements[i]!==null&&visit(expr.elements[i])){return true}}return false;case Syntax.BinaryExpression:return!isConstant(expr);case Syntax.CallExpression:return true;case Syntax.ConditionalExpression:return visit(expr.test)||visit(expr.consequent)||visit(expr.alternate);case Syntax.FunctionExpression:return false;case Syntax.Identifier:ref=scope.resolve(expr);if(ref&&ref.isStatic()){return false}return true;case Syntax.Literal:return false;case Syntax.LogicalExpression:return visit(expr.left)||visit(expr.right);case Syntax.MemberExpression:return true;case Syntax.NewExpression:return true;case Syntax.ObjectExpression:for(i=0,iz=expr.properties.length;i<iz;++i){if(visit(expr.properties[i])){return true}}return false;case Syntax.Property:return visit(expr.value);case Syntax.SequenceExpression:for(i=0,iz=expr.expressions.length;i<iz;++i){if(visit(expr.expressions[i])){return true}}return false;case Syntax.ThisExpression:return false;case Syntax.UnaryExpression:if(expr.operator==="void"||expr.operator==="delete"||expr.operator==="typeof"||expr.operator==="!"){return visit(expr.argument)}return!isConstant(expr);case Syntax.UpdateExpression:return true}return true}return visit(expr)}exports.hasSideEffect=hasSideEffect;function booleanCondition(expr){var ret;switch(expr.type){case Syntax.AssignmentExpression:return booleanCondition(expr.right);case Syntax.ArrayExpression:return true;case Syntax.BinaryExpression:if(isConstant(expr)){return!!getConstant(expr)}return null;case Syntax.CallExpression:return null;case Syntax.ConditionalExpression:ret=booleanCondition(expr.test);if(ret===true){return booleanCondition(expr.consequent)}if(ret===false){return booleanCondition(expr.alternate)}ret=booleanCondition(expr.consequent);if(ret===booleanCondition(expr.alternate)){return ret}return null;case Syntax.FunctionExpression:return true;case Syntax.Identifier:return null;case Syntax.Literal:return!!getConstant(expr);case Syntax.LogicalExpression:if(expr.operator==="&&"){ret=booleanCondition(expr.left);if(ret===null){return null}if(!ret){return false}return booleanCondition(expr.right)}else{ret=booleanCondition(expr.left);if(ret===null){return null}if(ret){return true}return booleanCondition(expr.right)}return null;case Syntax.MemberExpression:return null;case Syntax.NewExpression:return true;case Syntax.ObjectExpression:return true;case Syntax.Property:common.unreachable();return null;case Syntax.SequenceExpression:return booleanCondition(common.Array.last(expr.expressions));case Syntax.ThisExpression:return null;case Syntax.UnaryExpression:if(expr.operator==="void"){return false}if(expr.operator==="typeof"){return true}if(expr.operator==="!"){ret=booleanCondition(expr.argument);if(ret===null){return null}return!ret}if(isConstant(expr)){return!!getConstant(expr)}return null;case Syntax.UpdateExpression:return null}return null}exports.booleanCondition=booleanCondition})()},{"./common":70}],73:[function(require,module,exports){(function(global){(function(){"use strict";var Map;if(typeof global.Map!=="undefined"){Map=global.Map}else{Map=function Map(){this.__data={}};Map.prototype.get=function MapGet(key){key="$"+key;if(this.__data.hasOwnProperty(key)){return this.__data[key]}};Map.prototype.has=function MapHas(key){key="$"+key;return this.__data.hasOwnProperty(key)};Map.prototype.set=function MapSet(key,val){key="$"+key;this.__data[key]=val};Map.prototype["delete"]=function MapDelete(key){key="$"+key;return delete this.__data[key]};Map.prototype.clear=function MapClear(){this.__data={}};Map.prototype.forEach=function MapForEach(callback,thisArg){var real,key;for(real in this.__data){if(this.__data.hasOwnProperty(real)){key=real.substring(1);callback.call(thisArg,this.__data[real],key,this)}}};Map.prototype.keys=function MapKeys(){var real,result;result=[];for(real in this.__data){if(this.__data.hasOwnProperty(real)){result.push(real.substring(1))}}return result};Map.prototype.values=function MapValues(){var real,result;result=[];for(real in this.__data){if(this.__data.hasOwnProperty(real)){result.push(this.__data[real])}}return result};Map.prototype.items=function MapItems(){var real,result;result=[];for(real in this.__data){if(this.__data.hasOwnProperty(real)){result.push([real.substring(1),this.__data[real]])}}return result}}module.exports=Map})()}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],74:[function(require,module,exports){(function(){"use strict";var common;common=require("./common");function extend(result,update){var prop,lhs,rhs;for(prop in update){if(!common.Object.has(update,prop)){continue}if(prop in result){lhs=result[prop];rhs=update[prop];if(common.Object.isObject(rhs)&&common.Object.isObject(lhs)){result[prop]=extend(lhs,rhs)}else{result[prop]=update[prop]}}else{result[prop]=update[prop]}}return result}function Options(override){var defaults={destructive:true,preserveCompletionValue:false};if(override==null){this.data=defaults;return}this.data=extend(defaults,override)}Options.prototype.get=function get(name,details){var local;if(details!=null){if(common.Object.has(details,"pathName")){local=this.data[details.pathName];if(local!=null&&common.Object.has(local,name)){return local[name]}}}return this.data[name]};module.exports=Options})()},{"./common":70}],75:[function(require,module,exports){(function(){"use strict";var query,Registry,pass,post,common;common=require("./common");query=require("./query");Registry={};Registry.__direct={};function initialize(kind,passes){var i,iz,pass;Registry[kind]={};for(i=0,iz=passes.length;i<iz;++i){pass=passes[i];common.assert(Registry[kind][pass.passName]==null,"don't create duplicate pass names");Registry[kind][pass.passName]=pass}common.assert(Registry.__direct[pass.passName]==null,"don't create duplicate pass names");Registry.__direct[pass.passName]=pass}pass=[require("./pass/hoist-variable-to-arguments"),require("./pass/transform-dynamic-to-static-property-access"),require("./pass/transform-dynamic-to-static-property-definition"),require("./pass/transform-immediate-function-call"),require("./pass/transform-logical-association"),require("./pass/reordering-function-declarations"),require("./pass/remove-unused-label"),require("./pass/remove-empty-statement"),require("./pass/remove-wasted-blocks"),require("./pass/transform-to-compound-assignment"),require("./pass/transform-to-sequence-expression"),require("./pass/transform-branch-to-expression"),require("./pass/transform-typeof-undefined"),require("./pass/reduce-sequence-expression"),require("./pass/reduce-branch-jump"),require("./pass/reduce-multiple-if-statements"),require("./pass/dead-code-elimination"),require("./pass/remove-side-effect-free-expressions"),require("./pass/remove-context-sensitive-expressions"),require("./pass/tree-based-constant-folding"),require("./pass/concatenate-variable-definition"),require("./pass/drop-variable-definition"),require("./pass/remove-unreachable-branch"),require("./pass/eliminate-duplicate-function-declarations")];post=[require("./post/transform-static-to-dynamic-property-access"),require("./post/transform-infinity"),require("./post/rewrite-boolean"),require("./post/rewrite-conditional-expression"),require("./post/omit-parens-in-void-context-iife")];initialize("pass",pass);initialize("post",post);function passRequire(name){if(common.Object.has(Registry.__direct,name)){return Registry.__direct[name]}return query.get(Registry,name.split("/"))}exports.require=passRequire;exports.Registry=Registry;exports.__defaultPipeline=[pass,{once:true,pass:post}]})()},{"./common":70,"./pass/concatenate-variable-definition":76,"./pass/dead-code-elimination":77,"./pass/drop-variable-definition":78,"./pass/eliminate-duplicate-function-declarations":79,"./pass/hoist-variable-to-arguments":80,"./pass/reduce-branch-jump":81,"./pass/reduce-multiple-if-statements":82,"./pass/reduce-sequence-expression":83,"./pass/remove-context-sensitive-expressions":84,"./pass/remove-empty-statement":85,"./pass/remove-side-effect-free-expressions":86,"./pass/remove-unreachable-branch":87,"./pass/remove-unused-label":88,"./pass/remove-wasted-blocks":89,"./pass/reordering-function-declarations":90,"./pass/transform-branch-to-expression":91,"./pass/transform-dynamic-to-static-property-access":92,"./pass/transform-dynamic-to-static-property-definition":93,"./pass/transform-immediate-function-call":94,"./pass/transform-logical-association":95,"./pass/transform-to-compound-assignment":96,"./pass/transform-to-sequence-expression":97,"./pass/transform-typeof-undefined":98,"./pass/tree-based-constant-folding":99,"./post/omit-parens-in-void-context-iife":100,"./post/rewrite-boolean":101,"./post/rewrite-conditional-expression":102,"./post/transform-infinity":103,"./post/transform-static-to-dynamic-property-access":104,"./query":105}],76:[function(require,module,exports){(function(){"use strict";var Name,Syntax,common,modified;Name="concatenate-variable-definition";common=require("../common");Syntax=common.Syntax;function concatenateVariableDefinition(tree,options){var result;result=options.get("destructive",{pathName:Name})?tree:common.deepCopy(tree);modified=false;common.traverse(result,{leave:function leave(node){var i,iz,j,jz,stmt,decl,target,body;if(node.type!==Syntax.BlockStatement&&node.type!==Syntax.Program){return}target=null;body=[];for(i=0,iz=node.body.length;i<iz;++i){stmt=node.body[i];if(stmt.type===Syntax.VariableDeclaration&&stmt.kind==="var"){if(!target){target=stmt;body.push(stmt);continue}modified=true;for(j=0,jz=stmt.declarations.length;j<jz;++j){decl=stmt.declarations[j];target.declarations.push(decl)}}else{target=null;body.push(stmt)}}node.body=body}});return{result:result,modified:modified}}concatenateVariableDefinition.passName=Name;module.exports=concatenateVariableDefinition})()},{"../common":70}],77:[function(require,module,exports){(function(){"use strict";var Name,Syntax,common,status,modified;Name="dead-code-elimination";common=require("../common");Syntax=common.Syntax;function JumpTarget(node,status,type){this.node=node;this.type=type;this.labels=status.labels||[];status.labels=null}JumpTarget.NAMED_ONLY=0;JumpTarget.ITERATION=2;JumpTarget.SWITCH=3;JumpTarget.prototype.isIteration=function isIteration(){return this.type===JumpTarget.ITERATION};JumpTarget.prototype.isAnonymous=function isAnonymous(){return this.type&2};JumpTarget.prototype.contains=function contains(label){return this.labels.indexOf(label)!==-1};function Jumps(){this.targets=[]}Jumps.prototype.lookupContinuableTarget=function lookupContinuableTarget(label){var i,target;for(i=this.targets.length-1;i>=0;--i){target=this.targets[i];if(target.isIteration()&&(!label||target.contains(label.name))){return target.node}}common.unreachable()};Jumps.prototype.lookupBreakableTarget=function lookupBreakableTarget(label){var i,target;for(i=this.targets.length-1;i>=0;--i){target=this.targets[i];if(label){if(target.contains(label.name)){return target.node}}else{if(target.isAnonymous()){return target.node}}}common.unreachable()};Jumps.prototype.push=function push(target){this.targets.push(target)};Jumps.prototype.pop=function pop(){this.targets.pop()};function Status(upper){this.current=[];this.upper=upper;this.jumps=new Jumps;this.labels=null;this.next()}Status.NEXT={};Status.prototype.insert=function insert(stmt){this.current.push(stmt)};Status.prototype.erase=function erase(stmt){var index=this.current.indexOf(stmt);if(index===-1){return false}this.current.splice(index,1);return true};Status.prototype.kill=function kill(){return this.erase(Status.NEXT)};Status.prototype.has=function has(stmt){return this.current.indexOf(stmt)!==-1};Status.prototype.jumpTo=function jumpTo(stmt){this.kill();this.insert(stmt)};Status.prototype.resolveJump=function resolveJump(stmt){var index=this.current.indexOf(stmt);if(index!==-1){this.current.splice(index,1);this.insert(Status.NEXT)}};Status.prototype.clear=function clear(){this.current.length=0};Status.prototype.next=function next(){this.insert(Status.NEXT)};Status.prototype.isDead=function isDead(){return!this.has(Status.NEXT)};Status.prototype.revive=function revive(){if(this.isDead()){this.next();return true}return false};Status.prototype.register=function register(node){if(!this.labels){this.labels=[]}this.labels.push(node.label.name)};Status.prototype.unregister=function unregister(){this.labels=null};Status.isRequired=function isRequired(node){var type=node.type;common.assert(node,"should be node");return type===Syntax.Program||type===Syntax.FunctionExpression||type===Syntax.FunctionDeclaration};function Context(node){node.__$context=this;this.node=node}Context.prototype.detach=function detach(){delete this.node.__$context};Context.lookup=function lookup(node){return node.__$context};function getForwardLastNode(node){while(true){switch(node.type){case Syntax.IfStatement:if(node.alternate){return null}node=node.consequent;continue;case Syntax.WithStatement:case Syntax.LabeledStatement:node=node.body;continue;case Syntax.BlockStatement:if(node.body.length){node=common.Array.last(node.body);continue}break}return node}}function visitLoopBody(loop,body){var jump,last;last=getForwardLastNode(body);if(last){if(last.type===Syntax.ContinueStatement){jump=status.jumps.lookupContinuableTarget(last.label);if(jump===loop){modified=true;common.convertToEmptyStatement(last)}}}return visit(body)}function visit(target){var live=false;if(!target){return!status.isDead()}function eliminate(node,array){var i,iz,stmt,ret,info,result;result=[];for(i=0,iz=array.length;i<iz;++i){stmt=array[i];if(stmt.type===Syntax.IfStatement){info=new Context(stmt);ret=visit(stmt);info.detach()}else{ret=visit(stmt)}if(ret){live|=1;result.push(stmt);if(stmt.type===Syntax.IfStatement&&stmt.alternate){if((!info.consequent||!info.alternate)&&info.consequent!==info.alternate){modified=true;if(info.consequent){stmt.test=common.moveLocation(stmt.test,{type:Syntax.UnaryExpression,operator:"!",argument:stmt.test});result.push(stmt.consequent);stmt.consequent=stmt.alternate;stmt.alternate=null}else{result.push(stmt.alternate);stmt.alternate=null}}}}else{modified=true}}return result}common.traverse(target,{enter:function enter(node){var i,iz,stmt,consequent,alternate,ctx,hasDefaultClause;if(Status.isRequired(node)){status=new Status(status)}live|=!status.isDead();switch(node.type){case Syntax.Program:node.body=eliminate(node,node.body);return common.VisitorOption.Skip;case Syntax.BlockStatement:status.jumps.push(new JumpTarget(node,status,JumpTarget.NAMED_ONLY));node.body=eliminate(node,node.body);status.jumps.pop();status.resolveJump(node);return common.VisitorOption.Skip;case Syntax.BreakStatement:if(node.label&&status.labels&&status.labels.indexOf(node.label)){modified=true;common.convertToEmptyStatement(node)}else{status.jumpTo(status.jumps.lookupBreakableTarget(node.label))}return common.VisitorOption.Skip;case Syntax.CatchClause:live|=visit(node.body);return common.VisitorOption.Skip;case Syntax.ContinueStatement:status.jumpTo(status.jumps.lookupContinuableTarget(node.label));return common.VisitorOption.Skip;case Syntax.DoWhileStatement:status.jumps.push(new JumpTarget(node,status,JumpTarget.ITERATION));live|=visitLoopBody(node,node.body);status.jumps.pop();live|=visit(node.test);status.resolveJump(node);status.revive();return common.VisitorOption.Skip;case Syntax.DebuggerStatement:return common.VisitorOption.Skip;case Syntax.EmptyStatement:return common.VisitorOption.Skip;case Syntax.ExpressionStatement:break;case Syntax.ForStatement:live|=visit(node.init);live|=visit(node.test);status.jumps.push(new JumpTarget(node,status,JumpTarget.ITERATION));live|=visitLoopBody(node,node.body);status.jumps.pop();live|=visit(node.update);status.resolveJump(node);status.revive();return common.VisitorOption.Skip;case Syntax.ForInStatement:live|=visit(node.left);live|=visit(node.right);status.jumps.push(new JumpTarget(node,status,JumpTarget.ITERATION));live|=visitLoopBody(node,node.body);status.jumps.pop();status.resolveJump(node);status.revive();return common.VisitorOption.Skip;case Syntax.IfStatement:live|=visit(node.test);live|=visit(node.consequent);if(!node.alternate){status.revive();return common.VisitorOption.Skip}consequent=!status.isDead();if(!status.revive()){status.insert(node)}live|=visit(node.alternate);alternate=!status.isDead();if(status.erase(node)){status.revive()}if(ctx=Context.lookup(node)){ctx.consequent=consequent;ctx.alternate=alternate}return common.VisitorOption.Skip;case Syntax.LabeledStatement:status.register(node);break;case Syntax.ReturnStatement:live|=visit(node.argument);status.kill();return common.VisitorOption.Skip;case Syntax.SwitchStatement:visit(node.discriminant);status.jumps.push(new JumpTarget(node,status,JumpTarget.SWITCH));for(i=0,iz=node.cases.length;i<iz;++i){stmt=node.cases[i];live|=visit(stmt);if(!stmt.test){hasDefaultClause=true}if(status.isDead()&&i+1<iz){status.next()}}status.jumps.pop();status.resolveJump(node);if(status.isDead()&&!hasDefaultClause){status.next()}return common.VisitorOption.Skip;case Syntax.SwitchCase:if(node.test){live|=visit(node.test)}node.consequent=eliminate(node,node.consequent);return common.VisitorOption.Skip;case Syntax.ThrowStatement:live|=visit(node.argument);status.kill();return common.VisitorOption.Skip;case Syntax.TryStatement:live|=visit(node.block);if(node.handlers&&node.handlers.length){if(!status.revive()){status.insert(node)}node.handlers=eliminate(node,node.handlers);if(status.erase(node)){status.revive()}}if(node.finalizer){if(!status.revive()){status.insert(node)}live|=visit(node.finalizer);if(!status.erase(node)){status.kill()}}return common.VisitorOption.Skip;case Syntax.WhileStatement:live|=visit(node.test);status.jumps.push(new JumpTarget(node,status,JumpTarget.ITERATION));live|=visitLoopBody(node,node.body);status.jumps.pop();status.resolveJump(node);status.revive();return common.VisitorOption.Skip;case Syntax.WithStatement:break;case Syntax.VariableDeclaration:case Syntax.FunctionDeclaration:live=true;break}},leave:function leave(node){if(Status.isRequired(node)){status=status.upper;return}if(node.type===Syntax.LabeledStatement){status.unregister()}}});return live}function deadCodeElimination(tree,options){var result;result=options.get("destructive",{pathName:Name})?tree:common.deepCopy(tree);status=null;modified=false;visit(result);common.assert(status===null,"status should be null");return{result:result,modified:modified}}deadCodeElimination.passName=Name;module.exports=deadCodeElimination})()},{"../common":70}],78:[function(require,module,exports){(function(){"use strict";var Name,Syntax,common,modified,escope,evaluator;Name="drop-variable-definition";common=require("../common");escope=require("escope");evaluator=require("../evaluator");Syntax=common.Syntax;function getCandidates(scope){var i,iz,j,jz,identifiers,slots,v;if(!scope.candidates){slots=[];identifiers=[];for(i=0,iz=scope.variables.length;i<iz;++i){v=scope.variables[i];for(j=0,jz=v.identifiers.length;j<jz;++j){identifiers.push(v.identifiers[j]);slots.push(v)}}scope.candidates={slots:slots,identifiers:identifiers}}return scope.candidates}function isRemovableDefinition(slot){var i,iz,ref,parent;if(slot.identifiers.length!==1){return false}if(slot.references.length===0){return true}for(i=0,iz=slot.references.length;i<iz;++i){ref=slot.references[i];if(ref.isRead()){return false}if(ref.isWrite()){if(!ref.writeExpr){return false}parent=ref.writeExpr.__$parent$__;if(!parent){return false}if(parent.type!==Syntax.AssignmentExpression&&parent.type!==Syntax.VariableDeclarator){return false}if(evaluator.hasSideEffect(ref.writeExpr,ref.from)){return false}}}return true}function overrideExpression(from,to){var key;for(key in from){delete from[key]}for(key in to){from[key]=to[key]}return from}function removeDefinition(node,index,slot){var i,iz,ref,parent;node.declarations.splice(index,1);for(i=0,iz=slot.references.length;i<iz;++i){ref=slot.references[i];common.assert(!ref.isRead());if(ref.isWrite()){parent=ref.writeExpr.__$parent$__;if(parent.type===Syntax.AssignmentExpression){overrideExpression(ref.writeExpr.__$parent$__,ref.writeExpr)}}}}function attachParent(tree){return common.traverse(tree,{enter:function(node,parent){node.__$parent$__=parent}})}function removeParent(tree){return common.traverse(tree,{enter:function(node){delete node.__$parent$__;delete node.__$escope$__}})}function dropVariableDefinition(tree,options){var result,manager,scope;result=options.get("destructive",{pathName:Name})?tree:common.deepCopy(tree);modified=false;scope=null;manager=escope.analyze(result,{directive:true});manager.attach();attachParent(result);result=common.replace(result,{enter:function enter(node,parent){var i,decl,cand,index,slot,ret;ret=node;if(scope){if(scope.variableScope.isStatic()){cand=getCandidates(scope.variableScope);if(node.type===Syntax.VariableDeclaration&&node.kind==="var"){i=node.declarations.length;while(i--){decl=node.declarations[i];index=cand.identifiers.indexOf(decl.id);if(index!==-1){slot=cand.slots[index];if(isRemovableDefinition(slot)){modified=true;removeDefinition(node,i,slot);continue}}}if(node.declarations.length===0){if(parent.type===Syntax.ForStatement){ret=null}else{ret=common.moveLocation(node,{type:Syntax.EmptyStatement})}}}if(node.type===Syntax.FunctionDeclaration){index=cand.identifiers.indexOf(node.id);if(index!==-1){slot=cand.slots[index];if(slot.identifiers.length===1&&slot.references.length===0){modified=true;ret=common.moveLocation(node,{type:Syntax.EmptyStatement});return ret}}}}}scope=manager.acquire(node)||scope;return ret},leave:function leave(node){scope=manager.release(node)||scope}});manager.detach();removeParent(result);return{result:result,modified:modified}}dropVariableDefinition.passName=Name;module.exports=dropVariableDefinition})()},{"../common":70,"../evaluator":72,escope:66}],79:[function(require,module,exports){(function(){"use strict";var Name,Syntax,Map,common,modified;Name="eliminate-duplicate-function-declarations";common=require("../common");Map=require("../map");Syntax=common.Syntax;function unique(map,root){return common.replace(root,{enter:function(node){var name,info;if(node.type===Syntax.FunctionDeclaration){name=node.id.name;info=map.get(name);--info.count;if(info.count!==0){modified=true;return common.moveLocation(node,{type:Syntax.EmptyStatement})}}if(node!==root&&node.type===Syntax.BlockStatement){return this.skip()}}})}function uniqueInGlobal(map,root){return common.replace(root,{enter:function(node){var name,info,first;if(node.type===Syntax.FunctionDeclaration){name=node.id.name;info=map.get(name);first=info.count===info.declarations.length;--info.count;if(info.declarations.length>1){if(first){modified=true;return common.Array.last(info.declarations)}else{modified=true;return common.moveLocation(node,{type:Syntax.EmptyStatement})}}}if(node!==root&&node.type===Syntax.BlockStatement){return this.skip()}}})}function main(tree,options){var result,stack,functionDepth,globalBlockFound;result=options.get("destructive",{pathName:Name})?tree:common.deepCopy(tree);modified=false;functionDepth=0;globalBlockFound=false;stack=[new Map];result=common.replace(result,{enter:function enter(node){var map,name,info;if(node.type===Syntax.FunctionDeclaration){name=node.id.name;map=common.Array.last(stack);if(map.has(name)){info=map.get(name);info.declarations.push(node);++info.count}else{info={declarations:[node],count:1};map.set(name,info)}}if(node.type===Syntax.BlockStatement){stack.push(new Map)}if(node.type===Syntax.FunctionDeclaration||node.type===Syntax.FunctionExpression){++functionDepth}},leave:function leave(node){var map,ret;if(node.type===Syntax.BlockStatement){map=stack.pop();if(functionDepth===0){if(map.keys().length!==0){globalBlockFound=true}}else{ret=unique(map,node)}}if(node.type===Syntax.FunctionDeclaration||node.type===Syntax.FunctionExpression){--functionDepth}return ret}});common.assert(stack.length===1,"global map remains");if(!globalBlockFound){result=uniqueInGlobal(stack[0],result)}return{result:result,modified:modified}}main.passName=Name;module.exports=main})()},{"../common":70,"../map":73}],80:[function(require,module,exports){(function(){"use strict";var Name,Syntax,common,escope,modified;Name="hoist-variable-to-arguments";escope=require("escope");common=require("../common");Syntax=common.Syntax;function hoist(callee){function hoisting(ident){var hoisted,i,iz;hoisted=false;for(i=0,iz=callee.params.length;i<iz;++i){if(ident.name===callee.params[i].name){hoisted=true;break}}if(!hoisted){callee.params.push(ident)}}callee.body=common.replace(callee.body,{enter:function(node,parent){var i,iz,expressions,declaration,forstmt,expr;if(node.type===Syntax.FunctionExpression||node.type===Syntax.FunctionDeclaration){this.skip();return}if(node.type===Syntax.VariableDeclaration&&node.kind==="var"){if(parent.type===Syntax.ForInStatement){common.assert(node.declarations.length===1,"for-in declaration length should be 1");declaration=node.declarations[0];if(declaration.init){return}if(declaration.id.type!==Syntax.Identifier){return}hoisting(declaration.id);modified=true;return declaration.id}forstmt=parent.type===Syntax.ForStatement;expressions=[];for(i=0,iz=node.declarations.length;i<iz;++i){declaration=node.declarations[i];if(declaration.id.type!==Syntax.Identifier){return}hoisting(declaration.id);if(declaration.init){expressions.push(common.moveLocation(declaration,{type:Syntax.AssignmentExpression,operator:"=",left:declaration.id,right:declaration.init}))}}modified=true;if(expressions.length===0){if(forstmt){return null}return common.moveLocation(node,{type:Syntax.EmptyStatement})}if(expressions.length===1){expr=expressions[0]}else{expr=common.moveLocation(node,{type:Syntax.SequenceExpression,expressions:expressions})}if(forstmt){return expr}return common.moveLocation(node,{type:Syntax.ExpressionStatement,expression:expr})}}})}function hoistVariableToArguments(tree,options){var result,scope,manager;result=options.get("destructive",{pathName:Name})?tree:common.deepCopy(tree);modified=false;scope=null;manager=escope.analyze(result,{directive:true});manager.attach();common.traverse(result,{enter:function enter(node){var callee;if(node.type===Syntax.CallExpression||node.type===Syntax.NewExpression){callee=node.callee;if(callee.type===Syntax.FunctionExpression&&!callee.id){if(callee.params.length===node["arguments"].length){scope=manager.acquire(callee);if(!scope.isArgumentsMaterialized()&&(node.type!==Syntax.NewExpression||!scope.isThisMaterialized())){hoist(callee)}}}}}});manager.detach();return{result:result,modified:modified}}hoistVariableToArguments.passName=Name;module.exports=hoistVariableToArguments})()},{"../common":70,escope:66}],81:[function(require,module,exports){(function(){"use strict";var Name,Syntax,common,modified;Name="reduce-branch-jump";common=require("../common");Syntax=common.Syntax;function reduceLast(ary,index){var node,left;node=ary[index];if(node.type===Syntax.IfStatement){if(!node.alternate){if(node.consequent.type===Syntax.ReturnStatement){modified=true;left=node.consequent.argument;if(!left){ary[index]=common.moveLocation(node,{type:Syntax.ReturnStatement,argument:{type:Syntax.SequenceExpression,expressions:[node.test,common.SpecialNode.generateUndefined()]}});return true}ary[index]=common.moveLocation(node,{type:Syntax.ReturnStatement,argument:{type:Syntax.ConditionalExpression,test:node.test,consequent:left,alternate:common.SpecialNode.generateUndefined()}});return true}}}}function reduce(ary,index){var node,sibling,left,right;node=ary[index];sibling=ary[index+1];if(node.type===Syntax.IfStatement){if(!node.alternate){if(node.consequent.type===Syntax.ReturnStatement&&sibling.type===Syntax.ReturnStatement){modified=true;ary.splice(index,1);left=node.consequent.argument;right=sibling.argument;if(!left&&!right){ary[index]=common.moveLocation(node,{type:Syntax.ReturnStatement,argument:{type:Syntax.SequenceExpression,expressions:[node.test,common.SpecialNode.generateUndefined()]}});return true}if(!left){left=common.SpecialNode.generateUndefined()}if(!right){right=common.SpecialNode.generateUndefined()}ary[index]=common.moveLocation(node,{type:Syntax.ReturnStatement,argument:{type:Syntax.ConditionalExpression,test:node.test,consequent:left,alternate:right}});return true}}}return false}function reduceBranchJump(tree,options){var result;result=options.get("destructive",{pathName:Name})?tree:common.deepCopy(tree);modified=false;common.traverse(result,{leave:function leave(node,parent){var i;switch(node.type){case Syntax.BlockStatement:case Syntax.Program:i=0;while(i<node.body.length-1){if(!reduce(node.body,i)){++i}}if(common.isFunctionBody(node,parent)){if(node.body.length>0){i=node.body.length-1;reduceLast(node.body,i)}}break;case Syntax.SwitchCase:i=0;while(i<node.consequent.length-1){if(!reduce(node.consequent,i)){++i}}break}}});return{result:result,modified:modified}}reduceBranchJump.passName=Name;module.exports=reduceBranchJump})()},{"../common":70}],82:[function(require,module,exports){(function(){"use strict";var Name,Syntax,common,modified;Name="reduce-multiple-if-statements";common=require("../common");Syntax=common.Syntax;function reduceMultipleIfStatements(tree,options){var result;result=options.get("destructive",{pathName:Name})?tree:common.deepCopy(tree);modified=false;common.traverse(result,{leave:function leave(node){if(node.type===Syntax.IfStatement&&!node.alternate&&node.consequent.type===Syntax.IfStatement&&!node.consequent.alternate){modified=true;node.test={type:Syntax.LogicalExpression,operator:"&&",left:node.test,right:node.consequent.test};node.consequent=node.consequent.consequent}}});return{result:result,modified:modified}}reduceMultipleIfStatements.passName=Name;module.exports=reduceMultipleIfStatements})()},{"../common":70}],83:[function(require,module,exports){(function(){"use strict";var Name,Syntax,common,evaluator,escope,modified;Name="reduce-sequence-expression";escope=require("escope");common=require("../common");evaluator=require("../evaluator");Syntax=common.Syntax;function reduce(node){var i,iz,j,jz,expr,result;result=[];for(i=0,iz=node.expressions.length;i<iz;++i){expr=node.expressions[i];if(expr.type===Syntax.SequenceExpression){modified=true;common.deleteLocation(node);for(j=0,jz=expr.expressions.length;j<jz;++j){result.push(expr.expressions[j])}}else{result.push(expr)}}node.expressions=result}function isLoadSideEffectFree(node,scope){var ref,value;if(evaluator.constant.isConstant(node)){value=evaluator.constant.evaluate(node);if(value===null||typeof value!=="object"){return true}}if(node.type===Syntax.Identifier){ref=scope.resolve(node);return ref&&ref.isStatic()}return false}function isStoreSideEffectFree(node,scope){if(!evaluator.hasSideEffect(node,scope)){return true}if(node.type===Syntax.Identifier){return true}if(node.type===Syntax.MemberExpression){if(!evaluator.hasSideEffect(node.object,scope)){if(!node.computed||isLoadSideEffectFree(node.property,scope)){return true}}return false}return false}function reduceSequenceExpression(tree,options){var result,scope,manager;result=options.get("destructive",{pathName:Name})?tree:common.deepCopy(tree);modified=false;scope=null;manager=escope.analyze(result,{directive:true});manager.attach();result=common.replace(result,{enter:function enter(node){scope=manager.acquire(node)||scope},leave:function leave(node){var result,last;switch(node.type){case Syntax.SequenceExpression:reduce(node);break;case Syntax.ConditionalExpression:if(node.test.type===Syntax.SequenceExpression){modified=true;result=node.test;node.test=common.Array.last(result.expressions);result.expressions[result.expressions.length-1]=node}break;case Syntax.LogicalExpression:if(node.left.type===Syntax.SequenceExpression){modified=true;result=node.left;node.left=common.Array.last(result.expressions);result.expressions[result.expressions.length-1]=node}break;case Syntax.BinaryExpression:if(node.left.type===Syntax.SequenceExpression){modified=true;result=node.left;node.left=common.Array.last(result.expressions);result.expressions[result.expressions.length-1]=node}else if(node.right.type===Syntax.SequenceExpression&&!evaluator.hasSideEffect(node.left,scope)){modified=true;result=node.right;node.right=common.Array.last(result.expressions);result.expressions[result.expressions.length-1]=node}break;case Syntax.UpdateExpression:case Syntax.UnaryExpression:if(node.argument.type===Syntax.SequenceExpression){last=common.Array.last(node.argument.expressions);if(!common.SpecialNode.canExtractSequence(last,node,scope)){break}modified=true;result=node.argument;node.argument=common.Array.last(result.expressions);result.expressions[result.expressions.length-1]=node}break;case Syntax.AssignmentExpression:if(node.operator==="="&&node.right.type===Syntax.SequenceExpression&&isStoreSideEffectFree(node.left,scope)){modified=true;result=node.right;node.right=common.Array.last(result.expressions);result.expressions[result.expressions.length-1]=node}break}scope=manager.release(node)||scope;return result}});manager.detach();return{result:result,modified:modified}}reduceSequenceExpression.passName=Name;module.exports=reduceSequenceExpression})()},{"../common":70,"../evaluator":72,escope:66}],84:[function(require,module,exports){(function(){"use strict";var Name,Syntax,common,evaluator,escope,modified;Name="remove-context-sensitive-expressions";common=require("../common");evaluator=require("../evaluator");escope=require("escope");Syntax=common.Syntax;function Transformer(trans,booleanFunction,voidFunction,scope){this.transform=trans;this.booleanFunction=booleanFunction;this.voidFunction=voidFunction;this.scope=scope}Transformer.prototype.booleanTransformation=function(expr){var consequent;do{if(expr.type===Syntax.UnaryExpression){if(expr.operator==="!"&&expr.argument.type===Syntax.UnaryExpression&&expr.argument.operator==="!"){modified=true;expr=expr.argument.argument;continue}}else if(expr.type===Syntax.LogicalExpression){if(expr.left.type===Syntax.UnaryExpression&&expr.left.operator==="!"&&expr.right.type===Syntax.UnaryExpression&&expr.right.operator==="!"){modified=true;expr.left=expr.left.argument;expr.right=expr.right.argument;expr.operator=expr.operator==="||"?"&&":"||";expr=common.moveLocation(expr,{type:Syntax.UnaryExpression,operator:"!",argument:expr});continue}}else if(expr.type===Syntax.ConditionalExpression){if(expr.test.type===Syntax.UnaryExpression&&expr.test.operator==="!"){modified=true;expr.test=expr.test.argument;consequent=expr.consequent;expr.consequent=expr.alternate;expr.alternate=consequent}}break}while(true);return expr};Transformer.prototype.voidTransformation=function(expr){var leftHasSideEffect,rightHasSideEffect;do{expr=this.booleanTransformation(expr);if(expr.type===Syntax.UnaryExpression){if(expr.operator==="!"||expr.operator==="void"){modified=true;expr=expr.argument;continue}}else if(expr.type===Syntax.LogicalExpression){if(expr.left.type===Syntax.UnaryExpression&&expr.left.operator==="!"){modified=true;expr.left=expr.left.argument;expr.operator=expr.operator==="||"?"&&":"||"}}else if(expr.type===Syntax.ConditionalExpression){leftHasSideEffect=evaluator.hasSideEffect(expr.consequent,this.scope);rightHasSideEffect=evaluator.hasSideEffect(expr.alternate,this.scope);if(!leftHasSideEffect&&!rightHasSideEffect){modified=true;expr=expr.test}else if(!leftHasSideEffect){modified=true;expr=common.moveLocation(expr,{type:Syntax.LogicalExpression,operator:"||",left:expr.test,right:expr.alternate})}else if(!rightHasSideEffect){modified=true;expr=common.moveLocation(expr,{type:Syntax.LogicalExpression,operator:"&&",left:expr.test,right:expr.consequent})}}break}while(true);return expr};Transformer.prototype.apply=function(expr){var prev;do{prev=expr;expr=this.transform(expr);if(prev!==expr){continue}if(expr.type===Syntax.LogicalExpression){expr.left=this.booleanFunction(expr.left,this.scope);expr.right=this.voidFunction(expr.right,this.scope)}else if(expr.type===Syntax.ConditionalExpression){expr.consequent=this.voidFunction(expr.consequent,this.scope);expr.alternate=this.voidFunction(expr.alternate,this.scope)}else if(expr.type===Syntax.SequenceExpression){expr.expressions[expr.expressions.length-1]=this.voidFunction(common.Array.last(expr.expressions),this.scope)}break}while(true);return expr};function voidContext(expr,scope){var trans=new Transformer(Transformer.prototype.voidTransformation,booleanContext,voidContext,scope);return trans.apply(expr)}function booleanContext(expr,scope){var trans=new Transformer(Transformer.prototype.booleanTransformation,booleanContext,booleanContext,scope);return trans.apply(expr)}function removeContextSensitiveExpressions(tree,options){var result,stackCount,preserveCompletionValue,scope,manager;result=options.get("destructive",{pathName:Name})?tree:common.deepCopy(tree);modified=false;stackCount=0;preserveCompletionValue=options.get("preserveCompletionValue",{pathName:Name});scope=null;manager=escope.analyze(result,{directive:true});manager.attach();result=common.replace(result,{enter:function enter(node){var i,iz;scope=manager.acquire(node)||scope;if(node.type===Syntax.FunctionExpression||node.type===Syntax.FunctionDeclaration){++stackCount}switch(node.type){case Syntax.AssignmentExpression:break;case Syntax.ArrayExpression:break;case Syntax.BlockStatement:break;case Syntax.BinaryExpression:break;case Syntax.BreakStatement:break;case Syntax.CallExpression:break;case Syntax.CatchClause:break;case Syntax.ConditionalExpression:node.test=booleanContext(node.test,scope);break;case Syntax.ContinueStatement:break;case Syntax.DoWhileStatement:node.test=booleanContext(node.test,scope);break;case Syntax.DebuggerStatement:break;case Syntax.EmptyStatement:break;case Syntax.ExpressionStatement:if(!preserveCompletionValue||stackCount!==0){node.expression=voidContext(node.expression,scope)}break;case Syntax.FunctionExpression:break;case Syntax.ForInStatement:break;case Syntax.FunctionDeclaration:break;case Syntax.ForStatement:if(node.init&&node.init.type!==Syntax.VariableDeclaration){node.init=voidContext(node.init,scope)}if(node.test){node.test=booleanContext(node.test,scope)}if(node.update){node.update=voidContext(node.update,scope)}break;case Syntax.Identifier:break;case Syntax.IfStatement:node.test=booleanContext(node.test,scope);break;case Syntax.Literal:break;case Syntax.LabeledStatement:break;case Syntax.LogicalExpression:break;case Syntax.MemberExpression:break;case Syntax.NewExpression:break;case Syntax.ObjectExpression:break;case Syntax.Program:break;case Syntax.Property:break;case Syntax.ReturnStatement:break;case Syntax.SequenceExpression:for(i=0,iz=node.expressions.length-1;i<iz;++i){node.expressions[i]=voidContext(node.expressions[i],scope)}break;case Syntax.SwitchStatement:break;case Syntax.SwitchCase:break;case Syntax.ThisExpression:break;case Syntax.ThrowStatement:break;case Syntax.TryStatement:break;case Syntax.UnaryExpression:if(node.operator==="!"){node.argument=booleanContext(node.argument,scope)}else if(node.operator==="void"){node.argument=voidContext(node.argument,scope)}break;case Syntax.UpdateExpression:break;case Syntax.VariableDeclaration:break;case Syntax.VariableDeclarator:break;case Syntax.WhileStatement:node.test=booleanContext(node.test,scope);break;case Syntax.WithStatement:break}},leave:function leave(node){scope=manager.release(node)||scope;if(node.type===Syntax.FunctionExpression||node.type===Syntax.FunctionDeclaration){--stackCount}}});manager.detach();return{result:result,modified:modified}}removeContextSensitiveExpressions.passName=Name;module.exports=removeContextSensitiveExpressions})()},{"../common":70,"../evaluator":72,escope:66}],85:[function(require,module,exports){(function(){"use strict";var Name,Syntax,common,modified;Name="remove-empty-statement";common=require("../common");Syntax=common.Syntax;function remove(array){var i,iz,node,result;result=[];for(i=0,iz=array.length;i<iz;++i){node=array[i];if(node.type===Syntax.EmptyStatement){modified=true}else{result.push(node)}}return result}function removeAlternate(node){if(node.alternate){if(node.alternate.type===Syntax.EmptyStatement){modified=true;node.alternate=null}else if(node.consequent.type===Syntax.EmptyStatement){modified=true;node.consequent=node.alternate;node.alternate=null;node.test=common.moveLocation(node.test,{type:Syntax.UnaryExpression,operator:"!",argument:node.test})}}}function removeEmptyStatement(tree,options){var result;modified=false;result=options.get("destructive",{pathName:Name})?tree:common.deepCopy(tree);common.traverse(result,{enter:function enter(node){var clause;switch(node.type){case Syntax.BlockStatement:case Syntax.Program:node.body=remove(node.body);break;case Syntax.SwitchCase:node.consequent=remove(node.consequent);break;case Syntax.IfStatement:removeAlternate(node);break;case Syntax.SwitchStatement:if(node.cases.length){clause=common.Array.last(node.cases);if(!clause.test&&common.Array.empty(clause.consequent)){modified=true;node.cases.pop()}}}}});return{result:result,modified:modified}}removeEmptyStatement.passName=Name;module.exports=removeEmptyStatement})()},{"../common":70}],86:[function(require,module,exports){(function(){"use strict";var Name,Syntax,common,escope,evaluator,modified;Name="remove-side-effect-free-expressions";escope=require("escope");common=require("../common");evaluator=require("../evaluator");Syntax=common.Syntax;function reduce(node,scope,parent,isResultNeeded){var i,iz,expr,result,prev;common.assert(node.expressions.length>1,"expressions should be more than one");result=[];for(i=0,iz=node.expressions.length;i<iz;++i){prev=expr;expr=node.expressions[i];if(i+1!==iz||!isResultNeeded){if(!evaluator.hasSideEffect(expr,scope)){continue}}result.push(expr)}if(!isResultNeeded&&result.length===0){modified=true;return expr}common.assert(result.length>0,"result should be more than zero");do{if(iz===result.length){return node}if(result.length===1){if(!common.SpecialNode.canExtractSequence(result[0],parent,scope)){result.unshift(prev);continue}modified=true;return result[0]}modified=true;node.expressions=result;return node}while(true)}function removeSideEffectFreeExpressions(tree,options){var result,scope,manager,preserveCompletionValue;function isResultNeeded(parent,scope){if(parent.type===Syntax.ExpressionStatement&&(!preserveCompletionValue||scope.type!=="global")){return false}return true}result=options.get("destructive",{pathName:Name})?tree:common.deepCopy(tree);preserveCompletionValue=options.get("preserveCompletionValue",{pathName:Name});modified=false;scope=null;manager=escope.analyze(result,{directive:true});manager.attach();result=common.replace(result,{enter:function enter(node,parent){var res,unary,trans;res=node;scope=manager.acquire(node)||scope;if(res.type===Syntax.SequenceExpression){res=reduce(res,scope,parent,isResultNeeded(parent,scope))}if(res.type===Syntax.SequenceExpression){common.assert(res.expressions.length>1,"sequences' length should be more than 1");unary=common.Array.last(res.expressions);if(unary.type===Syntax.UnaryExpression&&unary.operator==="void"&&!evaluator.hasSideEffect(unary.argument,scope)){modified=true;res.expressions.pop();trans=common.moveLocation(unary,{type:Syntax.UnaryExpression,operator:"void",argument:common.Array.last(res.expressions)});if(res.expressions.length===1){res=trans}else{res.expressions[res.expressions.length-1]=trans}}}if(!isResultNeeded(res,scope)){if(!evaluator.hasSideEffect(res.expression,scope)){modified=true;res=common.moveLocation(res,{type:Syntax.EmptyStatement})}}return res},leave:function leave(node){scope=manager.release(node)||scope}});manager.detach();return{result:result,modified:modified}}removeSideEffectFreeExpressions.passName=Name;module.exports=removeSideEffectFreeExpressions})()},{"../common":70,"../evaluator":72,escope:66}],87:[function(require,module,exports){(function(){"use strict";var Name,Syntax,common,escope,evaluator,modified;Name="remove-unreachable-branch";escope=require("escope");common=require("../common");evaluator=require("../evaluator");Syntax=common.Syntax;function handleIfStatement(func,node){var test,body,decl;test=evaluator.booleanCondition(node.test);if(!node.alternate){if(typeof test==="boolean"){modified=true;body=[];if(test){body.push(common.moveLocation(node.test,{type:Syntax.ExpressionStatement,expression:node.test}),node.consequent);return{type:Syntax.BlockStatement,body:body}}else{decl=common.delegateVariableDeclarations(node.consequent,func);if(decl){body.push(decl)}body.push(common.moveLocation(node.test,{type:Syntax.ExpressionStatement,expression:node.test}));return{type:Syntax.BlockStatement,body:body}}}}else{if(typeof test==="boolean"){modified=true;body=[];if(test){decl=common.delegateVariableDeclarations(node.alternate,func);if(decl){body.push(decl)}body.push(common.moveLocation(node.test,{type:Syntax.ExpressionStatement,expression:node.test}),node.consequent);return{type:Syntax.BlockStatement,body:body}}else{decl=common.delegateVariableDeclarations(node.consequent,func);if(decl){body.push(decl)}body.push(common.moveLocation(node.test,{type:Syntax.ExpressionStatement,expression:node.test}),node.alternate);return{type:Syntax.BlockStatement,body:body}}}}}function handleLogicalExpression(func,node){var test;test=evaluator.booleanCondition(node.left);if(typeof test==="boolean"){modified=true;if(test){if(node.operator==="&&"){return common.moveLocation(node,{type:Syntax.SequenceExpression,expressions:[node.left,node.right]})}else{return node.left}}else{if(node.operator==="&&"){return node.left}else{return common.moveLocation(node,{type:Syntax.SequenceExpression,expressions:[node.left,node.right]})}}}}function handleConditionalExpression(func,node){var test;test=evaluator.booleanCondition(node.test);if(typeof test==="boolean"){modified=true;if(test){return common.moveLocation(node,{type:Syntax.SequenceExpression,expressions:[node.test,node.consequent]})}else{return common.moveLocation(node,{type:Syntax.SequenceExpression,expressions:[node.test,node.alternate]})}}}function removeUnreachableBranch(tree,options){var result,stack;result=options.get("destructive",{pathName:Name})?tree:common.deepCopy(tree);modified=false;stack=[];result=common.replace(result,{enter:function enter(node){var func;if(escope.Scope.isVariableScopeRequired(node)){stack.push(node);return}func=common.Array.last(stack);switch(node.type){case Syntax.IfStatement:return handleIfStatement(func,node);case Syntax.LogicalExpression:return handleLogicalExpression(func,node);case Syntax.ConditionalExpression:return handleConditionalExpression(func,node)}},leave:function leave(node){if(escope.Scope.isVariableScopeRequired(node)){stack.pop()}}});return{result:result,modified:modified}}removeUnreachableBranch.passName=Name;module.exports=removeUnreachableBranch})()},{"../common":70,"../evaluator":72,escope:66}],88:[function(require,module,exports){(function(){"use strict";var Name,Syntax,Map,common,scope,modified;Name="remove-unused-label";common=require("../common");Map=require("../map");Syntax=common.Syntax;function Scope(upper){this.set=new Map;this.unused=[];this.upper=upper}Scope.prototype.register=function register(node){var name;common.assert(node.type===Syntax.LabeledStatement);name=node.label.name;common.assert(!this.set.has(name),"duplicate label is found");this.set.set(name,{used:false,stmt:node})};Scope.prototype.unregister=function unregister(node){var name,ref;if(node.type===Syntax.LabeledStatement){name=node.label.name;ref=this.set.get(name);this.set["delete"](name);if(!ref.used){modified=true;return node.body}}return node};Scope.prototype.resolve=function resolve(node){var name;if(node.label){name=node.label.name;common.assert(this.set.has(name),"unresolved label");this.set.get(name).used=true}};Scope.prototype.close=function close(){return this.upper};function removeUnusedLabel(tree,options){var result;result=options.get("destructive",{pathName:Name})?tree:common.deepCopy(tree);scope=null;modified=false;result=common.replace(result,{enter:function enter(node){switch(node.type){case Syntax.Program:case Syntax.FunctionDeclaration:case Syntax.FunctionExpression:scope=new Scope(scope);break;case Syntax.LabeledStatement:scope.register(node);break;case Syntax.BreakStatement:case Syntax.ContinueStatement:scope.resolve(node);break}},leave:function leave(node){var ret;ret=scope.unregister(node);if(node.type===Syntax.Program||node.type===Syntax.FunctionDeclaration||node.type===Syntax.FunctionExpression){scope=scope.close()}return ret}});return{result:result,modified:modified}}removeUnusedLabel.passName=Name;module.exports=removeUnusedLabel})()},{"../common":70,"../map":73}],89:[function(require,module,exports){(function(){"use strict";var Name,Syntax,common,modified;Name="remove-wasted-blocks";common=require("../common");Syntax=common.Syntax;function flattenBlockStatement(body){var i,iz,j,jz,result,stmt,inner,ok;result=[];for(i=0,iz=body.length;i<iz;++i){stmt=body[i];if(stmt.type===Syntax.BlockStatement){ok=true;for(j=0,jz=stmt.body.length;j<jz;++j){inner=stmt.body[j];if(common.isScopedDeclaration(inner)){ok=false}}if(ok){modified=true;result=result.concat(stmt.body)}else{result.push(stmt)}}else{result.push(stmt)}}return result}function removeWastedBlocks(tree,options){var result;result=options.get("destructive",{pathName:Name})?tree:common.deepCopy(tree);modified=false;result=common.replace(result,{leave:function leave(node,parent){var i,iz,stmt;if(node.type===Syntax.BlockStatement||node.type===Syntax.Program){for(i=0,iz=node.body.length;i<iz;++i){stmt=node.body[i];if(stmt.type===Syntax.BlockStatement){node.body=flattenBlockStatement(node.body);break}}}if(parent.type===Syntax.FunctionDeclaration||parent.type===Syntax.FunctionExpression||parent.type===Syntax.TryStatement||parent.type===Syntax.CatchClause){return}while(node.type===Syntax.BlockStatement&&node.body.length===1&&!common.isScopedDeclaration(node.body[0])){modified=true;node=node.body[0]}if(node.type===Syntax.BlockStatement&&node.body.length===0){modified=true;return{type:Syntax.EmptyStatement}}return node}});return{result:result,modified:modified}}removeWastedBlocks.passName=Name;module.exports=removeWastedBlocks})()},{"../common":70}],90:[function(require,module,exports){(function(){"use strict";var Name,Syntax,common,modified;Name="reordering-function-declarations";common=require("../common");Syntax=common.Syntax;function reordering(array){var i,iz,node,directives,declarations,others;directives=[];declarations=[];others=[];for(i=0,iz=array.length;i<iz;++i){node=array[i];if(node.type===Syntax.FunctionDeclaration){if(declarations.length+directives.length!==i){modified=true}declarations.push(node)}else if(node.type===Syntax.DirectiveStatement){directives.push(node)}else{others.push(node)}}return directives.concat(declarations,others)}function reorderingFunctionDeclarations(tree,options){var result;result=options.get("destructive",{pathName:Name})?tree:common.deepCopy(tree);modified=false;common.traverse(result,{leave:function leave(node){switch(node.type){case Syntax.Program:node.body=reordering(node.body);break;case Syntax.FunctionDeclaration:case Syntax.FunctionExpression:node.body.body=reordering(node.body.body);break}}});return{result:result,modified:modified}}reorderingFunctionDeclarations.passName=Name;module.exports=reorderingFunctionDeclarations})()},{"../common":70}],91:[function(require,module,exports){(function(){"use strict";var Name,Syntax,common,modified;Name="transform-branch-to-expression";common=require("../common");Syntax=common.Syntax;function transformBranchToExpression(tree,options){var result,preserveCompletionValue;result=options.get("destructive",{pathName:Name})?tree:common.deepCopy(tree);preserveCompletionValue=options.get("preserveCompletionValue",{pathName:Name});modified=false;result=common.replace(result,{leave:function leave(node){var consequent,alternate,ancestors;if(node.type===Syntax.IfStatement){ancestors=this.parents();if(preserveCompletionValue&&common.mayBeCompletionValue(node,ancestors)){return}if(node.alternate){if(node.consequent.type===Syntax.ExpressionStatement&&node.alternate.type===Syntax.ExpressionStatement){modified=true;return common.moveLocation(node,{type:Syntax.ExpressionStatement,expression:common.moveLocation(node,{type:Syntax.ConditionalExpression,test:node.test,consequent:node.consequent.expression,alternate:node.alternate.expression})})}if(node.consequent.type===Syntax.ReturnStatement&&node.alternate.type===Syntax.ReturnStatement){modified=true;if(!node.consequent.argument&&!node.alternate.argument){return common.moveLocation(node,{type:Syntax.ReturnStatement,argument:common.moveLocation(node,{type:Syntax.SequenceExpression,expressions:[node.test,common.SpecialNode.generateUndefined()]})})}consequent=node.consequent.argument||common.SpecialNode.generateUndefined();alternate=node.alternate.argument||common.SpecialNode.generateUndefined();return common.moveLocation(node,{type:Syntax.ReturnStatement,argument:common.moveLocation(node,{type:Syntax.ConditionalExpression,test:node.test,consequent:consequent,alternate:alternate})})}if(node.consequent.type===Syntax.ThrowStatement&&node.alternate.type===Syntax.ThrowStatement){modified=true;return common.moveLocation(node,{type:Syntax.ThrowStatement,argument:common.moveLocation(node,{type:Syntax.ConditionalExpression,test:node.test,consequent:node.consequent.argument,alternate:node.alternate.argument})})}}else{if(node.consequent.type===Syntax.ExpressionStatement){modified=true;return common.moveLocation(node,{type:Syntax.ExpressionStatement,expression:common.moveLocation(node,{type:Syntax.LogicalExpression,operator:"&&",left:node.test,right:node.consequent.expression})})}else if(node.consequent.type===Syntax.EmptyStatement){modified=true;return common.moveLocation(node,{type:Syntax.ExpressionStatement,expression:node.test})}}}}});return{result:result,modified:modified}}transformBranchToExpression.passName=Name;module.exports=transformBranchToExpression})()},{"../common":70}],92:[function(require,module,exports){(function(){"use strict";var Name,Syntax,common,modified;Name="transform-dynamic-to-static-property-access";common=require("../common");Syntax=common.Syntax;function transformDynamicToStaticPropertyAccess(tree,options){var result;modified=false;result=options.get("destructive",{pathName:Name})?tree:common.deepCopy(tree);common.traverse(result,{enter:function enter(node){var property;if(node.type===Syntax.MemberExpression&&node.computed){property=node.property;if(property.type===Syntax.Literal&&typeof property.value==="string"){if(common.isIdentifier(property.value)){modified=true;node.computed=false;node.property=common.moveLocation(property,{type:Syntax.Identifier,name:property.value})}else if(property.value===Number(property.value).toString()){modified=true;node.computed=true;node.property=common.moveLocation(node.property,common.SpecialNode.generateFromValue(Number(node.property.value)))}}}}});return{result:result,modified:modified}}transformDynamicToStaticPropertyAccess.passName=Name;module.exports=transformDynamicToStaticPropertyAccess})()},{"../common":70}],93:[function(require,module,exports){(function(){"use strict";var Name,Syntax,common,modified;Name="transform-dynamic-to-static-property-definition";common=require("../common");Syntax=common.Syntax;function transformDynamicToStaticPropertyDefinition(tree,options){var result;result=options.get("destructive",{pathName:Name})?tree:common.deepCopy(tree);modified=false;common.traverse(result,{enter:function enter(node){var generated;if(node.type===Syntax.Property){if(node.key.type===Syntax.Literal&&typeof node.key.value==="string"){if(common.isIdentifier(node.key.value)){modified=true;node.key=common.moveLocation(node.key,{type:Syntax.Identifier,name:node.key.value})}else if(node.key.value===Number(node.key.value).toString()){generated=common.SpecialNode.generateFromValue(Number(node.key.value));if(generated.type===Syntax.Literal){modified=true;node.key=common.moveLocation(node.key,generated)}}}}}});return{result:result,modified:modified}}transformDynamicToStaticPropertyDefinition.passName=Name;module.exports=transformDynamicToStaticPropertyDefinition})()},{"../common":70}],94:[function(require,module,exports){(function(){"use strict";var Name,Syntax,common,modified;Name="transform-immediate-function-call";common=require("../common");Syntax=common.Syntax;function isEmptyFunctionCall(call){var callee,i,iz,stmt;if(call.type!==Syntax.CallExpression){return false}callee=call.callee;if(callee.type!==Syntax.FunctionExpression){return false}if(callee.body.type!==Syntax.BlockStatement){return false}if(callee.body.body.length===0){return true}for(i=0,iz=callee.body.body.length;i<iz;++i){stmt=callee.body.body[i];if(stmt.type!==Syntax.FunctionDeclaration){return false}}return true}function callToSequence(call){var expressions;expressions=common.Array.from(call["arguments"]);if(expressions.length===0){return common.SpecialNode.generateUndefined(call)}expressions.push(common.SpecialNode.generateUndefined());return common.moveLocation(call,{type:Syntax.SequenceExpression,expressions:expressions})}function transformImmediateFunctionCall(tree,options){var result;result=options.get("destructive",{pathName:Name})?tree:common.deepCopy(tree);modified=false;result=common.replace(result,{leave:function leave(node){if(isEmptyFunctionCall(node)){modified=true;return callToSequence(node)}}});return{result:result,modified:modified}}transformImmediateFunctionCall.passName=Name;module.exports=transformImmediateFunctionCall})()},{"../common":70}],95:[function(require,module,exports){(function(){"use strict";var Name,Syntax,common,modified;Name="transform-logical-association";common=require("../common");Syntax=common.Syntax;function transformLogicalAssociation(tree,options){var result;result=options.get("destructive",{pathName:Name})?tree:common.deepCopy(tree);modified=false;common.traverse(result,{enter:function enter(node){if(node.type===Syntax.LogicalExpression){if(node.right.type===Syntax.LogicalExpression&&node.operator===node.right.operator){modified=true;node.left={type:Syntax.LogicalExpression,operator:node.operator,left:node.left,right:node.right.left};node.right=node.right.right}}}});return{result:result,modified:modified}}transformLogicalAssociation.passName=Name;module.exports=transformLogicalAssociation})()},{"../common":70}],96:[function(require,module,exports){(function(){"use strict";var Name,Syntax,common,escope,modified;Name="transform-to-compound-assignment";escope=require("escope");common=require("../common");Syntax=common.Syntax;function equals(lhs,rhs){if(lhs.type!==rhs.type){return false}if(lhs.type===Syntax.Identifier){return lhs.name===rhs.name}return false}function compound(operator){switch(operator){case"*":case"/":case"%":case"+":case"-":case"<<":case">>":case">>>":case"&":case"^":case"|":return operator+"="}return null}function observableCompound(operator){switch(operator){case"*=":case"/=":case"%=":case"+=":case"-=":case"<<=":case">>=":case">>>=":case"&=":case"^=":case"|=":return operator}return null}function transformToCompoundAssignment(tree,options){var result,scope,manager;result=options.get("destructive",{pathName:Name})?tree:common.deepCopy(tree);modified=false;scope=null;manager=escope.analyze(result,{directive:true});manager.attach();common.traverse(result,{enter:function enter(node){var left,right,operator,ref;scope=manager.acquire(node)||scope;if(node.type===Syntax.AssignmentExpression&&node.operator==="="){left=node.left;right=node.right;if(right.type===Syntax.BinaryExpression&&equals(right.left,left)){operator=compound(right.operator);if(operator){modified=true;node.operator=operator;node.right=right.right}}else if(right.type===Syntax.AssignmentExpression&&equals(right.left,left)){if(observableCompound(right.operator)){ref=scope.resolve(node.left);if(ref.isStatic()){modified=true;node.operator=right.operator;node.right=right.right}}}}},leave:function leave(node){scope=manager.release(node)||scope}});manager.detach();return{result:result,modified:modified}}transformToCompoundAssignment.passName=Name;module.exports=transformToCompoundAssignment})()},{"../common":70,escope:66}],97:[function(require,module,exports){(function(){"use strict";var Name,Syntax,common,modified;Name="transform-to-sequence-expression";common=require("../common");Syntax=common.Syntax;function transform(node){var i,iz,expressions,stmt,prev,body;function constructSeq(expressions,stmt){var seq;if(expressions.length!==1){modified=true;seq={type:Syntax.SequenceExpression,expressions:expressions};if(stmt.type===Syntax.ExpressionStatement){stmt.expression=seq}else{stmt.argument=seq}}return stmt}body=[];expressions=[];for(i=0,iz=node.body.length;i<iz;++i){prev=stmt;stmt=node.body[i];if(stmt.type===Syntax.ExpressionStatement){expressions.push(stmt.expression)}else if(stmt.type===Syntax.ReturnStatement&&stmt.argument!=null||stmt.type===Syntax.ThrowStatement){expressions.push(stmt.argument);body.push(constructSeq(expressions,stmt));expressions=[]}else if(stmt.type===Syntax.ForStatement&&(!stmt.init||stmt.init.type!==Syntax.VariableDeclaration)){if(expressions.length){modified=true;if(stmt.init){expressions.push(stmt.init)}if(expressions.length===1){stmt.init=expressions[0]}else{stmt.init={type:Syntax.SequenceExpression,expressions:expressions}}expressions=[]}body.push(stmt)}else if(stmt.type===Syntax.IfStatement){if(expressions.length){modified=true;expressions.push(stmt.test);stmt.test={type:Syntax.SequenceExpression,expressions:expressions};expressions=[]}body.push(stmt)}else{if(expressions.length){body.push(constructSeq(expressions,prev));expressions=[]}body.push(stmt)}}if(expressions.length){body.push(constructSeq(expressions,stmt))}node.body=body}function transformToSequenceExpression(tree,options){var result;modified=false;result=options.get("destructive",{pathName:Name})?tree:common.deepCopy(tree);common.traverse(result,{enter:function enter(node){switch(node.type){case Syntax.BlockStatement:case Syntax.Program:transform(node);break}}});return{result:result,modified:modified}}transformToSequenceExpression.passName=Name;module.exports=transformToSequenceExpression})()},{"../common":70}],98:[function(require,module,exports){(function(){"use strict";var Name,Syntax,common,escope,modified;Name="transform-typeof-undefined";escope=require("escope");common=require("../common");Syntax=common.Syntax;function isUndefinedStringLiteral(node){return node.type===Syntax.Literal&&node.value==="undefined"}function transformTypeofUndefined(tree,options){var result,manager,scope;result=options.get("destructive",{pathName:Name})?tree:common.deepCopy(tree);modified=false;scope=null;manager=escope.analyze(result,{directive:true});manager.attach();common.traverse(result,{enter:function enter(node){var target,undef,argument,ref;scope=manager.acquire(node)||scope;if(node.type===Syntax.BinaryExpression&&(node.operator==="==="||node.operator==="!=="||node.operator==="=="||node.operator==="!=")){if(isUndefinedStringLiteral(node.left)){undef="left";target="right"}else if(isUndefinedStringLiteral(node.right)){undef="right";target="left"}else{return}if(node[target].type===Syntax.UnaryExpression&&node[target].operator==="typeof"){argument=node[target].argument;if(argument.type===Syntax.Identifier){ref=scope.resolve(argument);if(!ref||!ref.isStatic()||!ref.resolved){return}}modified=true;node[undef]=common.SpecialNode.generateUndefined();node[target]=argument;node.operator=node.operator.charAt(0)==="!"?"!==":"==="}}},leave:function leave(node){scope=manager.release(node)||scope}});manager.detach();return{result:result,modified:modified}}transformTypeofUndefined.passName=Name;module.exports=transformTypeofUndefined})()},{"../common":70,escope:66}],99:[function(require,module,exports){(function(){"use strict";var Name,Syntax,common,evaluator,modified;Name="tree-based-constant-folding";common=require("../common");evaluator=require("../evaluator");Syntax=common.Syntax;function isModifiedConstant(node){if(common.SpecialNode.isUndefined(node)){return false}if(common.SpecialNode.isNegative(node)){return false}if(common.SpecialNode.isNaN(node)){return false}return evaluator.constant.isConstant(node,false)}function isFoldableConditional(node){if(node.type!==Syntax.ConditionalExpression){return false}return evaluator.constant.isConstant(node.consequent)||evaluator.constant.isConstant(node.alternate)}function foldConditional(node){var binary,unary,operator,left,right;switch(node.type){case Syntax.BinaryExpression:if(node.operator==="in"||node.operator==="instanceof"){return node}if(evaluator.constant.isConstant(node.left)&&isFoldableConditional(node.right)){modified=true;binary=node;operator=binary.operator;left=evaluator.constant.evaluate(binary.left);node=node.right;if(evaluator.constant.isConstant(node.consequent)){node.consequent=common.SpecialNode.generateFromValue(evaluator.constant.doBinary(operator,left,evaluator.constant.evaluate(node.consequent)))}else{binary.right=node.consequent;node.consequent=binary}if(evaluator.constant.isConstant(node.alternate)){node.alternate=common.SpecialNode.generateFromValue(evaluator.constant.doBinary(operator,left,evaluator.constant.evaluate(node.alternate)))}else{binary.right=node.alternate;node.alternate=binary}}else if(evaluator.constant.isConstant(node.right)&&isFoldableConditional(node.left)){modified=true;binary=node;operator=binary.operator;right=evaluator.constant.evaluate(binary.right);node=node.left;if(evaluator.constant.isConstant(node.consequent)){node.consequent=common.SpecialNode.generateFromValue(evaluator.constant.doBinary(operator,evaluator.constant.evaluate(node.consequent),right))}else{binary.left=node.consequent;node.consequent=binary}if(evaluator.constant.isConstant(node.alternate)){node.alternate=common.SpecialNode.generateFromValue(evaluator.constant.doBinary(operator,evaluator.constant.evaluate(node.alternate),right))}else{binary.left=node.alternate;node.alternate=binary}}break;case Syntax.LogicalExpression:break;case Syntax.UnaryExpression:if(isFoldableConditional(node.argument)){modified=true;unary=node;operator=unary.operator;node=unary.argument;if(evaluator.constant.isConstant(node.consequent)){node.consequent=common.SpecialNode.generateFromValue(evaluator.constant.doUnary(operator,evaluator.constant.evaluate(node.consequent)))}else{unary.argument=node.consequent;node.consequent=unary}if(evaluator.constant.isConstant(node.alternate)){node.alternate=common.SpecialNode.generateFromValue(evaluator.constant.doUnary(operator,evaluator.constant.evaluate(node.alternate)))}else{unary.argument=node.alternate;node.alternate=unary}}break}return node}function treeBasedConstantFolding(tree,options){var result;result=options.get("destructive",{pathName:Name})?tree:common.deepCopy(tree);modified=false;result=common.replace(result,{leave:function leave(node){var con,alt;switch(node.type){case Syntax.BinaryExpression:case Syntax.LogicalExpression:case Syntax.UnaryExpression:if(isModifiedConstant(node)){modified=true;return common.moveLocation(node,common.SpecialNode.generateFromValue(evaluator.constant.evaluate(node)))}return foldConditional(node);case Syntax.ConditionalExpression:if(evaluator.constant.isConstant(node.consequent)&&evaluator.constant.isConstant(node.alternate)){con=evaluator.constant.evaluate(node.consequent);alt=evaluator.constant.evaluate(node.alternate);if(common.sameValue(con,alt)){modified=true;return common.moveLocation(node,{type:Syntax.SequenceExpression,expressions:[node.test,common.SpecialNode.generateFromValue(con)]})}}break}}});return{result:result,modified:modified}}treeBasedConstantFolding.passName=Name;module.exports=treeBasedConstantFolding})()},{"../common":70,"../evaluator":72}],100:[function(require,module,exports){(function(){"use strict";var Name,Syntax,common,modified;Name="omit-parens-in-void-context-iife";common=require("../common");Syntax=common.Syntax;function isIIFE(node){var callee;if(node.type!==Syntax.CallExpression){return false}callee=node.callee;return callee.type===Syntax.FunctionExpression}function main(tree,options){var result,stackCount,preserveCompletionValue;result=options.get("destructive",{pathName:Name})?tree:common.deepCopy(tree);preserveCompletionValue=options.get("preserveCompletionValue",{pathName:Name});modified=false;result=common.replace(result,{enter:function enter(node,parent){var ancestors,target;if(!isIIFE(node)){return}target=parent;if(target.type===Syntax.ExpressionStatement){ancestors=this.parents();ancestors.pop();if(preserveCompletionValue&&common.mayBeCompletionValue(target,ancestors)){return}}else if(target.type===Syntax.SequenceExpression&&target.expressions.length>=2&&target.expressions[0]===node){ancestors=this.parents();ancestors.pop();target=ancestors.pop();if(target.type!==Syntax.ExpressionStatement){return}}else{return}modified=true;return{type:Syntax.UnaryExpression,operator:"!",argument:node}},leave:function leave(node){if(node.type===Syntax.FunctionExpression||node.type===Syntax.FunctionDeclaration){--stackCount}}});return{result:result,modified:modified}}main.passName=Name;module.exports=main})()},{"../common":70}],101:[function(require,module,exports){(function(){"use strict";var Name,Syntax,common,modified;Name="rewrite-boolean";common=require("../common");Syntax=common.Syntax;function isBooleanLiteral(node){return node.type===Syntax.Literal&&typeof node.value==="boolean"}function rewrite(node){if(isBooleanLiteral(node)){modified=true;return common.moveLocation(node,{type:Syntax.UnaryExpression,operator:"!",argument:common.moveLocation(node,{type:Syntax.Literal,value:+!node.value})})}if(node.type===Syntax.BinaryExpression&&node.operator==="=="||node.operator==="!="){if(isBooleanLiteral(node.left)){modified=true;node.left=common.moveLocation(node.left,{type:Syntax.Literal,value:+node.left.value});return node}if(isBooleanLiteral(node.right)){modified=true;node.right=common.moveLocation(node.right,{type:Syntax.Literal,value:+node.right.value});return node}}return node}function rewriteBoolean(tree,options){var result;modified=false;result=options.get("destructive",{pathName:Name})?tree:common.deepCopy(tree);result=common.replace(result,{enter:rewrite});return{result:result,modified:modified}}rewriteBoolean.passName=Name;module.exports=rewriteBoolean})()},{"../common":70}],102:[function(require,module,exports){(function(){"use strict";var Name,Syntax,common,modified;Name="rewrite-conditional-expression";common=require("../common");Syntax=common.Syntax;function rewrite(node){var test,consequent,alternate;test=node.test;consequent=node.consequent;alternate=node.alternate;if(test.type===Syntax.UnaryExpression&&test.operator==="!"){modified=true;node.consequent=alternate;node.alternate=consequent;node.test=test.argument}}function rewriteConditionalExpression(tree,options){var result;modified=false;result=options.get("destructive",{pathName:Name})?tree:common.deepCopy(tree);common.traverse(result,{enter:function enter(node){if(node.type===Syntax.ConditionalExpression){rewrite(node)}}});return{result:result,modified:modified}}rewriteConditionalExpression.passName=Name;module.exports=rewriteConditionalExpression})()},{"../common":70}],103:[function(require,module,exports){(function(){"use strict";var Name,Syntax,common;Name="transform-infinity";common=require("../common");Syntax=common.Syntax;function transformInfinity(tree,options){var result,modified;result=options.get("destructive",{pathName:Name})?tree:common.deepCopy(tree);modified=false;result=common.replace(result,{enter:function enter(node){if(node.type===Syntax.Literal&&typeof node.value==="number"){if(node.value===Infinity){modified=true;return common.moveLocation(node,{type:Syntax.BinaryExpression,operator:"/",left:{type:Syntax.Literal,value:1},right:{type:Syntax.Literal,value:0}})}}}});return{result:result,modified:modified}}transformInfinity.passName=Name;module.exports=transformInfinity})()},{"../common":70}],104:[function(require,module,exports){(function(){"use strict";var Name,Syntax,common;Name="transform-static-to-dynamic-property-access";common=require("../common");Syntax=common.Syntax;function transformStaticToDynamicPropertyAccess(tree,options){var result,modified;result=options.get("destructive",{pathName:Name})?tree:common.deepCopy(tree);modified=false;common.traverse(result,{enter:function enter(node){var property;if(node.type!==Syntax.MemberExpression||node.computed||node.property.type!==Syntax.Identifier){return}property=node.property;switch(property.name){case"undefined":modified=true;node.computed=true;node.property=common.moveLocation(property,{type:Syntax.UnaryExpression,operator:"void",argument:{type:Syntax.Literal,value:0}});break;case"true":case"false":modified=true;node.computed=true;node.property=common.moveLocation(property,{type:Syntax.Literal,value:property.name==="true"});break;case"Infinity":modified=true;node.computed=true;node.property=common.moveLocation(property,{type:Syntax.BinaryExpression,operator:"/",left:{type:Syntax.Literal,value:1},right:{type:Syntax.Literal,value:0}});break}}});return{result:result,modified:modified}}transformStaticToDynamicPropertyAccess.passName=Name;module.exports=transformStaticToDynamicPropertyAccess})()},{"../common":70}],105:[function(require,module,exports){(function(){"use strict";var common;common=require("./common");exports.get=function get(root,query){var i,iz,name,node;node=root;for(i=0,iz=query.length;i<iz;++i){name=query[i];node=node[name]}return node};exports.set=function set(root,query,value){var i,iz,name,node;common.assert(query.length>0);node=root;for(i=0,iz=query.length-1;i<iz;++i){name=query[i];node=node[name]}name=query[i];node[name]=value}})()},{"./common":70}],106:[function(require,module,exports){(function(root,factory){"use strict";if(typeof define==="function"&&define.amd){define(["exports"],factory)}else if(typeof exports!=="undefined"){factory(exports)}else{factory(root.estraverse={})}})(this,function(exports){"use strict";var Syntax,isArray,VisitorOption,VisitorKeys,BREAK,SKIP;Syntax={AssignmentExpression:"AssignmentExpression",ArrayExpression:"ArrayExpression",ArrayPattern:"ArrayPattern",ArrowFunctionExpression:"ArrowFunctionExpression",BlockStatement:"BlockStatement",BinaryExpression:"BinaryExpression",BreakStatement:"BreakStatement",CallExpression:"CallExpression",CatchClause:"CatchClause",ClassBody:"ClassBody",ClassDeclaration:"ClassDeclaration",ClassExpression:"ClassExpression",ConditionalExpression:"ConditionalExpression",ContinueStatement:"ContinueStatement",DebuggerStatement:"DebuggerStatement",DirectiveStatement:"DirectiveStatement",DoWhileStatement:"DoWhileStatement",EmptyStatement:"EmptyStatement",ExpressionStatement:"ExpressionStatement",ForStatement:"ForStatement",ForInStatement:"ForInStatement",FunctionDeclaration:"FunctionDeclaration",FunctionExpression:"FunctionExpression",Identifier:"Identifier",IfStatement:"IfStatement",Literal:"Literal",LabeledStatement:"LabeledStatement",LogicalExpression:"LogicalExpression",MemberExpression:"MemberExpression",MethodDefinition:"MethodDefinition",NewExpression:"NewExpression",ObjectExpression:"ObjectExpression",ObjectPattern:"ObjectPattern",Program:"Program",Property:"Property",ReturnStatement:"ReturnStatement",SequenceExpression:"SequenceExpression",SwitchStatement:"SwitchStatement",SwitchCase:"SwitchCase",ThisExpression:"ThisExpression",ThrowStatement:"ThrowStatement",TryStatement:"TryStatement",UnaryExpression:"UnaryExpression",UpdateExpression:"UpdateExpression",VariableDeclaration:"VariableDeclaration",VariableDeclarator:"VariableDeclarator",WhileStatement:"WhileStatement",WithStatement:"WithStatement",YieldExpression:"YieldExpression"};function ignoreJSHintError(){}isArray=Array.isArray;if(!isArray){isArray=function isArray(array){return Object.prototype.toString.call(array)==="[object Array]"}}function deepCopy(obj){var ret={},key,val;for(key in obj){if(obj.hasOwnProperty(key)){val=obj[key];if(typeof val==="object"&&val!==null){ret[key]=deepCopy(val)}else{ret[key]=val}}}return ret}function shallowCopy(obj){var ret={},key;for(key in obj){if(obj.hasOwnProperty(key)){ret[key]=obj[key]}}return ret}ignoreJSHintError(shallowCopy);function upperBound(array,func){var diff,len,i,current;len=array.length;i=0;while(len){diff=len>>>1;current=i+diff;if(func(array[current])){len=diff}else{i=current+1;len-=diff+1}}return i}function lowerBound(array,func){var diff,len,i,current;len=array.length;i=0;while(len){diff=len>>>1;current=i+diff;if(func(array[current])){i=current+1;len-=diff+1}else{len=diff}}return i}ignoreJSHintError(lowerBound);VisitorKeys={AssignmentExpression:["left","right"],ArrayExpression:["elements"],ArrayPattern:["elements"],ArrowFunctionExpression:["params","defaults","rest","body"],BlockStatement:["body"],BinaryExpression:["left","right"],BreakStatement:["label"],CallExpression:["callee","arguments"],CatchClause:["param","body"],ClassBody:["body"],ClassDeclaration:["id","body","superClass"],ClassExpression:["id","body","superClass"],ConditionalExpression:["test","consequent","alternate"],ContinueStatement:["label"],DebuggerStatement:[],DirectiveStatement:[],DoWhileStatement:["body","test"],EmptyStatement:[],ExpressionStatement:["expression"],ForStatement:["init","test","update","body"],ForInStatement:["left","right","body"],ForOfStatement:["left","right","body"],FunctionDeclaration:["id","params","defaults","rest","body"],FunctionExpression:["id","params","defaults","rest","body"],Identifier:[],IfStatement:["test","consequent","alternate"],Literal:[],LabeledStatement:["label","body"],LogicalExpression:["left","right"],MemberExpression:["object","property"],MethodDefinition:["key","value"],NewExpression:["callee","arguments"],ObjectExpression:["properties"],ObjectPattern:["properties"],Program:["body"],Property:["key","value"],ReturnStatement:["argument"],SequenceExpression:["expressions"],SwitchStatement:["discriminant","cases"],SwitchCase:["test","consequent"],ThisExpression:[],ThrowStatement:["argument"],TryStatement:["block","handlers","handler","guardedHandlers","finalizer"],UnaryExpression:["argument"],UpdateExpression:["argument"],VariableDeclaration:["declarations"],VariableDeclarator:["id","init"],WhileStatement:["test","body"],WithStatement:["object","body"],YieldExpression:["argument"]};BREAK={};SKIP={};VisitorOption={Break:BREAK,Skip:SKIP};function Reference(parent,key){this.parent=parent;this.key=key}Reference.prototype.replace=function replace(node){this.parent[this.key]=node};function Element(node,path,wrap,ref){this.node=node;this.path=path;this.wrap=wrap;this.ref=ref}function Controller(){}Controller.prototype.path=function path(){var i,iz,j,jz,result,element;function addToPath(result,path){if(isArray(path)){for(j=0,jz=path.length;j<jz;++j){result.push(path[j])}}else{result.push(path)}}if(!this.__current.path){return null}result=[];for(i=2,iz=this.__leavelist.length;i<iz;++i){element=this.__leavelist[i];addToPath(result,element.path)}addToPath(result,this.__current.path);return result};Controller.prototype.parents=function parents(){var i,iz,result;result=[];for(i=1,iz=this.__leavelist.length;i<iz;++i){result.push(this.__leavelist[i].node)}return result};Controller.prototype.current=function current(){return this.__current.node};Controller.prototype.__execute=function __execute(callback,element){var previous,result;result=undefined;previous=this.__current;this.__current=element;this.__state=null;if(callback){result=callback.call(this,element.node,this.__leavelist[this.__leavelist.length-1].node)}this.__current=previous;return result};Controller.prototype.notify=function notify(flag){this.__state=flag};Controller.prototype.skip=function(){this.notify(SKIP)};Controller.prototype["break"]=function(){this.notify(BREAK)};Controller.prototype.__initialize=function(root,visitor){this.visitor=visitor;this.root=root;this.__worklist=[];this.__leavelist=[];this.__current=null;this.__state=null};Controller.prototype.traverse=function traverse(root,visitor){var worklist,leavelist,element,node,nodeType,ret,key,current,current2,candidates,candidate,sentinel;this.__initialize(root,visitor);sentinel={};worklist=this.__worklist;leavelist=this.__leavelist;worklist.push(new Element(root,null,null,null));leavelist.push(new Element(null,null,null,null));while(worklist.length){element=worklist.pop();if(element===sentinel){element=leavelist.pop();ret=this.__execute(visitor.leave,element);if(this.__state===BREAK||ret===BREAK){return}continue}if(element.node){ret=this.__execute(visitor.enter,element);if(this.__state===BREAK||ret===BREAK){return}worklist.push(sentinel);leavelist.push(element);if(this.__state===SKIP||ret===SKIP){continue}node=element.node;nodeType=element.wrap||node.type;candidates=VisitorKeys[nodeType];current=candidates.length;while((current-=1)>=0){key=candidates[current];candidate=node[key];if(!candidate){continue}if(!isArray(candidate)){worklist.push(new Element(candidate,key,null,null));continue}current2=candidate.length;while((current2-=1)>=0){if(!candidate[current2]){continue}if((nodeType===Syntax.ObjectExpression||nodeType===Syntax.ObjectPattern)&&"properties"===candidates[current]){element=new Element(candidate[current2],[key,current2],"Property",null)}else{element=new Element(candidate[current2],[key,current2],null,null)}worklist.push(element)}}}}};Controller.prototype.replace=function replace(root,visitor){var worklist,leavelist,node,nodeType,target,element,current,current2,candidates,candidate,sentinel,outer,key;this.__initialize(root,visitor);sentinel={};worklist=this.__worklist;leavelist=this.__leavelist;outer={root:root};element=new Element(root,null,null,new Reference(outer,"root"));worklist.push(element);leavelist.push(element);while(worklist.length){element=worklist.pop();if(element===sentinel){element=leavelist.pop();target=this.__execute(visitor.leave,element);if(target!==undefined&&target!==BREAK&&target!==SKIP){element.ref.replace(target)}if(this.__state===BREAK||target===BREAK){return outer.root}continue}target=this.__execute(visitor.enter,element);if(target!==undefined&&target!==BREAK&&target!==SKIP){element.ref.replace(target);element.node=target}if(this.__state===BREAK||target===BREAK){return outer.root}node=element.node;if(!node){continue}worklist.push(sentinel);leavelist.push(element);if(this.__state===SKIP||target===SKIP){continue}nodeType=element.wrap||node.type;candidates=VisitorKeys[nodeType];current=candidates.length;while((current-=1)>=0){key=candidates[current];candidate=node[key];if(!candidate){continue}if(!isArray(candidate)){worklist.push(new Element(candidate,key,null,new Reference(node,key)));continue}current2=candidate.length;while((current2-=1)>=0){if(!candidate[current2]){continue}if(nodeType===Syntax.ObjectExpression&&"properties"===candidates[current]){element=new Element(candidate[current2],[key,current2],"Property",new Reference(candidate,current2))}else{element=new Element(candidate[current2],[key,current2],null,new Reference(candidate,current2))}worklist.push(element)}}}return outer.root};function traverse(root,visitor){var controller=new Controller;return controller.traverse(root,visitor)}function replace(root,visitor){var controller=new Controller;return controller.replace(root,visitor)}function extendCommentRange(comment,tokens){var target;target=upperBound(tokens,function search(token){return token.range[0]>comment.range[0]});comment.extendedRange=[comment.range[0],comment.range[1]];if(target!==tokens.length){comment.extendedRange[1]=tokens[target].range[0]}target-=1;if(target>=0){comment.extendedRange[0]=tokens[target].range[1]}return comment}function attachComments(tree,providedComments,tokens){var comments=[],comment,len,i,cursor;if(!tree.range){throw new Error("attachComments needs range information")}if(!tokens.length){if(providedComments.length){for(i=0,len=providedComments.length;i<len;i+=1){comment=deepCopy(providedComments[i]);comment.extendedRange=[0,tree.range[0]];comments.push(comment)}tree.leadingComments=comments}return tree}for(i=0,len=providedComments.length;i<len;i+=1){comments.push(extendCommentRange(deepCopy(providedComments[i]),tokens))}cursor=0;traverse(tree,{enter:function(node){var comment;while(cursor<comments.length){comment=comments[cursor];if(comment.extendedRange[1]>node.range[0]){break}if(comment.extendedRange[1]===node.range[0]){if(!node.leadingComments){node.leadingComments=[]}node.leadingComments.push(comment);comments.splice(cursor,1)}else{cursor+=1}}if(cursor===comments.length){return VisitorOption.Break}if(comments[cursor].extendedRange[0]>node.range[1]){return VisitorOption.Skip}}});cursor=0;traverse(tree,{leave:function(node){var comment;while(cursor<comments.length){comment=comments[cursor];if(node.range[1]<comment.extendedRange[0]){break}if(node.range[1]===comment.extendedRange[0]){if(!node.trailingComments){node.trailingComments=[]}node.trailingComments.push(comment);comments.splice(cursor,1)}else{cursor+=1}}if(cursor===comments.length){return VisitorOption.Break}if(comments[cursor].extendedRange[0]>node.range[1]){return VisitorOption.Skip}}});return tree}exports.version="1.5.1-dev";exports.Syntax=Syntax;exports.traverse=traverse;exports.replace=replace;exports.attachComments=attachComments;exports.VisitorKeys=VisitorKeys;exports.VisitorOption=VisitorOption;exports.Controller=Controller})},{}],107:[function(require,module,exports){(function(){"use strict";var Regex;Regex={NonAsciiIdentifierStart:new RegExp("[\xaa\xb5\xba\xc0-\xd6\xd8-\xf6\xf8-\u02c1\u02c6-\u02d1\u02e0-\u02e4\u02ec\u02ee\u0370-\u0374\u0376\u0377\u037a-\u037d\u0386\u0388-\u038a\u038c\u038e-\u03a1\u03a3-\u03f5\u03f7-\u0481\u048a-\u0527\u0531-\u0556\u0559\u0561-\u0587\u05d0-\u05ea\u05f0-\u05f2\u0620-\u064a\u066e\u066f\u0671-\u06d3\u06d5\u06e5\u06e6\u06ee\u06ef\u06fa-\u06fc\u06ff\u0710\u0712-\u072f\u074d-\u07a5\u07b1\u07ca-\u07ea\u07f4\u07f5\u07fa\u0800-\u0815\u081a\u0824\u0828\u0840-\u0858\u08a0\u08a2-\u08ac\u0904-\u0939\u093d\u0950\u0958-\u0961\u0971-\u0977\u0979-\u097f\u0985-\u098c\u098f\u0990\u0993-\u09a8\u09aa-\u09b0\u09b2\u09b6-\u09b9\u09bd\u09ce\u09dc\u09dd\u09df-\u09e1\u09f0\u09f1\u0a05-\u0a0a\u0a0f\u0a10\u0a13-\u0a28\u0a2a-\u0a30\u0a32\u0a33\u0a35\u0a36\u0a38\u0a39\u0a59-\u0a5c\u0a5e\u0a72-\u0a74\u0a85-\u0a8d\u0a8f-\u0a91\u0a93-\u0aa8\u0aaa-\u0ab0\u0ab2\u0ab3\u0ab5-\u0ab9\u0abd\u0ad0\u0ae0\u0ae1\u0b05-\u0b0c\u0b0f\u0b10\u0b13-\u0b28\u0b2a-\u0b30\u0b32\u0b33\u0b35-\u0b39\u0b3d\u0b5c\u0b5d\u0b5f-\u0b61\u0b71\u0b83\u0b85-\u0b8a\u0b8e-\u0b90\u0b92-\u0b95\u0b99\u0b9a\u0b9c\u0b9e\u0b9f\u0ba3\u0ba4\u0ba8-\u0baa\u0bae-\u0bb9\u0bd0\u0c05-\u0c0c\u0c0e-\u0c10\u0c12-\u0c28\u0c2a-\u0c33\u0c35-\u0c39\u0c3d\u0c58\u0c59\u0c60\u0c61\u0c85-\u0c8c\u0c8e-\u0c90\u0c92-\u0ca8\u0caa-\u0cb3\u0cb5-\u0cb9\u0cbd\u0cde\u0ce0\u0ce1\u0cf1\u0cf2\u0d05-\u0d0c\u0d0e-\u0d10\u0d12-\u0d3a\u0d3d\u0d4e\u0d60\u0d61\u0d7a-\u0d7f\u0d85-\u0d96\u0d9a-\u0db1\u0db3-\u0dbb\u0dbd\u0dc0-\u0dc6\u0e01-\u0e30\u0e32\u0e33\u0e40-\u0e46\u0e81\u0e82\u0e84\u0e87\u0e88\u0e8a\u0e8d\u0e94-\u0e97\u0e99-\u0e9f\u0ea1-\u0ea3\u0ea5\u0ea7\u0eaa\u0eab\u0ead-\u0eb0\u0eb2\u0eb3\u0ebd\u0ec0-\u0ec4\u0ec6\u0edc-\u0edf\u0f00\u0f40-\u0f47\u0f49-\u0f6c\u0f88-\u0f8c\u1000-\u102a\u103f\u1050-\u1055\u105a-\u105d\u1061\u1065\u1066\u106e-\u1070\u1075-\u1081\u108e\u10a0-\u10c5\u10c7\u10cd\u10d0-\u10fa\u10fc-\u1248\u124a-\u124d\u1250-\u1256\u1258\u125a-\u125d\u1260-\u1288\u128a-\u128d\u1290-\u12b0\u12b2-\u12b5\u12b8-\u12be\u12c0\u12c2-\u12c5\u12c8-\u12d6\u12d8-\u1310\u1312-\u1315\u1318-\u135a\u1380-\u138f\u13a0-\u13f4\u1401-\u166c\u166f-\u167f\u1681-\u169a\u16a0-\u16ea\u16ee-\u16f0\u1700-\u170c\u170e-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176c\u176e-\u1770\u1780-\u17b3\u17d7\u17dc\u1820-\u1877\u1880-\u18a8\u18aa\u18b0-\u18f5\u1900-\u191c\u1950-\u196d\u1970-\u1974\u1980-\u19ab\u19c1-\u19c7\u1a00-\u1a16\u1a20-\u1a54\u1aa7\u1b05-\u1b33\u1b45-\u1b4b\u1b83-\u1ba0\u1bae\u1baf\u1bba-\u1be5\u1c00-\u1c23\u1c4d-\u1c4f\u1c5a-\u1c7d\u1ce9-\u1cec\u1cee-\u1cf1\u1cf5\u1cf6\u1d00-\u1dbf\u1e00-\u1f15\u1f18-\u1f1d\u1f20-\u1f45\u1f48-\u1f4d\u1f50-\u1f57\u1f59\u1f5b\u1f5d\u1f5f-\u1f7d\u1f80-\u1fb4\u1fb6-\u1fbc\u1fbe\u1fc2-\u1fc4\u1fc6-\u1fcc\u1fd0-\u1fd3\u1fd6-\u1fdb\u1fe0-\u1fec\u1ff2-\u1ff4\u1ff6-\u1ffc\u2071\u207f\u2090-\u209c\u2102\u2107\u210a-\u2113\u2115\u2119-\u211d\u2124\u2126\u2128\u212a-\u212d\u212f-\u2139\u213c-\u213f\u2145-\u2149\u214e\u2160-\u2188\u2c00-\u2c2e\u2c30-\u2c5e\u2c60-\u2ce4\u2ceb-\u2cee\u2cf2\u2cf3\u2d00-\u2d25\u2d27\u2d2d\u2d30-\u2d67\u2d6f\u2d80-\u2d96\u2da0-\u2da6\u2da8-\u2dae\u2db0-\u2db6\u2db8-\u2dbe\u2dc0-\u2dc6\u2dc8-\u2dce\u2dd0-\u2dd6\u2dd8-\u2dde\u2e2f\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303c\u3041-\u3096\u309d-\u309f\u30a1-\u30fa\u30fc-\u30ff\u3105-\u312d\u3131-\u318e\u31a0-\u31ba\u31f0-\u31ff\u3400-\u4db5\u4e00-\u9fcc\ua000-\ua48c\ua4d0-\ua4fd\ua500-\ua60c\ua610-\ua61f\ua62a\ua62b\ua640-\ua66e\ua67f-\ua697\ua6a0-\ua6ef\ua717-\ua71f\ua722-\ua788\ua78b-\ua78e\ua790-\ua793\ua7a0-\ua7aa\ua7f8-\ua801\ua803-\ua805\ua807-\ua80a\ua80c-\ua822\ua840-\ua873\ua882-\ua8b3\ua8f2-\ua8f7\ua8fb\ua90a-\ua925\ua930-\ua946\ua960-\ua97c\ua984-\ua9b2\ua9cf\uaa00-\uaa28\uaa40-\uaa42\uaa44-\uaa4b\uaa60-\uaa76\uaa7a\uaa80-\uaaaf\uaab1\uaab5\uaab6\uaab9-\uaabd\uaac0\uaac2\uaadb-\uaadd\uaae0-\uaaea\uaaf2-\uaaf4\uab01-\uab06\uab09-\uab0e\uab11-\uab16\uab20-\uab26\uab28-\uab2e\uabc0-\uabe2\uac00-\ud7a3\ud7b0-\ud7c6\ud7cb-\ud7fb\uf900-\ufa6d\ufa70-\ufad9\ufb00-\ufb06\ufb13-\ufb17\ufb1d\ufb1f-\ufb28\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40\ufb41\ufb43\ufb44\ufb46-\ufbb1\ufbd3-\ufd3d\ufd50-\ufd8f\ufd92-\ufdc7\ufdf0-\ufdfb\ufe70-\ufe74\ufe76-\ufefc\uff21-\uff3a\uff41-\uff5a\uff66-\uffbe\uffc2-\uffc7\uffca-\uffcf\uffd2-\uffd7\uffda-\uffdc]"),NonAsciiIdentifierPart:new RegExp("[\xaa\xb5\xba\xc0-\xd6\xd8-\xf6\xf8-\u02c1\u02c6-\u02d1\u02e0-\u02e4\u02ec\u02ee\u0300-\u0374\u0376\u0377\u037a-\u037d\u0386\u0388-\u038a\u038c\u038e-\u03a1\u03a3-\u03f5\u03f7-\u0481\u0483-\u0487\u048a-\u0527\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u05d0-\u05ea\u05f0-\u05f2\u0610-\u061a\u0620-\u0669\u066e-\u06d3\u06d5-\u06dc\u06df-\u06e8\u06ea-\u06fc\u06ff\u0710-\u074a\u074d-\u07b1\u07c0-\u07f5\u07fa\u0800-\u082d\u0840-\u085b\u08a0\u08a2-\u08ac\u08e4-\u08fe\u0900-\u0963\u0966-\u096f\u0971-\u0977\u0979-\u097f\u0981-\u0983\u0985-\u098c\u098f\u0990\u0993-\u09a8\u09aa-\u09b0\u09b2\u09b6-\u09b9\u09bc-\u09c4\u09c7\u09c8\u09cb-\u09ce\u09d7\u09dc\u09dd\u09df-\u09e3\u09e6-\u09f1\u0a01-\u0a03\u0a05-\u0a0a\u0a0f\u0a10\u0a13-\u0a28\u0a2a-\u0a30\u0a32\u0a33\u0a35\u0a36\u0a38\u0a39\u0a3c\u0a3e-\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a59-\u0a5c\u0a5e\u0a66-\u0a75\u0a81-\u0a83\u0a85-\u0a8d\u0a8f-\u0a91\u0a93-\u0aa8\u0aaa-\u0ab0\u0ab2\u0ab3\u0ab5-\u0ab9\u0abc-\u0ac5\u0ac7-\u0ac9\u0acb-\u0acd\u0ad0\u0ae0-\u0ae3\u0ae6-\u0aef\u0b01-\u0b03\u0b05-\u0b0c\u0b0f\u0b10\u0b13-\u0b28\u0b2a-\u0b30\u0b32\u0b33\u0b35-\u0b39\u0b3c-\u0b44\u0b47\u0b48\u0b4b-\u0b4d\u0b56\u0b57\u0b5c\u0b5d\u0b5f-\u0b63\u0b66-\u0b6f\u0b71\u0b82\u0b83\u0b85-\u0b8a\u0b8e-\u0b90\u0b92-\u0b95\u0b99\u0b9a\u0b9c\u0b9e\u0b9f\u0ba3\u0ba4\u0ba8-\u0baa\u0bae-\u0bb9\u0bbe-\u0bc2\u0bc6-\u0bc8\u0bca-\u0bcd\u0bd0\u0bd7\u0be6-\u0bef\u0c01-\u0c03\u0c05-\u0c0c\u0c0e-\u0c10\u0c12-\u0c28\u0c2a-\u0c33\u0c35-\u0c39\u0c3d-\u0c44\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c58\u0c59\u0c60-\u0c63\u0c66-\u0c6f\u0c82\u0c83\u0c85-\u0c8c\u0c8e-\u0c90\u0c92-\u0ca8\u0caa-\u0cb3\u0cb5-\u0cb9\u0cbc-\u0cc4\u0cc6-\u0cc8\u0cca-\u0ccd\u0cd5\u0cd6\u0cde\u0ce0-\u0ce3\u0ce6-\u0cef\u0cf1\u0cf2\u0d02\u0d03\u0d05-\u0d0c\u0d0e-\u0d10\u0d12-\u0d3a\u0d3d-\u0d44\u0d46-\u0d48\u0d4a-\u0d4e\u0d57\u0d60-\u0d63\u0d66-\u0d6f\u0d7a-\u0d7f\u0d82\u0d83\u0d85-\u0d96\u0d9a-\u0db1\u0db3-\u0dbb\u0dbd\u0dc0-\u0dc6\u0dca\u0dcf-\u0dd4\u0dd6\u0dd8-\u0ddf\u0df2\u0df3\u0e01-\u0e3a\u0e40-\u0e4e\u0e50-\u0e59\u0e81\u0e82\u0e84\u0e87\u0e88\u0e8a\u0e8d\u0e94-\u0e97\u0e99-\u0e9f\u0ea1-\u0ea3\u0ea5\u0ea7\u0eaa\u0eab\u0ead-\u0eb9\u0ebb-\u0ebd\u0ec0-\u0ec4\u0ec6\u0ec8-\u0ecd\u0ed0-\u0ed9\u0edc-\u0edf\u0f00\u0f18\u0f19\u0f20-\u0f29\u0f35\u0f37\u0f39\u0f3e-\u0f47\u0f49-\u0f6c\u0f71-\u0f84\u0f86-\u0f97\u0f99-\u0fbc\u0fc6\u1000-\u1049\u1050-\u109d\u10a0-\u10c5\u10c7\u10cd\u10d0-\u10fa\u10fc-\u1248\u124a-\u124d\u1250-\u1256\u1258\u125a-\u125d\u1260-\u1288\u128a-\u128d\u1290-\u12b0\u12b2-\u12b5\u12b8-\u12be\u12c0\u12c2-\u12c5\u12c8-\u12d6\u12d8-\u1310\u1312-\u1315\u1318-\u135a\u135d-\u135f\u1380-\u138f\u13a0-\u13f4\u1401-\u166c\u166f-\u167f\u1681-\u169a\u16a0-\u16ea\u16ee-\u16f0\u1700-\u170c\u170e-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176c\u176e-\u1770\u1772\u1773\u1780-\u17d3\u17d7\u17dc\u17dd\u17e0-\u17e9\u180b-\u180d\u1810-\u1819\u1820-\u1877\u1880-\u18aa\u18b0-\u18f5\u1900-\u191c\u1920-\u192b\u1930-\u193b\u1946-\u196d\u1970-\u1974\u1980-\u19ab\u19b0-\u19c9\u19d0-\u19d9\u1a00-\u1a1b\u1a20-\u1a5e\u1a60-\u1a7c\u1a7f-\u1a89\u1a90-\u1a99\u1aa7\u1b00-\u1b4b\u1b50-\u1b59\u1b6b-\u1b73\u1b80-\u1bf3\u1c00-\u1c37\u1c40-\u1c49\u1c4d-\u1c7d\u1cd0-\u1cd2\u1cd4-\u1cf6\u1d00-\u1de6\u1dfc-\u1f15\u1f18-\u1f1d\u1f20-\u1f45\u1f48-\u1f4d\u1f50-\u1f57\u1f59\u1f5b\u1f5d\u1f5f-\u1f7d\u1f80-\u1fb4\u1fb6-\u1fbc\u1fbe\u1fc2-\u1fc4\u1fc6-\u1fcc\u1fd0-\u1fd3\u1fd6-\u1fdb\u1fe0-\u1fec\u1ff2-\u1ff4\u1ff6-\u1ffc\u200c\u200d\u203f\u2040\u2054\u2071\u207f\u2090-\u209c\u20d0-\u20dc\u20e1\u20e5-\u20f0\u2102\u2107\u210a-\u2113\u2115\u2119-\u211d\u2124\u2126\u2128\u212a-\u212d\u212f-\u2139\u213c-\u213f\u2145-\u2149\u214e\u2160-\u2188\u2c00-\u2c2e\u2c30-\u2c5e\u2c60-\u2ce4\u2ceb-\u2cf3\u2d00-\u2d25\u2d27\u2d2d\u2d30-\u2d67\u2d6f\u2d7f-\u2d96\u2da0-\u2da6\u2da8-\u2dae\u2db0-\u2db6\u2db8-\u2dbe\u2dc0-\u2dc6\u2dc8-\u2dce\u2dd0-\u2dd6\u2dd8-\u2dde\u2de0-\u2dff\u2e2f\u3005-\u3007\u3021-\u302f\u3031-\u3035\u3038-\u303c\u3041-\u3096\u3099\u309a\u309d-\u309f\u30a1-\u30fa\u30fc-\u30ff\u3105-\u312d\u3131-\u318e\u31a0-\u31ba\u31f0-\u31ff\u3400-\u4db5\u4e00-\u9fcc\ua000-\ua48c\ua4d0-\ua4fd\ua500-\ua60c\ua610-\ua62b\ua640-\ua66f\ua674-\ua67d\ua67f-\ua697\ua69f-\ua6f1\ua717-\ua71f\ua722-\ua788\ua78b-\ua78e\ua790-\ua793\ua7a0-\ua7aa\ua7f8-\ua827\ua840-\ua873\ua880-\ua8c4\ua8d0-\ua8d9\ua8e0-\ua8f7\ua8fb\ua900-\ua92d\ua930-\ua953\ua960-\ua97c\ua980-\ua9c0\ua9cf-\ua9d9\uaa00-\uaa36\uaa40-\uaa4d\uaa50-\uaa59\uaa60-\uaa76\uaa7a\uaa7b\uaa80-\uaac2\uaadb-\uaadd\uaae0-\uaaef\uaaf2-\uaaf6\uab01-\uab06\uab09-\uab0e\uab11-\uab16\uab20-\uab26\uab28-\uab2e\uabc0-\uabea\uabec\uabed\uabf0-\uabf9\uac00-\ud7a3\ud7b0-\ud7c6\ud7cb-\ud7fb\uf900-\ufa6d\ufa70-\ufad9\ufb00-\ufb06\ufb13-\ufb17\ufb1d-\ufb28\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40\ufb41\ufb43\ufb44\ufb46-\ufbb1\ufbd3-\ufd3d\ufd50-\ufd8f\ufd92-\ufdc7\ufdf0-\ufdfb\ufe00-\ufe0f\ufe20-\ufe26\ufe33\ufe34\ufe4d-\ufe4f\ufe70-\ufe74\ufe76-\ufefc\uff10-\uff19\uff21-\uff3a\uff3f\uff41-\uff5a\uff66-\uffbe\uffc2-\uffc7\uffca-\uffcf\uffd2-\uffd7\uffda-\uffdc]")};function isDecimalDigit(ch){return ch>=48&&ch<=57}function isHexDigit(ch){return isDecimalDigit(ch)||97<=ch&&ch<=102||65<=ch&&ch<=70}function isOctalDigit(ch){return ch>=48&&ch<=55}function isWhiteSpace(ch){return ch===32||ch===9||ch===11||ch===12||ch===160||ch>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(ch)>=0}function isLineTerminator(ch){return ch===10||ch===13||ch===8232||ch===8233}function isIdentifierStart(ch){return ch===36||ch===95||ch>=65&&ch<=90||ch>=97&&ch<=122||ch===92||ch>=128&&Regex.NonAsciiIdentifierStart.test(String.fromCharCode(ch))}function isIdentifierPart(ch){return ch===36||ch===95||ch>=65&&ch<=90||ch>=97&&ch<=122||ch>=48&&ch<=57||ch===92||ch>=128&&Regex.NonAsciiIdentifierPart.test(String.fromCharCode(ch))}module.exports={isDecimalDigit:isDecimalDigit,isHexDigit:isHexDigit,isOctalDigit:isOctalDigit,isWhiteSpace:isWhiteSpace,isLineTerminator:isLineTerminator,isIdentifierStart:isIdentifierStart,isIdentifierPart:isIdentifierPart}})()},{}],108:[function(require,module,exports){(function(){"use strict";var code=require("./code");function isStrictModeReservedWordES6(id){switch(id){case"implements":case"interface":case"package":case"private":case"protected":case"public":case"static":case"let":return true;default:return false}}function isKeywordES5(id,strict){if(!strict&&id==="yield"){return false}return isKeywordES6(id,strict)}function isKeywordES6(id,strict){if(strict&&isStrictModeReservedWordES6(id)){return true}switch(id.length){case 2:return id==="if"||id==="in"||id==="do";case 3:return id==="var"||id==="for"||id==="new"||id==="try";case 4:return id==="this"||id==="else"||id==="case"||id==="void"||id==="with"||id==="enum";case 5:return id==="while"||id==="break"||id==="catch"||id==="throw"||id==="const"||id==="yield"||id==="class"||id==="super";case 6:return id==="return"||id==="typeof"||id==="delete"||id==="switch"||id==="export"||id==="import";case 7:return id==="default"||id==="finally"||id==="extends";case 8:return id==="function"||id==="continue"||id==="debugger";case 10:return id==="instanceof";default:return false}}function isRestrictedWord(id){return id==="eval"||id==="arguments"}function isIdentifierName(id){var i,iz,ch;if(id.length===0){return false}ch=id.charCodeAt(0);if(!code.isIdentifierStart(ch)||ch===92){return false}for(i=1,iz=id.length;i<iz;++i){ch=id.charCodeAt(i);if(!code.isIdentifierPart(ch)||ch===92){return false}}return true}module.exports={isKeywordES5:isKeywordES5,isKeywordES6:isKeywordES6,isRestrictedWord:isRestrictedWord,isIdentifierName:isIdentifierName}})()},{"./code":107}],109:[function(require,module,exports){(function(){"use strict";exports.code=require("./code");exports.keyword=require("./keyword")})()},{"./code":107,"./keyword":108}],110:[function(require,module,exports){module.exports={_from:"esmangle@^1.0.1",_id:"esmangle@1.0.1",_inBundle:false,_integrity:"sha1-2bs3uPjq+/Tm1O1reqKVarvTxMI=",_location:"/esmangle",_phantomChildren:{amdefine:"1.0.1","deep-is":"0.1.3","prelude-ls":"1.1.2","type-check":"0.3.2"},_requested:{type:"range",registry:true,raw:"esmangle@^1.0.1",name:"esmangle",escapedName:"esmangle",rawSpec:"^1.0.1",saveSpec:null,fetchSpec:"^1.0.1"},_requiredBy:["/"],_resolved:"https://registry.npmjs.org/esmangle/-/esmangle-1.0.1.tgz",_shasum:"d9bb37b8f8eafbf4e6d4ed6b7aa2956abbd3c4c2",_spec:"esmangle@^1.0.1",_where:"/Users/jkhartshorne/Documents/Teaching/probmods2/node_modules/webppl",bin:{esmangle:"./bin/esmangle.js"},bugs:{url:"https://github.com/Constellation/esmangle/issues"},bundleDependencies:false,dependencies:{escodegen:"~1.3.2",escope:"~1.0.1",esprima:"~1.1.1",esshorten:"~1.1.0",estraverse:"~1.5.0",esutils:"~ 1.0.0",optionator:"~0.3.0","source-map":"~0.1.33"},deprecated:false,description:"ECMAScript code mangler / minifier",devDependencies:{async:"~0.2.9",chai:"*",clone:"~0.1.11","commonjs-everywhere":"~0.9.4",grunt:"~0.4.2","grunt-cli":"~0.1.11","grunt-contrib-clean":"~0.5.0","grunt-contrib-copy":"~0.5.0","grunt-contrib-jshint":"~0.8.0","grunt-mocha-test":"~0.8.1","grunt-shell":"~0.6.1","grunt-update-submodules":"~0.2.1",q:"~0.9.7"},directories:{lib:"./lib"},engines:{node:">=0.6.0"},homepage:"http://github.com/Constellation/esmangle.html",licenses:[{type:"BSD",url:"http://github.com/Constellation/esmangle/raw/master/LICENSE.BSD"}],main:"lib/esmangle.js",maintainers:[{name:"Yusuke Suzuki",email:"utatane.tea@gmail.com",url:"http://github.com/Constellation"}],name:"esmangle",repository:{type:"git",url:"git+ssh://git@github.com/Constellation/esmangle.git"},scripts:{build:"grunt build",lint:"grunt lint","regression-test":"grunt test:regression",test:"grunt travis","unit-test":"grunt test"},version:"1.0.1"}},{}],111:[function(require,module,exports){(function webpackUniversalModuleDefinition(root,factory){if(typeof exports==="object"&&typeof module==="object")module.exports=factory();else if(typeof define==="function"&&define.amd)define([],factory);else if(typeof exports==="object")exports["esprima"]=factory();else root["esprima"]=factory()})(this,function(){return function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={exports:{},id:moduleId,loaded:false};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.loaded=true;return module.exports}__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.p="";return __webpack_require__(0)}([function(module,exports,__webpack_require__){"use strict";var comment_handler_1=__webpack_require__(1);var parser_1=__webpack_require__(3);var jsx_parser_1=__webpack_require__(11);var tokenizer_1=__webpack_require__(15);function parse(code,options,delegate){var commentHandler=null;var proxyDelegate=function(node,metadata){if(delegate){delegate(node,metadata)}if(commentHandler){commentHandler.visit(node,metadata)}};var parserDelegate=typeof delegate==="function"?proxyDelegate:null;var collectComment=false;if(options){collectComment=typeof options.comment==="boolean"&&options.comment;var attachComment=typeof options.attachComment==="boolean"&&options.attachComment;if(collectComment||attachComment){commentHandler=new comment_handler_1.CommentHandler;commentHandler.attach=attachComment;options.comment=true;parserDelegate=proxyDelegate}}var parser;if(options&&typeof options.jsx==="boolean"&&options.jsx){parser=new jsx_parser_1.JSXParser(code,options,parserDelegate)}else{parser=new parser_1.Parser(code,options,parserDelegate)}var ast=parser.parseProgram();if(collectComment){ast.comments=commentHandler.comments}if(parser.config.tokens){ast.tokens=parser.tokens}if(parser.config.tolerant){ast.errors=parser.errorHandler.errors}return ast}exports.parse=parse;function tokenize(code,options,delegate){var tokenizer=new tokenizer_1.Tokenizer(code,options);var tokens;tokens=[];try{while(true){var token=tokenizer.getNextToken();if(!token){break}if(delegate){token=delegate(token)}tokens.push(token)}}catch(e){tokenizer.errorHandler.tolerate(e)}if(tokenizer.errorHandler.tolerant){tokens.errors=tokenizer.errors()}return tokens}exports.tokenize=tokenize;var syntax_1=__webpack_require__(2);exports.Syntax=syntax_1.Syntax;exports.version="3.1.3"},function(module,exports,__webpack_require__){"use strict";var syntax_1=__webpack_require__(2);var CommentHandler=function(){function CommentHandler(){this.attach=false;this.comments=[];this.stack=[];this.leading=[];this.trailing=[]}CommentHandler.prototype.insertInnerComments=function(node,metadata){if(node.type===syntax_1.Syntax.BlockStatement&&node.body.length===0){var innerComments=[];for(var i=this.leading.length-1;i>=0;--i){var entry=this.leading[i];if(metadata.end.offset>=entry.start){innerComments.unshift(entry.comment);this.leading.splice(i,1);this.trailing.splice(i,1)}}if(innerComments.length){node.innerComments=innerComments}}};CommentHandler.prototype.findTrailingComments=function(node,metadata){var trailingComments=[];if(this.trailing.length>0){for(var i=this.trailing.length-1;i>=0;--i){var entry_1=this.trailing[i];if(entry_1.start>=metadata.end.offset){trailingComments.unshift(entry_1.comment)}}this.trailing.length=0;return trailingComments}var entry=this.stack[this.stack.length-1];if(entry&&entry.node.trailingComments){var firstComment=entry.node.trailingComments[0];if(firstComment&&firstComment.range[0]>=metadata.end.offset){trailingComments=entry.node.trailingComments;delete entry.node.trailingComments}}return trailingComments};CommentHandler.prototype.findLeadingComments=function(node,metadata){var leadingComments=[];var target;while(this.stack.length>0){var entry=this.stack[this.stack.length-1];if(entry&&entry.start>=metadata.start.offset){target=this.stack.pop().node}else{break}}if(target){var count=target.leadingComments?target.leadingComments.length:0;for(var i=count-1;i>=0;--i){var comment=target.leadingComments[i];if(comment.range[1]<=metadata.start.offset){leadingComments.unshift(comment);target.leadingComments.splice(i,1)}}if(target.leadingComments&&target.leadingComments.length===0){delete target.leadingComments}return leadingComments}for(var i=this.leading.length-1;i>=0;--i){var entry=this.leading[i];if(entry.start<=metadata.start.offset){leadingComments.unshift(entry.comment);this.leading.splice(i,1)}}return leadingComments};CommentHandler.prototype.visitNode=function(node,metadata){if(node.type===syntax_1.Syntax.Program&&node.body.length>0){return}this.insertInnerComments(node,metadata);var trailingComments=this.findTrailingComments(node,metadata);var leadingComments=this.findLeadingComments(node,metadata);if(leadingComments.length>0){node.leadingComments=leadingComments}if(trailingComments.length>0){node.trailingComments=trailingComments}this.stack.push({node:node,start:metadata.start.offset})};CommentHandler.prototype.visitComment=function(node,metadata){var type=node.type[0]==="L"?"Line":"Block";var comment={type:type,value:node.value};if(node.range){comment.range=node.range}if(node.loc){comment.loc=node.loc}this.comments.push(comment);if(this.attach){var entry={comment:{type:type,value:node.value,range:[metadata.start.offset,metadata.end.offset]},start:metadata.start.offset};if(node.loc){entry.comment.loc=node.loc}node.type=type;this.leading.push(entry);this.trailing.push(entry)}};CommentHandler.prototype.visit=function(node,metadata){if(node.type==="LineComment"){this.visitComment(node,metadata)}else if(node.type==="BlockComment"){this.visitComment(node,metadata)}else if(this.attach){this.visitNode(node,metadata)}};return CommentHandler}();exports.CommentHandler=CommentHandler},function(module,exports){"use strict";exports.Syntax={AssignmentExpression:"AssignmentExpression",AssignmentPattern:"AssignmentPattern",ArrayExpression:"ArrayExpression",ArrayPattern:"ArrayPattern",ArrowFunctionExpression:"ArrowFunctionExpression",BlockStatement:"BlockStatement",BinaryExpression:"BinaryExpression",BreakStatement:"BreakStatement",CallExpression:"CallExpression",CatchClause:"CatchClause",ClassBody:"ClassBody",ClassDeclaration:"ClassDeclaration",ClassExpression:"ClassExpression",ConditionalExpression:"ConditionalExpression",ContinueStatement:"ContinueStatement",DoWhileStatement:"DoWhileStatement",DebuggerStatement:"DebuggerStatement",EmptyStatement:"EmptyStatement",ExportAllDeclaration:"ExportAllDeclaration",ExportDefaultDeclaration:"ExportDefaultDeclaration",ExportNamedDeclaration:"ExportNamedDeclaration",ExportSpecifier:"ExportSpecifier",ExpressionStatement:"ExpressionStatement",ForStatement:"ForStatement",ForOfStatement:"ForOfStatement",ForInStatement:"ForInStatement",FunctionDeclaration:"FunctionDeclaration",FunctionExpression:"FunctionExpression",Identifier:"Identifier",IfStatement:"IfStatement",ImportDeclaration:"ImportDeclaration",ImportDefaultSpecifier:"ImportDefaultSpecifier",ImportNamespaceSpecifier:"ImportNamespaceSpecifier",ImportSpecifier:"ImportSpecifier",Literal:"Literal",LabeledStatement:"LabeledStatement",LogicalExpression:"LogicalExpression",MemberExpression:"MemberExpression",MetaProperty:"MetaProperty",MethodDefinition:"MethodDefinition",NewExpression:"NewExpression",ObjectExpression:"ObjectExpression",ObjectPattern:"ObjectPattern",Program:"Program",Property:"Property",RestElement:"RestElement",ReturnStatement:"ReturnStatement",SequenceExpression:"SequenceExpression",SpreadElement:"SpreadElement",Super:"Super",SwitchCase:"SwitchCase",SwitchStatement:"SwitchStatement",TaggedTemplateExpression:"TaggedTemplateExpression",TemplateElement:"TemplateElement",TemplateLiteral:"TemplateLiteral",ThisExpression:"ThisExpression",ThrowStatement:"ThrowStatement",TryStatement:"TryStatement",UnaryExpression:"UnaryExpression",UpdateExpression:"UpdateExpression",VariableDeclaration:"VariableDeclaration",VariableDeclarator:"VariableDeclarator",WhileStatement:"WhileStatement",WithStatement:"WithStatement",YieldExpression:"YieldExpression"}},function(module,exports,__webpack_require__){"use strict";var assert_1=__webpack_require__(4);var messages_1=__webpack_require__(5);var error_handler_1=__webpack_require__(6);var token_1=__webpack_require__(7);var scanner_1=__webpack_require__(8);var syntax_1=__webpack_require__(2);var Node=__webpack_require__(10);var ArrowParameterPlaceHolder="ArrowParameterPlaceHolder";var Parser=function(){function Parser(code,options,delegate){if(options===void 0){options={}}this.config={range:typeof options.range==="boolean"&&options.range,loc:typeof options.loc==="boolean"&&options.loc,source:null,tokens:typeof options.tokens==="boolean"&&options.tokens,comment:typeof options.comment==="boolean"&&options.comment,tolerant:typeof options.tolerant==="boolean"&&options.tolerant};if(this.config.loc&&options.source&&options.source!==null){this.config.source=String(options.source)}this.delegate=delegate;this.errorHandler=new error_handler_1.ErrorHandler;this.errorHandler.tolerant=this.config.tolerant;this.scanner=new scanner_1.Scanner(code,this.errorHandler);this.scanner.trackComment=this.config.comment;this.operatorPrecedence={")":0,";":0,",":0,"=":0,"]":0,"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":11,"/":11,"%":11};this.sourceType=options&&options.sourceType==="module"?"module":"script";this.lookahead=null;this.hasLineTerminator=false;this.context={allowIn:true,allowYield:true,firstCoverInitializedNameError:null,isAssignmentTarget:false,isBindingElement:false,inFunctionBody:false,inIteration:false,inSwitch:false,labelSet:{},strict:this.sourceType==="module"};this.tokens=[];this.startMarker={index:0,lineNumber:this.scanner.lineNumber,lineStart:0};this.lastMarker={index:0,lineNumber:this.scanner.lineNumber,lineStart:0};this.nextToken();this.lastMarker={index:this.scanner.index,lineNumber:this.scanner.lineNumber,lineStart:this.scanner.lineStart}}Parser.prototype.throwError=function(messageFormat){var values=[];for(var _i=1;_i<arguments.length;_i++){values[_i-1]=arguments[_i]}var args=Array.prototype.slice.call(arguments,1);var msg=messageFormat.replace(/%(\d)/g,function(whole,idx){assert_1.assert(idx<args.length,"Message reference must be in range");return args[idx]});var index=this.lastMarker.index;var line=this.lastMarker.lineNumber;var column=this.lastMarker.index-this.lastMarker.lineStart+1;throw this.errorHandler.createError(index,line,column,msg)};Parser.prototype.tolerateError=function(messageFormat){var values=[];for(var _i=1;_i<arguments.length;_i++){values[_i-1]=arguments[_i]}var args=Array.prototype.slice.call(arguments,1);var msg=messageFormat.replace(/%(\d)/g,function(whole,idx){assert_1.assert(idx<args.length,"Message reference must be in range");return args[idx]});var index=this.lastMarker.index;var line=this.scanner.lineNumber;var column=this.lastMarker.index-this.lastMarker.lineStart+1;this.errorHandler.tolerateError(index,line,column,msg)};Parser.prototype.unexpectedTokenError=function(token,message){var msg=message||messages_1.Messages.UnexpectedToken;var value;if(token){if(!message){msg=token.type===token_1.Token.EOF?messages_1.Messages.UnexpectedEOS:token.type===token_1.Token.Identifier?messages_1.Messages.UnexpectedIdentifier:token.type===token_1.Token.NumericLiteral?messages_1.Messages.UnexpectedNumber:token.type===token_1.Token.StringLiteral?messages_1.Messages.UnexpectedString:token.type===token_1.Token.Template?messages_1.Messages.UnexpectedTemplate:messages_1.Messages.UnexpectedToken;if(token.type===token_1.Token.Keyword){if(this.scanner.isFutureReservedWord(token.value)){msg=messages_1.Messages.UnexpectedReserved}else if(this.context.strict&&this.scanner.isStrictModeReservedWord(token.value)){msg=messages_1.Messages.StrictReservedWord}}}value=token.type===token_1.Token.Template?token.value.raw:token.value}else{value="ILLEGAL"}msg=msg.replace("%0",value);if(token&&typeof token.lineNumber==="number"){var index=token.start;var line=token.lineNumber;var column=token.start-this.lastMarker.lineStart+1;return this.errorHandler.createError(index,line,column,msg)}else{var index=this.lastMarker.index;var line=this.lastMarker.lineNumber;var column=index-this.lastMarker.lineStart+1;return this.errorHandler.createError(index,line,column,msg)}};Parser.prototype.throwUnexpectedToken=function(token,message){throw this.unexpectedTokenError(token,message)};Parser.prototype.tolerateUnexpectedToken=function(token,message){this.errorHandler.tolerate(this.unexpectedTokenError(token,message))};Parser.prototype.collectComments=function(){if(!this.config.comment){this.scanner.scanComments()}else{var comments=this.scanner.scanComments();if(comments.length>0&&this.delegate){for(var i=0;i<comments.length;++i){var e=comments[i];var node=void 0;node={type:e.multiLine?"BlockComment":"LineComment",value:this.scanner.source.slice(e.slice[0],e.slice[1])};if(this.config.range){node.range=e.range}if(this.config.loc){node.loc=e.loc}var metadata={start:{line:e.loc.start.line,column:e.loc.start.column,offset:e.range[0]},end:{line:e.loc.end.line,column:e.loc.end.column,offset:e.range[1]}};this.delegate(node,metadata)}}}};Parser.prototype.getTokenRaw=function(token){return this.scanner.source.slice(token.start,token.end)};Parser.prototype.convertToken=function(token){var t;t={type:token_1.TokenName[token.type],value:this.getTokenRaw(token)};if(this.config.range){t.range=[token.start,token.end]}if(this.config.loc){t.loc={start:{line:this.startMarker.lineNumber,column:this.startMarker.index-this.startMarker.lineStart},end:{line:this.scanner.lineNumber,column:this.scanner.index-this.scanner.lineStart}}}if(token.regex){t.regex=token.regex}return t};Parser.prototype.nextToken=function(){var token=this.lookahead;this.lastMarker.index=this.scanner.index;this.lastMarker.lineNumber=this.scanner.lineNumber;this.lastMarker.lineStart=this.scanner.lineStart;this.collectComments();this.startMarker.index=this.scanner.index;this.startMarker.lineNumber=this.scanner.lineNumber;this.startMarker.lineStart=this.scanner.lineStart;var next;next=this.scanner.lex();this.hasLineTerminator=token&&next?token.lineNumber!==next.lineNumber:false;if(next&&this.context.strict&&next.type===token_1.Token.Identifier){if(this.scanner.isStrictModeReservedWord(next.value)){next.type=token_1.Token.Keyword}}this.lookahead=next;if(this.config.tokens&&next.type!==token_1.Token.EOF){this.tokens.push(this.convertToken(next))}return token};Parser.prototype.nextRegexToken=function(){this.collectComments();var token=this.scanner.scanRegExp();if(this.config.tokens){this.tokens.pop();this.tokens.push(this.convertToken(token))}this.lookahead=token;this.nextToken();return token};Parser.prototype.createNode=function(){return{index:this.startMarker.index,line:this.startMarker.lineNumber,column:this.startMarker.index-this.startMarker.lineStart}};Parser.prototype.startNode=function(token){return{index:token.start,line:token.lineNumber,column:token.start-token.lineStart}};Parser.prototype.finalize=function(meta,node){if(this.config.range){node.range=[meta.index,this.lastMarker.index]}if(this.config.loc){node.loc={start:{line:meta.line,column:meta.column},end:{line:this.lastMarker.lineNumber,column:this.lastMarker.index-this.lastMarker.lineStart}};if(this.config.source){node.loc.source=this.config.source}}if(this.delegate){var metadata={start:{line:meta.line,column:meta.column,offset:meta.index},end:{line:this.lastMarker.lineNumber,column:this.lastMarker.index-this.lastMarker.lineStart,offset:this.lastMarker.index}};this.delegate(node,metadata)}return node};Parser.prototype.expect=function(value){var token=this.nextToken();if(token.type!==token_1.Token.Punctuator||token.value!==value){this.throwUnexpectedToken(token)}};Parser.prototype.expectCommaSeparator=function(){if(this.config.tolerant){var token=this.lookahead;if(token.type===token_1.Token.Punctuator&&token.value===","){this.nextToken()}else if(token.type===token_1.Token.Punctuator&&token.value===";"){this.nextToken();this.tolerateUnexpectedToken(token)}else{this.tolerateUnexpectedToken(token,messages_1.Messages.UnexpectedToken)}}else{this.expect(",")}};Parser.prototype.expectKeyword=function(keyword){var token=this.nextToken();if(token.type!==token_1.Token.Keyword||token.value!==keyword){this.throwUnexpectedToken(token)}};Parser.prototype.match=function(value){return this.lookahead.type===token_1.Token.Punctuator&&this.lookahead.value===value};Parser.prototype.matchKeyword=function(keyword){return this.lookahead.type===token_1.Token.Keyword&&this.lookahead.value===keyword};Parser.prototype.matchContextualKeyword=function(keyword){return this.lookahead.type===token_1.Token.Identifier&&this.lookahead.value===keyword};Parser.prototype.matchAssign=function(){if(this.lookahead.type!==token_1.Token.Punctuator){return false}var op=this.lookahead.value;return op==="="||op==="*="||op==="**="||op==="/="||op==="%="||op==="+="||op==="-="||op==="<<="||op===">>="||op===">>>="||op==="&="||op==="^="||op==="|="};Parser.prototype.isolateCoverGrammar=function(parseFunction){var previousIsBindingElement=this.context.isBindingElement;var previousIsAssignmentTarget=this.context.isAssignmentTarget;var previousFirstCoverInitializedNameError=this.context.firstCoverInitializedNameError;this.context.isBindingElement=true;this.context.isAssignmentTarget=true;this.context.firstCoverInitializedNameError=null;var result=parseFunction.call(this);if(this.context.firstCoverInitializedNameError!==null){this.throwUnexpectedToken(this.context.firstCoverInitializedNameError)}this.context.isBindingElement=previousIsBindingElement;this.context.isAssignmentTarget=previousIsAssignmentTarget;this.context.firstCoverInitializedNameError=previousFirstCoverInitializedNameError;return result};Parser.prototype.inheritCoverGrammar=function(parseFunction){var previousIsBindingElement=this.context.isBindingElement;var previousIsAssignmentTarget=this.context.isAssignmentTarget;var previousFirstCoverInitializedNameError=this.context.firstCoverInitializedNameError;this.context.isBindingElement=true;this.context.isAssignmentTarget=true;this.context.firstCoverInitializedNameError=null;var result=parseFunction.call(this);this.context.isBindingElement=this.context.isBindingElement&&previousIsBindingElement;this.context.isAssignmentTarget=this.context.isAssignmentTarget&&previousIsAssignmentTarget;this.context.firstCoverInitializedNameError=previousFirstCoverInitializedNameError||this.context.firstCoverInitializedNameError;return result};Parser.prototype.consumeSemicolon=function(){if(this.match(";")){this.nextToken()}else if(!this.hasLineTerminator){if(this.lookahead.type!==token_1.Token.EOF&&!this.match("}")){this.throwUnexpectedToken(this.lookahead)}this.lastMarker.index=this.startMarker.index;this.lastMarker.lineNumber=this.startMarker.lineNumber;this.lastMarker.lineStart=this.startMarker.lineStart}};Parser.prototype.parsePrimaryExpression=function(){var node=this.createNode();var expr;var value,token,raw;switch(this.lookahead.type){case token_1.Token.Identifier:if(this.sourceType==="module"&&this.lookahead.value==="await"){this.tolerateUnexpectedToken(this.lookahead)}expr=this.finalize(node,new Node.Identifier(this.nextToken().value));break;case token_1.Token.NumericLiteral:case token_1.Token.StringLiteral:if(this.context.strict&&this.lookahead.octal){this.tolerateUnexpectedToken(this.lookahead,messages_1.Messages.StrictOctalLiteral)}this.context.isAssignmentTarget=false;this.context.isBindingElement=false;token=this.nextToken();raw=this.getTokenRaw(token);expr=this.finalize(node,new Node.Literal(token.value,raw));break;case token_1.Token.BooleanLiteral:this.context.isAssignmentTarget=false;this.context.isBindingElement=false;token=this.nextToken();token.value=token.value==="true";raw=this.getTokenRaw(token);expr=this.finalize(node,new Node.Literal(token.value,raw));break;case token_1.Token.NullLiteral:this.context.isAssignmentTarget=false;this.context.isBindingElement=false;token=this.nextToken();token.value=null;raw=this.getTokenRaw(token);expr=this.finalize(node,new Node.Literal(token.value,raw));break;case token_1.Token.Template:expr=this.parseTemplateLiteral();break;case token_1.Token.Punctuator:value=this.lookahead.value;switch(value){case"(":this.context.isBindingElement=false;expr=this.inheritCoverGrammar(this.parseGroupExpression);break;case"[":expr=this.inheritCoverGrammar(this.parseArrayInitializer);break;case"{":expr=this.inheritCoverGrammar(this.parseObjectInitializer);break;case"/":case"/=":this.context.isAssignmentTarget=false;this.context.isBindingElement=false;this.scanner.index=this.startMarker.index;token=this.nextRegexToken();raw=this.getTokenRaw(token);expr=this.finalize(node,new Node.RegexLiteral(token.value,raw,token.regex));break;default:this.throwUnexpectedToken(this.nextToken())}break;case token_1.Token.Keyword:if(!this.context.strict&&this.context.allowYield&&this.matchKeyword("yield")){expr=this.parseIdentifierName()}else if(!this.context.strict&&this.matchKeyword("let")){expr=this.finalize(node,new Node.Identifier(this.nextToken().value))}else{this.context.isAssignmentTarget=false;this.context.isBindingElement=false;if(this.matchKeyword("function")){expr=this.parseFunctionExpression()}else if(this.matchKeyword("this")){this.nextToken();expr=this.finalize(node,new Node.ThisExpression)}else if(this.matchKeyword("class")){expr=this.parseClassExpression()}else{this.throwUnexpectedToken(this.nextToken())}}break;default:this.throwUnexpectedToken(this.nextToken())}return expr};Parser.prototype.parseSpreadElement=function(){var node=this.createNode();this.expect("...");var arg=this.inheritCoverGrammar(this.parseAssignmentExpression);return this.finalize(node,new Node.SpreadElement(arg))};Parser.prototype.parseArrayInitializer=function(){var node=this.createNode();var elements=[];this.expect("[");while(!this.match("]")){if(this.match(",")){this.nextToken();elements.push(null)}else if(this.match("...")){var element=this.parseSpreadElement();if(!this.match("]")){this.context.isAssignmentTarget=false;this.context.isBindingElement=false;this.expect(",")}elements.push(element)}else{elements.push(this.inheritCoverGrammar(this.parseAssignmentExpression));if(!this.match("]")){this.expect(",")}}}this.expect("]");return this.finalize(node,new Node.ArrayExpression(elements))};Parser.prototype.parsePropertyMethod=function(params){this.context.isAssignmentTarget=false;this.context.isBindingElement=false;var previousStrict=this.context.strict;var body=this.isolateCoverGrammar(this.parseFunctionSourceElements);if(this.context.strict&&params.firstRestricted){this.tolerateUnexpectedToken(params.firstRestricted,params.message)}if(this.context.strict&&params.stricted){this.tolerateUnexpectedToken(params.stricted,params.message)}this.context.strict=previousStrict;return body};Parser.prototype.parsePropertyMethodFunction=function(){var isGenerator=false;var node=this.createNode();var previousAllowYield=this.context.allowYield;this.context.allowYield=false;var params=this.parseFormalParameters();var method=this.parsePropertyMethod(params);this.context.allowYield=previousAllowYield;return this.finalize(node,new Node.FunctionExpression(null,params.params,method,isGenerator))};Parser.prototype.parseObjectPropertyKey=function(){var node=this.createNode();var token=this.nextToken();var key=null;switch(token.type){case token_1.Token.StringLiteral:case token_1.Token.NumericLiteral:if(this.context.strict&&token.octal){this.tolerateUnexpectedToken(token,messages_1.Messages.StrictOctalLiteral)}var raw=this.getTokenRaw(token);key=this.finalize(node,new Node.Literal(token.value,raw));break;case token_1.Token.Identifier:case token_1.Token.BooleanLiteral:case token_1.Token.NullLiteral:case token_1.Token.Keyword:key=this.finalize(node,new Node.Identifier(token.value));break;case token_1.Token.Punctuator:if(token.value==="["){key=this.isolateCoverGrammar(this.parseAssignmentExpression);this.expect("]")}else{this.throwUnexpectedToken(token)}break;default:this.throwUnexpectedToken(token)}return key};Parser.prototype.isPropertyKey=function(key,value){return key.type===syntax_1.Syntax.Identifier&&key.name===value||key.type===syntax_1.Syntax.Literal&&key.value===value};Parser.prototype.parseObjectProperty=function(hasProto){var node=this.createNode();var token=this.lookahead;var kind;var key;var value;var computed=false;var method=false;var shorthand=false;if(token.type===token_1.Token.Identifier){this.nextToken();key=this.finalize(node,new Node.Identifier(token.value))}else if(this.match("*")){this.nextToken()}else{computed=this.match("[");key=this.parseObjectPropertyKey()}var lookaheadPropertyKey=this.qualifiedPropertyName(this.lookahead);if(token.type===token_1.Token.Identifier&&token.value==="get"&&lookaheadPropertyKey){kind="get";computed=this.match("[");key=this.parseObjectPropertyKey();this.context.allowYield=false;value=this.parseGetterMethod()}else if(token.type===token_1.Token.Identifier&&token.value==="set"&&lookaheadPropertyKey){kind="set";computed=this.match("[");key=this.parseObjectPropertyKey();value=this.parseSetterMethod()}else if(token.type===token_1.Token.Punctuator&&token.value==="*"&&lookaheadPropertyKey){kind="init";computed=this.match("[");key=this.parseObjectPropertyKey();value=this.parseGeneratorMethod();method=true}else{if(!key){this.throwUnexpectedToken(this.lookahead)}kind="init";if(this.match(":")){if(!computed&&this.isPropertyKey(key,"__proto__")){if(hasProto.value){this.tolerateError(messages_1.Messages.DuplicateProtoProperty)}hasProto.value=true}this.nextToken();value=this.inheritCoverGrammar(this.parseAssignmentExpression)}else if(this.match("(")){value=this.parsePropertyMethodFunction();method=true}else if(token.type===token_1.Token.Identifier){var id=this.finalize(node,new Node.Identifier(token.value));if(this.match("=")){this.context.firstCoverInitializedNameError=this.lookahead;this.nextToken();shorthand=true;var init=this.isolateCoverGrammar(this.parseAssignmentExpression);value=this.finalize(node,new Node.AssignmentPattern(id,init))}else{shorthand=true;value=id}}else{this.throwUnexpectedToken(this.nextToken())}}return this.finalize(node,new Node.Property(kind,key,computed,value,method,shorthand))};Parser.prototype.parseObjectInitializer=function(){var node=this.createNode();this.expect("{");var properties=[];var hasProto={value:false};while(!this.match("}")){properties.push(this.parseObjectProperty(hasProto));if(!this.match("}")){this.expectCommaSeparator()}}this.expect("}");return this.finalize(node,new Node.ObjectExpression(properties))};Parser.prototype.parseTemplateHead=function(){assert_1.assert(this.lookahead.head,"Template literal must start with a template head");var node=this.createNode();var token=this.nextToken();var value={raw:token.value.raw,cooked:token.value.cooked};return this.finalize(node,new Node.TemplateElement(value,token.tail))};Parser.prototype.parseTemplateElement=function(){if(this.lookahead.type!==token_1.Token.Template){this.throwUnexpectedToken()}var node=this.createNode();var token=this.nextToken();var value={raw:token.value.raw,cooked:token.value.cooked};return this.finalize(node,new Node.TemplateElement(value,token.tail))};Parser.prototype.parseTemplateLiteral=function(){var node=this.createNode();var expressions=[];var quasis=[];var quasi=this.parseTemplateHead();quasis.push(quasi);while(!quasi.tail){expressions.push(this.parseExpression());quasi=this.parseTemplateElement();quasis.push(quasi)}return this.finalize(node,new Node.TemplateLiteral(quasis,expressions))};Parser.prototype.reinterpretExpressionAsPattern=function(expr){switch(expr.type){case syntax_1.Syntax.Identifier:case syntax_1.Syntax.MemberExpression:case syntax_1.Syntax.RestElement:case syntax_1.Syntax.AssignmentPattern:break;case syntax_1.Syntax.SpreadElement:expr.type=syntax_1.Syntax.RestElement;this.reinterpretExpressionAsPattern(expr.argument);break;case syntax_1.Syntax.ArrayExpression:expr.type=syntax_1.Syntax.ArrayPattern;for(var i=0;i<expr.elements.length;i++){if(expr.elements[i]!==null){this.reinterpretExpressionAsPattern(expr.elements[i])}}break;case syntax_1.Syntax.ObjectExpression:expr.type=syntax_1.Syntax.ObjectPattern;for(var i=0;i<expr.properties.length;i++){this.reinterpretExpressionAsPattern(expr.properties[i].value)}break;case syntax_1.Syntax.AssignmentExpression:expr.type=syntax_1.Syntax.AssignmentPattern;delete expr.operator;this.reinterpretExpressionAsPattern(expr.left);break;default:break}};Parser.prototype.parseGroupExpression=function(){var expr;this.expect("(");if(this.match(")")){this.nextToken();if(!this.match("=>")){this.expect("=>")}expr={type:ArrowParameterPlaceHolder,params:[]}}else{var startToken=this.lookahead;var params=[];if(this.match("...")){expr=this.parseRestElement(params);this.expect(")");if(!this.match("=>")){this.expect("=>")}expr={type:ArrowParameterPlaceHolder,params:[expr]}}else{var arrow=false;this.context.isBindingElement=true;expr=this.inheritCoverGrammar(this.parseAssignmentExpression);if(this.match(",")){var expressions=[];this.context.isAssignmentTarget=false;expressions.push(expr);while(this.startMarker.index<this.scanner.length){if(!this.match(",")){break}this.nextToken();if(this.match("...")){if(!this.context.isBindingElement){this.throwUnexpectedToken(this.lookahead)}expressions.push(this.parseRestElement(params));this.expect(")");if(!this.match("=>")){this.expect("=>")}this.context.isBindingElement=false;for(var i=0;i<expressions.length;i++){this.reinterpretExpressionAsPattern(expressions[i])}arrow=true;expr={type:ArrowParameterPlaceHolder,params:expressions}}else{expressions.push(this.inheritCoverGrammar(this.parseAssignmentExpression))}if(arrow){break}}if(!arrow){expr=this.finalize(this.startNode(startToken),new Node.SequenceExpression(expressions))}}if(!arrow){this.expect(")");if(this.match("=>")){if(expr.type===syntax_1.Syntax.Identifier&&expr.name==="yield"){arrow=true;expr={type:ArrowParameterPlaceHolder,params:[expr]}}if(!arrow){if(!this.context.isBindingElement){this.throwUnexpectedToken(this.lookahead)}if(expr.type===syntax_1.Syntax.SequenceExpression){for(var i=0;i<expr.expressions.length;i++){this.reinterpretExpressionAsPattern(expr.expressions[i])}}else{this.reinterpretExpressionAsPattern(expr)}var params_1=expr.type===syntax_1.Syntax.SequenceExpression?expr.expressions:[expr];expr={type:ArrowParameterPlaceHolder,params:params_1}}}this.context.isBindingElement=false}}}return expr};Parser.prototype.parseArguments=function(){this.expect("(");var args=[];if(!this.match(")")){while(true){var expr=this.match("...")?this.parseSpreadElement():this.isolateCoverGrammar(this.parseAssignmentExpression);args.push(expr);if(this.match(")")){break}this.expectCommaSeparator()}}this.expect(")");return args};Parser.prototype.isIdentifierName=function(token){return token.type===token_1.Token.Identifier||token.type===token_1.Token.Keyword||token.type===token_1.Token.BooleanLiteral||token.type===token_1.Token.NullLiteral};Parser.prototype.parseIdentifierName=function(){var node=this.createNode();var token=this.nextToken();if(!this.isIdentifierName(token)){this.throwUnexpectedToken(token)}return this.finalize(node,new Node.Identifier(token.value))};Parser.prototype.parseNewExpression=function(){var node=this.createNode();var id=this.parseIdentifierName();assert_1.assert(id.name==="new","New expression must start with `new`");var expr;if(this.match(".")){this.nextToken();if(this.lookahead.type===token_1.Token.Identifier&&this.context.inFunctionBody&&this.lookahead.value==="target"){var property=this.parseIdentifierName();expr=new Node.MetaProperty(id,property)}else{this.throwUnexpectedToken(this.lookahead)}}else{var callee=this.isolateCoverGrammar(this.parseLeftHandSideExpression);var args=this.match("(")?this.parseArguments():[];expr=new Node.NewExpression(callee,args);this.context.isAssignmentTarget=false;this.context.isBindingElement=false}return this.finalize(node,expr)};Parser.prototype.parseLeftHandSideExpressionAllowCall=function(){var startToken=this.lookahead;var previousAllowIn=this.context.allowIn;this.context.allowIn=true;var expr;if(this.matchKeyword("super")&&this.context.inFunctionBody){expr=this.createNode();this.nextToken();expr=this.finalize(expr,new Node.Super);if(!this.match("(")&&!this.match(".")&&!this.match("[")){this.throwUnexpectedToken(this.lookahead)}}else{expr=this.inheritCoverGrammar(this.matchKeyword("new")?this.parseNewExpression:this.parsePrimaryExpression)}while(true){if(this.match(".")){this.context.isBindingElement=false;this.context.isAssignmentTarget=true;this.expect(".");var property=this.parseIdentifierName();expr=this.finalize(this.startNode(startToken),new Node.StaticMemberExpression(expr,property))}else if(this.match("(")){this.context.isBindingElement=false;this.context.isAssignmentTarget=false;var args=this.parseArguments();expr=this.finalize(this.startNode(startToken),new Node.CallExpression(expr,args))}else if(this.match("[")){this.context.isBindingElement=false;this.context.isAssignmentTarget=true;this.expect("[");var property=this.isolateCoverGrammar(this.parseExpression);this.expect("]");expr=this.finalize(this.startNode(startToken),new Node.ComputedMemberExpression(expr,property))}else if(this.lookahead.type===token_1.Token.Template&&this.lookahead.head){var quasi=this.parseTemplateLiteral();expr=this.finalize(this.startNode(startToken),new Node.TaggedTemplateExpression(expr,quasi))}else{break}}this.context.allowIn=previousAllowIn;return expr};Parser.prototype.parseSuper=function(){var node=this.createNode();this.expectKeyword("super");if(!this.match("[")&&!this.match(".")){this.throwUnexpectedToken(this.lookahead)}return this.finalize(node,new Node.Super)};Parser.prototype.parseLeftHandSideExpression=function(){assert_1.assert(this.context.allowIn,"callee of new expression always allow in keyword.");var node=this.startNode(this.lookahead);var expr=this.matchKeyword("super")&&this.context.inFunctionBody?this.parseSuper():this.inheritCoverGrammar(this.matchKeyword("new")?this.parseNewExpression:this.parsePrimaryExpression);while(true){if(this.match("[")){this.context.isBindingElement=false;this.context.isAssignmentTarget=true;this.expect("[");var property=this.isolateCoverGrammar(this.parseExpression);this.expect("]");expr=this.finalize(node,new Node.ComputedMemberExpression(expr,property))}else if(this.match(".")){this.context.isBindingElement=false;this.context.isAssignmentTarget=true;this.expect(".");var property=this.parseIdentifierName();expr=this.finalize(node,new Node.StaticMemberExpression(expr,property))}else if(this.lookahead.type===token_1.Token.Template&&this.lookahead.head){var quasi=this.parseTemplateLiteral();expr=this.finalize(node,new Node.TaggedTemplateExpression(expr,quasi))}else{break}}return expr};Parser.prototype.parseUpdateExpression=function(){var expr;var startToken=this.lookahead;if(this.match("++")||this.match("--")){var node=this.startNode(startToken);var token=this.nextToken();expr=this.inheritCoverGrammar(this.parseUnaryExpression);if(this.context.strict&&expr.type===syntax_1.Syntax.Identifier&&this.scanner.isRestrictedWord(expr.name)){this.tolerateError(messages_1.Messages.StrictLHSPrefix)}if(!this.context.isAssignmentTarget){this.tolerateError(messages_1.Messages.InvalidLHSInAssignment)}var prefix=true;expr=this.finalize(node,new Node.UpdateExpression(token.value,expr,prefix));this.context.isAssignmentTarget=false;this.context.isBindingElement=false}else{expr=this.inheritCoverGrammar(this.parseLeftHandSideExpressionAllowCall);if(!this.hasLineTerminator&&this.lookahead.type===token_1.Token.Punctuator){if(this.match("++")||this.match("--")){if(this.context.strict&&expr.type===syntax_1.Syntax.Identifier&&this.scanner.isRestrictedWord(expr.name)){this.tolerateError(messages_1.Messages.StrictLHSPostfix)}if(!this.context.isAssignmentTarget){this.tolerateError(messages_1.Messages.InvalidLHSInAssignment)}this.context.isAssignmentTarget=false;this.context.isBindingElement=false;var operator=this.nextToken().value;var prefix=false;expr=this.finalize(this.startNode(startToken),new Node.UpdateExpression(operator,expr,prefix))}}}return expr};Parser.prototype.parseUnaryExpression=function(){var expr;if(this.match("+")||this.match("-")||this.match("~")||this.match("!")||this.matchKeyword("delete")||this.matchKeyword("void")||this.matchKeyword("typeof")){var node=this.startNode(this.lookahead);var token=this.nextToken();expr=this.inheritCoverGrammar(this.parseUnaryExpression);expr=this.finalize(node,new Node.UnaryExpression(token.value,expr));if(this.context.strict&&expr.operator==="delete"&&expr.argument.type===syntax_1.Syntax.Identifier){this.tolerateError(messages_1.Messages.StrictDelete)}this.context.isAssignmentTarget=false;this.context.isBindingElement=false}else{expr=this.parseUpdateExpression()}return expr};Parser.prototype.parseExponentiationExpression=function(){var startToken=this.lookahead;var expr=this.inheritCoverGrammar(this.parseUnaryExpression);if(expr.type!==syntax_1.Syntax.UnaryExpression&&this.match("**")){this.nextToken();this.context.isAssignmentTarget=false;this.context.isBindingElement=false;var left=expr;var right=this.isolateCoverGrammar(this.parseExponentiationExpression);expr=this.finalize(this.startNode(startToken),new Node.BinaryExpression("**",left,right))}return expr};Parser.prototype.binaryPrecedence=function(token){var op=token.value;var precedence;if(token.type===token_1.Token.Punctuator){precedence=this.operatorPrecedence[op]||0}else if(token.type===token_1.Token.Keyword){precedence=op==="instanceof"||this.context.allowIn&&op==="in"?7:0}else{precedence=0}return precedence};Parser.prototype.parseBinaryExpression=function(){var startToken=this.lookahead;var expr=this.inheritCoverGrammar(this.parseExponentiationExpression);var token=this.lookahead;var prec=this.binaryPrecedence(token);if(prec>0){this.nextToken();token.prec=prec;this.context.isAssignmentTarget=false;this.context.isBindingElement=false;var markers=[startToken,this.lookahead];var left=expr;var right=this.isolateCoverGrammar(this.parseExponentiationExpression);var stack=[left,token,right];while(true){prec=this.binaryPrecedence(this.lookahead);if(prec<=0){break}while(stack.length>2&&prec<=stack[stack.length-2].prec){right=stack.pop();var operator=stack.pop().value;left=stack.pop();markers.pop();var node=this.startNode(markers[markers.length-1]);stack.push(this.finalize(node,new Node.BinaryExpression(operator,left,right)))}token=this.nextToken();token.prec=prec;stack.push(token);markers.push(this.lookahead);stack.push(this.isolateCoverGrammar(this.parseExponentiationExpression))}var i=stack.length-1;expr=stack[i];markers.pop();while(i>1){var node=this.startNode(markers.pop());expr=this.finalize(node,new Node.BinaryExpression(stack[i-1].value,stack[i-2],expr));i-=2}}return expr};Parser.prototype.parseConditionalExpression=function(){var startToken=this.lookahead;var expr=this.inheritCoverGrammar(this.parseBinaryExpression);if(this.match("?")){this.nextToken();var previousAllowIn=this.context.allowIn;this.context.allowIn=true;var consequent=this.isolateCoverGrammar(this.parseAssignmentExpression);this.context.allowIn=previousAllowIn;this.expect(":");var alternate=this.isolateCoverGrammar(this.parseAssignmentExpression);expr=this.finalize(this.startNode(startToken),new Node.ConditionalExpression(expr,consequent,alternate));this.context.isAssignmentTarget=false;this.context.isBindingElement=false}return expr};Parser.prototype.checkPatternParam=function(options,param){switch(param.type){case syntax_1.Syntax.Identifier:this.validateParam(options,param,param.name);break;case syntax_1.Syntax.RestElement:this.checkPatternParam(options,param.argument);break;case syntax_1.Syntax.AssignmentPattern:this.checkPatternParam(options,param.left);break;case syntax_1.Syntax.ArrayPattern:for(var i=0;i<param.elements.length;i++){if(param.elements[i]!==null){this.checkPatternParam(options,param.elements[i])}}break;case syntax_1.Syntax.YieldExpression:break;default:assert_1.assert(param.type===syntax_1.Syntax.ObjectPattern,"Invalid type");for(var i=0;i<param.properties.length;i++){this.checkPatternParam(options,param.properties[i].value)}break}};Parser.prototype.reinterpretAsCoverFormalsList=function(expr){var params=[expr];var options;switch(expr.type){case syntax_1.Syntax.Identifier:break;case ArrowParameterPlaceHolder:params=expr.params;break;default:return null}options={paramSet:{}};for(var i=0;i<params.length;++i){var param=params[i];if(param.type===syntax_1.Syntax.AssignmentPattern){if(param.right.type===syntax_1.Syntax.YieldExpression){if(param.right.argument){this.throwUnexpectedToken(this.lookahead)}param.right.type=syntax_1.Syntax.Identifier;param.right.name="yield";delete param.right.argument;delete param.right.delegate}}this.checkPatternParam(options,param);params[i]=param}if(this.context.strict||!this.context.allowYield){for(var i=0;i<params.length;++i){var param=params[i];if(param.type===syntax_1.Syntax.YieldExpression){this.throwUnexpectedToken(this.lookahead)}}}if(options.message===messages_1.Messages.StrictParamDupe){var token=this.context.strict?options.stricted:options.firstRestricted;this.throwUnexpectedToken(token,options.message)}return{params:params,stricted:options.stricted,firstRestricted:options.firstRestricted,message:options.message}};Parser.prototype.parseAssignmentExpression=function(){var expr;if(!this.context.allowYield&&this.matchKeyword("yield")){expr=this.parseYieldExpression()}else{var startToken=this.lookahead;var token=startToken;expr=this.parseConditionalExpression();if(expr.type===ArrowParameterPlaceHolder||this.match("=>")){this.context.isAssignmentTarget=false;this.context.isBindingElement=false;var list=this.reinterpretAsCoverFormalsList(expr);if(list){if(this.hasLineTerminator){this.tolerateUnexpectedToken(this.lookahead)}this.context.firstCoverInitializedNameError=null;var previousStrict=this.context.strict;var previousAllowYield=this.context.allowYield;this.context.allowYield=true;var node=this.startNode(startToken);this.expect("=>");var body=this.match("{")?this.parseFunctionSourceElements():this.isolateCoverGrammar(this.parseAssignmentExpression);var expression=body.type!==syntax_1.Syntax.BlockStatement;if(this.context.strict&&list.firstRestricted){this.throwUnexpectedToken(list.firstRestricted,list.message)}if(this.context.strict&&list.stricted){this.tolerateUnexpectedToken(list.stricted,list.message)}expr=this.finalize(node,new Node.ArrowFunctionExpression(list.params,body,expression));this.context.strict=previousStrict;this.context.allowYield=previousAllowYield}}else{if(this.matchAssign()){if(!this.context.isAssignmentTarget){this.tolerateError(messages_1.Messages.InvalidLHSInAssignment)}if(this.context.strict&&expr.type===syntax_1.Syntax.Identifier){var id=expr;if(this.scanner.isRestrictedWord(id.name)){this.tolerateUnexpectedToken(token,messages_1.Messages.StrictLHSAssignment)}if(this.scanner.isStrictModeReservedWord(id.name)){this.tolerateUnexpectedToken(token,messages_1.Messages.StrictReservedWord)}}if(!this.match("=")){this.context.isAssignmentTarget=false;this.context.isBindingElement=false}else{this.reinterpretExpressionAsPattern(expr)}token=this.nextToken();var right=this.isolateCoverGrammar(this.parseAssignmentExpression);expr=this.finalize(this.startNode(startToken),new Node.AssignmentExpression(token.value,expr,right));this.context.firstCoverInitializedNameError=null}}}return expr};Parser.prototype.parseExpression=function(){var startToken=this.lookahead;var expr=this.isolateCoverGrammar(this.parseAssignmentExpression);if(this.match(",")){var expressions=[];expressions.push(expr);while(this.startMarker.index<this.scanner.length){if(!this.match(",")){break}this.nextToken();expressions.push(this.isolateCoverGrammar(this.parseAssignmentExpression))}expr=this.finalize(this.startNode(startToken),new Node.SequenceExpression(expressions))}return expr};Parser.prototype.parseStatementListItem=function(){var statement=null;this.context.isAssignmentTarget=true;this.context.isBindingElement=true;if(this.lookahead.type===token_1.Token.Keyword){switch(this.lookahead.value){case"export":if(this.sourceType!=="module"){this.tolerateUnexpectedToken(this.lookahead,messages_1.Messages.IllegalExportDeclaration)}statement=this.parseExportDeclaration();break;case"import":if(this.sourceType!=="module"){this.tolerateUnexpectedToken(this.lookahead,messages_1.Messages.IllegalImportDeclaration)}statement=this.parseImportDeclaration();break;case"const":statement=this.parseLexicalDeclaration({inFor:false});break;case"function":statement=this.parseFunctionDeclaration();break;case"class":statement=this.parseClassDeclaration();break;case"let":statement=this.isLexicalDeclaration()?this.parseLexicalDeclaration({inFor:false}):this.parseStatement();break;default:statement=this.parseStatement();break}}else{statement=this.parseStatement()}return statement};Parser.prototype.parseBlock=function(){var node=this.createNode();this.expect("{");var block=[];while(true){if(this.match("}")){break}block.push(this.parseStatementListItem())}this.expect("}");return this.finalize(node,new Node.BlockStatement(block))};Parser.prototype.parseLexicalBinding=function(kind,options){var node=this.createNode();var params=[];var id=this.parsePattern(params,kind);if(this.context.strict&&id.type===syntax_1.Syntax.Identifier){if(this.scanner.isRestrictedWord(id.name)){this.tolerateError(messages_1.Messages.StrictVarName)}}var init=null;if(kind==="const"){if(!this.matchKeyword("in")&&!this.matchContextualKeyword("of")){this.expect("=");init=this.isolateCoverGrammar(this.parseAssignmentExpression)}}else if(!options.inFor&&id.type!==syntax_1.Syntax.Identifier||this.match("=")){this.expect("=");init=this.isolateCoverGrammar(this.parseAssignmentExpression)}return this.finalize(node,new Node.VariableDeclarator(id,init))};Parser.prototype.parseBindingList=function(kind,options){var list=[this.parseLexicalBinding(kind,options)];while(this.match(",")){this.nextToken();list.push(this.parseLexicalBinding(kind,options))}return list};Parser.prototype.isLexicalDeclaration=function(){var previousIndex=this.scanner.index;var previousLineNumber=this.scanner.lineNumber;var previousLineStart=this.scanner.lineStart;this.collectComments();var next=this.scanner.lex();this.scanner.index=previousIndex;this.scanner.lineNumber=previousLineNumber;this.scanner.lineStart=previousLineStart;return next.type===token_1.Token.Identifier||next.type===token_1.Token.Punctuator&&next.value==="["||next.type===token_1.Token.Punctuator&&next.value==="{"||next.type===token_1.Token.Keyword&&next.value==="let"||next.type===token_1.Token.Keyword&&next.value==="yield"};Parser.prototype.parseLexicalDeclaration=function(options){var node=this.createNode();var kind=this.nextToken().value;assert_1.assert(kind==="let"||kind==="const","Lexical declaration must be either let or const");var declarations=this.parseBindingList(kind,options);this.consumeSemicolon();return this.finalize(node,new Node.VariableDeclaration(declarations,kind))};Parser.prototype.parseBindingRestElement=function(params,kind){var node=this.createNode();this.expect("...");var arg=this.parsePattern(params,kind);return this.finalize(node,new Node.RestElement(arg))};Parser.prototype.parseArrayPattern=function(params,kind){var node=this.createNode();this.expect("[");var elements=[];while(!this.match("]")){if(this.match(",")){this.nextToken();elements.push(null)}else{if(this.match("...")){elements.push(this.parseBindingRestElement(params,kind));break}else{elements.push(this.parsePatternWithDefault(params,kind))}if(!this.match("]")){this.expect(",")}}}this.expect("]");return this.finalize(node,new Node.ArrayPattern(elements))};Parser.prototype.parsePropertyPattern=function(params,kind){var node=this.createNode();var computed=false;var shorthand=false;var method=false;var key;var value;if(this.lookahead.type===token_1.Token.Identifier){var keyToken=this.lookahead;key=this.parseVariableIdentifier();var init=this.finalize(node,new Node.Identifier(keyToken.value));if(this.match("=")){params.push(keyToken);shorthand=true;this.nextToken();var expr=this.parseAssignmentExpression();value=this.finalize(this.startNode(keyToken),new Node.AssignmentPattern(init,expr))}else if(!this.match(":")){params.push(keyToken);shorthand=true;value=init}else{this.expect(":");value=this.parsePatternWithDefault(params,kind)}}else{computed=this.match("[");key=this.parseObjectPropertyKey();this.expect(":");value=this.parsePatternWithDefault(params,kind)}return this.finalize(node,new Node.Property("init",key,computed,value,method,shorthand))};Parser.prototype.parseObjectPattern=function(params,kind){var node=this.createNode();var properties=[];this.expect("{");while(!this.match("}")){properties.push(this.parsePropertyPattern(params,kind));if(!this.match("}")){this.expect(",")}}this.expect("}");return this.finalize(node,new Node.ObjectPattern(properties))};Parser.prototype.parsePattern=function(params,kind){var pattern;if(this.match("[")){pattern=this.parseArrayPattern(params,kind)}else if(this.match("{")){pattern=this.parseObjectPattern(params,kind)}else{if(this.matchKeyword("let")&&(kind==="const"||kind==="let")){this.tolerateUnexpectedToken(this.lookahead,messages_1.Messages.UnexpectedToken)}params.push(this.lookahead);pattern=this.parseVariableIdentifier(kind)}return pattern};Parser.prototype.parsePatternWithDefault=function(params,kind){var startToken=this.lookahead;var pattern=this.parsePattern(params,kind);if(this.match("=")){this.nextToken();var previousAllowYield=this.context.allowYield;this.context.allowYield=true;var right=this.isolateCoverGrammar(this.parseAssignmentExpression);this.context.allowYield=previousAllowYield;pattern=this.finalize(this.startNode(startToken),new Node.AssignmentPattern(pattern,right))}return pattern};Parser.prototype.parseVariableIdentifier=function(kind){var node=this.createNode();var token=this.nextToken();if(token.type===token_1.Token.Keyword&&token.value==="yield"){if(this.context.strict){this.tolerateUnexpectedToken(token,messages_1.Messages.StrictReservedWord)}if(!this.context.allowYield){this.throwUnexpectedToken(token)}}else if(token.type!==token_1.Token.Identifier){if(this.context.strict&&token.type===token_1.Token.Keyword&&this.scanner.isStrictModeReservedWord(token.value)){this.tolerateUnexpectedToken(token,messages_1.Messages.StrictReservedWord)}else{if(this.context.strict||token.value!=="let"||kind!=="var"){this.throwUnexpectedToken(token)}}}else if(this.sourceType==="module"&&token.type===token_1.Token.Identifier&&token.value==="await"){this.tolerateUnexpectedToken(token)}return this.finalize(node,new Node.Identifier(token.value))};Parser.prototype.parseVariableDeclaration=function(options){var node=this.createNode();var params=[];var id=this.parsePattern(params,"var");if(this.context.strict&&id.type===syntax_1.Syntax.Identifier){if(this.scanner.isRestrictedWord(id.name)){this.tolerateError(messages_1.Messages.StrictVarName)}}var init=null;if(this.match("=")){this.nextToken();init=this.isolateCoverGrammar(this.parseAssignmentExpression)}else if(id.type!==syntax_1.Syntax.Identifier&&!options.inFor){this.expect("=")}return this.finalize(node,new Node.VariableDeclarator(id,init))};Parser.prototype.parseVariableDeclarationList=function(options){var opt={inFor:options.inFor};var list=[];list.push(this.parseVariableDeclaration(opt));while(this.match(",")){this.nextToken();list.push(this.parseVariableDeclaration(opt))}return list};Parser.prototype.parseVariableStatement=function(){var node=this.createNode();this.expectKeyword("var");var declarations=this.parseVariableDeclarationList({inFor:false});this.consumeSemicolon();return this.finalize(node,new Node.VariableDeclaration(declarations,"var"))};Parser.prototype.parseEmptyStatement=function(){var node=this.createNode();this.expect(";");return this.finalize(node,new Node.EmptyStatement)};Parser.prototype.parseExpressionStatement=function(){var node=this.createNode();var expr=this.parseExpression();this.consumeSemicolon();return this.finalize(node,new Node.ExpressionStatement(expr))};Parser.prototype.parseIfStatement=function(){var node=this.createNode();var consequent;var alternate=null;this.expectKeyword("if");this.expect("(");var test=this.parseExpression();if(!this.match(")")&&this.config.tolerant){this.tolerateUnexpectedToken(this.nextToken());consequent=this.finalize(this.createNode(),new Node.EmptyStatement)}else{this.expect(")");consequent=this.parseStatement();if(this.matchKeyword("else")){this.nextToken();alternate=this.parseStatement()}}return this.finalize(node,new Node.IfStatement(test,consequent,alternate))};Parser.prototype.parseDoWhileStatement=function(){var node=this.createNode();this.expectKeyword("do");var previousInIteration=this.context.inIteration;this.context.inIteration=true;var body=this.parseStatement();this.context.inIteration=previousInIteration;this.expectKeyword("while");this.expect("(");var test=this.parseExpression();this.expect(")");if(this.match(";")){this.nextToken()}return this.finalize(node,new Node.DoWhileStatement(body,test))};Parser.prototype.parseWhileStatement=function(){var node=this.createNode();var body;this.expectKeyword("while");this.expect("(");var test=this.parseExpression();if(!this.match(")")&&this.config.tolerant){this.tolerateUnexpectedToken(this.nextToken());body=this.finalize(this.createNode(),new Node.EmptyStatement)}else{this.expect(")");var previousInIteration=this.context.inIteration;this.context.inIteration=true;body=this.parseStatement();this.context.inIteration=previousInIteration}return this.finalize(node,new Node.WhileStatement(test,body))};Parser.prototype.parseForStatement=function(){var init=null;var test=null;var update=null;var forIn=true;var left,right;var node=this.createNode();this.expectKeyword("for");this.expect("(");if(this.match(";")){this.nextToken()}else{if(this.matchKeyword("var")){init=this.createNode();this.nextToken();var previousAllowIn=this.context.allowIn;this.context.allowIn=false;var declarations=this.parseVariableDeclarationList({inFor:true});this.context.allowIn=previousAllowIn;if(declarations.length===1&&this.matchKeyword("in")){var decl=declarations[0];if(decl.init&&(decl.id.type===syntax_1.Syntax.ArrayPattern||decl.id.type===syntax_1.Syntax.ObjectPattern||this.context.strict)){this.tolerateError(messages_1.Messages.ForInOfLoopInitializer,"for-in")}init=this.finalize(init,new Node.VariableDeclaration(declarations,"var"));this.nextToken();left=init;right=this.parseExpression();init=null}else if(declarations.length===1&&declarations[0].init===null&&this.matchContextualKeyword("of")){init=this.finalize(init,new Node.VariableDeclaration(declarations,"var"));this.nextToken();left=init;right=this.parseAssignmentExpression();init=null;forIn=false}else{init=this.finalize(init,new Node.VariableDeclaration(declarations,"var"));this.expect(";")}}else if(this.matchKeyword("const")||this.matchKeyword("let")){init=this.createNode();var kind=this.nextToken().value;if(!this.context.strict&&this.lookahead.value==="in"){init=this.finalize(init,new Node.Identifier(kind));this.nextToken();left=init;right=this.parseExpression();init=null}else{var previousAllowIn=this.context.allowIn;this.context.allowIn=false;var declarations=this.parseBindingList(kind,{inFor:true});this.context.allowIn=previousAllowIn;if(declarations.length===1&&declarations[0].init===null&&this.matchKeyword("in")){init=this.finalize(init,new Node.VariableDeclaration(declarations,kind));this.nextToken();left=init;right=this.parseExpression();init=null}else if(declarations.length===1&&declarations[0].init===null&&this.matchContextualKeyword("of")){init=this.finalize(init,new Node.VariableDeclaration(declarations,kind));this.nextToken();left=init;right=this.parseAssignmentExpression();init=null;forIn=false}else{this.consumeSemicolon();init=this.finalize(init,new Node.VariableDeclaration(declarations,kind))}}}else{var initStartToken=this.lookahead;var previousAllowIn=this.context.allowIn;this.context.allowIn=false;init=this.inheritCoverGrammar(this.parseAssignmentExpression);this.context.allowIn=previousAllowIn;if(this.matchKeyword("in")){if(!this.context.isAssignmentTarget||init.type===syntax_1.Syntax.AssignmentExpression){this.tolerateError(messages_1.Messages.InvalidLHSInForIn)}this.nextToken();this.reinterpretExpressionAsPattern(init);left=init;right=this.parseExpression();init=null}else if(this.matchContextualKeyword("of")){if(!this.context.isAssignmentTarget||init.type===syntax_1.Syntax.AssignmentExpression){this.tolerateError(messages_1.Messages.InvalidLHSInForLoop)}this.nextToken();this.reinterpretExpressionAsPattern(init);left=init;right=this.parseAssignmentExpression();init=null;forIn=false}else{if(this.match(",")){var initSeq=[init];while(this.match(",")){this.nextToken();initSeq.push(this.isolateCoverGrammar(this.parseAssignmentExpression))}init=this.finalize(this.startNode(initStartToken),new Node.SequenceExpression(initSeq))}this.expect(";")}}}if(typeof left==="undefined"){if(!this.match(";")){test=this.parseExpression()}this.expect(";");if(!this.match(")")){update=this.parseExpression()}}var body;if(!this.match(")")&&this.config.tolerant){this.tolerateUnexpectedToken(this.nextToken());body=this.finalize(this.createNode(),new Node.EmptyStatement)}else{this.expect(")");var previousInIteration=this.context.inIteration;this.context.inIteration=true;body=this.isolateCoverGrammar(this.parseStatement);this.context.inIteration=previousInIteration}return typeof left==="undefined"?this.finalize(node,new Node.ForStatement(init,test,update,body)):forIn?this.finalize(node,new Node.ForInStatement(left,right,body)):this.finalize(node,new Node.ForOfStatement(left,right,body))};Parser.prototype.parseContinueStatement=function(){var node=this.createNode();this.expectKeyword("continue");var label=null;if(this.lookahead.type===token_1.Token.Identifier&&!this.hasLineTerminator){label=this.parseVariableIdentifier();var key="$"+label.name;if(!Object.prototype.hasOwnProperty.call(this.context.labelSet,key)){this.throwError(messages_1.Messages.UnknownLabel,label.name)}}this.consumeSemicolon();if(label===null&&!this.context.inIteration){this.throwError(messages_1.Messages.IllegalContinue)}return this.finalize(node,new Node.ContinueStatement(label))};Parser.prototype.parseBreakStatement=function(){var node=this.createNode();this.expectKeyword("break");var label=null;if(this.lookahead.type===token_1.Token.Identifier&&!this.hasLineTerminator){label=this.parseVariableIdentifier();var key="$"+label.name;if(!Object.prototype.hasOwnProperty.call(this.context.labelSet,key)){this.throwError(messages_1.Messages.UnknownLabel,label.name)}}this.consumeSemicolon();if(label===null&&!this.context.inIteration&&!this.context.inSwitch){this.throwError(messages_1.Messages.IllegalBreak)}return this.finalize(node,new Node.BreakStatement(label))};Parser.prototype.parseReturnStatement=function(){if(!this.context.inFunctionBody){this.tolerateError(messages_1.Messages.IllegalReturn)}var node=this.createNode();this.expectKeyword("return");var hasArgument=!this.match(";")&&!this.match("}")&&!this.hasLineTerminator&&this.lookahead.type!==token_1.Token.EOF;var argument=hasArgument?this.parseExpression():null;this.consumeSemicolon();return this.finalize(node,new Node.ReturnStatement(argument))};Parser.prototype.parseWithStatement=function(){if(this.context.strict){this.tolerateError(messages_1.Messages.StrictModeWith)}var node=this.createNode();this.expectKeyword("with");this.expect("(");var object=this.parseExpression();this.expect(")");var body=this.parseStatement();return this.finalize(node,new Node.WithStatement(object,body))};Parser.prototype.parseSwitchCase=function(){var node=this.createNode();var test;if(this.matchKeyword("default")){this.nextToken();test=null}else{this.expectKeyword("case");test=this.parseExpression()}this.expect(":");var consequent=[];while(true){if(this.match("}")||this.matchKeyword("default")||this.matchKeyword("case")){break}consequent.push(this.parseStatementListItem())}return this.finalize(node,new Node.SwitchCase(test,consequent))};Parser.prototype.parseSwitchStatement=function(){var node=this.createNode();this.expectKeyword("switch");this.expect("(");var discriminant=this.parseExpression();this.expect(")");var previousInSwitch=this.context.inSwitch;this.context.inSwitch=true;var cases=[];var defaultFound=false;this.expect("{");while(true){if(this.match("}")){break}var clause=this.parseSwitchCase();if(clause.test===null){if(defaultFound){this.throwError(messages_1.Messages.MultipleDefaultsInSwitch)}defaultFound=true}cases.push(clause)}this.expect("}");this.context.inSwitch=previousInSwitch;return this.finalize(node,new Node.SwitchStatement(discriminant,cases))};Parser.prototype.parseLabelledStatement=function(){var node=this.createNode();var expr=this.parseExpression();var statement;if(expr.type===syntax_1.Syntax.Identifier&&this.match(":")){this.nextToken();var id=expr;var key="$"+id.name;if(Object.prototype.hasOwnProperty.call(this.context.labelSet,key)){this.throwError(messages_1.Messages.Redeclaration,"Label",id.name)}this.context.labelSet[key]=true;var labeledBody=this.parseStatement();delete this.context.labelSet[key];statement=new Node.LabeledStatement(id,labeledBody)}else{this.consumeSemicolon();statement=new Node.ExpressionStatement(expr)}return this.finalize(node,statement)};Parser.prototype.parseThrowStatement=function(){var node=this.createNode();this.expectKeyword("throw");if(this.hasLineTerminator){this.throwError(messages_1.Messages.NewlineAfterThrow)}var argument=this.parseExpression();this.consumeSemicolon();return this.finalize(node,new Node.ThrowStatement(argument))};Parser.prototype.parseCatchClause=function(){var node=this.createNode();this.expectKeyword("catch");this.expect("(");if(this.match(")")){this.throwUnexpectedToken(this.lookahead)}var params=[];var param=this.parsePattern(params);var paramMap={};for(var i=0;i<params.length;i++){var key="$"+params[i].value;if(Object.prototype.hasOwnProperty.call(paramMap,key)){this.tolerateError(messages_1.Messages.DuplicateBinding,params[i].value)}paramMap[key]=true}if(this.context.strict&&param.type===syntax_1.Syntax.Identifier){if(this.scanner.isRestrictedWord(param.name)){this.tolerateError(messages_1.Messages.StrictCatchVariable)}}this.expect(")");var body=this.parseBlock();return this.finalize(node,new Node.CatchClause(param,body))};Parser.prototype.parseFinallyClause=function(){this.expectKeyword("finally");return this.parseBlock()};Parser.prototype.parseTryStatement=function(){var node=this.createNode();this.expectKeyword("try");var block=this.parseBlock();var handler=this.matchKeyword("catch")?this.parseCatchClause():null;var finalizer=this.matchKeyword("finally")?this.parseFinallyClause():null;if(!handler&&!finalizer){this.throwError(messages_1.Messages.NoCatchOrFinally)}return this.finalize(node,new Node.TryStatement(block,handler,finalizer))};Parser.prototype.parseDebuggerStatement=function(){var node=this.createNode();this.expectKeyword("debugger");this.consumeSemicolon();return this.finalize(node,new Node.DebuggerStatement)};Parser.prototype.parseStatement=function(){var statement=null;switch(this.lookahead.type){case token_1.Token.BooleanLiteral:case token_1.Token.NullLiteral:case token_1.Token.NumericLiteral:case token_1.Token.StringLiteral:case token_1.Token.Template:case token_1.Token.RegularExpression:statement=this.parseExpressionStatement();break;case token_1.Token.Punctuator:var value=this.lookahead.value;if(value==="{"){statement=this.parseBlock()}else if(value==="("){statement=this.parseExpressionStatement()}else if(value===";"){statement=this.parseEmptyStatement()}else{statement=this.parseExpressionStatement()}break;case token_1.Token.Identifier:statement=this.parseLabelledStatement();break;case token_1.Token.Keyword:switch(this.lookahead.value){case"break":statement=this.parseBreakStatement();break;case"continue":statement=this.parseContinueStatement();break;case"debugger":statement=this.parseDebuggerStatement();break;case"do":statement=this.parseDoWhileStatement();break;case"for":statement=this.parseForStatement();break;case"function":statement=this.parseFunctionDeclaration();break;case"if":statement=this.parseIfStatement();break;case"return":statement=this.parseReturnStatement();break;case"switch":statement=this.parseSwitchStatement();break;case"throw":statement=this.parseThrowStatement();break;case"try":statement=this.parseTryStatement();break;case"var":statement=this.parseVariableStatement();break;case"while":statement=this.parseWhileStatement();break;case"with":statement=this.parseWithStatement();break;default:statement=this.parseExpressionStatement();break}break;default:this.throwUnexpectedToken(this.lookahead)}return statement};Parser.prototype.parseFunctionSourceElements=function(){var node=this.createNode();this.expect("{");var body=this.parseDirectivePrologues();var previousLabelSet=this.context.labelSet;var previousInIteration=this.context.inIteration;var previousInSwitch=this.context.inSwitch;var previousInFunctionBody=this.context.inFunctionBody;this.context.labelSet={};this.context.inIteration=false;this.context.inSwitch=false;this.context.inFunctionBody=true;while(this.startMarker.index<this.scanner.length){if(this.match("}")){break}body.push(this.parseStatementListItem())}this.expect("}");this.context.labelSet=previousLabelSet;this.context.inIteration=previousInIteration;this.context.inSwitch=previousInSwitch;this.context.inFunctionBody=previousInFunctionBody;return this.finalize(node,new Node.BlockStatement(body))};Parser.prototype.validateParam=function(options,param,name){var key="$"+name;if(this.context.strict){if(this.scanner.isRestrictedWord(name)){options.stricted=param;options.message=messages_1.Messages.StrictParamName}if(Object.prototype.hasOwnProperty.call(options.paramSet,key)){options.stricted=param;options.message=messages_1.Messages.StrictParamDupe}}else if(!options.firstRestricted){if(this.scanner.isRestrictedWord(name)){options.firstRestricted=param;options.message=messages_1.Messages.StrictParamName}else if(this.scanner.isStrictModeReservedWord(name)){options.firstRestricted=param;options.message=messages_1.Messages.StrictReservedWord}else if(Object.prototype.hasOwnProperty.call(options.paramSet,key)){options.stricted=param;options.message=messages_1.Messages.StrictParamDupe}}if(typeof Object.defineProperty==="function"){Object.defineProperty(options.paramSet,key,{value:true,enumerable:true,writable:true,configurable:true})}else{options.paramSet[key]=true}};Parser.prototype.parseRestElement=function(params){var node=this.createNode();this.expect("...");var arg=this.parsePattern(params);if(this.match("=")){this.throwError(messages_1.Messages.DefaultRestParameter)}if(!this.match(")")){this.throwError(messages_1.Messages.ParameterAfterRestParameter)}return this.finalize(node,new Node.RestElement(arg))};Parser.prototype.parseFormalParameter=function(options){var params=[];var param=this.match("...")?this.parseRestElement(params):this.parsePatternWithDefault(params);for(var i=0;i<params.length;i++){this.validateParam(options,params[i],params[i].value)}options.params.push(param);return!this.match(")")};Parser.prototype.parseFormalParameters=function(firstRestricted){var options;options={params:[],firstRestricted:firstRestricted};this.expect("(");if(!this.match(")")){options.paramSet={};while(this.startMarker.index<this.scanner.length){if(!this.parseFormalParameter(options)){break}this.expect(",")}}this.expect(")");return{params:options.params,stricted:options.stricted,firstRestricted:options.firstRestricted,message:options.message}};Parser.prototype.parseFunctionDeclaration=function(identifierIsOptional){var node=this.createNode();this.expectKeyword("function");var isGenerator=this.match("*");if(isGenerator){this.nextToken()}var message;var id=null;var firstRestricted=null;if(!identifierIsOptional||!this.match("(")){var token=this.lookahead;id=this.parseVariableIdentifier();if(this.context.strict){if(this.scanner.isRestrictedWord(token.value)){this.tolerateUnexpectedToken(token,messages_1.Messages.StrictFunctionName)}}else{if(this.scanner.isRestrictedWord(token.value)){firstRestricted=token;message=messages_1.Messages.StrictFunctionName}else if(this.scanner.isStrictModeReservedWord(token.value)){firstRestricted=token;message=messages_1.Messages.StrictReservedWord}}}var previousAllowYield=this.context.allowYield;this.context.allowYield=!isGenerator;var formalParameters=this.parseFormalParameters(firstRestricted);var params=formalParameters.params;var stricted=formalParameters.stricted;firstRestricted=formalParameters.firstRestricted;if(formalParameters.message){message=formalParameters.message}var previousStrict=this.context.strict;var body=this.parseFunctionSourceElements();if(this.context.strict&&firstRestricted){this.throwUnexpectedToken(firstRestricted,message)}if(this.context.strict&&stricted){this.tolerateUnexpectedToken(stricted,message)}this.context.strict=previousStrict;this.context.allowYield=previousAllowYield;return this.finalize(node,new Node.FunctionDeclaration(id,params,body,isGenerator))};Parser.prototype.parseFunctionExpression=function(){var node=this.createNode();this.expectKeyword("function");var isGenerator=this.match("*");if(isGenerator){this.nextToken()}var message;var id=null;var firstRestricted;var previousAllowYield=this.context.allowYield;this.context.allowYield=!isGenerator;if(!this.match("(")){var token=this.lookahead;id=!this.context.strict&&!isGenerator&&this.matchKeyword("yield")?this.parseIdentifierName():this.parseVariableIdentifier();if(this.context.strict){if(this.scanner.isRestrictedWord(token.value)){this.tolerateUnexpectedToken(token,messages_1.Messages.StrictFunctionName)}}else{if(this.scanner.isRestrictedWord(token.value)){firstRestricted=token;message=messages_1.Messages.StrictFunctionName}else if(this.scanner.isStrictModeReservedWord(token.value)){firstRestricted=token;message=messages_1.Messages.StrictReservedWord}}}var formalParameters=this.parseFormalParameters(firstRestricted);var params=formalParameters.params;var stricted=formalParameters.stricted;firstRestricted=formalParameters.firstRestricted;if(formalParameters.message){message=formalParameters.message}var previousStrict=this.context.strict;var body=this.parseFunctionSourceElements();if(this.context.strict&&firstRestricted){this.throwUnexpectedToken(firstRestricted,message)}if(this.context.strict&&stricted){this.tolerateUnexpectedToken(stricted,message)}this.context.strict=previousStrict;this.context.allowYield=previousAllowYield;return this.finalize(node,new Node.FunctionExpression(id,params,body,isGenerator))};Parser.prototype.parseDirective=function(){var token=this.lookahead;var directive=null;var node=this.createNode();var expr=this.parseExpression();if(expr.type===syntax_1.Syntax.Literal){directive=this.getTokenRaw(token).slice(1,-1)}this.consumeSemicolon();return this.finalize(node,directive?new Node.Directive(expr,directive):new Node.ExpressionStatement(expr))};Parser.prototype.parseDirectivePrologues=function(){var firstRestricted=null;var body=[];while(true){var token=this.lookahead;if(token.type!==token_1.Token.StringLiteral){break}var statement=this.parseDirective();body.push(statement);var directive=statement.directive;if(typeof directive!=="string"){break}if(directive==="use strict"){this.context.strict=true;if(firstRestricted){this.tolerateUnexpectedToken(firstRestricted,messages_1.Messages.StrictOctalLiteral)}}else{if(!firstRestricted&&token.octal){firstRestricted=token}}}return body};Parser.prototype.qualifiedPropertyName=function(token){switch(token.type){case token_1.Token.Identifier:case token_1.Token.StringLiteral:case token_1.Token.BooleanLiteral:case token_1.Token.NullLiteral:case token_1.Token.NumericLiteral:case token_1.Token.Keyword:return true;case token_1.Token.Punctuator:return token.value==="["}return false};Parser.prototype.parseGetterMethod=function(){var node=this.createNode();this.expect("(");this.expect(")");var isGenerator=false;var params={params:[],stricted:null,firstRestricted:null,message:null};var previousAllowYield=this.context.allowYield;this.context.allowYield=false;var method=this.parsePropertyMethod(params);this.context.allowYield=previousAllowYield;return this.finalize(node,new Node.FunctionExpression(null,params.params,method,isGenerator))};Parser.prototype.parseSetterMethod=function(){var node=this.createNode();var options={params:[],firstRestricted:null,paramSet:{}};var isGenerator=false;var previousAllowYield=this.context.allowYield;this.context.allowYield=false;this.expect("(");if(this.match(")")){this.tolerateUnexpectedToken(this.lookahead)}else{this.parseFormalParameter(options)}this.expect(")");var method=this.parsePropertyMethod(options);this.context.allowYield=previousAllowYield;return this.finalize(node,new Node.FunctionExpression(null,options.params,method,isGenerator))};Parser.prototype.parseGeneratorMethod=function(){var node=this.createNode();var isGenerator=true;var previousAllowYield=this.context.allowYield;this.context.allowYield=true;var params=this.parseFormalParameters();this.context.allowYield=false;var method=this.parsePropertyMethod(params);this.context.allowYield=previousAllowYield;return this.finalize(node,new Node.FunctionExpression(null,params.params,method,isGenerator))};Parser.prototype.isStartOfExpression=function(){var start=true;var value=this.lookahead.value;switch(this.lookahead.type){case token_1.Token.Punctuator:start=value==="["||value==="("||value==="{"||value==="+"||value==="-"||value==="!"||value==="~"||value==="++"||value==="--"||value==="/"||value==="/=";break;case token_1.Token.Keyword:start=value==="class"||value==="delete"||value==="function"||value==="let"||value==="new"||value==="super"||value==="this"||value==="typeof"||value==="void"||value==="yield";break;default:break}return start};Parser.prototype.parseYieldExpression=function(){var node=this.createNode();this.expectKeyword("yield");var argument=null;var delegate=false;if(!this.hasLineTerminator){var previousAllowYield=this.context.allowYield;this.context.allowYield=false;delegate=this.match("*");if(delegate){this.nextToken();argument=this.parseAssignmentExpression()}else if(this.isStartOfExpression()){argument=this.parseAssignmentExpression()}this.context.allowYield=previousAllowYield}return this.finalize(node,new Node.YieldExpression(argument,delegate))};Parser.prototype.parseClassElement=function(hasConstructor){var token=this.lookahead;var node=this.createNode();var kind;var key;var value;var computed=false;var method=false;var isStatic=false;if(this.match("*")){this.nextToken()}else{computed=this.match("[");key=this.parseObjectPropertyKey();var id=key;if(id.name==="static"&&(this.qualifiedPropertyName(this.lookahead)||this.match("*"))){token=this.lookahead;isStatic=true;computed=this.match("[");if(this.match("*")){this.nextToken()}else{key=this.parseObjectPropertyKey()}}}var lookaheadPropertyKey=this.qualifiedPropertyName(this.lookahead);if(token.type===token_1.Token.Identifier){if(token.value==="get"&&lookaheadPropertyKey){kind="get";computed=this.match("[");key=this.parseObjectPropertyKey();this.context.allowYield=false;value=this.parseGetterMethod()}else if(token.value==="set"&&lookaheadPropertyKey){kind="set";computed=this.match("[");key=this.parseObjectPropertyKey();value=this.parseSetterMethod()}}else if(token.type===token_1.Token.Punctuator&&token.value==="*"&&lookaheadPropertyKey){kind="init";computed=this.match("[");key=this.parseObjectPropertyKey();value=this.parseGeneratorMethod();method=true}if(!kind&&key&&this.match("(")){kind="init";value=this.parsePropertyMethodFunction();method=true}if(!kind){this.throwUnexpectedToken(this.lookahead)}if(kind==="init"){kind="method"}if(!computed){if(isStatic&&this.isPropertyKey(key,"prototype")){this.throwUnexpectedToken(token,messages_1.Messages.StaticPrototype)}if(!isStatic&&this.isPropertyKey(key,"constructor")){if(kind!=="method"||!method||value.generator){this.throwUnexpectedToken(token,messages_1.Messages.ConstructorSpecialMethod)}if(hasConstructor.value){this.throwUnexpectedToken(token,messages_1.Messages.DuplicateConstructor)}else{hasConstructor.value=true}kind="constructor"}}return this.finalize(node,new Node.MethodDefinition(key,computed,value,kind,isStatic))};Parser.prototype.parseClassElementList=function(){var body=[];var hasConstructor={value:false};this.expect("{");while(!this.match("}")){if(this.match(";")){this.nextToken()}else{body.push(this.parseClassElement(hasConstructor))}}this.expect("}");return body};Parser.prototype.parseClassBody=function(){var node=this.createNode();var elementList=this.parseClassElementList();return this.finalize(node,new Node.ClassBody(elementList))};Parser.prototype.parseClassDeclaration=function(identifierIsOptional){var node=this.createNode();var previousStrict=this.context.strict;this.context.strict=true;this.expectKeyword("class");var id=identifierIsOptional&&this.lookahead.type!==token_1.Token.Identifier?null:this.parseVariableIdentifier();var superClass=null;if(this.matchKeyword("extends")){this.nextToken();superClass=this.isolateCoverGrammar(this.parseLeftHandSideExpressionAllowCall)}var classBody=this.parseClassBody();this.context.strict=previousStrict;return this.finalize(node,new Node.ClassDeclaration(id,superClass,classBody))};Parser.prototype.parseClassExpression=function(){var node=this.createNode();var previousStrict=this.context.strict;this.context.strict=true;this.expectKeyword("class");var id=this.lookahead.type===token_1.Token.Identifier?this.parseVariableIdentifier():null;var superClass=null;if(this.matchKeyword("extends")){this.nextToken();superClass=this.isolateCoverGrammar(this.parseLeftHandSideExpressionAllowCall)}var classBody=this.parseClassBody();this.context.strict=previousStrict;return this.finalize(node,new Node.ClassExpression(id,superClass,classBody))};Parser.prototype.parseProgram=function(){var node=this.createNode();var body=this.parseDirectivePrologues();while(this.startMarker.index<this.scanner.length){body.push(this.parseStatementListItem())}return this.finalize(node,new Node.Program(body,this.sourceType))};Parser.prototype.parseModuleSpecifier=function(){var node=this.createNode();if(this.lookahead.type!==token_1.Token.StringLiteral){this.throwError(messages_1.Messages.InvalidModuleSpecifier)}var token=this.nextToken();var raw=this.getTokenRaw(token);return this.finalize(node,new Node.Literal(token.value,raw))};Parser.prototype.parseImportSpecifier=function(){var node=this.createNode();var imported;var local;if(this.lookahead.type===token_1.Token.Identifier){imported=this.parseVariableIdentifier();local=imported;if(this.matchContextualKeyword("as")){this.nextToken();local=this.parseVariableIdentifier()}}else{imported=this.parseIdentifierName();local=imported;if(this.matchContextualKeyword("as")){this.nextToken();local=this.parseVariableIdentifier()}else{this.throwUnexpectedToken(this.nextToken())}}return this.finalize(node,new Node.ImportSpecifier(local,imported))};Parser.prototype.parseNamedImports=function(){this.expect("{");var specifiers=[];while(!this.match("}")){specifiers.push(this.parseImportSpecifier());if(!this.match("}")){this.expect(",")}}this.expect("}");return specifiers};Parser.prototype.parseImportDefaultSpecifier=function(){var node=this.createNode();var local=this.parseIdentifierName();return this.finalize(node,new Node.ImportDefaultSpecifier(local))};Parser.prototype.parseImportNamespaceSpecifier=function(){var node=this.createNode();this.expect("*");if(!this.matchContextualKeyword("as")){this.throwError(messages_1.Messages.NoAsAfterImportNamespace)}this.nextToken();var local=this.parseIdentifierName();return this.finalize(node,new Node.ImportNamespaceSpecifier(local))};Parser.prototype.parseImportDeclaration=function(){if(this.context.inFunctionBody){this.throwError(messages_1.Messages.IllegalImportDeclaration)}var node=this.createNode();this.expectKeyword("import");var src;var specifiers=[];if(this.lookahead.type===token_1.Token.StringLiteral){src=this.parseModuleSpecifier()}else{if(this.match("{")){specifiers=specifiers.concat(this.parseNamedImports())}else if(this.match("*")){specifiers.push(this.parseImportNamespaceSpecifier())}else if(this.isIdentifierName(this.lookahead)&&!this.matchKeyword("default")){specifiers.push(this.parseImportDefaultSpecifier());if(this.match(",")){this.nextToken();if(this.match("*")){specifiers.push(this.parseImportNamespaceSpecifier())}else if(this.match("{")){specifiers=specifiers.concat(this.parseNamedImports())}else{this.throwUnexpectedToken(this.lookahead)}}}else{this.throwUnexpectedToken(this.nextToken())}if(!this.matchContextualKeyword("from")){var message=this.lookahead.value?messages_1.Messages.UnexpectedToken:messages_1.Messages.MissingFromClause;this.throwError(message,this.lookahead.value)}this.nextToken();src=this.parseModuleSpecifier()}this.consumeSemicolon();return this.finalize(node,new Node.ImportDeclaration(specifiers,src))};Parser.prototype.parseExportSpecifier=function(){var node=this.createNode();var local=this.parseIdentifierName();var exported=local;if(this.matchContextualKeyword("as")){this.nextToken();exported=this.parseIdentifierName()}return this.finalize(node,new Node.ExportSpecifier(local,exported))};Parser.prototype.parseExportDeclaration=function(){if(this.context.inFunctionBody){this.throwError(messages_1.Messages.IllegalExportDeclaration)}var node=this.createNode();this.expectKeyword("export");var exportDeclaration;if(this.matchKeyword("default")){this.nextToken();if(this.matchKeyword("function")){var declaration=this.parseFunctionDeclaration(true);exportDeclaration=this.finalize(node,new Node.ExportDefaultDeclaration(declaration))}else if(this.matchKeyword("class")){var declaration=this.parseClassDeclaration(true);exportDeclaration=this.finalize(node,new Node.ExportDefaultDeclaration(declaration))}else{if(this.matchContextualKeyword("from")){this.throwError(messages_1.Messages.UnexpectedToken,this.lookahead.value)}var declaration=this.match("{")?this.parseObjectInitializer():this.match("[")?this.parseArrayInitializer():this.parseAssignmentExpression();this.consumeSemicolon();exportDeclaration=this.finalize(node,new Node.ExportDefaultDeclaration(declaration))}}else if(this.match("*")){this.nextToken();if(!this.matchContextualKeyword("from")){var message=this.lookahead.value?messages_1.Messages.UnexpectedToken:messages_1.Messages.MissingFromClause;this.throwError(message,this.lookahead.value)}this.nextToken();var src=this.parseModuleSpecifier();this.consumeSemicolon();exportDeclaration=this.finalize(node,new Node.ExportAllDeclaration(src))}else if(this.lookahead.type===token_1.Token.Keyword){var declaration=void 0;switch(this.lookahead.value){case"let":case"const":declaration=this.parseLexicalDeclaration({inFor:false});break;case"var":case"class":case"function":declaration=this.parseStatementListItem();break;default:this.throwUnexpectedToken(this.lookahead)}exportDeclaration=this.finalize(node,new Node.ExportNamedDeclaration(declaration,[],null))}else{var specifiers=[];var source=null;var isExportFromIdentifier=false;this.expect("{");while(!this.match("}")){isExportFromIdentifier=isExportFromIdentifier||this.matchKeyword("default");specifiers.push(this.parseExportSpecifier());if(!this.match("}")){this.expect(",")}}this.expect("}");if(this.matchContextualKeyword("from")){this.nextToken();source=this.parseModuleSpecifier();this.consumeSemicolon()}else if(isExportFromIdentifier){var message=this.lookahead.value?messages_1.Messages.UnexpectedToken:messages_1.Messages.MissingFromClause;this.throwError(message,this.lookahead.value)}else{this.consumeSemicolon()}exportDeclaration=this.finalize(node,new Node.ExportNamedDeclaration(null,specifiers,source))}return exportDeclaration};return Parser}();exports.Parser=Parser},function(module,exports){"use strict";function assert(condition,message){if(!condition){throw new Error("ASSERT: "+message)}}exports.assert=assert},function(module,exports){"use strict";exports.Messages={UnexpectedToken:"Unexpected token %0",UnexpectedTokenIllegal:"Unexpected token ILLEGAL",UnexpectedNumber:"Unexpected number",UnexpectedString:"Unexpected string",UnexpectedIdentifier:"Unexpected identifier",UnexpectedReserved:"Unexpected reserved word",UnexpectedTemplate:"Unexpected quasi %0",UnexpectedEOS:"Unexpected end of input",NewlineAfterThrow:"Illegal newline after throw",InvalidRegExp:"Invalid regular expression",UnterminatedRegExp:"Invalid regular expression: missing /",InvalidLHSInAssignment:"Invalid left-hand side in assignment",InvalidLHSInForIn:"Invalid left-hand side in for-in",InvalidLHSInForLoop:"Invalid left-hand side in for-loop",MultipleDefaultsInSwitch:"More than one default clause in switch statement",NoCatchOrFinally:"Missing catch or finally after try",UnknownLabel:"Undefined label '%0'",Redeclaration:"%0 '%1' has already been declared",IllegalContinue:"Illegal continue statement",IllegalBreak:"Illegal break statement",IllegalReturn:"Illegal return statement",StrictModeWith:"Strict mode code may not include a with statement",StrictCatchVariable:"Catch variable may not be eval or arguments in strict mode",StrictVarName:"Variable name may not be eval or arguments in strict mode",StrictParamName:"Parameter name eval or arguments is not allowed in strict mode",StrictParamDupe:"Strict mode function may not have duplicate parameter names",StrictFunctionName:"Function name may not be eval or arguments in strict mode",StrictOctalLiteral:"Octal literals are not allowed in strict mode.",StrictDelete:"Delete of an unqualified identifier in strict mode.",StrictLHSAssignment:"Assignment to eval or arguments is not allowed in strict mode",StrictLHSPostfix:"Postfix increment/decrement may not have eval or arguments operand in strict mode",StrictLHSPrefix:"Prefix increment/decrement may not have eval or arguments operand in strict mode",StrictReservedWord:"Use of future reserved word in strict mode",TemplateOctalLiteral:"Octal literals are not allowed in template strings.",ParameterAfterRestParameter:"Rest parameter must be last formal parameter",DefaultRestParameter:"Unexpected token =",DuplicateProtoProperty:"Duplicate __proto__ fields are not allowed in object literals",ConstructorSpecialMethod:"Class constructor may not be an accessor",DuplicateConstructor:"A class may only have one constructor",StaticPrototype:"Classes may not have static property named prototype",MissingFromClause:"Unexpected token",NoAsAfterImportNamespace:"Unexpected token",InvalidModuleSpecifier:"Unexpected token",IllegalImportDeclaration:"Unexpected token",IllegalExportDeclaration:"Unexpected token",DuplicateBinding:"Duplicate binding %0",ForInOfLoopInitializer:"%0 loop variable declaration may not have an initializer"}},function(module,exports){"use strict";var ErrorHandler=function(){function ErrorHandler(){this.errors=[];this.tolerant=false}ErrorHandler.prototype.recordError=function(error){this.errors.push(error)};ErrorHandler.prototype.tolerate=function(error){if(this.tolerant){this.recordError(error)}else{throw error}};ErrorHandler.prototype.constructError=function(msg,column){var error=new Error(msg);try{throw error}catch(base){if(Object.create&&Object.defineProperty){error=Object.create(base);Object.defineProperty(error,"column",{value:column})}}finally{return error}};ErrorHandler.prototype.createError=function(index,line,col,description){var msg="Line "+line+": "+description;var error=this.constructError(msg,col);error.index=index;error.lineNumber=line;error.description=description;return error};ErrorHandler.prototype.throwError=function(index,line,col,description){throw this.createError(index,line,col,description)};ErrorHandler.prototype.tolerateError=function(index,line,col,description){var error=this.createError(index,line,col,description);if(this.tolerant){this.recordError(error)}else{throw error}};return ErrorHandler}();exports.ErrorHandler=ErrorHandler},function(module,exports){"use strict";(function(Token){Token[Token["BooleanLiteral"]=1]="BooleanLiteral";Token[Token["EOF"]=2]="EOF";Token[Token["Identifier"]=3]="Identifier";Token[Token["Keyword"]=4]="Keyword";Token[Token["NullLiteral"]=5]="NullLiteral";Token[Token["NumericLiteral"]=6]="NumericLiteral";Token[Token["Punctuator"]=7]="Punctuator";Token[Token["StringLiteral"]=8]="StringLiteral";Token[Token["RegularExpression"]=9]="RegularExpression";Token[Token["Template"]=10]="Template"})(exports.Token||(exports.Token={}));var Token=exports.Token;exports.TokenName={};exports.TokenName[Token.BooleanLiteral]="Boolean";exports.TokenName[Token.EOF]="<end>";exports.TokenName[Token.Identifier]="Identifier";exports.TokenName[Token.Keyword]="Keyword";exports.TokenName[Token.NullLiteral]="Null";exports.TokenName[Token.NumericLiteral]="Numeric";exports.TokenName[Token.Punctuator]="Punctuator";exports.TokenName[Token.StringLiteral]="String";exports.TokenName[Token.RegularExpression]="RegularExpression";exports.TokenName[Token.Template]="Template"},function(module,exports,__webpack_require__){"use strict";var assert_1=__webpack_require__(4);var messages_1=__webpack_require__(5);var character_1=__webpack_require__(9);var token_1=__webpack_require__(7);function hexValue(ch){return"0123456789abcdef".indexOf(ch.toLowerCase())}function octalValue(ch){return"01234567".indexOf(ch)}var Scanner=function(){function Scanner(code,handler){this.source=code;this.errorHandler=handler;this.trackComment=false;this.length=code.length;this.index=0;this.lineNumber=code.length>0?1:0;this.lineStart=0;this.curlyStack=[]}Scanner.prototype.eof=function(){return this.index>=this.length};Scanner.prototype.throwUnexpectedToken=function(message){if(message===void 0){message=messages_1.Messages.UnexpectedTokenIllegal}this.errorHandler.throwError(this.index,this.lineNumber,this.index-this.lineStart+1,message)};Scanner.prototype.tolerateUnexpectedToken=function(){this.errorHandler.tolerateError(this.index,this.lineNumber,this.index-this.lineStart+1,messages_1.Messages.UnexpectedTokenIllegal)};Scanner.prototype.skipSingleLineComment=function(offset){var comments;var start,loc;if(this.trackComment){comments=[];start=this.index-offset;loc={start:{line:this.lineNumber,column:this.index-this.lineStart-offset},end:{}}}while(!this.eof()){var ch=this.source.charCodeAt(this.index);++this.index;if(character_1.Character.isLineTerminator(ch)){if(this.trackComment){loc.end={line:this.lineNumber,column:this.index-this.lineStart-1};var entry={multiLine:false,slice:[start+offset,this.index-1],range:[start,this.index-1],loc:loc};comments.push(entry)}if(ch===13&&this.source.charCodeAt(this.index)===10){++this.index}++this.lineNumber;this.lineStart=this.index;return comments}}if(this.trackComment){loc.end={line:this.lineNumber,column:this.index-this.lineStart};var entry={multiLine:false,slice:[start+offset,this.index],range:[start,this.index],loc:loc};comments.push(entry)}return comments};Scanner.prototype.skipMultiLineComment=function(){var comments;var start,loc;if(this.trackComment){comments=[];start=this.index-2;loc={start:{line:this.lineNumber,column:this.index-this.lineStart-2},end:{}}}while(!this.eof()){var ch=this.source.charCodeAt(this.index);if(character_1.Character.isLineTerminator(ch)){if(ch===13&&this.source.charCodeAt(this.index+1)===10){++this.index}++this.lineNumber;++this.index;this.lineStart=this.index}else if(ch===42){if(this.source.charCodeAt(this.index+1)===47){this.index+=2;if(this.trackComment){loc.end={line:this.lineNumber,column:this.index-this.lineStart};var entry={multiLine:true,slice:[start+2,this.index-2],range:[start,this.index],loc:loc};comments.push(entry)}return comments}++this.index}else{++this.index}}if(this.trackComment){loc.end={line:this.lineNumber,column:this.index-this.lineStart};var entry={multiLine:true,slice:[start+2,this.index],range:[start,this.index],loc:loc};comments.push(entry)}this.tolerateUnexpectedToken();return comments};Scanner.prototype.scanComments=function(){var comments;if(this.trackComment){comments=[]}var start=this.index===0;while(!this.eof()){var ch=this.source.charCodeAt(this.index);if(character_1.Character.isWhiteSpace(ch)){++this.index}else if(character_1.Character.isLineTerminator(ch)){++this.index;if(ch===13&&this.source.charCodeAt(this.index)===10){++this.index}++this.lineNumber;this.lineStart=this.index;start=true}else if(ch===47){ch=this.source.charCodeAt(this.index+1);if(ch===47){this.index+=2;var comment=this.skipSingleLineComment(2);if(this.trackComment){comments=comments.concat(comment)}start=true}else if(ch===42){this.index+=2;var comment=this.skipMultiLineComment();if(this.trackComment){comments=comments.concat(comment)}}else{break}}else if(start&&ch===45){if(this.source.charCodeAt(this.index+1)===45&&this.source.charCodeAt(this.index+2)===62){this.index+=3;var comment=this.skipSingleLineComment(3);if(this.trackComment){comments=comments.concat(comment)}}else{break}}else if(ch===60){if(this.source.slice(this.index+1,this.index+4)==="!--"){this.index+=4;var comment=this.skipSingleLineComment(4);if(this.trackComment){comments=comments.concat(comment)}}else{break}}else{break}}return comments};Scanner.prototype.isFutureReservedWord=function(id){switch(id){case"enum":case"export":case"import":case"super":return true;default:return false}};Scanner.prototype.isStrictModeReservedWord=function(id){switch(id){case"implements":case"interface":case"package":case"private":case"protected":case"public":case"static":case"yield":case"let":return true;default:return false}};Scanner.prototype.isRestrictedWord=function(id){return id==="eval"||id==="arguments"};Scanner.prototype.isKeyword=function(id){switch(id.length){case 2:return id==="if"||id==="in"||id==="do";case 3:return id==="var"||id==="for"||id==="new"||id==="try"||id==="let";case 4:return id==="this"||id==="else"||id==="case"||id==="void"||id==="with"||id==="enum";case 5:return id==="while"||id==="break"||id==="catch"||id==="throw"||id==="const"||id==="yield"||id==="class"||id==="super";case 6:return id==="return"||id==="typeof"||id==="delete"||id==="switch"||id==="export"||id==="import";case 7:return id==="default"||id==="finally"||id==="extends";case 8:return id==="function"||id==="continue"||id==="debugger";case 10:return id==="instanceof";default:return false}};Scanner.prototype.codePointAt=function(i){var cp=this.source.charCodeAt(i);if(cp>=55296&&cp<=56319){var second=this.source.charCodeAt(i+1);if(second>=56320&&second<=57343){var first=cp;cp=(first-55296)*1024+second-56320+65536}}return cp};Scanner.prototype.scanHexEscape=function(prefix){var len=prefix==="u"?4:2;var code=0;for(var i=0;i<len;++i){if(!this.eof()&&character_1.Character.isHexDigit(this.source.charCodeAt(this.index))){code=code*16+hexValue(this.source[this.index++])}else{return""}}return String.fromCharCode(code)};Scanner.prototype.scanUnicodeCodePointEscape=function(){var ch=this.source[this.index];var code=0;if(ch==="}"){this.throwUnexpectedToken()}while(!this.eof()){ch=this.source[this.index++];if(!character_1.Character.isHexDigit(ch.charCodeAt(0))){break}code=code*16+hexValue(ch)}if(code>1114111||ch!=="}"){this.throwUnexpectedToken()}return character_1.Character.fromCodePoint(code)};Scanner.prototype.getIdentifier=function(){var start=this.index++;while(!this.eof()){var ch=this.source.charCodeAt(this.index);if(ch===92){this.index=start;return this.getComplexIdentifier()}else if(ch>=55296&&ch<57343){this.index=start;return this.getComplexIdentifier()}if(character_1.Character.isIdentifierPart(ch)){++this.index}else{break}}return this.source.slice(start,this.index)};Scanner.prototype.getComplexIdentifier=function(){var cp=this.codePointAt(this.index);var id=character_1.Character.fromCodePoint(cp);this.index+=id.length;var ch;if(cp===92){if(this.source.charCodeAt(this.index)!==117){this.throwUnexpectedToken()}++this.index;if(this.source[this.index]==="{"){++this.index;ch=this.scanUnicodeCodePointEscape()}else{ch=this.scanHexEscape("u");cp=ch.charCodeAt(0);if(!ch||ch==="\\"||!character_1.Character.isIdentifierStart(cp)){this.throwUnexpectedToken()}}id=ch}while(!this.eof()){cp=this.codePointAt(this.index);if(!character_1.Character.isIdentifierPart(cp)){break}ch=character_1.Character.fromCodePoint(cp);id+=ch;this.index+=ch.length;if(cp===92){id=id.substr(0,id.length-1);if(this.source.charCodeAt(this.index)!==117){this.throwUnexpectedToken()}++this.index;if(this.source[this.index]==="{"){++this.index;ch=this.scanUnicodeCodePointEscape()}else{ch=this.scanHexEscape("u");cp=ch.charCodeAt(0);if(!ch||ch==="\\"||!character_1.Character.isIdentifierPart(cp)){this.throwUnexpectedToken()}}id+=ch}}return id};Scanner.prototype.octalToDecimal=function(ch){var octal=ch!=="0";var code=octalValue(ch);if(!this.eof()&&character_1.Character.isOctalDigit(this.source.charCodeAt(this.index))){octal=true;code=code*8+octalValue(this.source[this.index++]);if("0123".indexOf(ch)>=0&&!this.eof()&&character_1.Character.isOctalDigit(this.source.charCodeAt(this.index))){code=code*8+octalValue(this.source[this.index++])}}return{code:code,octal:octal}};Scanner.prototype.scanIdentifier=function(){var type;var start=this.index;var id=this.source.charCodeAt(start)===92?this.getComplexIdentifier():this.getIdentifier();if(id.length===1){type=token_1.Token.Identifier}else if(this.isKeyword(id)){type=token_1.Token.Keyword}else if(id==="null"){type=token_1.Token.NullLiteral}else if(id==="true"||id==="false"){type=token_1.Token.BooleanLiteral}else{type=token_1.Token.Identifier}return{type:type,value:id,lineNumber:this.lineNumber,lineStart:this.lineStart,start:start,end:this.index}};Scanner.prototype.scanPunctuator=function(){var token={type:token_1.Token.Punctuator,value:"",lineNumber:this.lineNumber,lineStart:this.lineStart,start:this.index,end:this.index};var str=this.source[this.index];switch(str){case"(":case"{":if(str==="{"){this.curlyStack.push("{")}++this.index;break;case".":++this.index;if(this.source[this.index]==="."&&this.source[this.index+1]==="."){this.index+=2;str="..."}break;case"}":++this.index;this.curlyStack.pop();break;case")":case";":case",":case"[":case"]":case":":case"?":case"~":++this.index;break;default:str=this.source.substr(this.index,4);if(str===">>>="){this.index+=4}else{str=str.substr(0,3);if(str==="==="||str==="!=="||str===">>>"||str==="<<="||str===">>="||str==="**="){this.index+=3}else{str=str.substr(0,2);if(str==="&&"||str==="||"||str==="=="||str==="!="||str==="+="||str==="-="||str==="*="||str==="/="||str==="++"||str==="--"||str==="<<"||str===">>"||str==="&="||str==="|="||str==="^="||str==="%="||str==="<="||str===">="||str==="=>"||str==="**"){this.index+=2}else{str=this.source[this.index];if("<>=!+-*%&|^/".indexOf(str)>=0){++this.index}}}}}if(this.index===token.start){this.throwUnexpectedToken()}token.end=this.index;token.value=str;return token};Scanner.prototype.scanHexLiteral=function(start){var number="";while(!this.eof()){if(!character_1.Character.isHexDigit(this.source.charCodeAt(this.index))){break}number+=this.source[this.index++]}if(number.length===0){this.throwUnexpectedToken()}if(character_1.Character.isIdentifierStart(this.source.charCodeAt(this.index))){this.throwUnexpectedToken()}return{type:token_1.Token.NumericLiteral,value:parseInt("0x"+number,16),lineNumber:this.lineNumber,lineStart:this.lineStart,start:start,end:this.index}};Scanner.prototype.scanBinaryLiteral=function(start){var number="";var ch;while(!this.eof()){ch=this.source[this.index];if(ch!=="0"&&ch!=="1"){break}number+=this.source[this.index++]}if(number.length===0){this.throwUnexpectedToken()}if(!this.eof()){ch=this.source.charCodeAt(this.index);if(character_1.Character.isIdentifierStart(ch)||character_1.Character.isDecimalDigit(ch)){this.throwUnexpectedToken()}}return{type:token_1.Token.NumericLiteral,value:parseInt(number,2),lineNumber:this.lineNumber,lineStart:this.lineStart,start:start,end:this.index}};Scanner.prototype.scanOctalLiteral=function(prefix,start){var number="";var octal=false;if(character_1.Character.isOctalDigit(prefix.charCodeAt(0))){octal=true;number="0"+this.source[this.index++]}else{++this.index}while(!this.eof()){if(!character_1.Character.isOctalDigit(this.source.charCodeAt(this.index))){break}number+=this.source[this.index++]}if(!octal&&number.length===0){this.throwUnexpectedToken()}if(character_1.Character.isIdentifierStart(this.source.charCodeAt(this.index))||character_1.Character.isDecimalDigit(this.source.charCodeAt(this.index))){this.throwUnexpectedToken()}return{type:token_1.Token.NumericLiteral,value:parseInt(number,8),octal:octal,lineNumber:this.lineNumber,lineStart:this.lineStart,start:start,end:this.index}};Scanner.prototype.isImplicitOctalLiteral=function(){for(var i=this.index+1;i<this.length;++i){var ch=this.source[i];if(ch==="8"||ch==="9"){return false}if(!character_1.Character.isOctalDigit(ch.charCodeAt(0))){return true}}return true};Scanner.prototype.scanNumericLiteral=function(){var start=this.index;var ch=this.source[start];assert_1.assert(character_1.Character.isDecimalDigit(ch.charCodeAt(0))||ch===".","Numeric literal must start with a decimal digit or a decimal point");var number="";if(ch!=="."){number=this.source[this.index++];ch=this.source[this.index];if(number==="0"){if(ch==="x"||ch==="X"){++this.index;return this.scanHexLiteral(start)}if(ch==="b"||ch==="B"){++this.index;return this.scanBinaryLiteral(start)}if(ch==="o"||ch==="O"){return this.scanOctalLiteral(ch,start)}if(ch&&character_1.Character.isOctalDigit(ch.charCodeAt(0))){if(this.isImplicitOctalLiteral()){return this.scanOctalLiteral(ch,start)}}}while(character_1.Character.isDecimalDigit(this.source.charCodeAt(this.index))){number+=this.source[this.index++]}ch=this.source[this.index]}if(ch==="."){number+=this.source[this.index++];while(character_1.Character.isDecimalDigit(this.source.charCodeAt(this.index))){number+=this.source[this.index++]}ch=this.source[this.index]}if(ch==="e"||ch==="E"){number+=this.source[this.index++];ch=this.source[this.index];if(ch==="+"||ch==="-"){number+=this.source[this.index++]}if(character_1.Character.isDecimalDigit(this.source.charCodeAt(this.index))){while(character_1.Character.isDecimalDigit(this.source.charCodeAt(this.index))){number+=this.source[this.index++]}}else{this.throwUnexpectedToken()}}if(character_1.Character.isIdentifierStart(this.source.charCodeAt(this.index))){this.throwUnexpectedToken()}return{type:token_1.Token.NumericLiteral,value:parseFloat(number),lineNumber:this.lineNumber,lineStart:this.lineStart,start:start,end:this.index}};Scanner.prototype.scanStringLiteral=function(){var start=this.index;var quote=this.source[start];assert_1.assert(quote==="'"||quote==='"',"String literal must starts with a quote");++this.index;var octal=false;var str="";while(!this.eof()){var ch=this.source[this.index++];if(ch===quote){quote="";break}else if(ch==="\\"){ch=this.source[this.index++];if(!ch||!character_1.Character.isLineTerminator(ch.charCodeAt(0))){switch(ch){case"u":case"x":if(this.source[this.index]==="{"){++this.index;str+=this.scanUnicodeCodePointEscape()}else{var unescaped=this.scanHexEscape(ch);if(!unescaped){this.throwUnexpectedToken()}str+=unescaped}break;case"n":str+="\n";break;case"r":str+="\r";break;case"t":str+="\t";break;case"b":str+="\b";break;case"f":str+="\f";break;case"v":str+="\v";break;case"8":case"9":str+=ch;this.tolerateUnexpectedToken();break;default:if(ch&&character_1.Character.isOctalDigit(ch.charCodeAt(0))){var octToDec=this.octalToDecimal(ch);octal=octToDec.octal||octal;str+=String.fromCharCode(octToDec.code)}else{str+=ch}break}}else{++this.lineNumber;if(ch==="\r"&&this.source[this.index]==="\n"){++this.index}this.lineStart=this.index}}else if(character_1.Character.isLineTerminator(ch.charCodeAt(0))){break}else{str+=ch}}if(quote!==""){this.index=start;this.throwUnexpectedToken()}return{type:token_1.Token.StringLiteral,value:str,octal:octal,lineNumber:this.lineNumber,lineStart:this.lineStart,start:start,end:this.index}};Scanner.prototype.scanTemplate=function(){var cooked="";var terminated=false;var start=this.index;var head=this.source[start]==="`";var tail=false;var rawOffset=2;++this.index;while(!this.eof()){var ch=this.source[this.index++];if(ch==="`"){rawOffset=1;tail=true;terminated=true;break}else if(ch==="$"){if(this.source[this.index]==="{"){this.curlyStack.push("${");++this.index;terminated=true;break}cooked+=ch}else if(ch==="\\"){ch=this.source[this.index++];if(!character_1.Character.isLineTerminator(ch.charCodeAt(0))){switch(ch){case"n":cooked+="\n";break;case"r":cooked+="\r";break;case"t":cooked+="\t";break;case"u":case"x":if(this.source[this.index]==="{"){++this.index;cooked+=this.scanUnicodeCodePointEscape()}else{var restore=this.index;var unescaped=this.scanHexEscape(ch);if(unescaped){cooked+=unescaped}else{this.index=restore;cooked+=ch}}break;case"b":cooked+="\b";break;case"f":cooked+="\f";break;case"v":cooked+="\v";break;default:if(ch==="0"){if(character_1.Character.isDecimalDigit(this.source.charCodeAt(this.index))){this.throwUnexpectedToken(messages_1.Messages.TemplateOctalLiteral)}cooked+="\0"}else if(character_1.Character.isOctalDigit(ch.charCodeAt(0))){this.throwUnexpectedToken(messages_1.Messages.TemplateOctalLiteral)}else{cooked+=ch}break}}else{++this.lineNumber;if(ch==="\r"&&this.source[this.index]==="\n"){++this.index}this.lineStart=this.index}}else if(character_1.Character.isLineTerminator(ch.charCodeAt(0))){++this.lineNumber;if(ch==="\r"&&this.source[this.index]==="\n"){++this.index}this.lineStart=this.index;cooked+="\n"}else{cooked+=ch}}if(!terminated){this.throwUnexpectedToken()}if(!head){this.curlyStack.pop()}return{type:token_1.Token.Template,value:{cooked:cooked,raw:this.source.slice(start+1,this.index-rawOffset)},head:head,tail:tail,lineNumber:this.lineNumber,lineStart:this.lineStart,start:start,end:this.index}};Scanner.prototype.testRegExp=function(pattern,flags){var astralSubstitute="\uffff";var tmp=pattern;var self=this;if(flags.indexOf("u")>=0){tmp=tmp.replace(/\\u\{([0-9a-fA-F]+)\}|\\u([a-fA-F0-9]{4})/g,function($0,$1,$2){var codePoint=parseInt($1||$2,16);if(codePoint>1114111){self.throwUnexpectedToken(messages_1.Messages.InvalidRegExp)}if(codePoint<=65535){return String.fromCharCode(codePoint)}return astralSubstitute}).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,astralSubstitute)}try{RegExp(tmp)}catch(e){this.throwUnexpectedToken(messages_1.Messages.InvalidRegExp)}try{return new RegExp(pattern,flags)}catch(exception){return null}};Scanner.prototype.scanRegExpBody=function(){var ch=this.source[this.index];assert_1.assert(ch==="/","Regular expression literal must start with a slash");var str=this.source[this.index++];var classMarker=false;var terminated=false;while(!this.eof()){ch=this.source[this.index++];str+=ch;if(ch==="\\"){ch=this.source[this.index++];if(character_1.Character.isLineTerminator(ch.charCodeAt(0))){this.throwUnexpectedToken(messages_1.Messages.UnterminatedRegExp)}str+=ch}else if(character_1.Character.isLineTerminator(ch.charCodeAt(0))){this.throwUnexpectedToken(messages_1.Messages.UnterminatedRegExp)}else if(classMarker){if(ch==="]"){classMarker=false}}else{if(ch==="/"){terminated=true;break}else if(ch==="["){classMarker=true}}}if(!terminated){this.throwUnexpectedToken(messages_1.Messages.UnterminatedRegExp)}var body=str.substr(1,str.length-2);return{value:body,literal:str}};Scanner.prototype.scanRegExpFlags=function(){var str="";var flags="";while(!this.eof()){var ch=this.source[this.index];if(!character_1.Character.isIdentifierPart(ch.charCodeAt(0))){break}++this.index;if(ch==="\\"&&!this.eof()){ch=this.source[this.index];if(ch==="u"){++this.index;var restore=this.index;ch=this.scanHexEscape("u");if(ch){flags+=ch;for(str+="\\u";restore<this.index;++restore){str+=this.source[restore]}}else{this.index=restore;flags+="u";str+="\\u"}this.tolerateUnexpectedToken()}else{str+="\\";this.tolerateUnexpectedToken()}}else{flags+=ch;str+=ch}}return{value:flags,literal:str}};Scanner.prototype.scanRegExp=function(){var start=this.index;var body=this.scanRegExpBody();var flags=this.scanRegExpFlags();var value=this.testRegExp(body.value,flags.value);return{type:token_1.Token.RegularExpression,value:value,literal:body.literal+flags.literal,regex:{pattern:body.value,flags:flags.value},lineNumber:this.lineNumber,lineStart:this.lineStart,start:start,end:this.index}};Scanner.prototype.lex=function(){if(this.eof()){return{type:token_1.Token.EOF,lineNumber:this.lineNumber,lineStart:this.lineStart,start:this.index,end:this.index}}var cp=this.source.charCodeAt(this.index);if(character_1.Character.isIdentifierStart(cp)){return this.scanIdentifier()}if(cp===40||cp===41||cp===59){return this.scanPunctuator()}if(cp===39||cp===34){return this.scanStringLiteral()}if(cp===46){if(character_1.Character.isDecimalDigit(this.source.charCodeAt(this.index+1))){return this.scanNumericLiteral()}return this.scanPunctuator()}if(character_1.Character.isDecimalDigit(cp)){return this.scanNumericLiteral()}if(cp===96||cp===125&&this.curlyStack[this.curlyStack.length-1]==="${"){return this.scanTemplate()}if(cp>=55296&&cp<57343){if(character_1.Character.isIdentifierStart(this.codePointAt(this.index))){return this.scanIdentifier()}}return this.scanPunctuator()};return Scanner}();exports.Scanner=Scanner},function(module,exports){"use strict";var Regex={NonAsciiIdentifierStart:/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0-\u08B4\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FD5\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AD\uA7B0-\uA7B7\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF30-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC03-\uDC37\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDF00-\uDF19]|\uD806[\uDCA0-\uDCDF\uDCFF\uDEC0-\uDEF8]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50\uDF93-\uDF9F]|\uD82C[\uDC00\uDC01]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD83A[\uDC00-\uDCC4]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1]|\uD87E[\uDC00-\uDE1D]/,NonAsciiIdentifierPart:/[\xAA\xB5\xB7\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05F0-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u082D\u0840-\u085B\u08A0-\u08B4\u08E3-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0AF9\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58-\u0C5A\u0C60-\u0C63\u0C66-\u0C6F\u0C81-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D01-\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D57\u0D5F-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D82\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB9\u0EBB-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1369-\u1371\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1877\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19DA\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1CD0-\u1CD2\u1CD4-\u1CF6\u1CF8\u1CF9\u1D00-\u1DF5\u1DFC-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u200C\u200D\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FD5\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AD\uA7B0-\uA7B7\uA7F7-\uA827\uA840-\uA873\uA880-\uA8C4\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD\uA900-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDDFD\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0\uDF00-\uDF1F\uDF30-\uDF4A\uDF50-\uDF7A\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00-\uDE03\uDE05\uDE06\uDE0C-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE38-\uDE3A\uDE3F\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE6\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC00-\uDC46\uDC66-\uDC6F\uDC7F-\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD00-\uDD34\uDD36-\uDD3F\uDD50-\uDD73\uDD76\uDD80-\uDDC4\uDDCA-\uDDCC\uDDD0-\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE37\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEEA\uDEF0-\uDEF9\uDF00-\uDF03\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3C-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF50\uDF57\uDF5D-\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC80-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDB5\uDDB8-\uDDC0\uDDD8-\uDDDD\uDE00-\uDE40\uDE44\uDE50-\uDE59\uDE80-\uDEB7\uDEC0-\uDEC9\uDF00-\uDF19\uDF1D-\uDF2B\uDF30-\uDF39]|\uD806[\uDCA0-\uDCE9\uDCFF\uDEC0-\uDEF8]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50-\uDF7E\uDF8F-\uDF9F]|\uD82C[\uDC00\uDC01]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99\uDC9D\uDC9E]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD83A[\uDC00-\uDCC4\uDCD0-\uDCD6]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1]|\uD87E[\uDC00-\uDE1D]|\uDB40[\uDD00-\uDDEF]/};exports.Character={fromCodePoint:function(cp){return cp<65536?String.fromCharCode(cp):String.fromCharCode(55296+(cp-65536>>10))+String.fromCharCode(56320+(cp-65536&1023))},isWhiteSpace:function(cp){return cp===32||cp===9||cp===11||cp===12||cp===160||cp>=5760&&[5760,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(cp)>=0},isLineTerminator:function(cp){return cp===10||cp===13||cp===8232||cp===8233},isIdentifierStart:function(cp){return cp===36||cp===95||cp>=65&&cp<=90||cp>=97&&cp<=122||cp===92||cp>=128&&Regex.NonAsciiIdentifierStart.test(exports.Character.fromCodePoint(cp))},isIdentifierPart:function(cp){return cp===36||cp===95||cp>=65&&cp<=90||cp>=97&&cp<=122||cp>=48&&cp<=57||cp===92||cp>=128&&Regex.NonAsciiIdentifierPart.test(exports.Character.fromCodePoint(cp))},isDecimalDigit:function(cp){return cp>=48&&cp<=57},isHexDigit:function(cp){return cp>=48&&cp<=57||cp>=65&&cp<=70||cp>=97&&cp<=102},isOctalDigit:function(cp){return cp>=48&&cp<=55}}},function(module,exports,__webpack_require__){"use strict";var syntax_1=__webpack_require__(2);var ArrayExpression=function(){function ArrayExpression(elements){this.type=syntax_1.Syntax.ArrayExpression;this.elements=elements}return ArrayExpression}();exports.ArrayExpression=ArrayExpression;var ArrayPattern=function(){function ArrayPattern(elements){this.type=syntax_1.Syntax.ArrayPattern;this.elements=elements}return ArrayPattern}();exports.ArrayPattern=ArrayPattern;var ArrowFunctionExpression=function(){function ArrowFunctionExpression(params,body,expression){this.type=syntax_1.Syntax.ArrowFunctionExpression;this.id=null;this.params=params;this.body=body;this.generator=false;this.expression=expression}return ArrowFunctionExpression}();exports.ArrowFunctionExpression=ArrowFunctionExpression;var AssignmentExpression=function(){function AssignmentExpression(operator,left,right){this.type=syntax_1.Syntax.AssignmentExpression;this.operator=operator;this.left=left;this.right=right}return AssignmentExpression}();exports.AssignmentExpression=AssignmentExpression;var AssignmentPattern=function(){function AssignmentPattern(left,right){this.type=syntax_1.Syntax.AssignmentPattern;this.left=left;this.right=right}return AssignmentPattern}();exports.AssignmentPattern=AssignmentPattern;var BinaryExpression=function(){function BinaryExpression(operator,left,right){var logical=operator==="||"||operator==="&&";this.type=logical?syntax_1.Syntax.LogicalExpression:syntax_1.Syntax.BinaryExpression;this.operator=operator;this.left=left;this.right=right}return BinaryExpression}();exports.BinaryExpression=BinaryExpression;var BlockStatement=function(){function BlockStatement(body){this.type=syntax_1.Syntax.BlockStatement;this.body=body}return BlockStatement}();exports.BlockStatement=BlockStatement;var BreakStatement=function(){function BreakStatement(label){this.type=syntax_1.Syntax.BreakStatement;this.label=label}return BreakStatement}();exports.BreakStatement=BreakStatement;var CallExpression=function(){function CallExpression(callee,args){this.type=syntax_1.Syntax.CallExpression;this.callee=callee;this.arguments=args}return CallExpression}();exports.CallExpression=CallExpression;var CatchClause=function(){function CatchClause(param,body){this.type=syntax_1.Syntax.CatchClause;this.param=param;this.body=body}return CatchClause}();exports.CatchClause=CatchClause;var ClassBody=function(){function ClassBody(body){this.type=syntax_1.Syntax.ClassBody;this.body=body}return ClassBody}();exports.ClassBody=ClassBody;var ClassDeclaration=function(){function ClassDeclaration(id,superClass,body){this.type=syntax_1.Syntax.ClassDeclaration;this.id=id;this.superClass=superClass;this.body=body}return ClassDeclaration}();exports.ClassDeclaration=ClassDeclaration;var ClassExpression=function(){function ClassExpression(id,superClass,body){this.type=syntax_1.Syntax.ClassExpression;this.id=id;this.superClass=superClass;this.body=body}return ClassExpression}();exports.ClassExpression=ClassExpression;var ComputedMemberExpression=function(){function ComputedMemberExpression(object,property){this.type=syntax_1.Syntax.MemberExpression;this.computed=true;this.object=object;this.property=property}return ComputedMemberExpression}();exports.ComputedMemberExpression=ComputedMemberExpression;var ConditionalExpression=function(){function ConditionalExpression(test,consequent,alternate){this.type=syntax_1.Syntax.ConditionalExpression;this.test=test;this.consequent=consequent;this.alternate=alternate}return ConditionalExpression}();exports.ConditionalExpression=ConditionalExpression;var ContinueStatement=function(){function ContinueStatement(label){this.type=syntax_1.Syntax.ContinueStatement;this.label=label}return ContinueStatement}();exports.ContinueStatement=ContinueStatement;var DebuggerStatement=function(){function DebuggerStatement(){this.type=syntax_1.Syntax.DebuggerStatement}return DebuggerStatement}();exports.DebuggerStatement=DebuggerStatement;var Directive=function(){function Directive(expression,directive){this.type=syntax_1.Syntax.ExpressionStatement;this.expression=expression;this.directive=directive}return Directive}();exports.Directive=Directive;var DoWhileStatement=function(){function DoWhileStatement(body,test){this.type=syntax_1.Syntax.DoWhileStatement;this.body=body;this.test=test}return DoWhileStatement}();exports.DoWhileStatement=DoWhileStatement;var EmptyStatement=function(){function EmptyStatement(){this.type=syntax_1.Syntax.EmptyStatement}return EmptyStatement}();exports.EmptyStatement=EmptyStatement;var ExportAllDeclaration=function(){function ExportAllDeclaration(source){this.type=syntax_1.Syntax.ExportAllDeclaration;this.source=source}return ExportAllDeclaration}();exports.ExportAllDeclaration=ExportAllDeclaration;var ExportDefaultDeclaration=function(){function ExportDefaultDeclaration(declaration){this.type=syntax_1.Syntax.ExportDefaultDeclaration;this.declaration=declaration}return ExportDefaultDeclaration}();exports.ExportDefaultDeclaration=ExportDefaultDeclaration;var ExportNamedDeclaration=function(){function ExportNamedDeclaration(declaration,specifiers,source){this.type=syntax_1.Syntax.ExportNamedDeclaration;this.declaration=declaration;this.specifiers=specifiers;this.source=source}return ExportNamedDeclaration}();exports.ExportNamedDeclaration=ExportNamedDeclaration;var ExportSpecifier=function(){function ExportSpecifier(local,exported){this.type=syntax_1.Syntax.ExportSpecifier;this.exported=exported;this.local=local}return ExportSpecifier}();exports.ExportSpecifier=ExportSpecifier;var ExpressionStatement=function(){function ExpressionStatement(expression){this.type=syntax_1.Syntax.ExpressionStatement;this.expression=expression}return ExpressionStatement}();exports.ExpressionStatement=ExpressionStatement;var ForInStatement=function(){function ForInStatement(left,right,body){this.type=syntax_1.Syntax.ForInStatement;this.left=left;this.right=right;this.body=body;this.each=false}return ForInStatement}();exports.ForInStatement=ForInStatement;var ForOfStatement=function(){function ForOfStatement(left,right,body){this.type=syntax_1.Syntax.ForOfStatement;this.left=left;this.right=right;this.body=body}return ForOfStatement}();exports.ForOfStatement=ForOfStatement;var ForStatement=function(){function ForStatement(init,test,update,body){this.type=syntax_1.Syntax.ForStatement;this.init=init;this.test=test;this.update=update;this.body=body}return ForStatement}();exports.ForStatement=ForStatement;var FunctionDeclaration=function(){function FunctionDeclaration(id,params,body,generator){this.type=syntax_1.Syntax.FunctionDeclaration;this.id=id;this.params=params;this.body=body;this.generator=generator;this.expression=false}return FunctionDeclaration}();exports.FunctionDeclaration=FunctionDeclaration;var FunctionExpression=function(){function FunctionExpression(id,params,body,generator){this.type=syntax_1.Syntax.FunctionExpression;this.id=id;this.params=params;this.body=body;this.generator=generator;this.expression=false}return FunctionExpression}();exports.FunctionExpression=FunctionExpression;var Identifier=function(){function Identifier(name){this.type=syntax_1.Syntax.Identifier;this.name=name}return Identifier}();exports.Identifier=Identifier;var IfStatement=function(){function IfStatement(test,consequent,alternate){this.type=syntax_1.Syntax.IfStatement;this.test=test;this.consequent=consequent;this.alternate=alternate}return IfStatement}();exports.IfStatement=IfStatement;var ImportDeclaration=function(){function ImportDeclaration(specifiers,source){this.type=syntax_1.Syntax.ImportDeclaration;this.specifiers=specifiers;this.source=source}return ImportDeclaration}();exports.ImportDeclaration=ImportDeclaration;var ImportDefaultSpecifier=function(){function ImportDefaultSpecifier(local){this.type=syntax_1.Syntax.ImportDefaultSpecifier;this.local=local}return ImportDefaultSpecifier}();exports.ImportDefaultSpecifier=ImportDefaultSpecifier;var ImportNamespaceSpecifier=function(){function ImportNamespaceSpecifier(local){this.type=syntax_1.Syntax.ImportNamespaceSpecifier;this.local=local}return ImportNamespaceSpecifier}();exports.ImportNamespaceSpecifier=ImportNamespaceSpecifier;var ImportSpecifier=function(){function ImportSpecifier(local,imported){this.type=syntax_1.Syntax.ImportSpecifier;this.local=local;this.imported=imported}return ImportSpecifier}();exports.ImportSpecifier=ImportSpecifier;var LabeledStatement=function(){function LabeledStatement(label,body){this.type=syntax_1.Syntax.LabeledStatement;this.label=label;this.body=body}return LabeledStatement}();exports.LabeledStatement=LabeledStatement;var Literal=function(){function Literal(value,raw){this.type=syntax_1.Syntax.Literal;this.value=value;this.raw=raw}return Literal}();exports.Literal=Literal;var MetaProperty=function(){function MetaProperty(meta,property){this.type=syntax_1.Syntax.MetaProperty;this.meta=meta;this.property=property}return MetaProperty}();exports.MetaProperty=MetaProperty;var MethodDefinition=function(){function MethodDefinition(key,computed,value,kind,isStatic){this.type=syntax_1.Syntax.MethodDefinition;this.key=key;this.computed=computed;this.value=value;this.kind=kind;this.static=isStatic}return MethodDefinition}();exports.MethodDefinition=MethodDefinition;var NewExpression=function(){function NewExpression(callee,args){this.type=syntax_1.Syntax.NewExpression;this.callee=callee;this.arguments=args}return NewExpression}();exports.NewExpression=NewExpression;var ObjectExpression=function(){function ObjectExpression(properties){this.type=syntax_1.Syntax.ObjectExpression;this.properties=properties}return ObjectExpression}();exports.ObjectExpression=ObjectExpression;var ObjectPattern=function(){function ObjectPattern(properties){this.type=syntax_1.Syntax.ObjectPattern;this.properties=properties}return ObjectPattern}();exports.ObjectPattern=ObjectPattern;var Program=function(){function Program(body,sourceType){this.type=syntax_1.Syntax.Program;this.body=body;this.sourceType=sourceType}return Program}();exports.Program=Program;var Property=function(){function Property(kind,key,computed,value,method,shorthand){this.type=syntax_1.Syntax.Property;this.key=key;this.computed=computed;this.value=value;this.kind=kind;this.method=method;this.shorthand=shorthand}return Property}();exports.Property=Property;var RegexLiteral=function(){function RegexLiteral(value,raw,regex){this.type=syntax_1.Syntax.Literal;this.value=value;this.raw=raw;this.regex=regex}return RegexLiteral}();exports.RegexLiteral=RegexLiteral;var RestElement=function(){function RestElement(argument){this.type=syntax_1.Syntax.RestElement;this.argument=argument}return RestElement}();exports.RestElement=RestElement;var ReturnStatement=function(){function ReturnStatement(argument){this.type=syntax_1.Syntax.ReturnStatement;this.argument=argument}return ReturnStatement}();exports.ReturnStatement=ReturnStatement;var SequenceExpression=function(){function SequenceExpression(expressions){this.type=syntax_1.Syntax.SequenceExpression;this.expressions=expressions}return SequenceExpression}();exports.SequenceExpression=SequenceExpression;var SpreadElement=function(){function SpreadElement(argument){this.type=syntax_1.Syntax.SpreadElement;this.argument=argument}return SpreadElement}();exports.SpreadElement=SpreadElement;var StaticMemberExpression=function(){function StaticMemberExpression(object,property){this.type=syntax_1.Syntax.MemberExpression;this.computed=false;this.object=object;this.property=property}return StaticMemberExpression}();exports.StaticMemberExpression=StaticMemberExpression;var Super=function(){function Super(){this.type=syntax_1.Syntax.Super}return Super}();exports.Super=Super;var SwitchCase=function(){function SwitchCase(test,consequent){this.type=syntax_1.Syntax.SwitchCase;this.test=test;this.consequent=consequent}return SwitchCase}();exports.SwitchCase=SwitchCase;var SwitchStatement=function(){function SwitchStatement(discriminant,cases){this.type=syntax_1.Syntax.SwitchStatement;this.discriminant=discriminant;this.cases=cases}return SwitchStatement}();exports.SwitchStatement=SwitchStatement;var TaggedTemplateExpression=function(){function TaggedTemplateExpression(tag,quasi){this.type=syntax_1.Syntax.TaggedTemplateExpression;this.tag=tag;this.quasi=quasi}return TaggedTemplateExpression}();exports.TaggedTemplateExpression=TaggedTemplateExpression;var TemplateElement=function(){function TemplateElement(value,tail){this.type=syntax_1.Syntax.TemplateElement;this.value=value;this.tail=tail}return TemplateElement}();exports.TemplateElement=TemplateElement;var TemplateLiteral=function(){function TemplateLiteral(quasis,expressions){this.type=syntax_1.Syntax.TemplateLiteral;this.quasis=quasis;this.expressions=expressions}return TemplateLiteral}();exports.TemplateLiteral=TemplateLiteral;var ThisExpression=function(){function ThisExpression(){this.type=syntax_1.Syntax.ThisExpression}return ThisExpression}();exports.ThisExpression=ThisExpression;var ThrowStatement=function(){function ThrowStatement(argument){this.type=syntax_1.Syntax.ThrowStatement;this.argument=argument}return ThrowStatement}();exports.ThrowStatement=ThrowStatement;var TryStatement=function(){function TryStatement(block,handler,finalizer){this.type=syntax_1.Syntax.TryStatement;this.block=block;this.handler=handler;this.finalizer=finalizer}return TryStatement}();exports.TryStatement=TryStatement;var UnaryExpression=function(){function UnaryExpression(operator,argument){this.type=syntax_1.Syntax.UnaryExpression;this.operator=operator;this.argument=argument;this.prefix=true}return UnaryExpression}();exports.UnaryExpression=UnaryExpression;var UpdateExpression=function(){function UpdateExpression(operator,argument,prefix){this.type=syntax_1.Syntax.UpdateExpression;this.operator=operator;this.argument=argument;this.prefix=prefix}return UpdateExpression}();exports.UpdateExpression=UpdateExpression;var VariableDeclaration=function(){function VariableDeclaration(declarations,kind){this.type=syntax_1.Syntax.VariableDeclaration;this.declarations=declarations;this.kind=kind}return VariableDeclaration}();exports.VariableDeclaration=VariableDeclaration;var VariableDeclarator=function(){function VariableDeclarator(id,init){this.type=syntax_1.Syntax.VariableDeclarator;this.id=id;this.init=init}return VariableDeclarator}();exports.VariableDeclarator=VariableDeclarator;var WhileStatement=function(){function WhileStatement(test,body){this.type=syntax_1.Syntax.WhileStatement;this.test=test;this.body=body}return WhileStatement}();exports.WhileStatement=WhileStatement;var WithStatement=function(){function WithStatement(object,body){this.type=syntax_1.Syntax.WithStatement;this.object=object;this.body=body}return WithStatement}();exports.WithStatement=WithStatement;var YieldExpression=function(){function YieldExpression(argument,delegate){this.type=syntax_1.Syntax.YieldExpression;this.argument=argument;this.delegate=delegate}return YieldExpression}();exports.YieldExpression=YieldExpression},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var character_1=__webpack_require__(9);var token_1=__webpack_require__(7);var parser_1=__webpack_require__(3);var xhtml_entities_1=__webpack_require__(12);var jsx_syntax_1=__webpack_require__(13);var Node=__webpack_require__(10);var JSXNode=__webpack_require__(14);var JSXToken;(function(JSXToken){JSXToken[JSXToken["Identifier"]=100]="Identifier";JSXToken[JSXToken["Text"]=101]="Text"})(JSXToken||(JSXToken={}));token_1.TokenName[JSXToken.Identifier]="JSXIdentifier";token_1.TokenName[JSXToken.Text]="JSXText";function getQualifiedElementName(elementName){var qualifiedName;switch(elementName.type){case jsx_syntax_1.JSXSyntax.JSXIdentifier:var id=elementName;qualifiedName=id.name;break;case jsx_syntax_1.JSXSyntax.JSXNamespacedName:var ns=elementName;qualifiedName=getQualifiedElementName(ns.namespace)+":"+getQualifiedElementName(ns.name);break;case jsx_syntax_1.JSXSyntax.JSXMemberExpression:var expr=elementName;qualifiedName=getQualifiedElementName(expr.object)+"."+getQualifiedElementName(expr.property);break}return qualifiedName}var JSXParser=function(_super){__extends(JSXParser,_super);function JSXParser(code,options,delegate){_super.call(this,code,options,delegate)}JSXParser.prototype.parsePrimaryExpression=function(){return this.match("<")?this.parseJSXRoot():_super.prototype.parsePrimaryExpression.call(this)};JSXParser.prototype.startJSX=function(){this.scanner.index=this.startMarker.index;this.scanner.lineNumber=this.startMarker.lineNumber;this.scanner.lineStart=this.startMarker.lineStart};JSXParser.prototype.finishJSX=function(){this.nextToken()};JSXParser.prototype.reenterJSX=function(){this.startJSX();this.expectJSX("}");if(this.config.tokens){this.tokens.pop()}};JSXParser.prototype.createJSXNode=function(){this.collectComments();return{index:this.scanner.index,line:this.scanner.lineNumber,column:this.scanner.index-this.scanner.lineStart}};JSXParser.prototype.createJSXChildNode=function(){return{index:this.scanner.index,line:this.scanner.lineNumber,column:this.scanner.index-this.scanner.lineStart}};JSXParser.prototype.scanXHTMLEntity=function(quote){var result="&";var valid=true;var terminated=false;var numeric=false;var hex=false;while(!this.scanner.eof()&&valid&&!terminated){var ch=this.scanner.source[this.scanner.index];if(ch===quote){break}terminated=ch===";";result+=ch;++this.scanner.index;if(!terminated){switch(result.length){case 2:numeric=ch==="#";break;case 3:if(numeric){hex=ch==="x";valid=hex||character_1.Character.isDecimalDigit(ch.charCodeAt(0));numeric=numeric&&!hex}break;default:valid=valid&&!(numeric&&!character_1.Character.isDecimalDigit(ch.charCodeAt(0)));valid=valid&&!(hex&&!character_1.Character.isHexDigit(ch.charCodeAt(0)));break}}}if(valid&&terminated&&result.length>2){var str=result.substr(1,result.length-2);if(numeric&&str.length>1){result=String.fromCharCode(parseInt(str.substr(1),10))}else if(hex&&str.length>2){result=String.fromCharCode(parseInt("0"+str.substr(1),16))}else if(!numeric&&!hex&&xhtml_entities_1.XHTMLEntities[str]){result=xhtml_entities_1.XHTMLEntities[str]}}return result};JSXParser.prototype.lexJSX=function(){var cp=this.scanner.source.charCodeAt(this.scanner.index);if(cp===60||cp===62||cp===47||cp===58||cp===61||cp===123||cp===125){var value=this.scanner.source[this.scanner.index++];return{type:token_1.Token.Punctuator,value:value,lineNumber:this.scanner.lineNumber,lineStart:this.scanner.lineStart,start:this.scanner.index-1,end:this.scanner.index}}if(cp===34||cp===39){var start=this.scanner.index;var quote=this.scanner.source[this.scanner.index++];var str="";while(!this.scanner.eof()){var ch=this.scanner.source[this.scanner.index++];if(ch===quote){break}else if(ch==="&"){str+=this.scanXHTMLEntity(quote)}else{str+=ch}}return{type:token_1.Token.StringLiteral,value:str,lineNumber:this.scanner.lineNumber,lineStart:this.scanner.lineStart,start:start,end:this.scanner.index}}if(cp===46){var n1=this.scanner.source.charCodeAt(this.scanner.index+1);var n2=this.scanner.source.charCodeAt(this.scanner.index+2);var value=n1===46&&n2===46?"...":".";var start=this.scanner.index;this.scanner.index+=value.length;return{type:token_1.Token.Punctuator,value:value,lineNumber:this.scanner.lineNumber,lineStart:this.scanner.lineStart,start:start,end:this.scanner.index}}if(cp===96){return{type:token_1.Token.Template,lineNumber:this.scanner.lineNumber,lineStart:this.scanner.lineStart,start:this.scanner.index,end:this.scanner.index}}if(character_1.Character.isIdentifierStart(cp)&&cp!==92){var start=this.scanner.index;++this.scanner.index;while(!this.scanner.eof()){var ch=this.scanner.source.charCodeAt(this.scanner.index);if(character_1.Character.isIdentifierPart(ch)&&ch!==92){++this.scanner.index}else if(ch===45){++this.scanner.index}else{break}}var id=this.scanner.source.slice(start,this.scanner.index);return{type:JSXToken.Identifier,value:id,lineNumber:this.scanner.lineNumber,lineStart:this.scanner.lineStart,start:start,end:this.scanner.index}}this.scanner.throwUnexpectedToken()};JSXParser.prototype.nextJSXToken=function(){this.collectComments();this.startMarker.index=this.scanner.index;this.startMarker.lineNumber=this.scanner.lineNumber;this.startMarker.lineStart=this.scanner.lineStart;var token=this.lexJSX();this.lastMarker.index=this.scanner.index;this.lastMarker.lineNumber=this.scanner.lineNumber;this.lastMarker.lineStart=this.scanner.lineStart;if(this.config.tokens){this.tokens.push(this.convertToken(token))}return token};JSXParser.prototype.nextJSXText=function(){this.startMarker.index=this.scanner.index;this.startMarker.lineNumber=this.scanner.lineNumber;this.startMarker.lineStart=this.scanner.lineStart;var start=this.scanner.index;var text="";while(!this.scanner.eof()){var ch=this.scanner.source[this.scanner.index];if(ch==="{"||ch==="<"){break}++this.scanner.index;text+=ch;if(character_1.Character.isLineTerminator(ch.charCodeAt(0))){++this.scanner.lineNumber;if(ch==="\r"&&this.scanner.source[this.scanner.index]==="\n"){++this.scanner.index}this.scanner.lineStart=this.scanner.index}}this.lastMarker.index=this.scanner.index;this.lastMarker.lineNumber=this.scanner.lineNumber;this.lastMarker.lineStart=this.scanner.lineStart;var token={type:JSXToken.Text,value:text,lineNumber:this.scanner.lineNumber,lineStart:this.scanner.lineStart,start:start,end:this.scanner.index};if(text.length>0&&this.config.tokens){this.tokens.push(this.convertToken(token))}return token};JSXParser.prototype.peekJSXToken=function(){var previousIndex=this.scanner.index;var previousLineNumber=this.scanner.lineNumber;var previousLineStart=this.scanner.lineStart;this.scanner.scanComments();var next=this.lexJSX();this.scanner.index=previousIndex;this.scanner.lineNumber=previousLineNumber;this.scanner.lineStart=previousLineStart;return next};JSXParser.prototype.expectJSX=function(value){var token=this.nextJSXToken();if(token.type!==token_1.Token.Punctuator||token.value!==value){this.throwUnexpectedToken(token)}};JSXParser.prototype.matchJSX=function(value){var next=this.peekJSXToken();return next.type===token_1.Token.Punctuator&&next.value===value};JSXParser.prototype.parseJSXIdentifier=function(){var node=this.createJSXNode();var token=this.nextJSXToken();if(token.type!==JSXToken.Identifier){this.throwUnexpectedToken(token)}return this.finalize(node,new JSXNode.JSXIdentifier(token.value))};JSXParser.prototype.parseJSXElementName=function(){var node=this.createJSXNode();var elementName=this.parseJSXIdentifier();if(this.matchJSX(":")){var namespace=elementName;this.expectJSX(":");var name_1=this.parseJSXIdentifier();elementName=this.finalize(node,new JSXNode.JSXNamespacedName(namespace,name_1))}else if(this.matchJSX(".")){while(this.matchJSX(".")){var object=elementName;this.expectJSX(".");var property=this.parseJSXIdentifier();elementName=this.finalize(node,new JSXNode.JSXMemberExpression(object,property))}}return elementName};JSXParser.prototype.parseJSXAttributeName=function(){var node=this.createJSXNode();var attributeName;var identifier=this.parseJSXIdentifier();if(this.matchJSX(":")){var namespace=identifier;this.expectJSX(":");var name_2=this.parseJSXIdentifier();attributeName=this.finalize(node,new JSXNode.JSXNamespacedName(namespace,name_2))}else{attributeName=identifier}return attributeName};JSXParser.prototype.parseJSXStringLiteralAttribute=function(){var node=this.createJSXNode();var token=this.nextJSXToken();if(token.type!==token_1.Token.StringLiteral){this.throwUnexpectedToken(token)}var raw=this.getTokenRaw(token);return this.finalize(node,new Node.Literal(token.value,raw))};JSXParser.prototype.parseJSXExpressionAttribute=function(){var node=this.createJSXNode();this.expectJSX("{");this.finishJSX();if(this.match("}")){this.tolerateError("JSX attributes must only be assigned a non-empty expression")}var expression=this.parseAssignmentExpression();this.reenterJSX();return this.finalize(node,new JSXNode.JSXExpressionContainer(expression))};JSXParser.prototype.parseJSXAttributeValue=function(){return this.matchJSX("{")?this.parseJSXExpressionAttribute():this.matchJSX("<")?this.parseJSXElement():this.parseJSXStringLiteralAttribute()};JSXParser.prototype.parseJSXNameValueAttribute=function(){var node=this.createJSXNode();var name=this.parseJSXAttributeName();var value=null;if(this.matchJSX("=")){this.expectJSX("=");value=this.parseJSXAttributeValue()}return this.finalize(node,new JSXNode.JSXAttribute(name,value))};JSXParser.prototype.parseJSXSpreadAttribute=function(){var node=this.createJSXNode();this.expectJSX("{");this.expectJSX("...");this.finishJSX();var argument=this.parseAssignmentExpression();this.reenterJSX();return this.finalize(node,new JSXNode.JSXSpreadAttribute(argument))};JSXParser.prototype.parseJSXAttributes=function(){var attributes=[];while(!this.matchJSX("/")&&!this.matchJSX(">")){var attribute=this.matchJSX("{")?this.parseJSXSpreadAttribute():this.parseJSXNameValueAttribute();attributes.push(attribute)}return attributes};JSXParser.prototype.parseJSXOpeningElement=function(){var node=this.createJSXNode();this.expectJSX("<");var name=this.parseJSXElementName();var attributes=this.parseJSXAttributes();var selfClosing=this.matchJSX("/");if(selfClosing){this.expectJSX("/")}this.expectJSX(">");return this.finalize(node,new JSXNode.JSXOpeningElement(name,selfClosing,attributes))};JSXParser.prototype.parseJSXBoundaryElement=function(){var node=this.createJSXNode();this.expectJSX("<");if(this.matchJSX("/")){this.expectJSX("/");var name_3=this.parseJSXElementName();this.expectJSX(">");return this.finalize(node,new JSXNode.JSXClosingElement(name_3))}var name=this.parseJSXElementName();var attributes=this.parseJSXAttributes();var selfClosing=this.matchJSX("/");if(selfClosing){this.expectJSX("/")}this.expectJSX(">");return this.finalize(node,new JSXNode.JSXOpeningElement(name,selfClosing,attributes))};JSXParser.prototype.parseJSXEmptyExpression=function(){var node=this.createJSXChildNode();this.collectComments();this.lastMarker.index=this.scanner.index;this.lastMarker.lineNumber=this.scanner.lineNumber;this.lastMarker.lineStart=this.scanner.lineStart;return this.finalize(node,new JSXNode.JSXEmptyExpression)};JSXParser.prototype.parseJSXExpressionContainer=function(){var node=this.createJSXNode();this.expectJSX("{");var expression;if(this.matchJSX("}")){expression=this.parseJSXEmptyExpression();this.expectJSX("}")}else{this.finishJSX();expression=this.parseAssignmentExpression();this.reenterJSX()}return this.finalize(node,new JSXNode.JSXExpressionContainer(expression))};JSXParser.prototype.parseJSXChildren=function(){var children=[];while(!this.scanner.eof()){var node=this.createJSXChildNode();var token=this.nextJSXText();if(token.start<token.end){var raw=this.getTokenRaw(token);var child=this.finalize(node,new JSXNode.JSXText(token.value,raw));children.push(child)}if(this.scanner.source[this.scanner.index]==="{"){var container=this.parseJSXExpressionContainer();children.push(container)}else{break}}return children};JSXParser.prototype.parseComplexJSXElement=function(el){var stack=[];while(!this.scanner.eof()){el.children=el.children.concat(this.parseJSXChildren());var node=this.createJSXChildNode();var element=this.parseJSXBoundaryElement();if(element.type===jsx_syntax_1.JSXSyntax.JSXOpeningElement){var opening=element;if(opening.selfClosing){var child=this.finalize(node,new JSXNode.JSXElement(opening,[],null));el.children.push(child)}else{stack.push(el);el={node:node,opening:opening,closing:null,children:[]}}}if(element.type===jsx_syntax_1.JSXSyntax.JSXClosingElement){el.closing=element;var open_1=getQualifiedElementName(el.opening.name);var close_1=getQualifiedElementName(el.closing.name);if(open_1!==close_1){this.tolerateError("Expected corresponding JSX closing tag for %0",open_1)}if(stack.length>0){var child=this.finalize(el.node,new JSXNode.JSXElement(el.opening,el.children,el.closing));el=stack.pop();el.children.push(child)}else{break}}}return el};JSXParser.prototype.parseJSXElement=function(){var node=this.createJSXNode();var opening=this.parseJSXOpeningElement();var children=[];var closing=null;if(!opening.selfClosing){var el=this.parseComplexJSXElement({node:node,opening:opening,closing:closing,children:children});children=el.children;closing=el.closing}return this.finalize(node,new JSXNode.JSXElement(opening,children,closing))};JSXParser.prototype.parseJSXRoot=function(){if(this.config.tokens){this.tokens.pop()}this.startJSX();var element=this.parseJSXElement();this.finishJSX();return element};return JSXParser}(parser_1.Parser);exports.JSXParser=JSXParser},function(module,exports){"use strict";exports.XHTMLEntities={quot:'"',amp:"&",apos:"'",gt:">",nbsp:"\xa0",iexcl:"\xa1",cent:"\xa2",pound:"\xa3",curren:"\xa4",yen:"\xa5",brvbar:"\xa6",sect:"\xa7",uml:"\xa8",copy:"\xa9",ordf:"\xaa",laquo:"\xab",not:"\xac",shy:"\xad",reg:"\xae",macr:"\xaf",deg:"\xb0",plusmn:"\xb1",sup2:"\xb2",sup3:"\xb3",acute:"\xb4",micro:"\xb5",para:"\xb6",middot:"\xb7",cedil:"\xb8",sup1:"\xb9",ordm:"\xba",raquo:"\xbb",frac14:"\xbc",frac12:"\xbd",frac34:"\xbe",iquest:"\xbf",Agrave:"\xc0",Aacute:"\xc1",Acirc:"\xc2",Atilde:"\xc3",Auml:"\xc4",Aring:"\xc5",AElig:"\xc6",Ccedil:"\xc7",Egrave:"\xc8",Eacute:"\xc9",Ecirc:"\xca",Euml:"\xcb",Igrave:"\xcc",Iacute:"\xcd",Icirc:"\xce",Iuml:"\xcf",ETH:"\xd0",Ntilde:"\xd1",Ograve:"\xd2",Oacute:"\xd3",Ocirc:"\xd4",Otilde:"\xd5",Ouml:"\xd6",times:"\xd7",Oslash:"\xd8",Ugrave:"\xd9",Uacute:"\xda",Ucirc:"\xdb",Uuml:"\xdc",Yacute:"\xdd",THORN:"\xde",szlig:"\xdf",agrave:"\xe0",aacute:"\xe1",acirc:"\xe2",atilde:"\xe3",auml:"\xe4",aring:"\xe5",aelig:"\xe6",ccedil:"\xe7",egrave:"\xe8",eacute:"\xe9",ecirc:"\xea",euml:"\xeb",igrave:"\xec",iacute:"\xed",icirc:"\xee",iuml:"\xef",eth:"\xf0",ntilde:"\xf1",ograve:"\xf2",oacute:"\xf3",ocirc:"\xf4",otilde:"\xf5",ouml:"\xf6",divide:"\xf7",oslash:"\xf8",ugrave:"\xf9",uacute:"\xfa",ucirc:"\xfb",uuml:"\xfc",yacute:"\xfd",thorn:"\xfe",yuml:"\xff",OElig:"\u0152",oelig:"\u0153",Scaron:"\u0160",scaron:"\u0161",Yuml:"\u0178",fnof:"\u0192",circ:"\u02c6",tilde:"\u02dc",Alpha:"\u0391",Beta:"\u0392",Gamma:"\u0393",Delta:"\u0394",Epsilon:"\u0395",Zeta:"\u0396",Eta:"\u0397",Theta:"\u0398",Iota:"\u0399",Kappa:"\u039a",Lambda:"\u039b",Mu:"\u039c",Nu:"\u039d",Xi:"\u039e",Omicron:"\u039f",Pi:"\u03a0",Rho:"\u03a1",Sigma:"\u03a3",Tau:"\u03a4",Upsilon:"\u03a5",Phi:"\u03a6",Chi:"\u03a7",Psi:"\u03a8",Omega:"\u03a9",alpha:"\u03b1",beta:"\u03b2",gamma:"\u03b3",delta:"\u03b4",epsilon:"\u03b5",zeta:"\u03b6",eta:"\u03b7",theta:"\u03b8",iota:"\u03b9",kappa:"\u03ba",lambda:"\u03bb",mu:"\u03bc",nu:"\u03bd",xi:"\u03be",omicron:"\u03bf",pi:"\u03c0",rho:"\u03c1",sigmaf:"\u03c2",sigma:"\u03c3",tau:"\u03c4",upsilon:"\u03c5",phi:"\u03c6",chi:"\u03c7",psi:"\u03c8",omega:"\u03c9",thetasym:"\u03d1",upsih:"\u03d2",piv:"\u03d6",ensp:"\u2002",emsp:"\u2003",thinsp:"\u2009",zwnj:"\u200c",zwj:"\u200d",lrm:"\u200e",rlm:"\u200f",ndash:"\u2013",mdash:"\u2014",lsquo:"\u2018",rsquo:"\u2019",sbquo:"\u201a",ldquo:"\u201c",rdquo:"\u201d",bdquo:"\u201e",dagger:"\u2020",Dagger:"\u2021",bull:"\u2022",hellip:"\u2026",permil:"\u2030",prime:"\u2032",Prime:"\u2033",lsaquo:"\u2039",rsaquo:"\u203a",oline:"\u203e",frasl:"\u2044",euro:"\u20ac",image:"\u2111",weierp:"\u2118",real:"\u211c",trade:"\u2122",alefsym:"\u2135",larr:"\u2190",uarr:"\u2191",rarr:"\u2192",darr:"\u2193",harr:"\u2194",crarr:"\u21b5",lArr:"\u21d0",uArr:"\u21d1",rArr:"\u21d2",dArr:"\u21d3",hArr:"\u21d4",forall:"\u2200",part:"\u2202",exist:"\u2203",empty:"\u2205",nabla:"\u2207",isin:"\u2208",notin:"\u2209",ni:"\u220b",prod:"\u220f",sum:"\u2211",minus:"\u2212",lowast:"\u2217",radic:"\u221a",prop:"\u221d",infin:"\u221e",ang:"\u2220",and:"\u2227",or:"\u2228",cap:"\u2229",cup:"\u222a",int:"\u222b",there4:"\u2234",sim:"\u223c",cong:"\u2245",asymp:"\u2248",ne:"\u2260",equiv:"\u2261",le:"\u2264",ge:"\u2265",sub:"\u2282",sup:"\u2283",nsub:"\u2284",sube:"\u2286",supe:"\u2287",oplus:"\u2295",otimes:"\u2297",perp:"\u22a5",sdot:"\u22c5",lceil:"\u2308",rceil:"\u2309",lfloor:"\u230a",rfloor:"\u230b",loz:"\u25ca",spades:"\u2660",clubs:"\u2663",hearts:"\u2665",diams:"\u2666",lang:"\u27e8",rang:"\u27e9"}},function(module,exports){"use strict";exports.JSXSyntax={JSXAttribute:"JSXAttribute",JSXClosingElement:"JSXClosingElement",JSXElement:"JSXElement",JSXEmptyExpression:"JSXEmptyExpression",JSXExpressionContainer:"JSXExpressionContainer",JSXIdentifier:"JSXIdentifier",JSXMemberExpression:"JSXMemberExpression",JSXNamespacedName:"JSXNamespacedName",JSXOpeningElement:"JSXOpeningElement",JSXSpreadAttribute:"JSXSpreadAttribute",JSXText:"JSXText"}},function(module,exports,__webpack_require__){"use strict";var jsx_syntax_1=__webpack_require__(13);var JSXClosingElement=function(){function JSXClosingElement(name){this.type=jsx_syntax_1.JSXSyntax.JSXClosingElement;this.name=name}return JSXClosingElement}();exports.JSXClosingElement=JSXClosingElement;var JSXElement=function(){function JSXElement(openingElement,children,closingElement){this.type=jsx_syntax_1.JSXSyntax.JSXElement;this.openingElement=openingElement;this.children=children;this.closingElement=closingElement}return JSXElement}();exports.JSXElement=JSXElement;var JSXEmptyExpression=function(){function JSXEmptyExpression(){this.type=jsx_syntax_1.JSXSyntax.JSXEmptyExpression}return JSXEmptyExpression}();exports.JSXEmptyExpression=JSXEmptyExpression;var JSXExpressionContainer=function(){function JSXExpressionContainer(expression){this.type=jsx_syntax_1.JSXSyntax.JSXExpressionContainer;this.expression=expression}return JSXExpressionContainer}();exports.JSXExpressionContainer=JSXExpressionContainer;var JSXIdentifier=function(){function JSXIdentifier(name){this.type=jsx_syntax_1.JSXSyntax.JSXIdentifier;this.name=name}return JSXIdentifier}();exports.JSXIdentifier=JSXIdentifier;var JSXMemberExpression=function(){function JSXMemberExpression(object,property){this.type=jsx_syntax_1.JSXSyntax.JSXMemberExpression;this.object=object;this.property=property}return JSXMemberExpression}();exports.JSXMemberExpression=JSXMemberExpression;var JSXAttribute=function(){function JSXAttribute(name,value){this.type=jsx_syntax_1.JSXSyntax.JSXAttribute;this.name=name;this.value=value}return JSXAttribute}();exports.JSXAttribute=JSXAttribute;var JSXNamespacedName=function(){function JSXNamespacedName(namespace,name){this.type=jsx_syntax_1.JSXSyntax.JSXNamespacedName;this.namespace=namespace;this.name=name}return JSXNamespacedName}();exports.JSXNamespacedName=JSXNamespacedName;var JSXOpeningElement=function(){function JSXOpeningElement(name,selfClosing,attributes){this.type=jsx_syntax_1.JSXSyntax.JSXOpeningElement;this.name=name;this.selfClosing=selfClosing;this.attributes=attributes}return JSXOpeningElement}();exports.JSXOpeningElement=JSXOpeningElement;var JSXSpreadAttribute=function(){function JSXSpreadAttribute(argument){this.type=jsx_syntax_1.JSXSyntax.JSXSpreadAttribute;this.argument=argument}return JSXSpreadAttribute}();exports.JSXSpreadAttribute=JSXSpreadAttribute;var JSXText=function(){function JSXText(value,raw){this.type=jsx_syntax_1.JSXSyntax.JSXText;this.value=value;this.raw=raw}return JSXText}();exports.JSXText=JSXText},function(module,exports,__webpack_require__){"use strict";var scanner_1=__webpack_require__(8);var error_handler_1=__webpack_require__(6);var token_1=__webpack_require__(7);var Reader=function(){function Reader(){this.values=[];this.curly=this.paren=-1}Reader.prototype.beforeFunctionExpression=function(t){return["(","{","[","in","typeof","instanceof","new","return","case","delete","throw","void","=","+=","-=","*=","**=","/=","%=","<<=",">>=",">>>=","&=","|=","^=",",","+","-","*","**","/","%","++","--","<<",">>",">>>","&","|","^","!","~","&&","||","?",":","===","==",">=","<=","<",">","!=","!=="].indexOf(t)>=0};Reader.prototype.isRegexStart=function(){var previous=this.values[this.values.length-1];var regex=previous!==null;switch(previous){case"this":case"]":regex=false;break;case")":var check=this.values[this.paren-1];regex=check==="if"||check==="while"||check==="for"||check==="with";break;case"}":regex=false;if(this.values[this.curly-3]==="function"){var check_1=this.values[this.curly-4];regex=check_1?!this.beforeFunctionExpression(check_1):false}else if(this.values[this.curly-4]==="function"){var check_2=this.values[this.curly-5];regex=check_2?!this.beforeFunctionExpression(check_2):true}}return regex};Reader.prototype.push=function(token){if(token.type===token_1.Token.Punctuator||token.type===token_1.Token.Keyword){if(token.value==="{"){this.curly=this.values.length}else if(token.value==="("){this.paren=this.values.length}this.values.push(token.value)}else{this.values.push(null)}};return Reader}();var Tokenizer=function(){function Tokenizer(code,config){this.errorHandler=new error_handler_1.ErrorHandler;this.errorHandler.tolerant=config?typeof config.tolerant==="boolean"&&config.tolerant:false;this.scanner=new scanner_1.Scanner(code,this.errorHandler);this.scanner.trackComment=config?typeof config.comment==="boolean"&&config.comment:false;this.trackRange=config?typeof config.range==="boolean"&&config.range:false;this.trackLoc=config?typeof config.loc==="boolean"&&config.loc:false;this.buffer=[];this.reader=new Reader}Tokenizer.prototype.errors=function(){return this.errorHandler.errors};Tokenizer.prototype.getNextToken=function(){if(this.buffer.length===0){var comments=this.scanner.scanComments();if(this.scanner.trackComment){for(var i=0;i<comments.length;++i){var e=comments[i];var comment=void 0;var value=this.scanner.source.slice(e.slice[0],e.slice[1]);comment={type:e.multiLine?"BlockComment":"LineComment",value:value};if(this.trackRange){comment.range=e.range}if(this.trackLoc){comment.loc=e.loc}this.buffer.push(comment)}}if(!this.scanner.eof()){var loc=void 0;if(this.trackLoc){loc={start:{line:this.scanner.lineNumber,column:this.scanner.index-this.scanner.lineStart},end:{}}}var token=void 0;if(this.scanner.source[this.scanner.index]==="/"){token=this.reader.isRegexStart()?this.scanner.scanRegExp():this.scanner.scanPunctuator()}else{token=this.scanner.lex()}this.reader.push(token);var entry=void 0;entry={type:token_1.TokenName[token.type],value:this.scanner.source.slice(token.start,token.end)};if(this.trackRange){entry.range=[token.start,token.end]}if(this.trackLoc){loc.end={line:this.scanner.lineNumber,column:this.scanner.index-this.scanner.lineStart};entry.loc=loc}if(token.regex){entry.regex=token.regex}this.buffer.push(entry)}}return this.buffer.shift()};return Tokenizer}();exports.Tokenizer=Tokenizer}])})},{}],112:[function(require,module,exports){(function(){"use strict";var escope,estraverse,esutils,utility,version,assert,Syntax,Map;escope=require("escope");estraverse=require("estraverse");esutils=require("esutils");utility=require("./utility");Map=require("./map");version=require("../package.json").version;Syntax=estraverse.Syntax;assert=function assert(cond,message){if(!cond){throw new Error(message)}};if(version.indexOf("-dev",version.length-4)===-1){assert=function(){}}function NameGenerator(scope,options){this._scope=scope;this._functionName="";if(!options.distinguishFunctionExpressionScope&&this._scope.upper&&this._scope.upper.functionExpressionScope){this._functionName=this._scope.upper.block.id.name}}NameGenerator.prototype.passAsUnique=function passAsUnique(name){var i,iz;if(this._functionName===name){return false}if(esutils.keyword.isKeywordES5(name,true)||esutils.keyword.isRestrictedWord(name)){return false}if(this._scope.taints.has(name)){return false}for(i=0,iz=this._scope.through.length;i<iz;++i){if(this._scope.through[i].identifier.name===name){return false}}return true};NameGenerator.prototype.generateName=function generateName(tip){do{tip=utility.generateNextName(tip)}while(!this.passAsUnique(tip));return tip};function run(scope,options){var i,iz,j,jz,variable,name,def,ref,generator;generator=new NameGenerator(scope,options);if(scope.isStatic()){name="9";scope.variables.sort(function(a,b){if(a.tainted){return 1}if(b.tainted){return-1}return b.identifiers.length+b.references.length-(a.identifiers.length+a.references.length)});for(i=0,iz=scope.variables.length;i<iz;++i){variable=scope.variables[i];if(variable.tainted){continue}if(variable.identifiers.length===0){continue}name=generator.generateName(name);for(j=0,jz=variable.identifiers.length;j<jz;++j){def=variable.identifiers[j];def.name=name}for(j=0,jz=variable.references.length;j<jz;++j){ref=variable.references[j];ref.identifier.name=name}}}}function Label(node,upper){this.node=node;this.upper=upper;this.users=[];this.names=new Map;this.name=null}Label.prototype.mangle=function(){var tip,current,i,iz;tip="9";for(current=this.upper;current;current=current.upper){if(current.name!==null){this.names.set(current.name,true)}}do{tip=utility.generateNextName(tip)}while(this.names.has(tip));this.name=tip;for(current=this.upper;current;current=current.upper){current.names.set(tip,true)}this.node.label.name=tip;for(i=0,iz=this.users.length;i<iz;++i){this.users[i].label.name=tip}};function LabelScope(upper){this.map=new Map;this.upper=upper;this.label=null;this.labels=[]}LabelScope.prototype.register=function register(node){var name;assert(node.type===Syntax.LabeledStatement,"node should be LabeledStatement");this.label=new Label(node,this.label);this.labels.push(this.label);name=node.label.name;assert(!this.map.has(name),"duplicate label is found");this.map.set(name,this.label)};LabelScope.prototype.unregister=function unregister(node){var name,ref;if(node.type!==Syntax.LabeledStatement){return}name=node.label.name;ref=this.map.get(name);this.map["delete"](name);this.label=ref.upper};LabelScope.prototype.resolve=function resolve(node){var name;if(node.label){name=node.label.name;assert(this.map.has(name),"unresolved label");this.map.get(name).users.push(node)}};LabelScope.prototype.close=function close(){var i,iz,label;this.labels.sort(function(lhs,rhs){return rhs.users.length-lhs.users.length});for(i=0,iz=this.labels.length;i<iz;++i){label=this.labels[i];label.mangle()}return this.upper};function mangleLabels(tree){var labelScope;estraverse.traverse(tree,{enter:function(node){if(escope.Scope.isVariableScopeRequired(node)){labelScope=new LabelScope(labelScope);return}switch(node.type){case Syntax.LabeledStatement:labelScope.register(node);break;case Syntax.BreakStatement:case Syntax.ContinueStatement:labelScope.resolve(node);break}},leave:function(node){labelScope.unregister(node);if(escope.Scope.isVariableScopeRequired(node)){labelScope=labelScope.close()}}});return tree}function mangle(tree,options){var result,manager,i,iz;if(options==null){options={destructive:true}}result=options.destructive==null||options.destructive?tree:utility.deepCopy(tree);manager=escope.analyze(result,{directive:true});for(i=0,iz=manager.scopes.length;i<iz;++i){run(manager.scopes[i],options)}return mangleLabels(result)}exports.mangle=mangle;exports.version=version;exports.generateNextName=utility.generateNextName})()},{"../package.json":117,"./map":113,"./utility":114,escope:66,estraverse:115,esutils:123}],113:[function(require,module,exports){arguments[4][73][0].apply(exports,arguments)},{dup:73}],114:[function(require,module,exports){(function(){"use strict";var isArray,NameSequence,ZeroSequenceCache;isArray=Array.isArray;if(!isArray){isArray=function isArray(array){return Object.prototype.toString.call(array)==="[object Array]"}}function deepCopy(obj){function deepCopyInternal(obj,result){var key,val;for(key in obj){if(key.lastIndexOf("__",0)===0){continue}if(obj.hasOwnProperty(key)){val=obj[key];if(typeof val==="object"&&val!==null){if(val instanceof RegExp){val=new RegExp(val)}else{val=deepCopyInternal(val,isArray(val)?[]:{})}}result[key]=val}}return result}return deepCopyInternal(obj,isArray(obj)?[]:{})}function stringRepeat(str,num){var result="";for(num|=0;num>0;num>>>=1,str+=str){if(num&1){result+=str}}return result}ZeroSequenceCache=[];function zeroSequence(num){var res=ZeroSequenceCache[num];if(res!==undefined){return res}res=stringRepeat("0",num);ZeroSequenceCache[num]=res;return res}NameSequence="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_$".split("");function generateNextName(name){var ch,index,cur;cur=name.length-1;do{ch=name.charAt(cur);index=NameSequence.indexOf(ch);if(index!==NameSequence.length-1){return name.substring(0,cur)+NameSequence[index+1]+zeroSequence(name.length-(cur+1))}--cur}while(cur>=0);return"a"+zeroSequence(name.length)}exports.generateNextName=generateNextName;exports.deepCopy=deepCopy})()},{}],115:[function(require,module,exports){(function clone(exports){"use strict";var Syntax,isArray,VisitorOption,VisitorKeys,objectCreate,objectKeys,BREAK,SKIP,REMOVE;function ignoreJSHintError(){}isArray=Array.isArray;if(!isArray){isArray=function isArray(array){return Object.prototype.toString.call(array)==="[object Array]"}}function deepCopy(obj){var ret={},key,val;for(key in obj){if(obj.hasOwnProperty(key)){val=obj[key];if(typeof val==="object"&&val!==null){ret[key]=deepCopy(val)}else{ret[key]=val}}}return ret}function shallowCopy(obj){var ret={},key;for(key in obj){if(obj.hasOwnProperty(key)){ret[key]=obj[key]}}return ret}ignoreJSHintError(shallowCopy);function upperBound(array,func){var diff,len,i,current;len=array.length;i=0;while(len){diff=len>>>1;current=i+diff;if(func(array[current])){len=diff}else{i=current+1;len-=diff+1}}return i}function lowerBound(array,func){var diff,len,i,current;len=array.length;i=0;while(len){diff=len>>>1;current=i+diff;if(func(array[current])){i=current+1;len-=diff+1}else{len=diff}}return i}ignoreJSHintError(lowerBound);objectCreate=Object.create||function(){function F(){}return function(o){F.prototype=o;return new F}}();objectKeys=Object.keys||function(o){var keys=[],key;for(key in o){keys.push(key)}return keys};function extend(to,from){var keys=objectKeys(from),key,i,len;for(i=0,len=keys.length;i<len;i+=1){key=keys[i];to[key]=from[key]}return to}Syntax={AssignmentExpression:"AssignmentExpression",AssignmentPattern:"AssignmentPattern",ArrayExpression:"ArrayExpression",ArrayPattern:"ArrayPattern",ArrowFunctionExpression:"ArrowFunctionExpression",AwaitExpression:"AwaitExpression",BlockStatement:"BlockStatement",BinaryExpression:"BinaryExpression",BreakStatement:"BreakStatement",CallExpression:"CallExpression",CatchClause:"CatchClause",ClassBody:"ClassBody",ClassDeclaration:"ClassDeclaration",ClassExpression:"ClassExpression",ComprehensionBlock:"ComprehensionBlock",ComprehensionExpression:"ComprehensionExpression",ConditionalExpression:"ConditionalExpression",ContinueStatement:"ContinueStatement",DebuggerStatement:"DebuggerStatement",DirectiveStatement:"DirectiveStatement",DoWhileStatement:"DoWhileStatement",EmptyStatement:"EmptyStatement",ExportAllDeclaration:"ExportAllDeclaration",ExportDefaultDeclaration:"ExportDefaultDeclaration",ExportNamedDeclaration:"ExportNamedDeclaration",ExportSpecifier:"ExportSpecifier",ExpressionStatement:"ExpressionStatement",ForStatement:"ForStatement",ForInStatement:"ForInStatement",ForOfStatement:"ForOfStatement",FunctionDeclaration:"FunctionDeclaration",FunctionExpression:"FunctionExpression",GeneratorExpression:"GeneratorExpression",Identifier:"Identifier",IfStatement:"IfStatement",ImportDeclaration:"ImportDeclaration",ImportDefaultSpecifier:"ImportDefaultSpecifier",ImportNamespaceSpecifier:"ImportNamespaceSpecifier",ImportSpecifier:"ImportSpecifier",Literal:"Literal",LabeledStatement:"LabeledStatement",LogicalExpression:"LogicalExpression",MemberExpression:"MemberExpression",MetaProperty:"MetaProperty",MethodDefinition:"MethodDefinition",ModuleSpecifier:"ModuleSpecifier",NewExpression:"NewExpression",ObjectExpression:"ObjectExpression",ObjectPattern:"ObjectPattern",Program:"Program",Property:"Property",RestElement:"RestElement",ReturnStatement:"ReturnStatement",SequenceExpression:"SequenceExpression",SpreadElement:"SpreadElement",Super:"Super",SwitchStatement:"SwitchStatement",SwitchCase:"SwitchCase",TaggedTemplateExpression:"TaggedTemplateExpression",TemplateElement:"TemplateElement",TemplateLiteral:"TemplateLiteral",ThisExpression:"ThisExpression",ThrowStatement:"ThrowStatement",TryStatement:"TryStatement",UnaryExpression:"UnaryExpression",UpdateExpression:"UpdateExpression",VariableDeclaration:"VariableDeclaration",VariableDeclarator:"VariableDeclarator",WhileStatement:"WhileStatement",WithStatement:"WithStatement",YieldExpression:"YieldExpression"};VisitorKeys={AssignmentExpression:["left","right"],AssignmentPattern:["left","right"],ArrayExpression:["elements"],ArrayPattern:["elements"],ArrowFunctionExpression:["params","body"],AwaitExpression:["argument"],BlockStatement:["body"],BinaryExpression:["left","right"],BreakStatement:["label"],CallExpression:["callee","arguments"],CatchClause:["param","body"],ClassBody:["body"],ClassDeclaration:["id","superClass","body"],ClassExpression:["id","superClass","body"],ComprehensionBlock:["left","right"],ComprehensionExpression:["blocks","filter","body"],ConditionalExpression:["test","consequent","alternate"],ContinueStatement:["label"],DebuggerStatement:[],DirectiveStatement:[],DoWhileStatement:["body","test"],EmptyStatement:[],ExportAllDeclaration:["source"],ExportDefaultDeclaration:["declaration"],ExportNamedDeclaration:["declaration","specifiers","source"],ExportSpecifier:["exported","local"],ExpressionStatement:["expression"],ForStatement:["init","test","update","body"],ForInStatement:["left","right","body"],ForOfStatement:["left","right","body"],FunctionDeclaration:["id","params","body"],FunctionExpression:["id","params","body"],GeneratorExpression:["blocks","filter","body"],Identifier:[],IfStatement:["test","consequent","alternate"],ImportDeclaration:["specifiers","source"],ImportDefaultSpecifier:["local"],ImportNamespaceSpecifier:["local"],ImportSpecifier:["imported","local"],Literal:[],LabeledStatement:["label","body"],LogicalExpression:["left","right"],MemberExpression:["object","property"],MetaProperty:["meta","property"],MethodDefinition:["key","value"],ModuleSpecifier:[],NewExpression:["callee","arguments"],ObjectExpression:["properties"],ObjectPattern:["properties"],Program:["body"],Property:["key","value"],RestElement:["argument"],ReturnStatement:["argument"],SequenceExpression:["expressions"],SpreadElement:["argument"],Super:[],SwitchStatement:["discriminant","cases"],SwitchCase:["test","consequent"],TaggedTemplateExpression:["tag","quasi"],TemplateElement:[],TemplateLiteral:["quasis","expressions"],ThisExpression:[],ThrowStatement:["argument"],TryStatement:["block","handler","finalizer"],UnaryExpression:["argument"],UpdateExpression:["argument"],VariableDeclaration:["declarations"],VariableDeclarator:["id","init"],WhileStatement:["test","body"],WithStatement:["object","body"],YieldExpression:["argument"]};BREAK={};SKIP={};REMOVE={};VisitorOption={Break:BREAK,Skip:SKIP,Remove:REMOVE};function Reference(parent,key){this.parent=parent;this.key=key}Reference.prototype.replace=function replace(node){this.parent[this.key]=node};Reference.prototype.remove=function remove(){if(isArray(this.parent)){this.parent.splice(this.key,1);return true}else{this.replace(null);return false}};function Element(node,path,wrap,ref){this.node=node;this.path=path;this.wrap=wrap;this.ref=ref}function Controller(){}Controller.prototype.path=function path(){var i,iz,j,jz,result,element;function addToPath(result,path){if(isArray(path)){for(j=0,jz=path.length;j<jz;++j){result.push(path[j])}}else{result.push(path)}}if(!this.__current.path){return null}result=[];for(i=2,iz=this.__leavelist.length;i<iz;++i){element=this.__leavelist[i];addToPath(result,element.path)}addToPath(result,this.__current.path);return result};Controller.prototype.type=function(){var node=this.current();return node.type||this.__current.wrap};Controller.prototype.parents=function parents(){var i,iz,result;result=[];for(i=1,iz=this.__leavelist.length;i<iz;++i){result.push(this.__leavelist[i].node)}return result};Controller.prototype.current=function current(){return this.__current.node};Controller.prototype.__execute=function __execute(callback,element){var previous,result;result=undefined;previous=this.__current;this.__current=element;this.__state=null;if(callback){result=callback.call(this,element.node,this.__leavelist[this.__leavelist.length-1].node)}this.__current=previous;return result};Controller.prototype.notify=function notify(flag){this.__state=flag};Controller.prototype.skip=function(){this.notify(SKIP)};Controller.prototype["break"]=function(){this.notify(BREAK)};Controller.prototype.remove=function(){this.notify(REMOVE)};Controller.prototype.__initialize=function(root,visitor){this.visitor=visitor;this.root=root;this.__worklist=[];this.__leavelist=[];this.__current=null;this.__state=null;this.__fallback=visitor.fallback==="iteration";this.__keys=VisitorKeys;if(visitor.keys){this.__keys=extend(objectCreate(this.__keys),visitor.keys)}};function isNode(node){if(node==null){return false}return typeof node==="object"&&typeof node.type==="string"}function isProperty(nodeType,key){return(nodeType===Syntax.ObjectExpression||nodeType===Syntax.ObjectPattern)&&"properties"===key}Controller.prototype.traverse=function traverse(root,visitor){var worklist,leavelist,element,node,nodeType,ret,key,current,current2,candidates,candidate,sentinel;this.__initialize(root,visitor);sentinel={};worklist=this.__worklist;leavelist=this.__leavelist;worklist.push(new Element(root,null,null,null));leavelist.push(new Element(null,null,null,null));while(worklist.length){element=worklist.pop();if(element===sentinel){element=leavelist.pop();ret=this.__execute(visitor.leave,element);if(this.__state===BREAK||ret===BREAK){return}continue}if(element.node){ret=this.__execute(visitor.enter,element);if(this.__state===BREAK||ret===BREAK){return}worklist.push(sentinel);leavelist.push(element);if(this.__state===SKIP||ret===SKIP){continue}node=element.node;nodeType=node.type||element.wrap;candidates=this.__keys[nodeType];if(!candidates){if(this.__fallback){candidates=objectKeys(node)}else{throw new Error("Unknown node type "+nodeType+".")}}current=candidates.length;while((current-=1)>=0){key=candidates[current];candidate=node[key];if(!candidate){continue}if(isArray(candidate)){current2=candidate.length;while((current2-=1)>=0){if(!candidate[current2]){continue}if(isProperty(nodeType,candidates[current])){element=new Element(candidate[current2],[key,current2],"Property",null)}else if(isNode(candidate[current2])){element=new Element(candidate[current2],[key,current2],null,null)}else{continue}worklist.push(element)}}else if(isNode(candidate)){worklist.push(new Element(candidate,key,null,null))}}}}};Controller.prototype.replace=function replace(root,visitor){function removeElem(element){var i,key,nextElem,parent;if(element.ref.remove()){key=element.ref.key;parent=element.ref.parent;i=worklist.length;while(i--){nextElem=worklist[i];if(nextElem.ref&&nextElem.ref.parent===parent){if(nextElem.ref.key<key){break}--nextElem.ref.key}}}}var worklist,leavelist,node,nodeType,target,element,current,current2,candidates,candidate,sentinel,outer,key;this.__initialize(root,visitor);sentinel={};worklist=this.__worklist;leavelist=this.__leavelist;outer={root:root};element=new Element(root,null,null,new Reference(outer,"root"));worklist.push(element);leavelist.push(element);while(worklist.length){element=worklist.pop();if(element===sentinel){element=leavelist.pop();target=this.__execute(visitor.leave,element);if(target!==undefined&&target!==BREAK&&target!==SKIP&&target!==REMOVE){element.ref.replace(target)}if(this.__state===REMOVE||target===REMOVE){removeElem(element)}if(this.__state===BREAK||target===BREAK){return outer.root}continue}target=this.__execute(visitor.enter,element);if(target!==undefined&&target!==BREAK&&target!==SKIP&&target!==REMOVE){element.ref.replace(target);element.node=target}if(this.__state===REMOVE||target===REMOVE){removeElem(element);element.node=null}if(this.__state===BREAK||target===BREAK){return outer.root}node=element.node;if(!node){continue}worklist.push(sentinel);leavelist.push(element);if(this.__state===SKIP||target===SKIP){continue}nodeType=node.type||element.wrap;candidates=this.__keys[nodeType];if(!candidates){if(this.__fallback){candidates=objectKeys(node)}else{throw new Error("Unknown node type "+nodeType+".")}}current=candidates.length;while((current-=1)>=0){key=candidates[current];candidate=node[key];if(!candidate){continue}if(isArray(candidate)){current2=candidate.length;while((current2-=1)>=0){if(!candidate[current2]){continue}if(isProperty(nodeType,candidates[current])){element=new Element(candidate[current2],[key,current2],"Property",new Reference(candidate,current2))}else if(isNode(candidate[current2])){element=new Element(candidate[current2],[key,current2],null,new Reference(candidate,current2))}else{continue}worklist.push(element)}}else if(isNode(candidate)){worklist.push(new Element(candidate,key,null,new Reference(node,key)))}}}return outer.root};function traverse(root,visitor){var controller=new Controller;return controller.traverse(root,visitor)}function replace(root,visitor){var controller=new Controller;return controller.replace(root,visitor)}function extendCommentRange(comment,tokens){var target;target=upperBound(tokens,function search(token){return token.range[0]>comment.range[0]});comment.extendedRange=[comment.range[0],comment.range[1]];if(target!==tokens.length){comment.extendedRange[1]=tokens[target].range[0]}target-=1;if(target>=0){comment.extendedRange[0]=tokens[target].range[1]}return comment}function attachComments(tree,providedComments,tokens){var comments=[],comment,len,i,cursor;if(!tree.range){throw new Error("attachComments needs range information")}if(!tokens.length){if(providedComments.length){for(i=0,len=providedComments.length;i<len;i+=1){comment=deepCopy(providedComments[i]);comment.extendedRange=[0,tree.range[0]];comments.push(comment)}tree.leadingComments=comments}return tree}for(i=0,len=providedComments.length;i<len;i+=1){comments.push(extendCommentRange(deepCopy(providedComments[i]),tokens))}cursor=0;traverse(tree,{enter:function(node){var comment;while(cursor<comments.length){comment=comments[cursor];if(comment.extendedRange[1]>node.range[0]){break}if(comment.extendedRange[1]===node.range[0]){if(!node.leadingComments){node.leadingComments=[]}node.leadingComments.push(comment);comments.splice(cursor,1)}else{cursor+=1}}if(cursor===comments.length){return VisitorOption.Break}if(comments[cursor].extendedRange[0]>node.range[1]){return VisitorOption.Skip}}});cursor=0;traverse(tree,{leave:function(node){var comment;while(cursor<comments.length){comment=comments[cursor];if(node.range[1]<comment.extendedRange[0]){break}if(node.range[1]===comment.extendedRange[0]){if(!node.trailingComments){node.trailingComments=[]}node.trailingComments.push(comment);comments.splice(cursor,1)}else{cursor+=1}}if(cursor===comments.length){return VisitorOption.Break}if(comments[cursor].extendedRange[0]>node.range[1]){return VisitorOption.Skip}}});return tree}exports.version=require("./package.json").version;exports.Syntax=Syntax;exports.traverse=traverse;exports.replace=replace;exports.attachComments=attachComments;exports.VisitorKeys=VisitorKeys;exports.VisitorOption=VisitorOption;exports.Controller=Controller;exports.cloneEnvironment=function(){return clone({})};return exports})(exports)},{"./package.json":116}],116:[function(require,module,exports){module.exports={_from:"estraverse@~4.1.1",_id:"estraverse@4.1.1",_inBundle:false,_integrity:"sha1-9srKcokzqFDvkGYdDheYK6RxEaI=",_location:"/esshorten/estraverse",_phantomChildren:{},_requested:{type:"range",registry:true,raw:"estraverse@~4.1.1",name:"estraverse",escapedName:"estraverse",rawSpec:"~4.1.1",saveSpec:null,fetchSpec:"~4.1.1"},_requiredBy:["/esshorten"],_resolved:"https://registry.npmjs.org/estraverse/-/estraverse-4.1.1.tgz",_shasum:"f6caca728933a850ef90661d0e17982ba47111a2",_spec:"estraverse@~4.1.1",_where:"/Users/jkhartshorne/Documents/Teaching/probmods2/node_modules/webppl/node_modules/esshorten",bugs:{url:"https://github.com/estools/estraverse/issues"},bundleDependencies:false,deprecated:false,description:"ECMAScript JS AST traversal functions",devDependencies:{chai:"^2.1.1","coffee-script":"^1.8.0",espree:"^1.11.0",gulp:"^3.8.10","gulp-bump":"^0.2.2","gulp-filter":"^2.0.0","gulp-git":"^1.0.1","gulp-tag-version":"^1.2.1",jshint:"^2.5.6",mocha:"^2.1.0"},engines:{node:">=0.10.0"},homepage:"https://github.com/estools/estraverse",license:"BSD-2-Clause",main:"estraverse.js",maintainers:[{name:"Yusuke Suzuki",email:"utatane.tea@gmail.com",url:"http://github.com/Constellation"}],name:"estraverse",repository:{type:"git",url:"git+ssh://git@github.com/estools/estraverse.git"},scripts:{lint:"jshint estraverse.js",test:"npm run-script lint && npm run-script unit-test","unit-test":"mocha --compilers coffee:coffee-script/register"},version:"4.1.1"}},{}],117:[function(require,module,exports){module.exports={_from:"esshorten@~1.1.0",_id:"esshorten@1.1.1",_inBundle:false,_integrity:"sha1-F0+Wt8wmfkaHLYFOfbfCkL3/Yak=",_location:"/esshorten",_phantomChildren:{},_requested:{type:"range",registry:true,raw:"esshorten@~1.1.0",name:"esshorten",escapedName:"esshorten",rawSpec:"~1.1.0",saveSpec:null,fetchSpec:"~1.1.0"},_requiredBy:["/esmangle"],_resolved:"https://registry.npmjs.org/esshorten/-/esshorten-1.1.1.tgz",_shasum:"174f96b7cc267e46872d814e7db7c290bdff61a9",_spec:"esshorten@~1.1.0",_where:"/Users/jkhartshorne/Documents/Teaching/probmods2/node_modules/webppl/node_modules/esmangle",bugs:{url:"https://github.com/estools/esshorten/issues"},bundleDependencies:false,dependencies:{escope:"~1.0.1",estraverse:"~4.1.1",esutils:"~2.0.2"},deprecated:false,description:"Shorten (mangle) names in JavaScript code",devDependencies:{chai:"*","coffee-script":"~1.10.0","commonjs-everywhere":"~0.9.7",gulp:"~3.9.0","gulp-jshint":"~1.11.2","gulp-mocha":"~2.1.3","jshint-stylish":"~2.0.1"},directories:{lib:"./lib"},engines:{node:">=0.6.0"},homepage:"https://github.com/estools/esshorten#readme",licenses:[{type:"BSD",url:"http://github.com/estools/esshorten/raw/master/LICENSE.BSD"}],main:"lib/esshorten.js",maintainers:[{name:"Yusuke Suzuki",email:"utatane.tea@gmail.com",url:"http://github.com/Constellation"}],name:"esshorten",repository:{type:"git",url:"git+ssh://git@github.com/estools/esshorten.git"},scripts:{lint:"gulp lint",test:"gulp travis","unit-test":"gulp test"},version:"1.1.1"}},{}],118:[function(require,module,exports){(function clone(exports){"use strict";var Syntax,isArray,VisitorOption,VisitorKeys,objectCreate,objectKeys,BREAK,SKIP,REMOVE;function ignoreJSHintError(){}isArray=Array.isArray;if(!isArray){isArray=function isArray(array){return Object.prototype.toString.call(array)==="[object Array]"}}function deepCopy(obj){var ret={},key,val;for(key in obj){if(obj.hasOwnProperty(key)){val=obj[key];if(typeof val==="object"&&val!==null){ret[key]=deepCopy(val)}else{ret[key]=val}}}return ret}function shallowCopy(obj){var ret={},key;for(key in obj){if(obj.hasOwnProperty(key)){ret[key]=obj[key]}}return ret}ignoreJSHintError(shallowCopy);function upperBound(array,func){var diff,len,i,current;len=array.length;i=0;while(len){diff=len>>>1;current=i+diff;if(func(array[current])){len=diff}else{i=current+1;len-=diff+1}}return i}function lowerBound(array,func){var diff,len,i,current;len=array.length;i=0;while(len){diff=len>>>1;current=i+diff;if(func(array[current])){i=current+1;len-=diff+1}else{len=diff}}return i}ignoreJSHintError(lowerBound);objectCreate=Object.create||function(){function F(){}return function(o){F.prototype=o;return new F}}();objectKeys=Object.keys||function(o){var keys=[],key;for(key in o){keys.push(key)}return keys};function extend(to,from){var keys=objectKeys(from),key,i,len;for(i=0,len=keys.length;i<len;i+=1){key=keys[i];to[key]=from[key]}return to}Syntax={AssignmentExpression:"AssignmentExpression",AssignmentPattern:"AssignmentPattern",ArrayExpression:"ArrayExpression",ArrayPattern:"ArrayPattern",ArrowFunctionExpression:"ArrowFunctionExpression",AwaitExpression:"AwaitExpression",BlockStatement:"BlockStatement",BinaryExpression:"BinaryExpression",BreakStatement:"BreakStatement",CallExpression:"CallExpression",CatchClause:"CatchClause",ClassBody:"ClassBody",ClassDeclaration:"ClassDeclaration",ClassExpression:"ClassExpression",ComprehensionBlock:"ComprehensionBlock",ComprehensionExpression:"ComprehensionExpression",ConditionalExpression:"ConditionalExpression",ContinueStatement:"ContinueStatement",DebuggerStatement:"DebuggerStatement",DirectiveStatement:"DirectiveStatement",DoWhileStatement:"DoWhileStatement",EmptyStatement:"EmptyStatement",ExportAllDeclaration:"ExportAllDeclaration",ExportDefaultDeclaration:"ExportDefaultDeclaration",ExportNamedDeclaration:"ExportNamedDeclaration",ExportSpecifier:"ExportSpecifier",ExpressionStatement:"ExpressionStatement",ForStatement:"ForStatement",ForInStatement:"ForInStatement",ForOfStatement:"ForOfStatement",FunctionDeclaration:"FunctionDeclaration",FunctionExpression:"FunctionExpression",GeneratorExpression:"GeneratorExpression",Identifier:"Identifier",IfStatement:"IfStatement",ImportDeclaration:"ImportDeclaration",ImportDefaultSpecifier:"ImportDefaultSpecifier",ImportNamespaceSpecifier:"ImportNamespaceSpecifier",ImportSpecifier:"ImportSpecifier",Literal:"Literal",LabeledStatement:"LabeledStatement",LogicalExpression:"LogicalExpression",MemberExpression:"MemberExpression",MetaProperty:"MetaProperty",MethodDefinition:"MethodDefinition",ModuleSpecifier:"ModuleSpecifier",NewExpression:"NewExpression",ObjectExpression:"ObjectExpression",ObjectPattern:"ObjectPattern",Program:"Program",Property:"Property",RestElement:"RestElement",ReturnStatement:"ReturnStatement",SequenceExpression:"SequenceExpression",SpreadElement:"SpreadElement",Super:"Super",SwitchStatement:"SwitchStatement",SwitchCase:"SwitchCase",TaggedTemplateExpression:"TaggedTemplateExpression",TemplateElement:"TemplateElement",TemplateLiteral:"TemplateLiteral",ThisExpression:"ThisExpression",ThrowStatement:"ThrowStatement",TryStatement:"TryStatement",UnaryExpression:"UnaryExpression",UpdateExpression:"UpdateExpression",VariableDeclaration:"VariableDeclaration",VariableDeclarator:"VariableDeclarator",WhileStatement:"WhileStatement",WithStatement:"WithStatement",YieldExpression:"YieldExpression"};VisitorKeys={AssignmentExpression:["left","right"],AssignmentPattern:["left","right"],ArrayExpression:["elements"],ArrayPattern:["elements"],ArrowFunctionExpression:["params","body"],AwaitExpression:["argument"],BlockStatement:["body"],BinaryExpression:["left","right"],BreakStatement:["label"],CallExpression:["callee","arguments"],CatchClause:["param","body"],ClassBody:["body"],ClassDeclaration:["id","superClass","body"],ClassExpression:["id","superClass","body"],ComprehensionBlock:["left","right"],ComprehensionExpression:["blocks","filter","body"],ConditionalExpression:["test","consequent","alternate"],ContinueStatement:["label"],DebuggerStatement:[],DirectiveStatement:[],DoWhileStatement:["body","test"],EmptyStatement:[],ExportAllDeclaration:["source"],ExportDefaultDeclaration:["declaration"],ExportNamedDeclaration:["declaration","specifiers","source"],ExportSpecifier:["exported","local"],ExpressionStatement:["expression"],ForStatement:["init","test","update","body"],ForInStatement:["left","right","body"],ForOfStatement:["left","right","body"],FunctionDeclaration:["id","params","body"],FunctionExpression:["id","params","body"],GeneratorExpression:["blocks","filter","body"],Identifier:[],IfStatement:["test","consequent","alternate"],ImportDeclaration:["specifiers","source"],ImportDefaultSpecifier:["local"],ImportNamespaceSpecifier:["local"],ImportSpecifier:["imported","local"],Literal:[],LabeledStatement:["label","body"],LogicalExpression:["left","right"],MemberExpression:["object","property"],MetaProperty:["meta","property"],MethodDefinition:["key","value"],ModuleSpecifier:[],NewExpression:["callee","arguments"],ObjectExpression:["properties"],ObjectPattern:["properties"],Program:["body"],Property:["key","value"],RestElement:["argument"],ReturnStatement:["argument"],SequenceExpression:["expressions"],SpreadElement:["argument"],Super:[],SwitchStatement:["discriminant","cases"],SwitchCase:["test","consequent"],TaggedTemplateExpression:["tag","quasi"],TemplateElement:[],TemplateLiteral:["quasis","expressions"],ThisExpression:[],ThrowStatement:["argument"],TryStatement:["block","handler","finalizer"],UnaryExpression:["argument"],UpdateExpression:["argument"],VariableDeclaration:["declarations"],VariableDeclarator:["id","init"],WhileStatement:["test","body"],WithStatement:["object","body"],YieldExpression:["argument"]};BREAK={};SKIP={};REMOVE={};VisitorOption={Break:BREAK,Skip:SKIP,Remove:REMOVE};function Reference(parent,key){this.parent=parent;this.key=key}Reference.prototype.replace=function replace(node){this.parent[this.key]=node};Reference.prototype.remove=function remove(){if(isArray(this.parent)){this.parent.splice(this.key,1);return true}else{this.replace(null);return false}};function Element(node,path,wrap,ref){this.node=node;this.path=path;this.wrap=wrap;this.ref=ref}function Controller(){}Controller.prototype.path=function path(){var i,iz,j,jz,result,element;function addToPath(result,path){if(isArray(path)){for(j=0,jz=path.length;j<jz;++j){result.push(path[j])}}else{result.push(path)}}if(!this.__current.path){return null}result=[];for(i=2,iz=this.__leavelist.length;i<iz;++i){element=this.__leavelist[i];addToPath(result,element.path)}addToPath(result,this.__current.path);return result};Controller.prototype.type=function(){var node=this.current();return node.type||this.__current.wrap};Controller.prototype.parents=function parents(){var i,iz,result;result=[];for(i=1,iz=this.__leavelist.length;i<iz;++i){result.push(this.__leavelist[i].node)}return result};Controller.prototype.current=function current(){return this.__current.node};Controller.prototype.__execute=function __execute(callback,element){var previous,result;result=undefined;previous=this.__current;this.__current=element;this.__state=null;if(callback){result=callback.call(this,element.node,this.__leavelist[this.__leavelist.length-1].node)}this.__current=previous;return result};Controller.prototype.notify=function notify(flag){this.__state=flag};Controller.prototype.skip=function(){this.notify(SKIP)};Controller.prototype["break"]=function(){this.notify(BREAK)};Controller.prototype.remove=function(){this.notify(REMOVE)};Controller.prototype.__initialize=function(root,visitor){this.visitor=visitor;this.root=root;this.__worklist=[];this.__leavelist=[];this.__current=null;this.__state=null;this.__fallback=null;if(visitor.fallback==="iteration"){this.__fallback=objectKeys}else if(typeof visitor.fallback==="function"){this.__fallback=visitor.fallback}this.__keys=VisitorKeys;if(visitor.keys){this.__keys=extend(objectCreate(this.__keys),visitor.keys)}};function isNode(node){if(node==null){return false}return typeof node==="object"&&typeof node.type==="string"}function isProperty(nodeType,key){return(nodeType===Syntax.ObjectExpression||nodeType===Syntax.ObjectPattern)&&"properties"===key}Controller.prototype.traverse=function traverse(root,visitor){var worklist,leavelist,element,node,nodeType,ret,key,current,current2,candidates,candidate,sentinel;this.__initialize(root,visitor);sentinel={};worklist=this.__worklist;leavelist=this.__leavelist;worklist.push(new Element(root,null,null,null));leavelist.push(new Element(null,null,null,null));while(worklist.length){element=worklist.pop();if(element===sentinel){element=leavelist.pop();ret=this.__execute(visitor.leave,element);if(this.__state===BREAK||ret===BREAK){return}continue}if(element.node){ret=this.__execute(visitor.enter,element);if(this.__state===BREAK||ret===BREAK){return}worklist.push(sentinel);leavelist.push(element);if(this.__state===SKIP||ret===SKIP){continue}node=element.node;nodeType=node.type||element.wrap;candidates=this.__keys[nodeType];if(!candidates){if(this.__fallback){candidates=this.__fallback(node)}else{throw new Error("Unknown node type "+nodeType+".")}}current=candidates.length;while((current-=1)>=0){key=candidates[current];candidate=node[key];if(!candidate){continue}if(isArray(candidate)){current2=candidate.length;while((current2-=1)>=0){if(!candidate[current2]){continue}if(isProperty(nodeType,candidates[current])){element=new Element(candidate[current2],[key,current2],"Property",null)}else if(isNode(candidate[current2])){element=new Element(candidate[current2],[key,current2],null,null)}else{continue}worklist.push(element)}}else if(isNode(candidate)){worklist.push(new Element(candidate,key,null,null))}}}}};Controller.prototype.replace=function replace(root,visitor){var worklist,leavelist,node,nodeType,target,element,current,current2,candidates,candidate,sentinel,outer,key;function removeElem(element){var i,key,nextElem,parent;if(element.ref.remove()){key=element.ref.key;parent=element.ref.parent;i=worklist.length;while(i--){nextElem=worklist[i];if(nextElem.ref&&nextElem.ref.parent===parent){if(nextElem.ref.key<key){break}--nextElem.ref.key}}}}this.__initialize(root,visitor);sentinel={};worklist=this.__worklist;leavelist=this.__leavelist;outer={root:root};element=new Element(root,null,null,new Reference(outer,"root"));worklist.push(element);leavelist.push(element);while(worklist.length){element=worklist.pop();if(element===sentinel){element=leavelist.pop();target=this.__execute(visitor.leave,element);if(target!==undefined&&target!==BREAK&&target!==SKIP&&target!==REMOVE){element.ref.replace(target)}if(this.__state===REMOVE||target===REMOVE){removeElem(element)}if(this.__state===BREAK||target===BREAK){return outer.root}continue}target=this.__execute(visitor.enter,element);if(target!==undefined&&target!==BREAK&&target!==SKIP&&target!==REMOVE){element.ref.replace(target);element.node=target}if(this.__state===REMOVE||target===REMOVE){removeElem(element);element.node=null}if(this.__state===BREAK||target===BREAK){return outer.root}node=element.node;if(!node){continue}worklist.push(sentinel);leavelist.push(element);if(this.__state===SKIP||target===SKIP){continue}nodeType=node.type||element.wrap;candidates=this.__keys[nodeType];if(!candidates){if(this.__fallback){candidates=this.__fallback(node)}else{throw new Error("Unknown node type "+nodeType+".")}}current=candidates.length;while((current-=1)>=0){key=candidates[current];candidate=node[key];if(!candidate){continue}if(isArray(candidate)){current2=candidate.length;while((current2-=1)>=0){if(!candidate[current2]){continue}if(isProperty(nodeType,candidates[current])){element=new Element(candidate[current2],[key,current2],"Property",new Reference(candidate,current2))}else if(isNode(candidate[current2])){element=new Element(candidate[current2],[key,current2],null,new Reference(candidate,current2))}else{continue}worklist.push(element)}}else if(isNode(candidate)){worklist.push(new Element(candidate,key,null,new Reference(node,key)))}}}return outer.root};function traverse(root,visitor){var controller=new Controller;return controller.traverse(root,visitor)}function replace(root,visitor){var controller=new Controller;return controller.replace(root,visitor)}function extendCommentRange(comment,tokens){var target;target=upperBound(tokens,function search(token){return token.range[0]>comment.range[0]});comment.extendedRange=[comment.range[0],comment.range[1]];if(target!==tokens.length){comment.extendedRange[1]=tokens[target].range[0]}target-=1;if(target>=0){comment.extendedRange[0]=tokens[target].range[1]}return comment}function attachComments(tree,providedComments,tokens){var comments=[],comment,len,i,cursor;if(!tree.range){throw new Error("attachComments needs range information")}if(!tokens.length){if(providedComments.length){for(i=0,len=providedComments.length;i<len;i+=1){comment=deepCopy(providedComments[i]);comment.extendedRange=[0,tree.range[0]];comments.push(comment)}tree.leadingComments=comments}return tree}for(i=0,len=providedComments.length;i<len;i+=1){comments.push(extendCommentRange(deepCopy(providedComments[i]),tokens))}cursor=0;traverse(tree,{enter:function(node){var comment;while(cursor<comments.length){comment=comments[cursor];if(comment.extendedRange[1]>node.range[0]){break}if(comment.extendedRange[1]===node.range[0]){if(!node.leadingComments){node.leadingComments=[]}node.leadingComments.push(comment);comments.splice(cursor,1)}else{cursor+=1}}if(cursor===comments.length){return VisitorOption.Break}if(comments[cursor].extendedRange[0]>node.range[1]){return VisitorOption.Skip}}});cursor=0;traverse(tree,{leave:function(node){var comment;while(cursor<comments.length){comment=comments[cursor];if(node.range[1]<comment.extendedRange[0]){break}if(node.range[1]===comment.extendedRange[0]){if(!node.trailingComments){node.trailingComments=[]}node.trailingComments.push(comment);comments.splice(cursor,1)}else{cursor+=1}}if(cursor===comments.length){return VisitorOption.Break}if(comments[cursor].extendedRange[0]>node.range[1]){return VisitorOption.Skip}}});return tree}exports.version=require("./package.json").version;exports.Syntax=Syntax;exports.traverse=traverse;exports.replace=replace;exports.attachComments=attachComments;exports.VisitorKeys=VisitorKeys;exports.VisitorOption=VisitorOption;exports.Controller=Controller;exports.cloneEnvironment=function(){return clone({})};return exports})(exports)},{"./package.json":119}],119:[function(require,module,exports){module.exports={_from:"estraverse@^4.1.0",_id:"estraverse@4.2.0",_inBundle:false,_integrity:"sha1-De4/7TH81GlhjOc0IJn8GvoL2xM=",_location:"/estraverse",_phantomChildren:{},_requested:{type:"range",registry:true,raw:"estraverse@^4.1.0",name:"estraverse",escapedName:"estraverse",rawSpec:"^4.1.0",saveSpec:null,fetchSpec:"^4.1.0"},_requiredBy:["/","/escodegen","/eslint","/eslint/escope","/esquery","/esrecurse","/estemplate"],_resolved:"https://registry.npmjs.org/estraverse/-/estraverse-4.2.0.tgz",_shasum:"0dee3fed31fcd469618ce7342099fc1afa0bdb13",_spec:"estraverse@^4.1.0",_where:"/Users/jkhartshorne/Documents/Teaching/probmods2/node_modules/webppl",bugs:{url:"https://github.com/estools/estraverse/issues"},bundleDependencies:false,deprecated:false,description:"ECMAScript JS AST traversal functions",devDependencies:{"babel-preset-es2015":"^6.3.13","babel-register":"^6.3.13",chai:"^2.1.1",espree:"^1.11.0",gulp:"^3.8.10","gulp-bump":"^0.2.2","gulp-filter":"^2.0.0","gulp-git":"^1.0.1","gulp-tag-version":"^1.2.1",jshint:"^2.5.6",mocha:"^2.1.0"},engines:{node:">=0.10.0"},homepage:"https://github.com/estools/estraverse",license:"BSD-2-Clause",main:"estraverse.js",maintainers:[{name:"Yusuke Suzuki",email:"utatane.tea@gmail.com",url:"http://github.com/Constellation"}],name:"estraverse",repository:{type:"git",url:"git+ssh://git@github.com/estools/estraverse.git"},scripts:{lint:"jshint estraverse.js",test:"npm run-script lint && npm run-script unit-test","unit-test":"mocha --compilers js:babel-register"},version:"4.2.0"}},{}],120:[function(require,module,exports){(function(){"use strict";function isExpression(node){if(node==null){return false}switch(node.type){case"ArrayExpression":case"AssignmentExpression":case"BinaryExpression":case"CallExpression":case"ConditionalExpression":case"FunctionExpression":case"Identifier":case"Literal":case"LogicalExpression":case"MemberExpression":case"NewExpression":case"ObjectExpression":case"SequenceExpression":case"ThisExpression":case"UnaryExpression":case"UpdateExpression":return true}return false}function isIterationStatement(node){if(node==null){return false}switch(node.type){case"DoWhileStatement":case"ForInStatement":case"ForStatement":case"WhileStatement":return true}return false}function isStatement(node){if(node==null){return false}switch(node.type){case"BlockStatement":case"BreakStatement":case"ContinueStatement":case"DebuggerStatement":case"DoWhileStatement":case"EmptyStatement":case"ExpressionStatement":case"ForInStatement":case"ForStatement":case"IfStatement":case"LabeledStatement":case"ReturnStatement":case"SwitchStatement":case"ThrowStatement":case"TryStatement":case"VariableDeclaration":case"WhileStatement":case"WithStatement":return true}return false}function isSourceElement(node){return isStatement(node)||node!=null&&node.type==="FunctionDeclaration"}function trailingStatement(node){switch(node.type){case"IfStatement":if(node.alternate!=null){return node.alternate}return node.consequent;case"LabeledStatement":case"ForStatement":case"ForInStatement":case"WhileStatement":case"WithStatement":return node.body}return null}function isProblematicIfStatement(node){var current;if(node.type!=="IfStatement"){return false}if(node.alternate==null){return false}current=node.consequent;do{if(current.type==="IfStatement"){if(current.alternate==null){return true}}current=trailingStatement(current)}while(current);return false}module.exports={isExpression:isExpression,isStatement:isStatement,isIterationStatement:isIterationStatement,isSourceElement:isSourceElement,isProblematicIfStatement:isProblematicIfStatement,trailingStatement:trailingStatement}})()},{}],121:[function(require,module,exports){(function(){"use strict";var ES6Regex,ES5Regex,NON_ASCII_WHITESPACES,IDENTIFIER_START,IDENTIFIER_PART,ch;ES5Regex={NonAsciiIdentifierStart:/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0-\u08B2\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58\u0C59\u0C60\u0C61\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D60\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19C1-\u19C7\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FCC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA78E\uA790-\uA7AD\uA7B0\uA7B1\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB5F\uAB64\uAB65\uABC0-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]/,NonAsciiIdentifierPart:/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05F0-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u082D\u0840-\u085B\u08A0-\u08B2\u08E4-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58\u0C59\u0C60-\u0C63\u0C66-\u0C6F\u0C81-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D01-\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D57\u0D60-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D82\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB9\u0EBB-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1877\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19D9\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1CD0-\u1CD2\u1CD4-\u1CF6\u1CF8\u1CF9\u1D00-\u1DF5\u1DFC-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u200C\u200D\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u2E2F\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099\u309A\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FCC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA69D\uA69F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA78E\uA790-\uA7AD\uA7B0\uA7B1\uA7F7-\uA827\uA840-\uA873\uA880-\uA8C4\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA900-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB5F\uAB64\uAB65\uABC0-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2D\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]/};ES6Regex={NonAsciiIdentifierStart:/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0-\u08B2\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58\u0C59\u0C60\u0C61\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D60\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19C1-\u19C7\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FCC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA78E\uA790-\uA7AD\uA7B0\uA7B1\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB5F\uAB64\uAB65\uABC0-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF30-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48]|\uD804[\uDC03-\uDC37\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDE00-\uDE11\uDE13-\uDE2B\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF5D-\uDF61]|\uD805[\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDE00-\uDE2F\uDE44\uDE80-\uDEAA]|\uD806[\uDCA0-\uDCDF\uDCFF\uDEC0-\uDEF8]|\uD808[\uDC00-\uDF98]|\uD809[\uDC00-\uDC6E]|[\uD80C\uD840-\uD868\uD86A-\uD86C][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50\uDF93-\uDF9F]|\uD82C[\uDC00\uDC01]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD83A[\uDC00-\uDCC4]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D]|\uD87E[\uDC00-\uDE1D]/,NonAsciiIdentifierPart:/[\xAA\xB5\xB7\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05F0-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u082D\u0840-\u085B\u08A0-\u08B2\u08E4-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58\u0C59\u0C60-\u0C63\u0C66-\u0C6F\u0C81-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D01-\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D57\u0D60-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D82\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB9\u0EBB-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1369-\u1371\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1877\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19DA\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1CD0-\u1CD2\u1CD4-\u1CF6\u1CF8\u1CF9\u1D00-\u1DF5\u1DFC-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u200C\u200D\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FCC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA69D\uA69F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA78E\uA790-\uA7AD\uA7B0\uA7B1\uA7F7-\uA827\uA840-\uA873\uA880-\uA8C4\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA900-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB5F\uAB64\uAB65\uABC0-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2D\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDDFD\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0\uDF00-\uDF1F\uDF30-\uDF4A\uDF50-\uDF7A\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00-\uDE03\uDE05\uDE06\uDE0C-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE38-\uDE3A\uDE3F\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE6\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48]|\uD804[\uDC00-\uDC46\uDC66-\uDC6F\uDC7F-\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD00-\uDD34\uDD36-\uDD3F\uDD50-\uDD73\uDD76\uDD80-\uDDC4\uDDD0-\uDDDA\uDE00-\uDE11\uDE13-\uDE37\uDEB0-\uDEEA\uDEF0-\uDEF9\uDF01-\uDF03\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3C-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF57\uDF5D-\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC80-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDB5\uDDB8-\uDDC0\uDE00-\uDE40\uDE44\uDE50-\uDE59\uDE80-\uDEB7\uDEC0-\uDEC9]|\uD806[\uDCA0-\uDCE9\uDCFF\uDEC0-\uDEF8]|\uD808[\uDC00-\uDF98]|\uD809[\uDC00-\uDC6E]|[\uD80C\uD840-\uD868\uD86A-\uD86C][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50-\uDF7E\uDF8F-\uDF9F]|\uD82C[\uDC00\uDC01]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99\uDC9D\uDC9E]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD83A[\uDC00-\uDCC4\uDCD0-\uDCD6]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D]|\uD87E[\uDC00-\uDE1D]|\uDB40[\uDD00-\uDDEF]/};function isDecimalDigit(ch){return 48<=ch&&ch<=57}function isHexDigit(ch){return 48<=ch&&ch<=57||97<=ch&&ch<=102||65<=ch&&ch<=70}function isOctalDigit(ch){return ch>=48&&ch<=55}NON_ASCII_WHITESPACES=[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279];function isWhiteSpace(ch){return ch===32||ch===9||ch===11||ch===12||ch===160||ch>=5760&&NON_ASCII_WHITESPACES.indexOf(ch)>=0}function isLineTerminator(ch){return ch===10||ch===13||ch===8232||ch===8233}function fromCodePoint(cp){if(cp<=65535){return String.fromCharCode(cp)}var cu1=String.fromCharCode(Math.floor((cp-65536)/1024)+55296);var cu2=String.fromCharCode((cp-65536)%1024+56320);return cu1+cu2}IDENTIFIER_START=new Array(128);for(ch=0;ch<128;++ch){IDENTIFIER_START[ch]=ch>=97&&ch<=122||ch>=65&&ch<=90||ch===36||ch===95}IDENTIFIER_PART=new Array(128);for(ch=0;ch<128;++ch){IDENTIFIER_PART[ch]=ch>=97&&ch<=122||ch>=65&&ch<=90||ch>=48&&ch<=57||ch===36||ch===95}function isIdentifierStartES5(ch){return ch<128?IDENTIFIER_START[ch]:ES5Regex.NonAsciiIdentifierStart.test(fromCodePoint(ch))}function isIdentifierPartES5(ch){return ch<128?IDENTIFIER_PART[ch]:ES5Regex.NonAsciiIdentifierPart.test(fromCodePoint(ch))}function isIdentifierStartES6(ch){return ch<128?IDENTIFIER_START[ch]:ES6Regex.NonAsciiIdentifierStart.test(fromCodePoint(ch))}function isIdentifierPartES6(ch){return ch<128?IDENTIFIER_PART[ch]:ES6Regex.NonAsciiIdentifierPart.test(fromCodePoint(ch))}module.exports={isDecimalDigit:isDecimalDigit,isHexDigit:isHexDigit,isOctalDigit:isOctalDigit,isWhiteSpace:isWhiteSpace,isLineTerminator:isLineTerminator,isIdentifierStartES5:isIdentifierStartES5,isIdentifierPartES5:isIdentifierPartES5,isIdentifierStartES6:isIdentifierStartES6,isIdentifierPartES6:isIdentifierPartES6}})()},{}],122:[function(require,module,exports){(function(){"use strict";var code=require("./code");function isStrictModeReservedWordES6(id){switch(id){case"implements":case"interface":case"package":case"private":case"protected":case"public":case"static":case"let":return true;default:return false}}function isKeywordES5(id,strict){if(!strict&&id==="yield"){return false}return isKeywordES6(id,strict)}function isKeywordES6(id,strict){if(strict&&isStrictModeReservedWordES6(id)){return true}switch(id.length){case 2:return id==="if"||id==="in"||id==="do";case 3:return id==="var"||id==="for"||id==="new"||id==="try";case 4:return id==="this"||id==="else"||id==="case"||id==="void"||id==="with"||id==="enum";case 5:return id==="while"||id==="break"||id==="catch"||id==="throw"||id==="const"||id==="yield"||id==="class"||id==="super";case 6:return id==="return"||id==="typeof"||id==="delete"||id==="switch"||id==="export"||id==="import";case 7:return id==="default"||id==="finally"||id==="extends";case 8:return id==="function"||id==="continue"||id==="debugger";case 10:return id==="instanceof";default:return false}}function isReservedWordES5(id,strict){return id==="null"||id==="true"||id==="false"||isKeywordES5(id,strict)}function isReservedWordES6(id,strict){return id==="null"||id==="true"||id==="false"||isKeywordES6(id,strict)}function isRestrictedWord(id){return id==="eval"||id==="arguments"}function isIdentifierNameES5(id){var i,iz,ch;if(id.length===0){return false}ch=id.charCodeAt(0);if(!code.isIdentifierStartES5(ch)){return false}for(i=1,iz=id.length;i<iz;++i){ch=id.charCodeAt(i);if(!code.isIdentifierPartES5(ch)){return false}}return true}function decodeUtf16(lead,trail){return(lead-55296)*1024+(trail-56320)+65536}function isIdentifierNameES6(id){var i,iz,ch,lowCh,check;if(id.length===0){return false}check=code.isIdentifierStartES6;for(i=0,iz=id.length;i<iz;++i){ch=id.charCodeAt(i);if(55296<=ch&&ch<=56319){++i;if(i>=iz){return false}lowCh=id.charCodeAt(i);if(!(56320<=lowCh&&lowCh<=57343)){return false}ch=decodeUtf16(ch,lowCh)}if(!check(ch)){return false}check=code.isIdentifierPartES6}return true}function isIdentifierES5(id,strict){return isIdentifierNameES5(id)&&!isReservedWordES5(id,strict)}function isIdentifierES6(id,strict){return isIdentifierNameES6(id)&&!isReservedWordES6(id,strict)}module.exports={isKeywordES5:isKeywordES5,isKeywordES6:isKeywordES6,isReservedWordES5:isReservedWordES5,isReservedWordES6:isReservedWordES6,isRestrictedWord:isRestrictedWord,isIdentifierNameES5:isIdentifierNameES5,isIdentifierNameES6:isIdentifierNameES6,isIdentifierES5:isIdentifierES5,isIdentifierES6:isIdentifierES6}})()},{"./code":121}],123:[function(require,module,exports){(function(){"use strict";exports.ast=require("./ast");exports.code=require("./code");exports.keyword=require("./keyword")})()},{"./ast":120,"./code":121,"./keyword":122}],124:[function(require,module,exports){(function(global){(function(){var undefined;var VERSION="4.17.5";var LARGE_ARRAY_SIZE=200;var CORE_ERROR_TEXT="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",FUNC_ERROR_TEXT="Expected a function";var HASH_UNDEFINED="__lodash_hash_undefined__";var MAX_MEMOIZE_SIZE=500;var PLACEHOLDER="__lodash_placeholder__";var CLONE_DEEP_FLAG=1,CLONE_FLAT_FLAG=2,CLONE_SYMBOLS_FLAG=4;var COMPARE_PARTIAL_FLAG=1,COMPARE_UNORDERED_FLAG=2;var WRAP_BIND_FLAG=1,WRAP_BIND_KEY_FLAG=2,WRAP_CURRY_BOUND_FLAG=4,WRAP_CURRY_FLAG=8,WRAP_CURRY_RIGHT_FLAG=16,WRAP_PARTIAL_FLAG=32,WRAP_PARTIAL_RIGHT_FLAG=64,WRAP_ARY_FLAG=128,WRAP_REARG_FLAG=256,WRAP_FLIP_FLAG=512;var DEFAULT_TRUNC_LENGTH=30,DEFAULT_TRUNC_OMISSION="...";var HOT_COUNT=800,HOT_SPAN=16;var LAZY_FILTER_FLAG=1,LAZY_MAP_FLAG=2,LAZY_WHILE_FLAG=3;var INFINITY=1/0,MAX_SAFE_INTEGER=9007199254740991,MAX_INTEGER=1.7976931348623157e308,NAN=0/0;var MAX_ARRAY_LENGTH=4294967295,MAX_ARRAY_INDEX=MAX_ARRAY_LENGTH-1,HALF_MAX_ARRAY_LENGTH=MAX_ARRAY_LENGTH>>>1;var wrapFlags=[["ary",WRAP_ARY_FLAG],["bind",WRAP_BIND_FLAG],["bindKey",WRAP_BIND_KEY_FLAG],["curry",WRAP_CURRY_FLAG],["curryRight",WRAP_CURRY_RIGHT_FLAG],["flip",WRAP_FLIP_FLAG],["partial",WRAP_PARTIAL_FLAG],["partialRight",WRAP_PARTIAL_RIGHT_FLAG],["rearg",WRAP_REARG_FLAG]];var argsTag="[object Arguments]",arrayTag="[object Array]",asyncTag="[object AsyncFunction]",boolTag="[object Boolean]",dateTag="[object Date]",domExcTag="[object DOMException]",errorTag="[object Error]",funcTag="[object Function]",genTag="[object GeneratorFunction]",mapTag="[object Map]",numberTag="[object Number]",nullTag="[object Null]",objectTag="[object Object]",promiseTag="[object Promise]",proxyTag="[object Proxy]",regexpTag="[object RegExp]",setTag="[object Set]",stringTag="[object String]",symbolTag="[object Symbol]",undefinedTag="[object Undefined]",weakMapTag="[object WeakMap]",weakSetTag="[object WeakSet]";var arrayBufferTag="[object ArrayBuffer]",dataViewTag="[object DataView]",float32Tag="[object Float32Array]",float64Tag="[object Float64Array]",int8Tag="[object Int8Array]",int16Tag="[object Int16Array]",int32Tag="[object Int32Array]",uint8Tag="[object Uint8Array]",uint8ClampedTag="[object Uint8ClampedArray]",uint16Tag="[object Uint16Array]",uint32Tag="[object Uint32Array]";var reEmptyStringLeading=/\b__p \+= '';/g,reEmptyStringMiddle=/\b(__p \+=) '' \+/g,reEmptyStringTrailing=/(__e\(.*?\)|\b__t\)) \+\n'';/g;var reEscapedHtml=/&(?:amp|lt|gt|quot|#39);/g,reUnescapedHtml=/[&<>"']/g,reHasEscapedHtml=RegExp(reEscapedHtml.source),reHasUnescapedHtml=RegExp(reUnescapedHtml.source);var reEscape=/<%-([\s\S]+?)%>/g,reEvaluate=/<%([\s\S]+?)%>/g,reInterpolate=/<%=([\s\S]+?)%>/g;var reIsDeepProp=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,reIsPlainProp=/^\w*$/,rePropName=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g;var reRegExpChar=/[\\^$.*+?()[\]{}|]/g,reHasRegExpChar=RegExp(reRegExpChar.source);var reTrim=/^\s+|\s+$/g,reTrimStart=/^\s+/,reTrimEnd=/\s+$/;var reWrapComment=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,reWrapDetails=/\{\n\/\* \[wrapped with (.+)\] \*/,reSplitDetails=/,? & /;var reAsciiWord=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;var reEscapeChar=/\\(\\)?/g;var reEsTemplate=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g;var reFlags=/\w*$/;var reIsBadHex=/^[-+]0x[0-9a-f]+$/i;var reIsBinary=/^0b[01]+$/i;var reIsHostCtor=/^\[object .+?Constructor\]$/;var reIsOctal=/^0o[0-7]+$/i;var reIsUint=/^(?:0|[1-9]\d*)$/;var reLatin=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g;var reNoMatch=/($^)/;var reUnescapedString=/['\n\r\u2028\u2029\\]/g;var rsAstralRange="\\ud800-\\udfff",rsComboMarksRange="\\u0300-\\u036f",reComboHalfMarksRange="\\ufe20-\\ufe2f",rsComboSymbolsRange="\\u20d0-\\u20ff",rsComboRange=rsComboMarksRange+reComboHalfMarksRange+rsComboSymbolsRange,rsDingbatRange="\\u2700-\\u27bf",rsLowerRange="a-z\\xdf-\\xf6\\xf8-\\xff",rsMathOpRange="\\xac\\xb1\\xd7\\xf7",rsNonCharRange="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",rsPunctuationRange="\\u2000-\\u206f",rsSpaceRange=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",rsUpperRange="A-Z\\xc0-\\xd6\\xd8-\\xde",rsVarRange="\\ufe0e\\ufe0f",rsBreakRange=rsMathOpRange+rsNonCharRange+rsPunctuationRange+rsSpaceRange;var rsApos="['\u2019]",rsAstral="["+rsAstralRange+"]",rsBreak="["+rsBreakRange+"]",rsCombo="["+rsComboRange+"]",rsDigits="\\d+",rsDingbat="["+rsDingbatRange+"]",rsLower="["+rsLowerRange+"]",rsMisc="[^"+rsAstralRange+rsBreakRange+rsDigits+rsDingbatRange+rsLowerRange+rsUpperRange+"]",rsFitz="\\ud83c[\\udffb-\\udfff]",rsModifier="(?:"+rsCombo+"|"+rsFitz+")",rsNonAstral="[^"+rsAstralRange+"]",rsRegional="(?:\\ud83c[\\udde6-\\uddff]){2}",rsSurrPair="[\\ud800-\\udbff][\\udc00-\\udfff]",rsUpper="["+rsUpperRange+"]",rsZWJ="\\u200d";var rsMiscLower="(?:"+rsLower+"|"+rsMisc+")",rsMiscUpper="(?:"+rsUpper+"|"+rsMisc+")",rsOptContrLower="(?:"+rsApos+"(?:d|ll|m|re|s|t|ve))?",rsOptContrUpper="(?:"+rsApos+"(?:D|LL|M|RE|S|T|VE))?",reOptMod=rsModifier+"?",rsOptVar="["+rsVarRange+"]?",rsOptJoin="(?:"+rsZWJ+"(?:"+[rsNonAstral,rsRegional,rsSurrPair].join("|")+")"+rsOptVar+reOptMod+")*",rsOrdLower="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",rsOrdUpper="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",rsSeq=rsOptVar+reOptMod+rsOptJoin,rsEmoji="(?:"+[rsDingbat,rsRegional,rsSurrPair].join("|")+")"+rsSeq,rsSymbol="(?:"+[rsNonAstral+rsCombo+"?",rsCombo,rsRegional,rsSurrPair,rsAstral].join("|")+")";var reApos=RegExp(rsApos,"g");var reComboMark=RegExp(rsCombo,"g");var reUnicode=RegExp(rsFitz+"(?="+rsFitz+")|"+rsSymbol+rsSeq,"g");var reUnicodeWord=RegExp([rsUpper+"?"+rsLower+"+"+rsOptContrLower+"(?="+[rsBreak,rsUpper,"$"].join("|")+")",rsMiscUpper+"+"+rsOptContrUpper+"(?="+[rsBreak,rsUpper+rsMiscLower,"$"].join("|")+")",rsUpper+"?"+rsMiscLower+"+"+rsOptContrLower,rsUpper+"+"+rsOptContrUpper,rsOrdUpper,rsOrdLower,rsDigits,rsEmoji].join("|"),"g");var reHasUnicode=RegExp("["+rsZWJ+rsAstralRange+rsComboRange+rsVarRange+"]");var reHasUnicodeWord=/[a-z][A-Z]|[A-Z]{2,}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;var contextProps=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"];var templateCounter=-1;var typedArrayTags={};typedArrayTags[float32Tag]=typedArrayTags[float64Tag]=typedArrayTags[int8Tag]=typedArrayTags[int16Tag]=typedArrayTags[int32Tag]=typedArrayTags[uint8Tag]=typedArrayTags[uint8ClampedTag]=typedArrayTags[uint16Tag]=typedArrayTags[uint32Tag]=true;typedArrayTags[argsTag]=typedArrayTags[arrayTag]=typedArrayTags[arrayBufferTag]=typedArrayTags[boolTag]=typedArrayTags[dataViewTag]=typedArrayTags[dateTag]=typedArrayTags[errorTag]=typedArrayTags[funcTag]=typedArrayTags[mapTag]=typedArrayTags[numberTag]=typedArrayTags[objectTag]=typedArrayTags[regexpTag]=typedArrayTags[setTag]=typedArrayTags[stringTag]=typedArrayTags[weakMapTag]=false;var cloneableTags={};cloneableTags[argsTag]=cloneableTags[arrayTag]=cloneableTags[arrayBufferTag]=cloneableTags[dataViewTag]=cloneableTags[boolTag]=cloneableTags[dateTag]=cloneableTags[float32Tag]=cloneableTags[float64Tag]=cloneableTags[int8Tag]=cloneableTags[int16Tag]=cloneableTags[int32Tag]=cloneableTags[mapTag]=cloneableTags[numberTag]=cloneableTags[objectTag]=cloneableTags[regexpTag]=cloneableTags[setTag]=cloneableTags[stringTag]=cloneableTags[symbolTag]=cloneableTags[uint8Tag]=cloneableTags[uint8ClampedTag]=cloneableTags[uint16Tag]=cloneableTags[uint32Tag]=true;cloneableTags[errorTag]=cloneableTags[funcTag]=cloneableTags[weakMapTag]=false;var deburredLetters={"\xc0":"A","\xc1":"A","\xc2":"A","\xc3":"A","\xc4":"A","\xc5":"A","\xe0":"a","\xe1":"a","\xe2":"a","\xe3":"a","\xe4":"a","\xe5":"a","\xc7":"C","\xe7":"c","\xd0":"D","\xf0":"d","\xc8":"E","\xc9":"E","\xca":"E","\xcb":"E","\xe8":"e","\xe9":"e","\xea":"e","\xeb":"e","\xcc":"I","\xcd":"I","\xce":"I","\xcf":"I","\xec":"i","\xed":"i","\xee":"i","\xef":"i","\xd1":"N","\xf1":"n","\xd2":"O","\xd3":"O","\xd4":"O","\xd5":"O","\xd6":"O","\xd8":"O","\xf2":"o","\xf3":"o","\xf4":"o","\xf5":"o","\xf6":"o","\xf8":"o","\xd9":"U","\xda":"U","\xdb":"U","\xdc":"U","\xf9":"u","\xfa":"u","\xfb":"u","\xfc":"u","\xdd":"Y","\xfd":"y","\xff":"y","\xc6":"Ae","\xe6":"ae","\xde":"Th","\xfe":"th","\xdf":"ss","\u0100":"A","\u0102":"A","\u0104":"A","\u0101":"a","\u0103":"a","\u0105":"a","\u0106":"C","\u0108":"C","\u010a":"C","\u010c":"C","\u0107":"c","\u0109":"c","\u010b":"c","\u010d":"c","\u010e":"D","\u0110":"D","\u010f":"d","\u0111":"d","\u0112":"E","\u0114":"E","\u0116":"E","\u0118":"E","\u011a":"E","\u0113":"e","\u0115":"e","\u0117":"e","\u0119":"e","\u011b":"e","\u011c":"G","\u011e":"G","\u0120":"G","\u0122":"G","\u011d":"g","\u011f":"g","\u0121":"g","\u0123":"g","\u0124":"H","\u0126":"H","\u0125":"h","\u0127":"h","\u0128":"I","\u012a":"I","\u012c":"I","\u012e":"I","\u0130":"I","\u0129":"i","\u012b":"i","\u012d":"i","\u012f":"i","\u0131":"i","\u0134":"J","\u0135":"j","\u0136":"K","\u0137":"k","\u0138":"k","\u0139":"L","\u013b":"L","\u013d":"L","\u013f":"L","\u0141":"L","\u013a":"l","\u013c":"l","\u013e":"l","\u0140":"l","\u0142":"l","\u0143":"N","\u0145":"N","\u0147":"N","\u014a":"N","\u0144":"n","\u0146":"n","\u0148":"n","\u014b":"n","\u014c":"O","\u014e":"O","\u0150":"O","\u014d":"o","\u014f":"o","\u0151":"o","\u0154":"R","\u0156":"R","\u0158":"R","\u0155":"r","\u0157":"r","\u0159":"r","\u015a":"S","\u015c":"S","\u015e":"S","\u0160":"S","\u015b":"s","\u015d":"s","\u015f":"s","\u0161":"s","\u0162":"T","\u0164":"T","\u0166":"T","\u0163":"t","\u0165":"t","\u0167":"t","\u0168":"U","\u016a":"U","\u016c":"U","\u016e":"U","\u0170":"U","\u0172":"U","\u0169":"u","\u016b":"u","\u016d":"u","\u016f":"u","\u0171":"u","\u0173":"u","\u0174":"W","\u0175":"w","\u0176":"Y","\u0177":"y","\u0178":"Y","\u0179":"Z","\u017b":"Z","\u017d":"Z","\u017a":"z","\u017c":"z","\u017e":"z","\u0132":"IJ","\u0133":"ij","\u0152":"Oe","\u0153":"oe","\u0149":"'n","\u017f":"s"};var htmlEscapes={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};var htmlUnescapes={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"};var stringEscapes={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"};var freeParseFloat=parseFloat,freeParseInt=parseInt;var freeGlobal=typeof global=="object"&&global&&global.Object===Object&&global;var freeSelf=typeof self=="object"&&self&&self.Object===Object&&self;var root=freeGlobal||freeSelf||Function("return this")();var freeExports=typeof exports=="object"&&exports&&!exports.nodeType&&exports;var freeModule=freeExports&&typeof module=="object"&&module&&!module.nodeType&&module;var moduleExports=freeModule&&freeModule.exports===freeExports;var freeProcess=moduleExports&&freeGlobal.process;var nodeUtil=function(){try{return freeProcess&&freeProcess.binding&&freeProcess.binding("util")}catch(e){}}();var nodeIsArrayBuffer=nodeUtil&&nodeUtil.isArrayBuffer,nodeIsDate=nodeUtil&&nodeUtil.isDate,nodeIsMap=nodeUtil&&nodeUtil.isMap,nodeIsRegExp=nodeUtil&&nodeUtil.isRegExp,nodeIsSet=nodeUtil&&nodeUtil.isSet,nodeIsTypedArray=nodeUtil&&nodeUtil.isTypedArray;function apply(func,thisArg,args){switch(args.length){case 0:return func.call(thisArg);case 1:return func.call(thisArg,args[0]);case 2:return func.call(thisArg,args[0],args[1]);case 3:return func.call(thisArg,args[0],args[1],args[2])}return func.apply(thisArg,args)}function arrayAggregator(array,setter,iteratee,accumulator){var index=-1,length=array==null?0:array.length;while(++index<length){var value=array[index];setter(accumulator,value,iteratee(value),array)}return accumulator}function arrayEach(array,iteratee){var index=-1,length=array==null?0:array.length;while(++index<length){if(iteratee(array[index],index,array)===false){break}}return array}function arrayEachRight(array,iteratee){var length=array==null?0:array.length;while(length--){if(iteratee(array[length],length,array)===false){break}}return array}function arrayEvery(array,predicate){var index=-1,length=array==null?0:array.length;while(++index<length){if(!predicate(array[index],index,array)){return false}}return true}function arrayFilter(array,predicate){var index=-1,length=array==null?0:array.length,resIndex=0,result=[];while(++index<length){var value=array[index];if(predicate(value,index,array)){result[resIndex++]=value}}return result}function arrayIncludes(array,value){var length=array==null?0:array.length;return!!length&&baseIndexOf(array,value,0)>-1}function arrayIncludesWith(array,value,comparator){var index=-1,length=array==null?0:array.length;while(++index<length){if(comparator(value,array[index])){return true}}return false}function arrayMap(array,iteratee){var index=-1,length=array==null?0:array.length,result=Array(length);while(++index<length){result[index]=iteratee(array[index],index,array)}return result}function arrayPush(array,values){var index=-1,length=values.length,offset=array.length;while(++index<length){array[offset+index]=values[index]}return array}function arrayReduce(array,iteratee,accumulator,initAccum){var index=-1,length=array==null?0:array.length;if(initAccum&&length){accumulator=array[++index]}while(++index<length){accumulator=iteratee(accumulator,array[index],index,array)}return accumulator}function arrayReduceRight(array,iteratee,accumulator,initAccum){var length=array==null?0:array.length;if(initAccum&&length){accumulator=array[--length]}while(length--){accumulator=iteratee(accumulator,array[length],length,array)}return accumulator}function arraySome(array,predicate){var index=-1,length=array==null?0:array.length;while(++index<length){if(predicate(array[index],index,array)){return true}}return false}var asciiSize=baseProperty("length");function asciiToArray(string){return string.split("")}function asciiWords(string){return string.match(reAsciiWord)||[]}function baseFindKey(collection,predicate,eachFunc){var result;eachFunc(collection,function(value,key,collection){if(predicate(value,key,collection)){result=key;return false}});return result}function baseFindIndex(array,predicate,fromIndex,fromRight){var length=array.length,index=fromIndex+(fromRight?1:-1);while(fromRight?index--:++index<length){if(predicate(array[index],index,array)){return index}}return-1}function baseIndexOf(array,value,fromIndex){return value===value?strictIndexOf(array,value,fromIndex):baseFindIndex(array,baseIsNaN,fromIndex)}function baseIndexOfWith(array,value,fromIndex,comparator){var index=fromIndex-1,length=array.length;while(++index<length){if(comparator(array[index],value)){return index}}return-1}function baseIsNaN(value){return value!==value}function baseMean(array,iteratee){var length=array==null?0:array.length;return length?baseSum(array,iteratee)/length:NAN}function baseProperty(key){return function(object){return object==null?undefined:object[key]}}function basePropertyOf(object){return function(key){return object==null?undefined:object[key]}}function baseReduce(collection,iteratee,accumulator,initAccum,eachFunc){eachFunc(collection,function(value,index,collection){accumulator=initAccum?(initAccum=false,value):iteratee(accumulator,value,index,collection)});return accumulator}function baseSortBy(array,comparer){var length=array.length;array.sort(comparer);while(length--){array[length]=array[length].value}return array}function baseSum(array,iteratee){var result,index=-1,length=array.length;while(++index<length){var current=iteratee(array[index]);if(current!==undefined){result=result===undefined?current:result+current}}return result}function baseTimes(n,iteratee){var index=-1,result=Array(n);while(++index<n){result[index]=iteratee(index)}return result}function baseToPairs(object,props){return arrayMap(props,function(key){return[key,object[key]]})}function baseUnary(func){return function(value){return func(value)}}function baseValues(object,props){return arrayMap(props,function(key){return object[key]})}function cacheHas(cache,key){return cache.has(key)}function charsStartIndex(strSymbols,chrSymbols){var index=-1,length=strSymbols.length;while(++index<length&&baseIndexOf(chrSymbols,strSymbols[index],0)>-1){}return index}function charsEndIndex(strSymbols,chrSymbols){var index=strSymbols.length;while(index--&&baseIndexOf(chrSymbols,strSymbols[index],0)>-1){}return index}function countHolders(array,placeholder){var length=array.length,result=0;while(length--){if(array[length]===placeholder){++result}}return result}var deburrLetter=basePropertyOf(deburredLetters);var escapeHtmlChar=basePropertyOf(htmlEscapes);function escapeStringChar(chr){return"\\"+stringEscapes[chr]}function getValue(object,key){return object==null?undefined:object[key]}function hasUnicode(string){return reHasUnicode.test(string)}function hasUnicodeWord(string){return reHasUnicodeWord.test(string)}function iteratorToArray(iterator){var data,result=[];while(!(data=iterator.next()).done){result.push(data.value)}return result}function mapToArray(map){var index=-1,result=Array(map.size);map.forEach(function(value,key){result[++index]=[key,value]});return result}function overArg(func,transform){return function(arg){return func(transform(arg))}}function replaceHolders(array,placeholder){var index=-1,length=array.length,resIndex=0,result=[];while(++index<length){var value=array[index];if(value===placeholder||value===PLACEHOLDER){array[index]=PLACEHOLDER;result[resIndex++]=index}}return result}function safeGet(object,key){return key=="__proto__"?undefined:object[key]}function setToArray(set){var index=-1,result=Array(set.size);set.forEach(function(value){result[++index]=value});return result}function setToPairs(set){var index=-1,result=Array(set.size);set.forEach(function(value){result[++index]=[value,value]});return result}function strictIndexOf(array,value,fromIndex){var index=fromIndex-1,length=array.length;while(++index<length){if(array[index]===value){return index}}return-1}function strictLastIndexOf(array,value,fromIndex){var index=fromIndex+1;while(index--){if(array[index]===value){return index}}return index}function stringSize(string){return hasUnicode(string)?unicodeSize(string):asciiSize(string)}function stringToArray(string){return hasUnicode(string)?unicodeToArray(string):asciiToArray(string)}var unescapeHtmlChar=basePropertyOf(htmlUnescapes);function unicodeSize(string){var result=reUnicode.lastIndex=0;while(reUnicode.test(string)){++result}return result}function unicodeToArray(string){return string.match(reUnicode)||[]}function unicodeWords(string){return string.match(reUnicodeWord)||[]}var runInContext=function runInContext(context){context=context==null?root:_.defaults(root.Object(),context,_.pick(root,contextProps));var Array=context.Array,Date=context.Date,Error=context.Error,Function=context.Function,Math=context.Math,Object=context.Object,RegExp=context.RegExp,String=context.String,TypeError=context.TypeError;var arrayProto=Array.prototype,funcProto=Function.prototype,objectProto=Object.prototype;var coreJsData=context["__core-js_shared__"];var funcToString=funcProto.toString;var hasOwnProperty=objectProto.hasOwnProperty;var idCounter=0;var maskSrcKey=function(){var uid=/[^.]+$/.exec(coreJsData&&coreJsData.keys&&coreJsData.keys.IE_PROTO||"");return uid?"Symbol(src)_1."+uid:""}();var nativeObjectToString=objectProto.toString;var objectCtorString=funcToString.call(Object);var oldDash=root._;var reIsNative=RegExp("^"+funcToString.call(hasOwnProperty).replace(reRegExpChar,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var Buffer=moduleExports?context.Buffer:undefined,Symbol=context.Symbol,Uint8Array=context.Uint8Array,allocUnsafe=Buffer?Buffer.allocUnsafe:undefined,getPrototype=overArg(Object.getPrototypeOf,Object),objectCreate=Object.create,propertyIsEnumerable=objectProto.propertyIsEnumerable,splice=arrayProto.splice,spreadableSymbol=Symbol?Symbol.isConcatSpreadable:undefined,symIterator=Symbol?Symbol.iterator:undefined,symToStringTag=Symbol?Symbol.toStringTag:undefined;var defineProperty=function(){try{var func=getNative(Object,"defineProperty");func({},"",{});return func}catch(e){}}();var ctxClearTimeout=context.clearTimeout!==root.clearTimeout&&context.clearTimeout,ctxNow=Date&&Date.now!==root.Date.now&&Date.now,ctxSetTimeout=context.setTimeout!==root.setTimeout&&context.setTimeout;var nativeCeil=Math.ceil,nativeFloor=Math.floor,nativeGetSymbols=Object.getOwnPropertySymbols,nativeIsBuffer=Buffer?Buffer.isBuffer:undefined,nativeIsFinite=context.isFinite,nativeJoin=arrayProto.join,nativeKeys=overArg(Object.keys,Object),nativeMax=Math.max,nativeMin=Math.min,nativeNow=Date.now,nativeParseInt=context.parseInt,nativeRandom=Math.random,nativeReverse=arrayProto.reverse;var DataView=getNative(context,"DataView"),Map=getNative(context,"Map"),Promise=getNative(context,"Promise"),Set=getNative(context,"Set"),WeakMap=getNative(context,"WeakMap"),nativeCreate=getNative(Object,"create");var metaMap=WeakMap&&new WeakMap;var realNames={};var dataViewCtorString=toSource(DataView),mapCtorString=toSource(Map),promiseCtorString=toSource(Promise),setCtorString=toSource(Set),weakMapCtorString=toSource(WeakMap);var symbolProto=Symbol?Symbol.prototype:undefined,symbolValueOf=symbolProto?symbolProto.valueOf:undefined,symbolToString=symbolProto?symbolProto.toString:undefined;function lodash(value){if(isObjectLike(value)&&!isArray(value)&&!(value instanceof LazyWrapper)){if(value instanceof LodashWrapper){return value}if(hasOwnProperty.call(value,"__wrapped__")){return wrapperClone(value)}}return new LodashWrapper(value)}var baseCreate=function(){function object(){}return function(proto){if(!isObject(proto)){return{}}if(objectCreate){return objectCreate(proto)}object.prototype=proto;var result=new object;object.prototype=undefined;return result}}();function baseLodash(){}function LodashWrapper(value,chainAll){this.__wrapped__=value;this.__actions__=[];this.__chain__=!!chainAll;this.__index__=0;this.__values__=undefined}lodash.templateSettings={escape:reEscape,evaluate:reEvaluate,interpolate:reInterpolate,variable:"",imports:{_:lodash}};lodash.prototype=baseLodash.prototype;lodash.prototype.constructor=lodash;LodashWrapper.prototype=baseCreate(baseLodash.prototype);LodashWrapper.prototype.constructor=LodashWrapper;function LazyWrapper(value){this.__wrapped__=value;this.__actions__=[];this.__dir__=1;this.__filtered__=false;this.__iteratees__=[];this.__takeCount__=MAX_ARRAY_LENGTH;this.__views__=[]}function lazyClone(){var result=new LazyWrapper(this.__wrapped__);result.__actions__=copyArray(this.__actions__);result.__dir__=this.__dir__;result.__filtered__=this.__filtered__;result.__iteratees__=copyArray(this.__iteratees__);result.__takeCount__=this.__takeCount__;result.__views__=copyArray(this.__views__);return result}function lazyReverse(){if(this.__filtered__){var result=new LazyWrapper(this);result.__dir__=-1;result.__filtered__=true}else{result=this.clone();result.__dir__*=-1}return result}function lazyValue(){var array=this.__wrapped__.value(),dir=this.__dir__,isArr=isArray(array),isRight=dir<0,arrLength=isArr?array.length:0,view=getView(0,arrLength,this.__views__),start=view.start,end=view.end,length=end-start,index=isRight?end:start-1,iteratees=this.__iteratees__,iterLength=iteratees.length,resIndex=0,takeCount=nativeMin(length,this.__takeCount__);if(!isArr||!isRight&&arrLength==length&&takeCount==length){return baseWrapperValue(array,this.__actions__)}var result=[];outer:while(length--&&resIndex<takeCount){index+=dir;var iterIndex=-1,value=array[index];while(++iterIndex<iterLength){var data=iteratees[iterIndex],iteratee=data.iteratee,type=data.type,computed=iteratee(value);if(type==LAZY_MAP_FLAG){value=computed}else if(!computed){if(type==LAZY_FILTER_FLAG){continue outer}else{break outer}}}result[resIndex++]=value}return result}LazyWrapper.prototype=baseCreate(baseLodash.prototype);LazyWrapper.prototype.constructor=LazyWrapper;function Hash(entries){var index=-1,length=entries==null?0:entries.length;this.clear();while(++index<length){var entry=entries[index];this.set(entry[0],entry[1])}}function hashClear(){this.__data__=nativeCreate?nativeCreate(null):{};this.size=0}function hashDelete(key){var result=this.has(key)&&delete this.__data__[key];this.size-=result?1:0;return result}function hashGet(key){var data=this.__data__;if(nativeCreate){var result=data[key];return result===HASH_UNDEFINED?undefined:result}return hasOwnProperty.call(data,key)?data[key]:undefined}function hashHas(key){var data=this.__data__;return nativeCreate?data[key]!==undefined:hasOwnProperty.call(data,key)}function hashSet(key,value){var data=this.__data__;this.size+=this.has(key)?0:1;data[key]=nativeCreate&&value===undefined?HASH_UNDEFINED:value;return this}Hash.prototype.clear=hashClear;Hash.prototype["delete"]=hashDelete;Hash.prototype.get=hashGet;Hash.prototype.has=hashHas;Hash.prototype.set=hashSet;function ListCache(entries){var index=-1,length=entries==null?0:entries.length;this.clear();while(++index<length){var entry=entries[index];this.set(entry[0],entry[1])}}function listCacheClear(){this.__data__=[];this.size=0}function listCacheDelete(key){var data=this.__data__,index=assocIndexOf(data,key);if(index<0){return false}var lastIndex=data.length-1;if(index==lastIndex){data.pop()}else{splice.call(data,index,1)}--this.size;return true}function listCacheGet(key){var data=this.__data__,index=assocIndexOf(data,key);return index<0?undefined:data[index][1]}function listCacheHas(key){return assocIndexOf(this.__data__,key)>-1}function listCacheSet(key,value){var data=this.__data__,index=assocIndexOf(data,key);if(index<0){++this.size;data.push([key,value])}else{data[index][1]=value}return this}ListCache.prototype.clear=listCacheClear;ListCache.prototype["delete"]=listCacheDelete;ListCache.prototype.get=listCacheGet;ListCache.prototype.has=listCacheHas;ListCache.prototype.set=listCacheSet;function MapCache(entries){var index=-1,length=entries==null?0:entries.length;this.clear();while(++index<length){var entry=entries[index];this.set(entry[0],entry[1])}}function mapCacheClear(){this.size=0;this.__data__={hash:new Hash,map:new(Map||ListCache),string:new Hash}}function mapCacheDelete(key){var result=getMapData(this,key)["delete"](key);this.size-=result?1:0;return result}function mapCacheGet(key){return getMapData(this,key).get(key)}function mapCacheHas(key){return getMapData(this,key).has(key)}function mapCacheSet(key,value){var data=getMapData(this,key),size=data.size;data.set(key,value);this.size+=data.size==size?0:1;return this}MapCache.prototype.clear=mapCacheClear;MapCache.prototype["delete"]=mapCacheDelete;MapCache.prototype.get=mapCacheGet;MapCache.prototype.has=mapCacheHas;MapCache.prototype.set=mapCacheSet;function SetCache(values){var index=-1,length=values==null?0:values.length;this.__data__=new MapCache;while(++index<length){this.add(values[index])}}function setCacheAdd(value){this.__data__.set(value,HASH_UNDEFINED);return this}function setCacheHas(value){return this.__data__.has(value)}SetCache.prototype.add=SetCache.prototype.push=setCacheAdd;SetCache.prototype.has=setCacheHas;function Stack(entries){var data=this.__data__=new ListCache(entries);this.size=data.size}function stackClear(){this.__data__=new ListCache;this.size=0}function stackDelete(key){var data=this.__data__,result=data["delete"](key);this.size=data.size;return result}function stackGet(key){return this.__data__.get(key)}function stackHas(key){return this.__data__.has(key)}function stackSet(key,value){var data=this.__data__;if(data instanceof ListCache){var pairs=data.__data__;if(!Map||pairs.length<LARGE_ARRAY_SIZE-1){pairs.push([key,value]);this.size=++data.size;return this}data=this.__data__=new MapCache(pairs)}data.set(key,value);this.size=data.size;return this}Stack.prototype.clear=stackClear;Stack.prototype["delete"]=stackDelete;Stack.prototype.get=stackGet;Stack.prototype.has=stackHas;Stack.prototype.set=stackSet;function arrayLikeKeys(value,inherited){var isArr=isArray(value),isArg=!isArr&&isArguments(value),isBuff=!isArr&&!isArg&&isBuffer(value),isType=!isArr&&!isArg&&!isBuff&&isTypedArray(value),skipIndexes=isArr||isArg||isBuff||isType,result=skipIndexes?baseTimes(value.length,String):[],length=result.length;for(var key in value){if((inherited||hasOwnProperty.call(value,key))&&!(skipIndexes&&(key=="length"||isBuff&&(key=="offset"||key=="parent")||isType&&(key=="buffer"||key=="byteLength"||key=="byteOffset")||isIndex(key,length)))){result.push(key)}}return result}function arraySample(array){var length=array.length;return length?array[baseRandom(0,length-1)]:undefined}function arraySampleSize(array,n){return shuffleSelf(copyArray(array),baseClamp(n,0,array.length))}function arrayShuffle(array){return shuffleSelf(copyArray(array))}function assignMergeValue(object,key,value){if(value!==undefined&&!eq(object[key],value)||value===undefined&&!(key in object)){baseAssignValue(object,key,value)}}function assignValue(object,key,value){var objValue=object[key];if(!(hasOwnProperty.call(object,key)&&eq(objValue,value))||value===undefined&&!(key in object)){baseAssignValue(object,key,value)}}function assocIndexOf(array,key){var length=array.length;while(length--){if(eq(array[length][0],key)){return length}}return-1}function baseAggregator(collection,setter,iteratee,accumulator){baseEach(collection,function(value,key,collection){setter(accumulator,value,iteratee(value),collection)});return accumulator}function baseAssign(object,source){return object&&copyObject(source,keys(source),object)}function baseAssignIn(object,source){return object&&copyObject(source,keysIn(source),object)}function baseAssignValue(object,key,value){if(key=="__proto__"&&defineProperty){defineProperty(object,key,{configurable:true,enumerable:true,value:value,writable:true})}else{object[key]=value}}function baseAt(object,paths){var index=-1,length=paths.length,result=Array(length),skip=object==null;while(++index<length){result[index]=skip?undefined:get(object,paths[index])}return result}function baseClamp(number,lower,upper){if(number===number){if(upper!==undefined){number=number<=upper?number:upper}if(lower!==undefined){number=number>=lower?number:lower}}return number}function baseClone(value,bitmask,customizer,key,object,stack){var result,isDeep=bitmask&CLONE_DEEP_FLAG,isFlat=bitmask&CLONE_FLAT_FLAG,isFull=bitmask&CLONE_SYMBOLS_FLAG;if(customizer){result=object?customizer(value,key,object,stack):customizer(value)}if(result!==undefined){return result}if(!isObject(value)){return value}var isArr=isArray(value);if(isArr){result=initCloneArray(value);if(!isDeep){return copyArray(value,result)}}else{var tag=getTag(value),isFunc=tag==funcTag||tag==genTag;if(isBuffer(value)){return cloneBuffer(value,isDeep)}if(tag==objectTag||tag==argsTag||isFunc&&!object){result=isFlat||isFunc?{}:initCloneObject(value);if(!isDeep){return isFlat?copySymbolsIn(value,baseAssignIn(result,value)):copySymbols(value,baseAssign(result,value))}}else{if(!cloneableTags[tag]){return object?value:{}}result=initCloneByTag(value,tag,isDeep)}}stack||(stack=new Stack);var stacked=stack.get(value);if(stacked){return stacked}stack.set(value,result);if(isSet(value)){value.forEach(function(subValue){result.add(baseClone(subValue,bitmask,customizer,subValue,value,stack))});return result}if(isMap(value)){value.forEach(function(subValue,key){result.set(key,baseClone(subValue,bitmask,customizer,key,value,stack))});return result}var keysFunc=isFull?isFlat?getAllKeysIn:getAllKeys:isFlat?keysIn:keys;var props=isArr?undefined:keysFunc(value);arrayEach(props||value,function(subValue,key){if(props){key=subValue;subValue=value[key]}assignValue(result,key,baseClone(subValue,bitmask,customizer,key,value,stack))});return result}function baseConforms(source){var props=keys(source);return function(object){return baseConformsTo(object,source,props)}}function baseConformsTo(object,source,props){var length=props.length;if(object==null){return!length}object=Object(object);while(length--){var key=props[length],predicate=source[key],value=object[key];if(value===undefined&&!(key in object)||!predicate(value)){return false}}return true}function baseDelay(func,wait,args){if(typeof func!="function"){throw new TypeError(FUNC_ERROR_TEXT)}return setTimeout(function(){func.apply(undefined,args)},wait)}function baseDifference(array,values,iteratee,comparator){var index=-1,includes=arrayIncludes,isCommon=true,length=array.length,result=[],valuesLength=values.length;if(!length){return result}if(iteratee){values=arrayMap(values,baseUnary(iteratee))}if(comparator){includes=arrayIncludesWith;isCommon=false}else if(values.length>=LARGE_ARRAY_SIZE){includes=cacheHas;isCommon=false;values=new SetCache(values)}outer:while(++index<length){var value=array[index],computed=iteratee==null?value:iteratee(value);value=comparator||value!==0?value:0;if(isCommon&&computed===computed){var valuesIndex=valuesLength;while(valuesIndex--){if(values[valuesIndex]===computed){continue outer}}result.push(value)}else if(!includes(values,computed,comparator)){result.push(value)}}return result}var baseEach=createBaseEach(baseForOwn);var baseEachRight=createBaseEach(baseForOwnRight,true);function baseEvery(collection,predicate){var result=true;baseEach(collection,function(value,index,collection){result=!!predicate(value,index,collection);return result});return result}function baseExtremum(array,iteratee,comparator){var index=-1,length=array.length;while(++index<length){var value=array[index],current=iteratee(value);if(current!=null&&(computed===undefined?current===current&&!isSymbol(current):comparator(current,computed))){var computed=current,result=value}}return result}function baseFill(array,value,start,end){var length=array.length;start=toInteger(start);if(start<0){start=-start>length?0:length+start}end=end===undefined||end>length?length:toInteger(end);if(end<0){end+=length}end=start>end?0:toLength(end);while(start<end){array[start++]=value}return array}function baseFilter(collection,predicate){var result=[];baseEach(collection,function(value,index,collection){if(predicate(value,index,collection)){result.push(value)}});return result}function baseFlatten(array,depth,predicate,isStrict,result){var index=-1,length=array.length;predicate||(predicate=isFlattenable);result||(result=[]);while(++index<length){var value=array[index];if(depth>0&&predicate(value)){if(depth>1){baseFlatten(value,depth-1,predicate,isStrict,result)}else{arrayPush(result,value)}}else if(!isStrict){result[result.length]=value}}return result}var baseFor=createBaseFor();var baseForRight=createBaseFor(true);function baseForOwn(object,iteratee){return object&&baseFor(object,iteratee,keys)}function baseForOwnRight(object,iteratee){return object&&baseForRight(object,iteratee,keys)}function baseFunctions(object,props){return arrayFilter(props,function(key){return isFunction(object[key])})}function baseGet(object,path){path=castPath(path,object);var index=0,length=path.length;while(object!=null&&index<length){object=object[toKey(path[index++])]}return index&&index==length?object:undefined}function baseGetAllKeys(object,keysFunc,symbolsFunc){var result=keysFunc(object);return isArray(object)?result:arrayPush(result,symbolsFunc(object))}function baseGetTag(value){if(value==null){return value===undefined?undefinedTag:nullTag}return symToStringTag&&symToStringTag in Object(value)?getRawTag(value):objectToString(value)}function baseGt(value,other){return value>other}function baseHas(object,key){return object!=null&&hasOwnProperty.call(object,key)}function baseHasIn(object,key){return object!=null&&key in Object(object)}function baseInRange(number,start,end){return number>=nativeMin(start,end)&&number<nativeMax(start,end)}function baseIntersection(arrays,iteratee,comparator){var includes=comparator?arrayIncludesWith:arrayIncludes,length=arrays[0].length,othLength=arrays.length,othIndex=othLength,caches=Array(othLength),maxLength=Infinity,result=[];while(othIndex--){var array=arrays[othIndex];if(othIndex&&iteratee){array=arrayMap(array,baseUnary(iteratee))}maxLength=nativeMin(array.length,maxLength);caches[othIndex]=!comparator&&(iteratee||length>=120&&array.length>=120)?new SetCache(othIndex&&array):undefined}array=arrays[0];var index=-1,seen=caches[0];outer:while(++index<length&&result.length<maxLength){var value=array[index],computed=iteratee?iteratee(value):value;value=comparator||value!==0?value:0;if(!(seen?cacheHas(seen,computed):includes(result,computed,comparator))){othIndex=othLength;while(--othIndex){var cache=caches[othIndex];if(!(cache?cacheHas(cache,computed):includes(arrays[othIndex],computed,comparator))){continue outer}}if(seen){seen.push(computed)}result.push(value)}}return result}function baseInverter(object,setter,iteratee,accumulator){baseForOwn(object,function(value,key,object){setter(accumulator,iteratee(value),key,object)});return accumulator}function baseInvoke(object,path,args){path=castPath(path,object);object=parent(object,path);var func=object==null?object:object[toKey(last(path))];return func==null?undefined:apply(func,object,args)}function baseIsArguments(value){return isObjectLike(value)&&baseGetTag(value)==argsTag}function baseIsArrayBuffer(value){return isObjectLike(value)&&baseGetTag(value)==arrayBufferTag}function baseIsDate(value){return isObjectLike(value)&&baseGetTag(value)==dateTag}function baseIsEqual(value,other,bitmask,customizer,stack){if(value===other){return true}if(value==null||other==null||!isObjectLike(value)&&!isObjectLike(other)){return value!==value&&other!==other}return baseIsEqualDeep(value,other,bitmask,customizer,baseIsEqual,stack)}function baseIsEqualDeep(object,other,bitmask,customizer,equalFunc,stack){var objIsArr=isArray(object),othIsArr=isArray(other),objTag=objIsArr?arrayTag:getTag(object),othTag=othIsArr?arrayTag:getTag(other);objTag=objTag==argsTag?objectTag:objTag;othTag=othTag==argsTag?objectTag:othTag;var objIsObj=objTag==objectTag,othIsObj=othTag==objectTag,isSameTag=objTag==othTag;if(isSameTag&&isBuffer(object)){if(!isBuffer(other)){return false}objIsArr=true;objIsObj=false}if(isSameTag&&!objIsObj){stack||(stack=new Stack);return objIsArr||isTypedArray(object)?equalArrays(object,other,bitmask,customizer,equalFunc,stack):equalByTag(object,other,objTag,bitmask,customizer,equalFunc,stack)}if(!(bitmask&COMPARE_PARTIAL_FLAG)){var objIsWrapped=objIsObj&&hasOwnProperty.call(object,"__wrapped__"),othIsWrapped=othIsObj&&hasOwnProperty.call(other,"__wrapped__");if(objIsWrapped||othIsWrapped){var objUnwrapped=objIsWrapped?object.value():object,othUnwrapped=othIsWrapped?other.value():other;stack||(stack=new Stack);return equalFunc(objUnwrapped,othUnwrapped,bitmask,customizer,stack)}}if(!isSameTag){return false}stack||(stack=new Stack);return equalObjects(object,other,bitmask,customizer,equalFunc,stack)}function baseIsMap(value){return isObjectLike(value)&&getTag(value)==mapTag}function baseIsMatch(object,source,matchData,customizer){var index=matchData.length,length=index,noCustomizer=!customizer;if(object==null){return!length}object=Object(object);while(index--){var data=matchData[index];if(noCustomizer&&data[2]?data[1]!==object[data[0]]:!(data[0]in object)){return false}}while(++index<length){data=matchData[index];var key=data[0],objValue=object[key],srcValue=data[1];if(noCustomizer&&data[2]){if(objValue===undefined&&!(key in object)){return false}}else{var stack=new Stack;if(customizer){var result=customizer(objValue,srcValue,key,object,source,stack)}if(!(result===undefined?baseIsEqual(srcValue,objValue,COMPARE_PARTIAL_FLAG|COMPARE_UNORDERED_FLAG,customizer,stack):result)){return false}}}return true}function baseIsNative(value){if(!isObject(value)||isMasked(value)){return false}var pattern=isFunction(value)?reIsNative:reIsHostCtor;return pattern.test(toSource(value))}function baseIsRegExp(value){return isObjectLike(value)&&baseGetTag(value)==regexpTag}function baseIsSet(value){return isObjectLike(value)&&getTag(value)==setTag}function baseIsTypedArray(value){return isObjectLike(value)&&isLength(value.length)&&!!typedArrayTags[baseGetTag(value)]}function baseIteratee(value){if(typeof value=="function"){return value}if(value==null){return identity}if(typeof value=="object"){return isArray(value)?baseMatchesProperty(value[0],value[1]):baseMatches(value)}return property(value)}function baseKeys(object){if(!isPrototype(object)){return nativeKeys(object)}var result=[];for(var key in Object(object)){if(hasOwnProperty.call(object,key)&&key!="constructor"){result.push(key)}}return result}function baseKeysIn(object){if(!isObject(object)){return nativeKeysIn(object)}var isProto=isPrototype(object),result=[];for(var key in object){if(!(key=="constructor"&&(isProto||!hasOwnProperty.call(object,key)))){result.push(key)}}return result}function baseLt(value,other){return value<other}function baseMap(collection,iteratee){var index=-1,result=isArrayLike(collection)?Array(collection.length):[];baseEach(collection,function(value,key,collection){result[++index]=iteratee(value,key,collection)});return result}function baseMatches(source){var matchData=getMatchData(source);if(matchData.length==1&&matchData[0][2]){return matchesStrictComparable(matchData[0][0],matchData[0][1])}return function(object){return object===source||baseIsMatch(object,source,matchData)}}function baseMatchesProperty(path,srcValue){if(isKey(path)&&isStrictComparable(srcValue)){return matchesStrictComparable(toKey(path),srcValue)}return function(object){var objValue=get(object,path);return objValue===undefined&&objValue===srcValue?hasIn(object,path):baseIsEqual(srcValue,objValue,COMPARE_PARTIAL_FLAG|COMPARE_UNORDERED_FLAG)}}function baseMerge(object,source,srcIndex,customizer,stack){if(object===source){return}baseFor(source,function(srcValue,key){if(isObject(srcValue)){stack||(stack=new Stack);baseMergeDeep(object,source,key,srcIndex,baseMerge,customizer,stack)}else{var newValue=customizer?customizer(safeGet(object,key),srcValue,key+"",object,source,stack):undefined;if(newValue===undefined){newValue=srcValue}assignMergeValue(object,key,newValue)}},keysIn)}function baseMergeDeep(object,source,key,srcIndex,mergeFunc,customizer,stack){var objValue=safeGet(object,key),srcValue=safeGet(source,key),stacked=stack.get(srcValue);if(stacked){assignMergeValue(object,key,stacked);return}var newValue=customizer?customizer(objValue,srcValue,key+"",object,source,stack):undefined;var isCommon=newValue===undefined;if(isCommon){var isArr=isArray(srcValue),isBuff=!isArr&&isBuffer(srcValue),isTyped=!isArr&&!isBuff&&isTypedArray(srcValue);newValue=srcValue;if(isArr||isBuff||isTyped){if(isArray(objValue)){newValue=objValue}else if(isArrayLikeObject(objValue)){newValue=copyArray(objValue)}else if(isBuff){isCommon=false;newValue=cloneBuffer(srcValue,true)}else if(isTyped){isCommon=false;newValue=cloneTypedArray(srcValue,true)}else{newValue=[]}}else if(isPlainObject(srcValue)||isArguments(srcValue)){newValue=objValue;if(isArguments(objValue)){newValue=toPlainObject(objValue)}else if(!isObject(objValue)||srcIndex&&isFunction(objValue)){newValue=initCloneObject(srcValue)}}else{isCommon=false}}if(isCommon){stack.set(srcValue,newValue);mergeFunc(newValue,srcValue,srcIndex,customizer,stack);stack["delete"](srcValue)}assignMergeValue(object,key,newValue)}function baseNth(array,n){var length=array.length;if(!length){return}n+=n<0?length:0;return isIndex(n,length)?array[n]:undefined}function baseOrderBy(collection,iteratees,orders){var index=-1;iteratees=arrayMap(iteratees.length?iteratees:[identity],baseUnary(getIteratee()));var result=baseMap(collection,function(value,key,collection){var criteria=arrayMap(iteratees,function(iteratee){return iteratee(value)});return{criteria:criteria,index:++index,value:value}});return baseSortBy(result,function(object,other){return compareMultiple(object,other,orders)})}function basePick(object,paths){return basePickBy(object,paths,function(value,path){return hasIn(object,path)})}function basePickBy(object,paths,predicate){var index=-1,length=paths.length,result={};while(++index<length){var path=paths[index],value=baseGet(object,path);if(predicate(value,path)){baseSet(result,castPath(path,object),value)}}return result}function basePropertyDeep(path){return function(object){return baseGet(object,path)}}function basePullAll(array,values,iteratee,comparator){var indexOf=comparator?baseIndexOfWith:baseIndexOf,index=-1,length=values.length,seen=array;if(array===values){values=copyArray(values)}if(iteratee){seen=arrayMap(array,baseUnary(iteratee))}while(++index<length){var fromIndex=0,value=values[index],computed=iteratee?iteratee(value):value;while((fromIndex=indexOf(seen,computed,fromIndex,comparator))>-1){if(seen!==array){splice.call(seen,fromIndex,1)}splice.call(array,fromIndex,1)}}return array}function basePullAt(array,indexes){var length=array?indexes.length:0,lastIndex=length-1;while(length--){var index=indexes[length];if(length==lastIndex||index!==previous){var previous=index;if(isIndex(index)){splice.call(array,index,1)}else{baseUnset(array,index)}}}return array}function baseRandom(lower,upper){return lower+nativeFloor(nativeRandom()*(upper-lower+1))}function baseRange(start,end,step,fromRight){var index=-1,length=nativeMax(nativeCeil((end-start)/(step||1)),0),result=Array(length);while(length--){result[fromRight?length:++index]=start;start+=step}return result}function baseRepeat(string,n){var result="";if(!string||n<1||n>MAX_SAFE_INTEGER){return result}do{if(n%2){result+=string}n=nativeFloor(n/2);if(n){string+=string}}while(n);return result}function baseRest(func,start){return setToString(overRest(func,start,identity),func+"")}function baseSample(collection){return arraySample(values(collection))}function baseSampleSize(collection,n){var array=values(collection);return shuffleSelf(array,baseClamp(n,0,array.length))}function baseSet(object,path,value,customizer){if(!isObject(object)){return object}path=castPath(path,object);var index=-1,length=path.length,lastIndex=length-1,nested=object;while(nested!=null&&++index<length){var key=toKey(path[index]),newValue=value;if(index!=lastIndex){var objValue=nested[key];newValue=customizer?customizer(objValue,key,nested):undefined;if(newValue===undefined){newValue=isObject(objValue)?objValue:isIndex(path[index+1])?[]:{}}}assignValue(nested,key,newValue);nested=nested[key]}return object}var baseSetData=!metaMap?identity:function(func,data){metaMap.set(func,data);return func};var baseSetToString=!defineProperty?identity:function(func,string){return defineProperty(func,"toString",{configurable:true,enumerable:false,value:constant(string),writable:true})};function baseShuffle(collection){return shuffleSelf(values(collection))}function baseSlice(array,start,end){var index=-1,length=array.length;if(start<0){start=-start>length?0:length+start}end=end>length?length:end;if(end<0){end+=length}length=start>end?0:end-start>>>0;start>>>=0;var result=Array(length);while(++index<length){result[index]=array[index+start]}return result}function baseSome(collection,predicate){var result;baseEach(collection,function(value,index,collection){result=predicate(value,index,collection);return!result});return!!result}function baseSortedIndex(array,value,retHighest){var low=0,high=array==null?low:array.length;if(typeof value=="number"&&value===value&&high<=HALF_MAX_ARRAY_LENGTH){while(low<high){var mid=low+high>>>1,computed=array[mid];if(computed!==null&&!isSymbol(computed)&&(retHighest?computed<=value:computed<value)){low=mid+1}else{high=mid}}return high}return baseSortedIndexBy(array,value,identity,retHighest)}function baseSortedIndexBy(array,value,iteratee,retHighest){value=iteratee(value);var low=0,high=array==null?0:array.length,valIsNaN=value!==value,valIsNull=value===null,valIsSymbol=isSymbol(value),valIsUndefined=value===undefined;while(low<high){var mid=nativeFloor((low+high)/2),computed=iteratee(array[mid]),othIsDefined=computed!==undefined,othIsNull=computed===null,othIsReflexive=computed===computed,othIsSymbol=isSymbol(computed);if(valIsNaN){var setLow=retHighest||othIsReflexive}else if(valIsUndefined){setLow=othIsReflexive&&(retHighest||othIsDefined)}else if(valIsNull){setLow=othIsReflexive&&othIsDefined&&(retHighest||!othIsNull)}else if(valIsSymbol){setLow=othIsReflexive&&othIsDefined&&!othIsNull&&(retHighest||!othIsSymbol)}else if(othIsNull||othIsSymbol){setLow=false}else{setLow=retHighest?computed<=value:computed<value}if(setLow){low=mid+1}else{high=mid}}return nativeMin(high,MAX_ARRAY_INDEX)}function baseSortedUniq(array,iteratee){var index=-1,length=array.length,resIndex=0,result=[];while(++index<length){var value=array[index],computed=iteratee?iteratee(value):value;if(!index||!eq(computed,seen)){var seen=computed;result[resIndex++]=value===0?0:value}}return result}function baseToNumber(value){if(typeof value=="number"){return value}if(isSymbol(value)){return NAN}return+value}function baseToString(value){if(typeof value=="string"){return value}if(isArray(value)){return arrayMap(value,baseToString)+""}if(isSymbol(value)){return symbolToString?symbolToString.call(value):""}var result=value+"";return result=="0"&&1/value==-INFINITY?"-0":result}function baseUniq(array,iteratee,comparator){var index=-1,includes=arrayIncludes,length=array.length,isCommon=true,result=[],seen=result;if(comparator){isCommon=false;includes=arrayIncludesWith}else if(length>=LARGE_ARRAY_SIZE){var set=iteratee?null:createSet(array);if(set){return setToArray(set)}isCommon=false;includes=cacheHas;seen=new SetCache}else{seen=iteratee?[]:result}outer:while(++index<length){var value=array[index],computed=iteratee?iteratee(value):value;value=comparator||value!==0?value:0;if(isCommon&&computed===computed){var seenIndex=seen.length;while(seenIndex--){if(seen[seenIndex]===computed){continue outer}}if(iteratee){seen.push(computed)}result.push(value)}else if(!includes(seen,computed,comparator)){if(seen!==result){seen.push(computed)}result.push(value)}}return result}function baseUnset(object,path){path=castPath(path,object);object=parent(object,path);return object==null||delete object[toKey(last(path))]}function baseUpdate(object,path,updater,customizer){return baseSet(object,path,updater(baseGet(object,path)),customizer)}function baseWhile(array,predicate,isDrop,fromRight){var length=array.length,index=fromRight?length:-1;while((fromRight?index--:++index<length)&&predicate(array[index],index,array)){}return isDrop?baseSlice(array,fromRight?0:index,fromRight?index+1:length):baseSlice(array,fromRight?index+1:0,fromRight?length:index)}function baseWrapperValue(value,actions){var result=value;if(result instanceof LazyWrapper){result=result.value()}return arrayReduce(actions,function(result,action){return action.func.apply(action.thisArg,arrayPush([result],action.args))},result)}function baseXor(arrays,iteratee,comparator){var length=arrays.length;if(length<2){return length?baseUniq(arrays[0]):[]}var index=-1,result=Array(length);while(++index<length){var array=arrays[index],othIndex=-1;while(++othIndex<length){if(othIndex!=index){result[index]=baseDifference(result[index]||array,arrays[othIndex],iteratee,comparator)}}}return baseUniq(baseFlatten(result,1),iteratee,comparator)}function baseZipObject(props,values,assignFunc){var index=-1,length=props.length,valsLength=values.length,result={};while(++index<length){var value=index<valsLength?values[index]:undefined;assignFunc(result,props[index],value)}return result}function castArrayLikeObject(value){return isArrayLikeObject(value)?value:[]}function castFunction(value){return typeof value=="function"?value:identity}function castPath(value,object){if(isArray(value)){return value}return isKey(value,object)?[value]:stringToPath(toString(value))}var castRest=baseRest;function castSlice(array,start,end){var length=array.length;end=end===undefined?length:end;return!start&&end>=length?array:baseSlice(array,start,end)}var clearTimeout=ctxClearTimeout||function(id){return root.clearTimeout(id)};function cloneBuffer(buffer,isDeep){if(isDeep){return buffer.slice()}var length=buffer.length,result=allocUnsafe?allocUnsafe(length):new buffer.constructor(length);buffer.copy(result);return result}function cloneArrayBuffer(arrayBuffer){var result=new arrayBuffer.constructor(arrayBuffer.byteLength);new Uint8Array(result).set(new Uint8Array(arrayBuffer));return result}function cloneDataView(dataView,isDeep){var buffer=isDeep?cloneArrayBuffer(dataView.buffer):dataView.buffer;return new dataView.constructor(buffer,dataView.byteOffset,dataView.byteLength)}function cloneRegExp(regexp){var result=new regexp.constructor(regexp.source,reFlags.exec(regexp));result.lastIndex=regexp.lastIndex;return result}function cloneSymbol(symbol){return symbolValueOf?Object(symbolValueOf.call(symbol)):{}}function cloneTypedArray(typedArray,isDeep){var buffer=isDeep?cloneArrayBuffer(typedArray.buffer):typedArray.buffer;return new typedArray.constructor(buffer,typedArray.byteOffset,typedArray.length)}function compareAscending(value,other){if(value!==other){var valIsDefined=value!==undefined,valIsNull=value===null,valIsReflexive=value===value,valIsSymbol=isSymbol(value);var othIsDefined=other!==undefined,othIsNull=other===null,othIsReflexive=other===other,othIsSymbol=isSymbol(other);if(!othIsNull&&!othIsSymbol&&!valIsSymbol&&value>other||valIsSymbol&&othIsDefined&&othIsReflexive&&!othIsNull&&!othIsSymbol||valIsNull&&othIsDefined&&othIsReflexive||!valIsDefined&&othIsReflexive||!valIsReflexive){return 1}if(!valIsNull&&!valIsSymbol&&!othIsSymbol&&value<other||othIsSymbol&&valIsDefined&&valIsReflexive&&!valIsNull&&!valIsSymbol||othIsNull&&valIsDefined&&valIsReflexive||!othIsDefined&&valIsReflexive||!othIsReflexive){return-1}}return 0}function compareMultiple(object,other,orders){var index=-1,objCriteria=object.criteria,othCriteria=other.criteria,length=objCriteria.length,ordersLength=orders.length;while(++index<length){var result=compareAscending(objCriteria[index],othCriteria[index]);if(result){if(index>=ordersLength){return result}var order=orders[index];return result*(order=="desc"?-1:1)}}return object.index-other.index}function composeArgs(args,partials,holders,isCurried){var argsIndex=-1,argsLength=args.length,holdersLength=holders.length,leftIndex=-1,leftLength=partials.length,rangeLength=nativeMax(argsLength-holdersLength,0),result=Array(leftLength+rangeLength),isUncurried=!isCurried;while(++leftIndex<leftLength){result[leftIndex]=partials[leftIndex]}while(++argsIndex<holdersLength){if(isUncurried||argsIndex<argsLength){result[holders[argsIndex]]=args[argsIndex]}}while(rangeLength--){result[leftIndex++]=args[argsIndex++]}return result}function composeArgsRight(args,partials,holders,isCurried){var argsIndex=-1,argsLength=args.length,holdersIndex=-1,holdersLength=holders.length,rightIndex=-1,rightLength=partials.length,rangeLength=nativeMax(argsLength-holdersLength,0),result=Array(rangeLength+rightLength),isUncurried=!isCurried;while(++argsIndex<rangeLength){result[argsIndex]=args[argsIndex]}var offset=argsIndex;while(++rightIndex<rightLength){result[offset+rightIndex]=partials[rightIndex]}while(++holdersIndex<holdersLength){if(isUncurried||argsIndex<argsLength){result[offset+holders[holdersIndex]]=args[argsIndex++]}}return result}function copyArray(source,array){var index=-1,length=source.length;array||(array=Array(length));while(++index<length){array[index]=source[index]}return array}function copyObject(source,props,object,customizer){var isNew=!object;object||(object={});var index=-1,length=props.length;while(++index<length){var key=props[index];var newValue=customizer?customizer(object[key],source[key],key,object,source):undefined;if(newValue===undefined){newValue=source[key]}if(isNew){baseAssignValue(object,key,newValue)}else{assignValue(object,key,newValue)}}return object}function copySymbols(source,object){return copyObject(source,getSymbols(source),object)}function copySymbolsIn(source,object){return copyObject(source,getSymbolsIn(source),object)}function createAggregator(setter,initializer){return function(collection,iteratee){var func=isArray(collection)?arrayAggregator:baseAggregator,accumulator=initializer?initializer():{};return func(collection,setter,getIteratee(iteratee,2),accumulator)}}function createAssigner(assigner){return baseRest(function(object,sources){var index=-1,length=sources.length,customizer=length>1?sources[length-1]:undefined,guard=length>2?sources[2]:undefined;customizer=assigner.length>3&&typeof customizer=="function"?(length--,customizer):undefined;if(guard&&isIterateeCall(sources[0],sources[1],guard)){customizer=length<3?undefined:customizer;length=1}object=Object(object);while(++index<length){var source=sources[index];if(source){assigner(object,source,index,customizer)}}return object})}function createBaseEach(eachFunc,fromRight){return function(collection,iteratee){if(collection==null){return collection}if(!isArrayLike(collection)){return eachFunc(collection,iteratee)}var length=collection.length,index=fromRight?length:-1,iterable=Object(collection);while(fromRight?index--:++index<length){if(iteratee(iterable[index],index,iterable)===false){break}}return collection}}function createBaseFor(fromRight){return function(object,iteratee,keysFunc){var index=-1,iterable=Object(object),props=keysFunc(object),length=props.length;while(length--){var key=props[fromRight?length:++index];if(iteratee(iterable[key],key,iterable)===false){break}}return object}}function createBind(func,bitmask,thisArg){var isBind=bitmask&WRAP_BIND_FLAG,Ctor=createCtor(func);function wrapper(){var fn=this&&this!==root&&this instanceof wrapper?Ctor:func;return fn.apply(isBind?thisArg:this,arguments)}return wrapper}function createCaseFirst(methodName){return function(string){string=toString(string);var strSymbols=hasUnicode(string)?stringToArray(string):undefined;var chr=strSymbols?strSymbols[0]:string.charAt(0);var trailing=strSymbols?castSlice(strSymbols,1).join(""):string.slice(1);return chr[methodName]()+trailing}}function createCompounder(callback){return function(string){return arrayReduce(words(deburr(string).replace(reApos,"")),callback,"")}}function createCtor(Ctor){return function(){var args=arguments;switch(args.length){case 0:return new Ctor;case 1:return new Ctor(args[0]);case 2:return new Ctor(args[0],args[1]);case 3:return new Ctor(args[0],args[1],args[2]);case 4:return new Ctor(args[0],args[1],args[2],args[3]);case 5:return new Ctor(args[0],args[1],args[2],args[3],args[4]);case 6:return new Ctor(args[0],args[1],args[2],args[3],args[4],args[5]);case 7:return new Ctor(args[0],args[1],args[2],args[3],args[4],args[5],args[6])}var thisBinding=baseCreate(Ctor.prototype),result=Ctor.apply(thisBinding,args);return isObject(result)?result:thisBinding}}function createCurry(func,bitmask,arity){var Ctor=createCtor(func);function wrapper(){var length=arguments.length,args=Array(length),index=length,placeholder=getHolder(wrapper);while(index--){args[index]=arguments[index]}var holders=length<3&&args[0]!==placeholder&&args[length-1]!==placeholder?[]:replaceHolders(args,placeholder);length-=holders.length;if(length<arity){return createRecurry(func,bitmask,createHybrid,wrapper.placeholder,undefined,args,holders,undefined,undefined,arity-length)}var fn=this&&this!==root&&this instanceof wrapper?Ctor:func;return apply(fn,this,args)}return wrapper}function createFind(findIndexFunc){return function(collection,predicate,fromIndex){var iterable=Object(collection);if(!isArrayLike(collection)){var iteratee=getIteratee(predicate,3);collection=keys(collection);predicate=function(key){return iteratee(iterable[key],key,iterable)}}var index=findIndexFunc(collection,predicate,fromIndex);return index>-1?iterable[iteratee?collection[index]:index]:undefined}}function createFlow(fromRight){return flatRest(function(funcs){var length=funcs.length,index=length,prereq=LodashWrapper.prototype.thru;if(fromRight){funcs.reverse()}while(index--){var func=funcs[index];if(typeof func!="function"){throw new TypeError(FUNC_ERROR_TEXT)}if(prereq&&!wrapper&&getFuncName(func)=="wrapper"){var wrapper=new LodashWrapper([],true)}}index=wrapper?index:length;while(++index<length){func=funcs[index];var funcName=getFuncName(func),data=funcName=="wrapper"?getData(func):undefined;if(data&&isLaziable(data[0])&&data[1]==(WRAP_ARY_FLAG|WRAP_CURRY_FLAG|WRAP_PARTIAL_FLAG|WRAP_REARG_FLAG)&&!data[4].length&&data[9]==1){wrapper=wrapper[getFuncName(data[0])].apply(wrapper,data[3])}else{wrapper=func.length==1&&isLaziable(func)?wrapper[funcName]():wrapper.thru(func)}}return function(){var args=arguments,value=args[0];if(wrapper&&args.length==1&&isArray(value)){return wrapper.plant(value).value()}var index=0,result=length?funcs[index].apply(this,args):value;while(++index<length){result=funcs[index].call(this,result)}return result}})}function createHybrid(func,bitmask,thisArg,partials,holders,partialsRight,holdersRight,argPos,ary,arity){var isAry=bitmask&WRAP_ARY_FLAG,isBind=bitmask&WRAP_BIND_FLAG,isBindKey=bitmask&WRAP_BIND_KEY_FLAG,isCurried=bitmask&(WRAP_CURRY_FLAG|WRAP_CURRY_RIGHT_FLAG),isFlip=bitmask&WRAP_FLIP_FLAG,Ctor=isBindKey?undefined:createCtor(func);function wrapper(){var length=arguments.length,args=Array(length),index=length;while(index--){args[index]=arguments[index]}if(isCurried){var placeholder=getHolder(wrapper),holdersCount=countHolders(args,placeholder)}if(partials){args=composeArgs(args,partials,holders,isCurried)}if(partialsRight){args=composeArgsRight(args,partialsRight,holdersRight,isCurried)}length-=holdersCount;if(isCurried&&length<arity){var newHolders=replaceHolders(args,placeholder);return createRecurry(func,bitmask,createHybrid,wrapper.placeholder,thisArg,args,newHolders,argPos,ary,arity-length)}var thisBinding=isBind?thisArg:this,fn=isBindKey?thisBinding[func]:func;length=args.length;if(argPos){args=reorder(args,argPos)}else if(isFlip&&length>1){args.reverse()}if(isAry&&ary<length){args.length=ary}if(this&&this!==root&&this instanceof wrapper){fn=Ctor||createCtor(fn)}return fn.apply(thisBinding,args)}return wrapper}function createInverter(setter,toIteratee){return function(object,iteratee){return baseInverter(object,setter,toIteratee(iteratee),{})}}function createMathOperation(operator,defaultValue){return function(value,other){var result;if(value===undefined&&other===undefined){return defaultValue}if(value!==undefined){result=value}if(other!==undefined){if(result===undefined){return other}if(typeof value=="string"||typeof other=="string"){value=baseToString(value);other=baseToString(other)}else{value=baseToNumber(value);other=baseToNumber(other)}result=operator(value,other)}return result}}function createOver(arrayFunc){return flatRest(function(iteratees){iteratees=arrayMap(iteratees,baseUnary(getIteratee()));return baseRest(function(args){var thisArg=this;return arrayFunc(iteratees,function(iteratee){return apply(iteratee,thisArg,args)})})})}function createPadding(length,chars){chars=chars===undefined?" ":baseToString(chars);var charsLength=chars.length;if(charsLength<2){return charsLength?baseRepeat(chars,length):chars}var result=baseRepeat(chars,nativeCeil(length/stringSize(chars)));return hasUnicode(chars)?castSlice(stringToArray(result),0,length).join(""):result.slice(0,length)}function createPartial(func,bitmask,thisArg,partials){var isBind=bitmask&WRAP_BIND_FLAG,Ctor=createCtor(func);function wrapper(){var argsIndex=-1,argsLength=arguments.length,leftIndex=-1,leftLength=partials.length,args=Array(leftLength+argsLength),fn=this&&this!==root&&this instanceof wrapper?Ctor:func;while(++leftIndex<leftLength){args[leftIndex]=partials[leftIndex]}while(argsLength--){args[leftIndex++]=arguments[++argsIndex]}return apply(fn,isBind?thisArg:this,args)}return wrapper}function createRange(fromRight){return function(start,end,step){if(step&&typeof step!="number"&&isIterateeCall(start,end,step)){end=step=undefined}start=toFinite(start);if(end===undefined){end=start;start=0}else{end=toFinite(end)}step=step===undefined?start<end?1:-1:toFinite(step);return baseRange(start,end,step,fromRight)}}function createRelationalOperation(operator){return function(value,other){if(!(typeof value=="string"&&typeof other=="string")){value=toNumber(value);other=toNumber(other)}return operator(value,other)}}function createRecurry(func,bitmask,wrapFunc,placeholder,thisArg,partials,holders,argPos,ary,arity){var isCurry=bitmask&WRAP_CURRY_FLAG,newHolders=isCurry?holders:undefined,newHoldersRight=isCurry?undefined:holders,newPartials=isCurry?partials:undefined,newPartialsRight=isCurry?undefined:partials;bitmask|=isCurry?WRAP_PARTIAL_FLAG:WRAP_PARTIAL_RIGHT_FLAG;bitmask&=~(isCurry?WRAP_PARTIAL_RIGHT_FLAG:WRAP_PARTIAL_FLAG);if(!(bitmask&WRAP_CURRY_BOUND_FLAG)){bitmask&=~(WRAP_BIND_FLAG|WRAP_BIND_KEY_FLAG)}var newData=[func,bitmask,thisArg,newPartials,newHolders,newPartialsRight,newHoldersRight,argPos,ary,arity];var result=wrapFunc.apply(undefined,newData);if(isLaziable(func)){setData(result,newData)}result.placeholder=placeholder;return setWrapToString(result,func,bitmask)}function createRound(methodName){var func=Math[methodName];return function(number,precision){number=toNumber(number);precision=precision==null?0:nativeMin(toInteger(precision),292);if(precision){var pair=(toString(number)+"e").split("e"),value=func(pair[0]+"e"+(+pair[1]+precision));pair=(toString(value)+"e").split("e");return+(pair[0]+"e"+(+pair[1]-precision))}return func(number)}}var createSet=!(Set&&1/setToArray(new Set([,-0]))[1]==INFINITY)?noop:function(values){return new Set(values)};function createToPairs(keysFunc){return function(object){var tag=getTag(object);if(tag==mapTag){return mapToArray(object)}if(tag==setTag){return setToPairs(object)}return baseToPairs(object,keysFunc(object))}}function createWrap(func,bitmask,thisArg,partials,holders,argPos,ary,arity){var isBindKey=bitmask&WRAP_BIND_KEY_FLAG;if(!isBindKey&&typeof func!="function"){throw new TypeError(FUNC_ERROR_TEXT)}var length=partials?partials.length:0;if(!length){bitmask&=~(WRAP_PARTIAL_FLAG|WRAP_PARTIAL_RIGHT_FLAG);partials=holders=undefined}ary=ary===undefined?ary:nativeMax(toInteger(ary),0);arity=arity===undefined?arity:toInteger(arity);length-=holders?holders.length:0;if(bitmask&WRAP_PARTIAL_RIGHT_FLAG){var partialsRight=partials,holdersRight=holders;partials=holders=undefined}var data=isBindKey?undefined:getData(func);var newData=[func,bitmask,thisArg,partials,holders,partialsRight,holdersRight,argPos,ary,arity];if(data){mergeData(newData,data)}func=newData[0];bitmask=newData[1];thisArg=newData[2];partials=newData[3];holders=newData[4];arity=newData[9]=newData[9]===undefined?isBindKey?0:func.length:nativeMax(newData[9]-length,0);if(!arity&&bitmask&(WRAP_CURRY_FLAG|WRAP_CURRY_RIGHT_FLAG)){bitmask&=~(WRAP_CURRY_FLAG|WRAP_CURRY_RIGHT_FLAG)}if(!bitmask||bitmask==WRAP_BIND_FLAG){var result=createBind(func,bitmask,thisArg)}else if(bitmask==WRAP_CURRY_FLAG||bitmask==WRAP_CURRY_RIGHT_FLAG){result=createCurry(func,bitmask,arity)}else if((bitmask==WRAP_PARTIAL_FLAG||bitmask==(WRAP_BIND_FLAG|WRAP_PARTIAL_FLAG))&&!holders.length){result=createPartial(func,bitmask,thisArg,partials)}else{result=createHybrid.apply(undefined,newData)}var setter=data?baseSetData:setData;return setWrapToString(setter(result,newData),func,bitmask)}function customDefaultsAssignIn(objValue,srcValue,key,object){if(objValue===undefined||eq(objValue,objectProto[key])&&!hasOwnProperty.call(object,key)){return srcValue}return objValue}function customDefaultsMerge(objValue,srcValue,key,object,source,stack){if(isObject(objValue)&&isObject(srcValue)){stack.set(srcValue,objValue);baseMerge(objValue,srcValue,undefined,customDefaultsMerge,stack);stack["delete"](srcValue)}return objValue}function customOmitClone(value){return isPlainObject(value)?undefined:value}function equalArrays(array,other,bitmask,customizer,equalFunc,stack){var isPartial=bitmask&COMPARE_PARTIAL_FLAG,arrLength=array.length,othLength=other.length;if(arrLength!=othLength&&!(isPartial&&othLength>arrLength)){return false}var stacked=stack.get(array);if(stacked&&stack.get(other)){return stacked==other}var index=-1,result=true,seen=bitmask&COMPARE_UNORDERED_FLAG?new SetCache:undefined;stack.set(array,other);stack.set(other,array);while(++index<arrLength){var arrValue=array[index],othValue=other[index];if(customizer){var compared=isPartial?customizer(othValue,arrValue,index,other,array,stack):customizer(arrValue,othValue,index,array,other,stack)}if(compared!==undefined){if(compared){continue}result=false;break}if(seen){if(!arraySome(other,function(othValue,othIndex){if(!cacheHas(seen,othIndex)&&(arrValue===othValue||equalFunc(arrValue,othValue,bitmask,customizer,stack))){return seen.push(othIndex)}})){result=false;break}}else if(!(arrValue===othValue||equalFunc(arrValue,othValue,bitmask,customizer,stack))){result=false;break}}stack["delete"](array);stack["delete"](other);return result}function equalByTag(object,other,tag,bitmask,customizer,equalFunc,stack){switch(tag){case dataViewTag:if(object.byteLength!=other.byteLength||object.byteOffset!=other.byteOffset){return false}object=object.buffer;other=other.buffer;case arrayBufferTag:if(object.byteLength!=other.byteLength||!equalFunc(new Uint8Array(object),new Uint8Array(other))){return false}return true;case boolTag:case dateTag:case numberTag:return eq(+object,+other);case errorTag:return object.name==other.name&&object.message==other.message;case regexpTag:case stringTag:return object==other+"";case mapTag:var convert=mapToArray;case setTag:var isPartial=bitmask&COMPARE_PARTIAL_FLAG;convert||(convert=setToArray);if(object.size!=other.size&&!isPartial){return false}var stacked=stack.get(object);if(stacked){return stacked==other}bitmask|=COMPARE_UNORDERED_FLAG;stack.set(object,other);var result=equalArrays(convert(object),convert(other),bitmask,customizer,equalFunc,stack);stack["delete"](object);return result;case symbolTag:if(symbolValueOf){return symbolValueOf.call(object)==symbolValueOf.call(other)}}return false}function equalObjects(object,other,bitmask,customizer,equalFunc,stack){var isPartial=bitmask&COMPARE_PARTIAL_FLAG,objProps=getAllKeys(object),objLength=objProps.length,othProps=getAllKeys(other),othLength=othProps.length;if(objLength!=othLength&&!isPartial){return false}var index=objLength;while(index--){var key=objProps[index];if(!(isPartial?key in other:hasOwnProperty.call(other,key))){return false}}var stacked=stack.get(object);if(stacked&&stack.get(other)){return stacked==other}var result=true;stack.set(object,other);stack.set(other,object);var skipCtor=isPartial;while(++index<objLength){key=objProps[index];var objValue=object[key],othValue=other[key];if(customizer){var compared=isPartial?customizer(othValue,objValue,key,other,object,stack):customizer(objValue,othValue,key,object,other,stack)}if(!(compared===undefined?objValue===othValue||equalFunc(objValue,othValue,bitmask,customizer,stack):compared)){result=false;break}skipCtor||(skipCtor=key=="constructor")}if(result&&!skipCtor){var objCtor=object.constructor,othCtor=other.constructor;if(objCtor!=othCtor&&("constructor"in object&&"constructor"in other)&&!(typeof objCtor=="function"&&objCtor instanceof objCtor&&typeof othCtor=="function"&&othCtor instanceof othCtor)){result=false}}stack["delete"](object);stack["delete"](other);return result}function flatRest(func){return setToString(overRest(func,undefined,flatten),func+"")}function getAllKeys(object){return baseGetAllKeys(object,keys,getSymbols)}function getAllKeysIn(object){return baseGetAllKeys(object,keysIn,getSymbolsIn)}var getData=!metaMap?noop:function(func){return metaMap.get(func)};function getFuncName(func){var result=func.name+"",array=realNames[result],length=hasOwnProperty.call(realNames,result)?array.length:0;while(length--){var data=array[length],otherFunc=data.func;if(otherFunc==null||otherFunc==func){return data.name}}return result}function getHolder(func){var object=hasOwnProperty.call(lodash,"placeholder")?lodash:func;return object.placeholder}function getIteratee(){var result=lodash.iteratee||iteratee;result=result===iteratee?baseIteratee:result;return arguments.length?result(arguments[0],arguments[1]):result}function getMapData(map,key){var data=map.__data__;return isKeyable(key)?data[typeof key=="string"?"string":"hash"]:data.map}function getMatchData(object){var result=keys(object),length=result.length;while(length--){var key=result[length],value=object[key];result[length]=[key,value,isStrictComparable(value)]}return result}function getNative(object,key){var value=getValue(object,key);return baseIsNative(value)?value:undefined}function getRawTag(value){var isOwn=hasOwnProperty.call(value,symToStringTag),tag=value[symToStringTag];try{value[symToStringTag]=undefined;var unmasked=true}catch(e){}var result=nativeObjectToString.call(value);if(unmasked){if(isOwn){value[symToStringTag]=tag}else{delete value[symToStringTag]}}return result}var getSymbols=!nativeGetSymbols?stubArray:function(object){if(object==null){return[]}object=Object(object);return arrayFilter(nativeGetSymbols(object),function(symbol){return propertyIsEnumerable.call(object,symbol)})};var getSymbolsIn=!nativeGetSymbols?stubArray:function(object){var result=[];while(object){arrayPush(result,getSymbols(object));object=getPrototype(object)}return result};var getTag=baseGetTag;if(DataView&&getTag(new DataView(new ArrayBuffer(1)))!=dataViewTag||Map&&getTag(new Map)!=mapTag||Promise&&getTag(Promise.resolve())!=promiseTag||Set&&getTag(new Set)!=setTag||WeakMap&&getTag(new WeakMap)!=weakMapTag){getTag=function(value){var result=baseGetTag(value),Ctor=result==objectTag?value.constructor:undefined,ctorString=Ctor?toSource(Ctor):"";if(ctorString){switch(ctorString){case dataViewCtorString:return dataViewTag;case mapCtorString:return mapTag;case promiseCtorString:return promiseTag;case setCtorString:return setTag;case weakMapCtorString:return weakMapTag}}return result}}function getView(start,end,transforms){var index=-1,length=transforms.length;while(++index<length){var data=transforms[index],size=data.size;switch(data.type){case"drop":start+=size;break;case"dropRight":end-=size;break;case"take":end=nativeMin(end,start+size);break;case"takeRight":start=nativeMax(start,end-size);break}}return{start:start,end:end}}function getWrapDetails(source){var match=source.match(reWrapDetails);return match?match[1].split(reSplitDetails):[]}function hasPath(object,path,hasFunc){path=castPath(path,object);var index=-1,length=path.length,result=false;while(++index<length){var key=toKey(path[index]);if(!(result=object!=null&&hasFunc(object,key))){break}object=object[key]}if(result||++index!=length){return result}length=object==null?0:object.length;return!!length&&isLength(length)&&isIndex(key,length)&&(isArray(object)||isArguments(object))}function initCloneArray(array){var length=array.length,result=new array.constructor(length);if(length&&typeof array[0]=="string"&&hasOwnProperty.call(array,"index")){result.index=array.index;result.input=array.input}return result}function initCloneObject(object){return typeof object.constructor=="function"&&!isPrototype(object)?baseCreate(getPrototype(object)):{}}function initCloneByTag(object,tag,isDeep){var Ctor=object.constructor;switch(tag){case arrayBufferTag:return cloneArrayBuffer(object);case boolTag:case dateTag:return new Ctor(+object);case dataViewTag:return cloneDataView(object,isDeep);case float32Tag:case float64Tag:case int8Tag:case int16Tag:case int32Tag:case uint8Tag:case uint8ClampedTag:case uint16Tag:case uint32Tag:return cloneTypedArray(object,isDeep);case mapTag:return new Ctor;case numberTag:case stringTag:return new Ctor(object);case regexpTag:return cloneRegExp(object);case setTag:return new Ctor;case symbolTag:return cloneSymbol(object)}}function insertWrapDetails(source,details){var length=details.length;if(!length){return source}var lastIndex=length-1;details[lastIndex]=(length>1?"& ":"")+details[lastIndex];details=details.join(length>2?", ":" ");return source.replace(reWrapComment,"{\n/* [wrapped with "+details+"] */\n")}function isFlattenable(value){return isArray(value)||isArguments(value)||!!(spreadableSymbol&&value&&value[spreadableSymbol])}function isIndex(value,length){var type=typeof value;length=length==null?MAX_SAFE_INTEGER:length;return!!length&&(type=="number"||type!="symbol"&&reIsUint.test(value))&&(value>-1&&value%1==0&&value<length)}function isIterateeCall(value,index,object){if(!isObject(object)){return false}var type=typeof index;if(type=="number"?isArrayLike(object)&&isIndex(index,object.length):type=="string"&&index in object){return eq(object[index],value)}return false}function isKey(value,object){if(isArray(value)){return false}var type=typeof value;if(type=="number"||type=="symbol"||type=="boolean"||value==null||isSymbol(value)){return true}return reIsPlainProp.test(value)||!reIsDeepProp.test(value)||object!=null&&value in Object(object)}function isKeyable(value){var type=typeof value;return type=="string"||type=="number"||type=="symbol"||type=="boolean"?value!=="__proto__":value===null}function isLaziable(func){var funcName=getFuncName(func),other=lodash[funcName];if(typeof other!="function"||!(funcName in LazyWrapper.prototype)){return false}if(func===other){return true}var data=getData(other);return!!data&&func===data[0]}function isMasked(func){return!!maskSrcKey&&maskSrcKey in func}var isMaskable=coreJsData?isFunction:stubFalse;function isPrototype(value){var Ctor=value&&value.constructor,proto=typeof Ctor=="function"&&Ctor.prototype||objectProto;return value===proto}function isStrictComparable(value){return value===value&&!isObject(value)}function matchesStrictComparable(key,srcValue){return function(object){if(object==null){return false}return object[key]===srcValue&&(srcValue!==undefined||key in Object(object))}}function memoizeCapped(func){var result=memoize(func,function(key){if(cache.size===MAX_MEMOIZE_SIZE){cache.clear()}return key});var cache=result.cache;return result}function mergeData(data,source){var bitmask=data[1],srcBitmask=source[1],newBitmask=bitmask|srcBitmask,isCommon=newBitmask<(WRAP_BIND_FLAG|WRAP_BIND_KEY_FLAG|WRAP_ARY_FLAG);var isCombo=srcBitmask==WRAP_ARY_FLAG&&bitmask==WRAP_CURRY_FLAG||srcBitmask==WRAP_ARY_FLAG&&bitmask==WRAP_REARG_FLAG&&data[7].length<=source[8]||srcBitmask==(WRAP_ARY_FLAG|WRAP_REARG_FLAG)&&source[7].length<=source[8]&&bitmask==WRAP_CURRY_FLAG;if(!(isCommon||isCombo)){return data}if(srcBitmask&WRAP_BIND_FLAG){data[2]=source[2];newBitmask|=bitmask&WRAP_BIND_FLAG?0:WRAP_CURRY_BOUND_FLAG}var value=source[3];if(value){var partials=data[3];data[3]=partials?composeArgs(partials,value,source[4]):value;data[4]=partials?replaceHolders(data[3],PLACEHOLDER):source[4]}value=source[5];if(value){partials=data[5];data[5]=partials?composeArgsRight(partials,value,source[6]):value;data[6]=partials?replaceHolders(data[5],PLACEHOLDER):source[6]}value=source[7];if(value){data[7]=value}if(srcBitmask&WRAP_ARY_FLAG){data[8]=data[8]==null?source[8]:nativeMin(data[8],source[8])}if(data[9]==null){data[9]=source[9]}data[0]=source[0];data[1]=newBitmask;return data}function nativeKeysIn(object){var result=[];if(object!=null){for(var key in Object(object)){result.push(key)}}return result}function objectToString(value){return nativeObjectToString.call(value)}function overRest(func,start,transform){start=nativeMax(start===undefined?func.length-1:start,0);return function(){var args=arguments,index=-1,length=nativeMax(args.length-start,0),array=Array(length);while(++index<length){array[index]=args[start+index]}index=-1;var otherArgs=Array(start+1);while(++index<start){otherArgs[index]=args[index]}otherArgs[start]=transform(array);return apply(func,this,otherArgs)}}function parent(object,path){return path.length<2?object:baseGet(object,baseSlice(path,0,-1))}function reorder(array,indexes){var arrLength=array.length,length=nativeMin(indexes.length,arrLength),oldArray=copyArray(array);while(length--){var index=indexes[length];array[length]=isIndex(index,arrLength)?oldArray[index]:undefined}return array}var setData=shortOut(baseSetData);var setTimeout=ctxSetTimeout||function(func,wait){return root.setTimeout(func,wait)};var setToString=shortOut(baseSetToString);function setWrapToString(wrapper,reference,bitmask){var source=reference+"";return setToString(wrapper,insertWrapDetails(source,updateWrapDetails(getWrapDetails(source),bitmask)))}function shortOut(func){var count=0,lastCalled=0;return function(){var stamp=nativeNow(),remaining=HOT_SPAN-(stamp-lastCalled);lastCalled=stamp;if(remaining>0){if(++count>=HOT_COUNT){return arguments[0]}}else{count=0}return func.apply(undefined,arguments)}}function shuffleSelf(array,size){var index=-1,length=array.length,lastIndex=length-1;size=size===undefined?length:size;while(++index<size){var rand=baseRandom(index,lastIndex),value=array[rand];array[rand]=array[index];array[index]=value}array.length=size;return array}var stringToPath=memoizeCapped(function(string){var result=[];if(string.charCodeAt(0)===46){result.push("")}string.replace(rePropName,function(match,number,quote,subString){result.push(quote?subString.replace(reEscapeChar,"$1"):number||match)});return result});function toKey(value){if(typeof value=="string"||isSymbol(value)){return value}var result=value+"";return result=="0"&&1/value==-INFINITY?"-0":result}function toSource(func){if(func!=null){try{return funcToString.call(func)}catch(e){}try{return func+""}catch(e){}}return""}function updateWrapDetails(details,bitmask){arrayEach(wrapFlags,function(pair){var value="_."+pair[0];if(bitmask&pair[1]&&!arrayIncludes(details,value)){details.push(value)}});return details.sort()}function wrapperClone(wrapper){if(wrapper instanceof LazyWrapper){return wrapper.clone()}var result=new LodashWrapper(wrapper.__wrapped__,wrapper.__chain__);result.__actions__=copyArray(wrapper.__actions__);result.__index__=wrapper.__index__;result.__values__=wrapper.__values__;return result}function chunk(array,size,guard){if(guard?isIterateeCall(array,size,guard):size===undefined){size=1}else{size=nativeMax(toInteger(size),0)}var length=array==null?0:array.length;if(!length||size<1){return[]}var index=0,resIndex=0,result=Array(nativeCeil(length/size));while(index<length){result[resIndex++]=baseSlice(array,index,index+=size)}return result}function compact(array){var index=-1,length=array==null?0:array.length,resIndex=0,result=[];while(++index<length){var value=array[index];if(value){result[resIndex++]=value}}return result}function concat(){var length=arguments.length;if(!length){return[]}var args=Array(length-1),array=arguments[0],index=length;while(index--){args[index-1]=arguments[index]}return arrayPush(isArray(array)?copyArray(array):[array],baseFlatten(args,1))}var difference=baseRest(function(array,values){return isArrayLikeObject(array)?baseDifference(array,baseFlatten(values,1,isArrayLikeObject,true)):[]});var differenceBy=baseRest(function(array,values){var iteratee=last(values);if(isArrayLikeObject(iteratee)){iteratee=undefined}return isArrayLikeObject(array)?baseDifference(array,baseFlatten(values,1,isArrayLikeObject,true),getIteratee(iteratee,2)):[]});var differenceWith=baseRest(function(array,values){var comparator=last(values);if(isArrayLikeObject(comparator)){comparator=undefined}return isArrayLikeObject(array)?baseDifference(array,baseFlatten(values,1,isArrayLikeObject,true),undefined,comparator):[]});function drop(array,n,guard){var length=array==null?0:array.length;if(!length){return[]}n=guard||n===undefined?1:toInteger(n);return baseSlice(array,n<0?0:n,length)}function dropRight(array,n,guard){var length=array==null?0:array.length;if(!length){return[]}n=guard||n===undefined?1:toInteger(n);n=length-n;return baseSlice(array,0,n<0?0:n)}function dropRightWhile(array,predicate){return array&&array.length?baseWhile(array,getIteratee(predicate,3),true,true):[]}function dropWhile(array,predicate){return array&&array.length?baseWhile(array,getIteratee(predicate,3),true):[]}function fill(array,value,start,end){var length=array==null?0:array.length;if(!length){return[]}if(start&&typeof start!="number"&&isIterateeCall(array,value,start)){start=0;end=length}return baseFill(array,value,start,end)}function findIndex(array,predicate,fromIndex){var length=array==null?0:array.length;if(!length){return-1}var index=fromIndex==null?0:toInteger(fromIndex);if(index<0){index=nativeMax(length+index,0)}return baseFindIndex(array,getIteratee(predicate,3),index)}function findLastIndex(array,predicate,fromIndex){var length=array==null?0:array.length;if(!length){return-1}var index=length-1;if(fromIndex!==undefined){index=toInteger(fromIndex);index=fromIndex<0?nativeMax(length+index,0):nativeMin(index,length-1)}return baseFindIndex(array,getIteratee(predicate,3),index,true)}function flatten(array){var length=array==null?0:array.length;return length?baseFlatten(array,1):[]}function flattenDeep(array){var length=array==null?0:array.length;return length?baseFlatten(array,INFINITY):[]}function flattenDepth(array,depth){var length=array==null?0:array.length;if(!length){return[]}depth=depth===undefined?1:toInteger(depth);return baseFlatten(array,depth)}function fromPairs(pairs){var index=-1,length=pairs==null?0:pairs.length,result={};while(++index<length){var pair=pairs[index];result[pair[0]]=pair[1]}return result}function head(array){return array&&array.length?array[0]:undefined}function indexOf(array,value,fromIndex){var length=array==null?0:array.length;if(!length){return-1}var index=fromIndex==null?0:toInteger(fromIndex);if(index<0){index=nativeMax(length+index,0)}return baseIndexOf(array,value,index)}function initial(array){var length=array==null?0:array.length;return length?baseSlice(array,0,-1):[]}var intersection=baseRest(function(arrays){var mapped=arrayMap(arrays,castArrayLikeObject);return mapped.length&&mapped[0]===arrays[0]?baseIntersection(mapped):[]});var intersectionBy=baseRest(function(arrays){var iteratee=last(arrays),mapped=arrayMap(arrays,castArrayLikeObject);if(iteratee===last(mapped)){iteratee=undefined}else{mapped.pop()}return mapped.length&&mapped[0]===arrays[0]?baseIntersection(mapped,getIteratee(iteratee,2)):[]});var intersectionWith=baseRest(function(arrays){var comparator=last(arrays),mapped=arrayMap(arrays,castArrayLikeObject);comparator=typeof comparator=="function"?comparator:undefined;if(comparator){mapped.pop()}return mapped.length&&mapped[0]===arrays[0]?baseIntersection(mapped,undefined,comparator):[]});function join(array,separator){return array==null?"":nativeJoin.call(array,separator)}function last(array){var length=array==null?0:array.length;return length?array[length-1]:undefined}function lastIndexOf(array,value,fromIndex){var length=array==null?0:array.length;if(!length){return-1}var index=length;if(fromIndex!==undefined){index=toInteger(fromIndex);index=index<0?nativeMax(length+index,0):nativeMin(index,length-1)}return value===value?strictLastIndexOf(array,value,index):baseFindIndex(array,baseIsNaN,index,true)}function nth(array,n){return array&&array.length?baseNth(array,toInteger(n)):undefined}var pull=baseRest(pullAll);function pullAll(array,values){return array&&array.length&&values&&values.length?basePullAll(array,values):array}function pullAllBy(array,values,iteratee){return array&&array.length&&values&&values.length?basePullAll(array,values,getIteratee(iteratee,2)):array}function pullAllWith(array,values,comparator){return array&&array.length&&values&&values.length?basePullAll(array,values,undefined,comparator):array}var pullAt=flatRest(function(array,indexes){var length=array==null?0:array.length,result=baseAt(array,indexes);basePullAt(array,arrayMap(indexes,function(index){return isIndex(index,length)?+index:index}).sort(compareAscending));return result});function remove(array,predicate){var result=[];if(!(array&&array.length)){return result}var index=-1,indexes=[],length=array.length;predicate=getIteratee(predicate,3);while(++index<length){var value=array[index];if(predicate(value,index,array)){result.push(value);indexes.push(index)}}basePullAt(array,indexes);return result}function reverse(array){return array==null?array:nativeReverse.call(array)}function slice(array,start,end){var length=array==null?0:array.length;if(!length){return[]}if(end&&typeof end!="number"&&isIterateeCall(array,start,end)){start=0;end=length}else{start=start==null?0:toInteger(start);end=end===undefined?length:toInteger(end)}return baseSlice(array,start,end)}function sortedIndex(array,value){return baseSortedIndex(array,value)}function sortedIndexBy(array,value,iteratee){return baseSortedIndexBy(array,value,getIteratee(iteratee,2))}function sortedIndexOf(array,value){var length=array==null?0:array.length;if(length){var index=baseSortedIndex(array,value);if(index<length&&eq(array[index],value)){return index}}return-1}function sortedLastIndex(array,value){return baseSortedIndex(array,value,true)}function sortedLastIndexBy(array,value,iteratee){return baseSortedIndexBy(array,value,getIteratee(iteratee,2),true)}function sortedLastIndexOf(array,value){var length=array==null?0:array.length;if(length){var index=baseSortedIndex(array,value,true)-1;if(eq(array[index],value)){return index}}return-1}function sortedUniq(array){return array&&array.length?baseSortedUniq(array):[]}function sortedUniqBy(array,iteratee){return array&&array.length?baseSortedUniq(array,getIteratee(iteratee,2)):[]}function tail(array){var length=array==null?0:array.length;return length?baseSlice(array,1,length):[]}function take(array,n,guard){if(!(array&&array.length)){return[]}n=guard||n===undefined?1:toInteger(n);return baseSlice(array,0,n<0?0:n)}function takeRight(array,n,guard){var length=array==null?0:array.length;if(!length){return[]}n=guard||n===undefined?1:toInteger(n);n=length-n;return baseSlice(array,n<0?0:n,length)}function takeRightWhile(array,predicate){return array&&array.length?baseWhile(array,getIteratee(predicate,3),false,true):[]}function takeWhile(array,predicate){return array&&array.length?baseWhile(array,getIteratee(predicate,3)):[]}var union=baseRest(function(arrays){return baseUniq(baseFlatten(arrays,1,isArrayLikeObject,true))});var unionBy=baseRest(function(arrays){var iteratee=last(arrays);if(isArrayLikeObject(iteratee)){iteratee=undefined}return baseUniq(baseFlatten(arrays,1,isArrayLikeObject,true),getIteratee(iteratee,2))});var unionWith=baseRest(function(arrays){var comparator=last(arrays);comparator=typeof comparator=="function"?comparator:undefined;return baseUniq(baseFlatten(arrays,1,isArrayLikeObject,true),undefined,comparator)});function uniq(array){return array&&array.length?baseUniq(array):[]}function uniqBy(array,iteratee){return array&&array.length?baseUniq(array,getIteratee(iteratee,2)):[]}function uniqWith(array,comparator){comparator=typeof comparator=="function"?comparator:undefined;return array&&array.length?baseUniq(array,undefined,comparator):[]}function unzip(array){if(!(array&&array.length)){return[]}var length=0;array=arrayFilter(array,function(group){if(isArrayLikeObject(group)){length=nativeMax(group.length,length);return true}});return baseTimes(length,function(index){return arrayMap(array,baseProperty(index))})}function unzipWith(array,iteratee){if(!(array&&array.length)){return[]}var result=unzip(array);if(iteratee==null){return result}return arrayMap(result,function(group){return apply(iteratee,undefined,group)})}var without=baseRest(function(array,values){return isArrayLikeObject(array)?baseDifference(array,values):[]});var xor=baseRest(function(arrays){return baseXor(arrayFilter(arrays,isArrayLikeObject))});var xorBy=baseRest(function(arrays){var iteratee=last(arrays);if(isArrayLikeObject(iteratee)){iteratee=undefined}return baseXor(arrayFilter(arrays,isArrayLikeObject),getIteratee(iteratee,2))});var xorWith=baseRest(function(arrays){var comparator=last(arrays);comparator=typeof comparator=="function"?comparator:undefined;return baseXor(arrayFilter(arrays,isArrayLikeObject),undefined,comparator)});var zip=baseRest(unzip);function zipObject(props,values){return baseZipObject(props||[],values||[],assignValue)}function zipObjectDeep(props,values){return baseZipObject(props||[],values||[],baseSet)}var zipWith=baseRest(function(arrays){var length=arrays.length,iteratee=length>1?arrays[length-1]:undefined;iteratee=typeof iteratee=="function"?(arrays.pop(),iteratee):undefined;return unzipWith(arrays,iteratee)});function chain(value){var result=lodash(value);result.__chain__=true;return result}function tap(value,interceptor){interceptor(value);return value}function thru(value,interceptor){return interceptor(value)}var wrapperAt=flatRest(function(paths){var length=paths.length,start=length?paths[0]:0,value=this.__wrapped__,interceptor=function(object){return baseAt(object,paths)};if(length>1||this.__actions__.length||!(value instanceof LazyWrapper)||!isIndex(start)){return this.thru(interceptor)}value=value.slice(start,+start+(length?1:0));value.__actions__.push({func:thru,args:[interceptor],thisArg:undefined});return new LodashWrapper(value,this.__chain__).thru(function(array){if(length&&!array.length){array.push(undefined)}return array})});function wrapperChain(){return chain(this)}function wrapperCommit(){return new LodashWrapper(this.value(),this.__chain__)}function wrapperNext(){if(this.__values__===undefined){this.__values__=toArray(this.value())}var done=this.__index__>=this.__values__.length,value=done?undefined:this.__values__[this.__index__++];return{done:done,value:value}}function wrapperToIterator(){return this}function wrapperPlant(value){var result,parent=this;while(parent instanceof baseLodash){var clone=wrapperClone(parent);clone.__index__=0;clone.__values__=undefined;if(result){previous.__wrapped__=clone}else{result=clone}var previous=clone;parent=parent.__wrapped__}previous.__wrapped__=value;return result}function wrapperReverse(){var value=this.__wrapped__;if(value instanceof LazyWrapper){var wrapped=value;if(this.__actions__.length){wrapped=new LazyWrapper(this)}wrapped=wrapped.reverse();wrapped.__actions__.push({func:thru,args:[reverse],thisArg:undefined});return new LodashWrapper(wrapped,this.__chain__)}return this.thru(reverse)}function wrapperValue(){return baseWrapperValue(this.__wrapped__,this.__actions__)}var countBy=createAggregator(function(result,value,key){if(hasOwnProperty.call(result,key)){++result[key]}else{baseAssignValue(result,key,1)}});function every(collection,predicate,guard){var func=isArray(collection)?arrayEvery:baseEvery;if(guard&&isIterateeCall(collection,predicate,guard)){predicate=undefined}return func(collection,getIteratee(predicate,3))}function filter(collection,predicate){var func=isArray(collection)?arrayFilter:baseFilter;return func(collection,getIteratee(predicate,3))}var find=createFind(findIndex);var findLast=createFind(findLastIndex);function flatMap(collection,iteratee){return baseFlatten(map(collection,iteratee),1)}function flatMapDeep(collection,iteratee){return baseFlatten(map(collection,iteratee),INFINITY)}function flatMapDepth(collection,iteratee,depth){depth=depth===undefined?1:toInteger(depth);return baseFlatten(map(collection,iteratee),depth)}function forEach(collection,iteratee){var func=isArray(collection)?arrayEach:baseEach;return func(collection,getIteratee(iteratee,3))}function forEachRight(collection,iteratee){var func=isArray(collection)?arrayEachRight:baseEachRight;return func(collection,getIteratee(iteratee,3))}var groupBy=createAggregator(function(result,value,key){if(hasOwnProperty.call(result,key)){result[key].push(value)}else{baseAssignValue(result,key,[value])}});function includes(collection,value,fromIndex,guard){collection=isArrayLike(collection)?collection:values(collection);fromIndex=fromIndex&&!guard?toInteger(fromIndex):0;var length=collection.length;if(fromIndex<0){fromIndex=nativeMax(length+fromIndex,0)}return isString(collection)?fromIndex<=length&&collection.indexOf(value,fromIndex)>-1:!!length&&baseIndexOf(collection,value,fromIndex)>-1}var invokeMap=baseRest(function(collection,path,args){var index=-1,isFunc=typeof path=="function",result=isArrayLike(collection)?Array(collection.length):[];baseEach(collection,function(value){result[++index]=isFunc?apply(path,value,args):baseInvoke(value,path,args)});return result});var keyBy=createAggregator(function(result,value,key){baseAssignValue(result,key,value)});function map(collection,iteratee){var func=isArray(collection)?arrayMap:baseMap;return func(collection,getIteratee(iteratee,3))}function orderBy(collection,iteratees,orders,guard){if(collection==null){return[]}if(!isArray(iteratees)){iteratees=iteratees==null?[]:[iteratees]}orders=guard?undefined:orders;if(!isArray(orders)){orders=orders==null?[]:[orders]}return baseOrderBy(collection,iteratees,orders)}var partition=createAggregator(function(result,value,key){result[key?0:1].push(value)},function(){return[[],[]]});function reduce(collection,iteratee,accumulator){var func=isArray(collection)?arrayReduce:baseReduce,initAccum=arguments.length<3;return func(collection,getIteratee(iteratee,4),accumulator,initAccum,baseEach)}function reduceRight(collection,iteratee,accumulator){var func=isArray(collection)?arrayReduceRight:baseReduce,initAccum=arguments.length<3;return func(collection,getIteratee(iteratee,4),accumulator,initAccum,baseEachRight)}function reject(collection,predicate){var func=isArray(collection)?arrayFilter:baseFilter;return func(collection,negate(getIteratee(predicate,3)))}function sample(collection){var func=isArray(collection)?arraySample:baseSample;return func(collection)}function sampleSize(collection,n,guard){if(guard?isIterateeCall(collection,n,guard):n===undefined){n=1}else{n=toInteger(n)}var func=isArray(collection)?arraySampleSize:baseSampleSize;return func(collection,n)}function shuffle(collection){var func=isArray(collection)?arrayShuffle:baseShuffle;return func(collection)}function size(collection){if(collection==null){return 0}if(isArrayLike(collection)){return isString(collection)?stringSize(collection):collection.length}var tag=getTag(collection);if(tag==mapTag||tag==setTag){return collection.size}return baseKeys(collection).length}function some(collection,predicate,guard){var func=isArray(collection)?arraySome:baseSome;if(guard&&isIterateeCall(collection,predicate,guard)){predicate=undefined}return func(collection,getIteratee(predicate,3))}var sortBy=baseRest(function(collection,iteratees){if(collection==null){return[]}var length=iteratees.length;if(length>1&&isIterateeCall(collection,iteratees[0],iteratees[1])){iteratees=[]}else if(length>2&&isIterateeCall(iteratees[0],iteratees[1],iteratees[2])){iteratees=[iteratees[0]]}return baseOrderBy(collection,baseFlatten(iteratees,1),[])});var now=ctxNow||function(){return root.Date.now()};function after(n,func){if(typeof func!="function"){throw new TypeError(FUNC_ERROR_TEXT)}n=toInteger(n);return function(){if(--n<1){return func.apply(this,arguments)}}}function ary(func,n,guard){n=guard?undefined:n;n=func&&n==null?func.length:n;return createWrap(func,WRAP_ARY_FLAG,undefined,undefined,undefined,undefined,n)}function before(n,func){var result;if(typeof func!="function"){throw new TypeError(FUNC_ERROR_TEXT)}n=toInteger(n);return function(){if(--n>0){result=func.apply(this,arguments)}if(n<=1){func=undefined}return result}}var bind=baseRest(function(func,thisArg,partials){var bitmask=WRAP_BIND_FLAG;if(partials.length){var holders=replaceHolders(partials,getHolder(bind));bitmask|=WRAP_PARTIAL_FLAG}return createWrap(func,bitmask,thisArg,partials,holders)});var bindKey=baseRest(function(object,key,partials){var bitmask=WRAP_BIND_FLAG|WRAP_BIND_KEY_FLAG;if(partials.length){var holders=replaceHolders(partials,getHolder(bindKey));bitmask|=WRAP_PARTIAL_FLAG}return createWrap(key,bitmask,object,partials,holders)});function curry(func,arity,guard){arity=guard?undefined:arity;var result=createWrap(func,WRAP_CURRY_FLAG,undefined,undefined,undefined,undefined,undefined,arity);result.placeholder=curry.placeholder;return result}function curryRight(func,arity,guard){arity=guard?undefined:arity;var result=createWrap(func,WRAP_CURRY_RIGHT_FLAG,undefined,undefined,undefined,undefined,undefined,arity);result.placeholder=curryRight.placeholder;return result}function debounce(func,wait,options){var lastArgs,lastThis,maxWait,result,timerId,lastCallTime,lastInvokeTime=0,leading=false,maxing=false,trailing=true;if(typeof func!="function"){throw new TypeError(FUNC_ERROR_TEXT)}wait=toNumber(wait)||0;if(isObject(options)){leading=!!options.leading;maxing="maxWait"in options;maxWait=maxing?nativeMax(toNumber(options.maxWait)||0,wait):maxWait;trailing="trailing"in options?!!options.trailing:trailing}function invokeFunc(time){var args=lastArgs,thisArg=lastThis;lastArgs=lastThis=undefined;lastInvokeTime=time;result=func.apply(thisArg,args);return result}function leadingEdge(time){lastInvokeTime=time;timerId=setTimeout(timerExpired,wait);return leading?invokeFunc(time):result}function remainingWait(time){var timeSinceLastCall=time-lastCallTime,timeSinceLastInvoke=time-lastInvokeTime,timeWaiting=wait-timeSinceLastCall;return maxing?nativeMin(timeWaiting,maxWait-timeSinceLastInvoke):timeWaiting}function shouldInvoke(time){var timeSinceLastCall=time-lastCallTime,timeSinceLastInvoke=time-lastInvokeTime;return lastCallTime===undefined||timeSinceLastCall>=wait||timeSinceLastCall<0||maxing&&timeSinceLastInvoke>=maxWait}function timerExpired(){var time=now();if(shouldInvoke(time)){return trailingEdge(time)}timerId=setTimeout(timerExpired,remainingWait(time))}function trailingEdge(time){timerId=undefined;if(trailing&&lastArgs){return invokeFunc(time)}lastArgs=lastThis=undefined;return result}function cancel(){if(timerId!==undefined){clearTimeout(timerId)}lastInvokeTime=0;lastArgs=lastCallTime=lastThis=timerId=undefined}function flush(){return timerId===undefined?result:trailingEdge(now())}function debounced(){var time=now(),isInvoking=shouldInvoke(time);lastArgs=arguments;lastThis=this;lastCallTime=time;if(isInvoking){if(timerId===undefined){return leadingEdge(lastCallTime)}if(maxing){timerId=setTimeout(timerExpired,wait);return invokeFunc(lastCallTime)}}if(timerId===undefined){timerId=setTimeout(timerExpired,wait)}return result}debounced.cancel=cancel;debounced.flush=flush;return debounced}var defer=baseRest(function(func,args){return baseDelay(func,1,args)});var delay=baseRest(function(func,wait,args){return baseDelay(func,toNumber(wait)||0,args)});function flip(func){return createWrap(func,WRAP_FLIP_FLAG)}function memoize(func,resolver){if(typeof func!="function"||resolver!=null&&typeof resolver!="function"){throw new TypeError(FUNC_ERROR_TEXT)}var memoized=function(){var args=arguments,key=resolver?resolver.apply(this,args):args[0],cache=memoized.cache;if(cache.has(key)){return cache.get(key)}var result=func.apply(this,args);memoized.cache=cache.set(key,result)||cache;return result};memoized.cache=new(memoize.Cache||MapCache);return memoized}memoize.Cache=MapCache;function negate(predicate){if(typeof predicate!="function"){throw new TypeError(FUNC_ERROR_TEXT)}return function(){var args=arguments;switch(args.length){case 0:return!predicate.call(this);case 1:return!predicate.call(this,args[0]);case 2:return!predicate.call(this,args[0],args[1]);case 3:return!predicate.call(this,args[0],args[1],args[2])}return!predicate.apply(this,args)}}function once(func){return before(2,func)}var overArgs=castRest(function(func,transforms){transforms=transforms.length==1&&isArray(transforms[0])?arrayMap(transforms[0],baseUnary(getIteratee())):arrayMap(baseFlatten(transforms,1),baseUnary(getIteratee()));var funcsLength=transforms.length;return baseRest(function(args){var index=-1,length=nativeMin(args.length,funcsLength);while(++index<length){args[index]=transforms[index].call(this,args[index])}return apply(func,this,args)})});var partial=baseRest(function(func,partials){var holders=replaceHolders(partials,getHolder(partial));return createWrap(func,WRAP_PARTIAL_FLAG,undefined,partials,holders)});var partialRight=baseRest(function(func,partials){var holders=replaceHolders(partials,getHolder(partialRight));return createWrap(func,WRAP_PARTIAL_RIGHT_FLAG,undefined,partials,holders)});var rearg=flatRest(function(func,indexes){return createWrap(func,WRAP_REARG_FLAG,undefined,undefined,undefined,indexes)});function rest(func,start){if(typeof func!="function"){throw new TypeError(FUNC_ERROR_TEXT)}start=start===undefined?start:toInteger(start);return baseRest(func,start)}function spread(func,start){if(typeof func!="function"){throw new TypeError(FUNC_ERROR_TEXT)}start=start==null?0:nativeMax(toInteger(start),0);return baseRest(function(args){var array=args[start],otherArgs=castSlice(args,0,start);if(array){arrayPush(otherArgs,array)}return apply(func,this,otherArgs)})}function throttle(func,wait,options){var leading=true,trailing=true;if(typeof func!="function"){throw new TypeError(FUNC_ERROR_TEXT)}if(isObject(options)){leading="leading"in options?!!options.leading:leading;trailing="trailing"in options?!!options.trailing:trailing}return debounce(func,wait,{leading:leading,maxWait:wait,trailing:trailing})}function unary(func){return ary(func,1)}function wrap(value,wrapper){return partial(castFunction(wrapper),value)}function castArray(){if(!arguments.length){return[]}var value=arguments[0];return isArray(value)?value:[value]}function clone(value){return baseClone(value,CLONE_SYMBOLS_FLAG)}function cloneWith(value,customizer){customizer=typeof customizer=="function"?customizer:undefined;return baseClone(value,CLONE_SYMBOLS_FLAG,customizer)}function cloneDeep(value){return baseClone(value,CLONE_DEEP_FLAG|CLONE_SYMBOLS_FLAG)}function cloneDeepWith(value,customizer){customizer=typeof customizer=="function"?customizer:undefined;return baseClone(value,CLONE_DEEP_FLAG|CLONE_SYMBOLS_FLAG,customizer)}function conformsTo(object,source){return source==null||baseConformsTo(object,source,keys(source))}function eq(value,other){return value===other||value!==value&&other!==other}var gt=createRelationalOperation(baseGt);var gte=createRelationalOperation(function(value,other){return value>=other});var isArguments=baseIsArguments(function(){return arguments}())?baseIsArguments:function(value){return isObjectLike(value)&&hasOwnProperty.call(value,"callee")&&!propertyIsEnumerable.call(value,"callee")};var isArray=Array.isArray;var isArrayBuffer=nodeIsArrayBuffer?baseUnary(nodeIsArrayBuffer):baseIsArrayBuffer;function isArrayLike(value){return value!=null&&isLength(value.length)&&!isFunction(value)}function isArrayLikeObject(value){return isObjectLike(value)&&isArrayLike(value)}function isBoolean(value){return value===true||value===false||isObjectLike(value)&&baseGetTag(value)==boolTag}var isBuffer=nativeIsBuffer||stubFalse;var isDate=nodeIsDate?baseUnary(nodeIsDate):baseIsDate;function isElement(value){return isObjectLike(value)&&value.nodeType===1&&!isPlainObject(value)}function isEmpty(value){if(value==null){return true}if(isArrayLike(value)&&(isArray(value)||typeof value=="string"||typeof value.splice=="function"||isBuffer(value)||isTypedArray(value)||isArguments(value))){return!value.length}var tag=getTag(value);if(tag==mapTag||tag==setTag){return!value.size}if(isPrototype(value)){return!baseKeys(value).length}for(var key in value){if(hasOwnProperty.call(value,key)){return false}}return true}function isEqual(value,other){return baseIsEqual(value,other)}function isEqualWith(value,other,customizer){customizer=typeof customizer=="function"?customizer:undefined;var result=customizer?customizer(value,other):undefined;return result===undefined?baseIsEqual(value,other,undefined,customizer):!!result}function isError(value){if(!isObjectLike(value)){return false}var tag=baseGetTag(value);return tag==errorTag||tag==domExcTag||typeof value.message=="string"&&typeof value.name=="string"&&!isPlainObject(value)}function isFinite(value){return typeof value=="number"&&nativeIsFinite(value)}function isFunction(value){if(!isObject(value)){return false}var tag=baseGetTag(value);return tag==funcTag||tag==genTag||tag==asyncTag||tag==proxyTag}function isInteger(value){return typeof value=="number"&&value==toInteger(value)}function isLength(value){return typeof value=="number"&&value>-1&&value%1==0&&value<=MAX_SAFE_INTEGER}function isObject(value){var type=typeof value;return value!=null&&(type=="object"||type=="function")}function isObjectLike(value){return value!=null&&typeof value=="object"}var isMap=nodeIsMap?baseUnary(nodeIsMap):baseIsMap;function isMatch(object,source){return object===source||baseIsMatch(object,source,getMatchData(source))}function isMatchWith(object,source,customizer){customizer=typeof customizer=="function"?customizer:undefined;return baseIsMatch(object,source,getMatchData(source),customizer)}function isNaN(value){return isNumber(value)&&value!=+value}function isNative(value){if(isMaskable(value)){throw new Error(CORE_ERROR_TEXT)}return baseIsNative(value)}function isNull(value){return value===null}function isNil(value){return value==null}function isNumber(value){return typeof value=="number"||isObjectLike(value)&&baseGetTag(value)==numberTag}function isPlainObject(value){if(!isObjectLike(value)||baseGetTag(value)!=objectTag){return false}var proto=getPrototype(value);if(proto===null){return true}var Ctor=hasOwnProperty.call(proto,"constructor")&&proto.constructor;return typeof Ctor=="function"&&Ctor instanceof Ctor&&funcToString.call(Ctor)==objectCtorString}var isRegExp=nodeIsRegExp?baseUnary(nodeIsRegExp):baseIsRegExp;function isSafeInteger(value){return isInteger(value)&&value>=-MAX_SAFE_INTEGER&&value<=MAX_SAFE_INTEGER}var isSet=nodeIsSet?baseUnary(nodeIsSet):baseIsSet;function isString(value){return typeof value=="string"||!isArray(value)&&isObjectLike(value)&&baseGetTag(value)==stringTag}function isSymbol(value){return typeof value=="symbol"||isObjectLike(value)&&baseGetTag(value)==symbolTag}var isTypedArray=nodeIsTypedArray?baseUnary(nodeIsTypedArray):baseIsTypedArray;function isUndefined(value){return value===undefined}function isWeakMap(value){return isObjectLike(value)&&getTag(value)==weakMapTag}function isWeakSet(value){return isObjectLike(value)&&baseGetTag(value)==weakSetTag}var lt=createRelationalOperation(baseLt);var lte=createRelationalOperation(function(value,other){return value<=other});function toArray(value){if(!value){return[]}if(isArrayLike(value)){return isString(value)?stringToArray(value):copyArray(value)}if(symIterator&&value[symIterator]){return iteratorToArray(value[symIterator]())}var tag=getTag(value),func=tag==mapTag?mapToArray:tag==setTag?setToArray:values;return func(value)}function toFinite(value){if(!value){return value===0?value:0}value=toNumber(value);if(value===INFINITY||value===-INFINITY){var sign=value<0?-1:1;return sign*MAX_INTEGER}return value===value?value:0}function toInteger(value){var result=toFinite(value),remainder=result%1;return result===result?remainder?result-remainder:result:0}function toLength(value){return value?baseClamp(toInteger(value),0,MAX_ARRAY_LENGTH):0}function toNumber(value){if(typeof value=="number"){return value}if(isSymbol(value)){return NAN}if(isObject(value)){var other=typeof value.valueOf=="function"?value.valueOf():value;value=isObject(other)?other+"":other}if(typeof value!="string"){return value===0?value:+value}value=value.replace(reTrim,"");var isBinary=reIsBinary.test(value);return isBinary||reIsOctal.test(value)?freeParseInt(value.slice(2),isBinary?2:8):reIsBadHex.test(value)?NAN:+value}function toPlainObject(value){return copyObject(value,keysIn(value))}function toSafeInteger(value){return value?baseClamp(toInteger(value),-MAX_SAFE_INTEGER,MAX_SAFE_INTEGER):value===0?value:0}function toString(value){return value==null?"":baseToString(value)}var assign=createAssigner(function(object,source){if(isPrototype(source)||isArrayLike(source)){copyObject(source,keys(source),object);return}for(var key in source){if(hasOwnProperty.call(source,key)){assignValue(object,key,source[key])}}});var assignIn=createAssigner(function(object,source){copyObject(source,keysIn(source),object)});var assignInWith=createAssigner(function(object,source,srcIndex,customizer){copyObject(source,keysIn(source),object,customizer)});var assignWith=createAssigner(function(object,source,srcIndex,customizer){copyObject(source,keys(source),object,customizer)});var at=flatRest(baseAt);function create(prototype,properties){var result=baseCreate(prototype);return properties==null?result:baseAssign(result,properties)}var defaults=baseRest(function(object,sources){object=Object(object);var index=-1;var length=sources.length;var guard=length>2?sources[2]:undefined;if(guard&&isIterateeCall(sources[0],sources[1],guard)){length=1}while(++index<length){var source=sources[index];var props=keysIn(source);var propsIndex=-1;var propsLength=props.length;while(++propsIndex<propsLength){var key=props[propsIndex];var value=object[key];if(value===undefined||eq(value,objectProto[key])&&!hasOwnProperty.call(object,key)){object[key]=source[key]}}}return object});var defaultsDeep=baseRest(function(args){args.push(undefined,customDefaultsMerge);return apply(mergeWith,undefined,args)});function findKey(object,predicate){return baseFindKey(object,getIteratee(predicate,3),baseForOwn)}function findLastKey(object,predicate){return baseFindKey(object,getIteratee(predicate,3),baseForOwnRight)}function forIn(object,iteratee){return object==null?object:baseFor(object,getIteratee(iteratee,3),keysIn)}function forInRight(object,iteratee){return object==null?object:baseForRight(object,getIteratee(iteratee,3),keysIn)}function forOwn(object,iteratee){return object&&baseForOwn(object,getIteratee(iteratee,3))}function forOwnRight(object,iteratee){return object&&baseForOwnRight(object,getIteratee(iteratee,3))}function functions(object){return object==null?[]:baseFunctions(object,keys(object))}function functionsIn(object){return object==null?[]:baseFunctions(object,keysIn(object))}function get(object,path,defaultValue){var result=object==null?undefined:baseGet(object,path);return result===undefined?defaultValue:result}function has(object,path){return object!=null&&hasPath(object,path,baseHas)}function hasIn(object,path){return object!=null&&hasPath(object,path,baseHasIn)}var invert=createInverter(function(result,value,key){if(value!=null&&typeof value.toString!="function"){value=nativeObjectToString.call(value)}result[value]=key},constant(identity));var invertBy=createInverter(function(result,value,key){if(value!=null&&typeof value.toString!="function"){value=nativeObjectToString.call(value)}if(hasOwnProperty.call(result,value)){result[value].push(key)}else{result[value]=[key]}},getIteratee);var invoke=baseRest(baseInvoke);function keys(object){return isArrayLike(object)?arrayLikeKeys(object):baseKeys(object)}function keysIn(object){return isArrayLike(object)?arrayLikeKeys(object,true):baseKeysIn(object)}function mapKeys(object,iteratee){var result={};iteratee=getIteratee(iteratee,3);baseForOwn(object,function(value,key,object){baseAssignValue(result,iteratee(value,key,object),value)});return result}function mapValues(object,iteratee){var result={};iteratee=getIteratee(iteratee,3);baseForOwn(object,function(value,key,object){baseAssignValue(result,key,iteratee(value,key,object))});return result}var merge=createAssigner(function(object,source,srcIndex){baseMerge(object,source,srcIndex)});var mergeWith=createAssigner(function(object,source,srcIndex,customizer){baseMerge(object,source,srcIndex,customizer)});var omit=flatRest(function(object,paths){var result={};if(object==null){return result}var isDeep=false;paths=arrayMap(paths,function(path){path=castPath(path,object);isDeep||(isDeep=path.length>1);return path});copyObject(object,getAllKeysIn(object),result);if(isDeep){result=baseClone(result,CLONE_DEEP_FLAG|CLONE_FLAT_FLAG|CLONE_SYMBOLS_FLAG,customOmitClone)}var length=paths.length;while(length--){baseUnset(result,paths[length])}return result});function omitBy(object,predicate){return pickBy(object,negate(getIteratee(predicate)))}var pick=flatRest(function(object,paths){return object==null?{}:basePick(object,paths)});function pickBy(object,predicate){if(object==null){return{}}var props=arrayMap(getAllKeysIn(object),function(prop){return[prop]});predicate=getIteratee(predicate);return basePickBy(object,props,function(value,path){return predicate(value,path[0])})}function result(object,path,defaultValue){path=castPath(path,object);var index=-1,length=path.length;if(!length){length=1;object=undefined}while(++index<length){var value=object==null?undefined:object[toKey(path[index])];if(value===undefined){index=length;value=defaultValue}object=isFunction(value)?value.call(object):value}return object}function set(object,path,value){return object==null?object:baseSet(object,path,value)}function setWith(object,path,value,customizer){customizer=typeof customizer=="function"?customizer:undefined;return object==null?object:baseSet(object,path,value,customizer)}var toPairs=createToPairs(keys);var toPairsIn=createToPairs(keysIn);function transform(object,iteratee,accumulator){var isArr=isArray(object),isArrLike=isArr||isBuffer(object)||isTypedArray(object);iteratee=getIteratee(iteratee,4);if(accumulator==null){var Ctor=object&&object.constructor;if(isArrLike){accumulator=isArr?new Ctor:[]}else if(isObject(object)){accumulator=isFunction(Ctor)?baseCreate(getPrototype(object)):{}}else{accumulator={}}}(isArrLike?arrayEach:baseForOwn)(object,function(value,index,object){return iteratee(accumulator,value,index,object)});return accumulator}function unset(object,path){return object==null?true:baseUnset(object,path)}function update(object,path,updater){return object==null?object:baseUpdate(object,path,castFunction(updater))}function updateWith(object,path,updater,customizer){customizer=typeof customizer=="function"?customizer:undefined;return object==null?object:baseUpdate(object,path,castFunction(updater),customizer)}function values(object){return object==null?[]:baseValues(object,keys(object))}function valuesIn(object){return object==null?[]:baseValues(object,keysIn(object))}function clamp(number,lower,upper){if(upper===undefined){upper=lower;lower=undefined}if(upper!==undefined){upper=toNumber(upper);upper=upper===upper?upper:0}if(lower!==undefined){lower=toNumber(lower);lower=lower===lower?lower:0}return baseClamp(toNumber(number),lower,upper)}function inRange(number,start,end){start=toFinite(start);if(end===undefined){end=start;start=0}else{end=toFinite(end)}number=toNumber(number);return baseInRange(number,start,end)}function random(lower,upper,floating){if(floating&&typeof floating!="boolean"&&isIterateeCall(lower,upper,floating)){upper=floating=undefined}if(floating===undefined){if(typeof upper=="boolean"){floating=upper;upper=undefined}else if(typeof lower=="boolean"){floating=lower;lower=undefined}}if(lower===undefined&&upper===undefined){lower=0;upper=1}else{lower=toFinite(lower);if(upper===undefined){upper=lower;lower=0}else{upper=toFinite(upper)}}if(lower>upper){var temp=lower;lower=upper;upper=temp}if(floating||lower%1||upper%1){var rand=nativeRandom();return nativeMin(lower+rand*(upper-lower+freeParseFloat("1e-"+((rand+"").length-1))),upper)}return baseRandom(lower,upper)}var camelCase=createCompounder(function(result,word,index){word=word.toLowerCase();return result+(index?capitalize(word):word)});function capitalize(string){return upperFirst(toString(string).toLowerCase())}function deburr(string){string=toString(string);return string&&string.replace(reLatin,deburrLetter).replace(reComboMark,"")}function endsWith(string,target,position){string=toString(string);target=baseToString(target);var length=string.length;position=position===undefined?length:baseClamp(toInteger(position),0,length);var end=position;position-=target.length;return position>=0&&string.slice(position,end)==target}function escape(string){string=toString(string);return string&&reHasUnescapedHtml.test(string)?string.replace(reUnescapedHtml,escapeHtmlChar):string}function escapeRegExp(string){string=toString(string);return string&&reHasRegExpChar.test(string)?string.replace(reRegExpChar,"\\$&"):string}var kebabCase=createCompounder(function(result,word,index){return result+(index?"-":"")+word.toLowerCase()});var lowerCase=createCompounder(function(result,word,index){return result+(index?" ":"")+word.toLowerCase()});var lowerFirst=createCaseFirst("toLowerCase");function pad(string,length,chars){string=toString(string);length=toInteger(length);var strLength=length?stringSize(string):0;if(!length||strLength>=length){return string}var mid=(length-strLength)/2;return createPadding(nativeFloor(mid),chars)+string+createPadding(nativeCeil(mid),chars)}function padEnd(string,length,chars){string=toString(string);length=toInteger(length);var strLength=length?stringSize(string):0;return length&&strLength<length?string+createPadding(length-strLength,chars):string}function padStart(string,length,chars){string=toString(string);length=toInteger(length);var strLength=length?stringSize(string):0;return length&&strLength<length?createPadding(length-strLength,chars)+string:string}function parseInt(string,radix,guard){if(guard||radix==null){radix=0}else if(radix){radix=+radix}return nativeParseInt(toString(string).replace(reTrimStart,""),radix||0)}function repeat(string,n,guard){if(guard?isIterateeCall(string,n,guard):n===undefined){n=1}else{n=toInteger(n)}return baseRepeat(toString(string),n)}function replace(){var args=arguments,string=toString(args[0]);return args.length<3?string:string.replace(args[1],args[2])}var snakeCase=createCompounder(function(result,word,index){return result+(index?"_":"")+word.toLowerCase()});function split(string,separator,limit){if(limit&&typeof limit!="number"&&isIterateeCall(string,separator,limit)){separator=limit=undefined}limit=limit===undefined?MAX_ARRAY_LENGTH:limit>>>0;if(!limit){return[]}string=toString(string);if(string&&(typeof separator=="string"||separator!=null&&!isRegExp(separator))){separator=baseToString(separator);if(!separator&&hasUnicode(string)){return castSlice(stringToArray(string),0,limit)}}return string.split(separator,limit)}var startCase=createCompounder(function(result,word,index){return result+(index?" ":"")+upperFirst(word)});function startsWith(string,target,position){string=toString(string);position=position==null?0:baseClamp(toInteger(position),0,string.length);target=baseToString(target);return string.slice(position,position+target.length)==target}function template(string,options,guard){var settings=lodash.templateSettings;if(guard&&isIterateeCall(string,options,guard)){options=undefined}string=toString(string);options=assignInWith({},options,settings,customDefaultsAssignIn);var imports=assignInWith({},options.imports,settings.imports,customDefaultsAssignIn),importsKeys=keys(imports),importsValues=baseValues(imports,importsKeys);var isEscaping,isEvaluating,index=0,interpolate=options.interpolate||reNoMatch,source="__p += '";var reDelimiters=RegExp((options.escape||reNoMatch).source+"|"+interpolate.source+"|"+(interpolate===reInterpolate?reEsTemplate:reNoMatch).source+"|"+(options.evaluate||reNoMatch).source+"|$","g");var sourceURL="//# sourceURL="+("sourceURL"in options?options.sourceURL:"lodash.templateSources["+ ++templateCounter+"]")+"\n";string.replace(reDelimiters,function(match,escapeValue,interpolateValue,esTemplateValue,evaluateValue,offset){interpolateValue||(interpolateValue=esTemplateValue);source+=string.slice(index,offset).replace(reUnescapedString,escapeStringChar);if(escapeValue){isEscaping=true;source+="' +\n__e("+escapeValue+") +\n'"}if(evaluateValue){isEvaluating=true;source+="';\n"+evaluateValue+";\n__p += '"}if(interpolateValue){source+="' +\n((__t = ("+interpolateValue+")) == null ? '' : __t) +\n'"}index=offset+match.length;return match});source+="';\n";var variable=options.variable;if(!variable){source="with (obj) {\n"+source+"\n}\n"}source=(isEvaluating?source.replace(reEmptyStringLeading,""):source).replace(reEmptyStringMiddle,"$1").replace(reEmptyStringTrailing,"$1;");source="function("+(variable||"obj")+") {\n"+(variable?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(isEscaping?", __e = _.escape":"")+(isEvaluating?", __j = Array.prototype.join;\n"+"function print() { __p += __j.call(arguments, '') }\n":";\n")+source+"return __p\n}";var result=attempt(function(){return Function(importsKeys,sourceURL+"return "+source).apply(undefined,importsValues)});result.source=source;if(isError(result)){throw result}return result}function toLower(value){return toString(value).toLowerCase()}function toUpper(value){return toString(value).toUpperCase()}function trim(string,chars,guard){string=toString(string);if(string&&(guard||chars===undefined)){return string.replace(reTrim,"")}if(!string||!(chars=baseToString(chars))){return string}var strSymbols=stringToArray(string),chrSymbols=stringToArray(chars),start=charsStartIndex(strSymbols,chrSymbols),end=charsEndIndex(strSymbols,chrSymbols)+1;return castSlice(strSymbols,start,end).join("")}function trimEnd(string,chars,guard){string=toString(string);if(string&&(guard||chars===undefined)){return string.replace(reTrimEnd,"")}if(!string||!(chars=baseToString(chars))){return string}var strSymbols=stringToArray(string),end=charsEndIndex(strSymbols,stringToArray(chars))+1;return castSlice(strSymbols,0,end).join("")}function trimStart(string,chars,guard){string=toString(string);if(string&&(guard||chars===undefined)){return string.replace(reTrimStart,"")}if(!string||!(chars=baseToString(chars))){return string}var strSymbols=stringToArray(string),start=charsStartIndex(strSymbols,stringToArray(chars));return castSlice(strSymbols,start).join("")}function truncate(string,options){var length=DEFAULT_TRUNC_LENGTH,omission=DEFAULT_TRUNC_OMISSION;if(isObject(options)){var separator="separator"in options?options.separator:separator;length="length"in options?toInteger(options.length):length;omission="omission"in options?baseToString(options.omission):omission}string=toString(string);var strLength=string.length;if(hasUnicode(string)){var strSymbols=stringToArray(string);strLength=strSymbols.length}if(length>=strLength){return string}var end=length-stringSize(omission);if(end<1){return omission}var result=strSymbols?castSlice(strSymbols,0,end).join(""):string.slice(0,end);if(separator===undefined){return result+omission}if(strSymbols){end+=result.length-end}if(isRegExp(separator)){if(string.slice(end).search(separator)){var match,substring=result;if(!separator.global){separator=RegExp(separator.source,toString(reFlags.exec(separator))+"g")}separator.lastIndex=0;while(match=separator.exec(substring)){var newEnd=match.index}result=result.slice(0,newEnd===undefined?end:newEnd)}}else if(string.indexOf(baseToString(separator),end)!=end){var index=result.lastIndexOf(separator);if(index>-1){result=result.slice(0,index)}}return result+omission}function unescape(string){string=toString(string);return string&&reHasEscapedHtml.test(string)?string.replace(reEscapedHtml,unescapeHtmlChar):string}var upperCase=createCompounder(function(result,word,index){return result+(index?" ":"")+word.toUpperCase()});var upperFirst=createCaseFirst("toUpperCase");function words(string,pattern,guard){string=toString(string);pattern=guard?undefined:pattern;if(pattern===undefined){return hasUnicodeWord(string)?unicodeWords(string):asciiWords(string)}return string.match(pattern)||[]}var attempt=baseRest(function(func,args){try{return apply(func,undefined,args)}catch(e){return isError(e)?e:new Error(e)}});var bindAll=flatRest(function(object,methodNames){arrayEach(methodNames,function(key){key=toKey(key);baseAssignValue(object,key,bind(object[key],object))});return object});function cond(pairs){var length=pairs==null?0:pairs.length,toIteratee=getIteratee();pairs=!length?[]:arrayMap(pairs,function(pair){if(typeof pair[1]!="function"){throw new TypeError(FUNC_ERROR_TEXT)}return[toIteratee(pair[0]),pair[1]]});return baseRest(function(args){var index=-1;while(++index<length){var pair=pairs[index];if(apply(pair[0],this,args)){return apply(pair[1],this,args)}}})}function conforms(source){return baseConforms(baseClone(source,CLONE_DEEP_FLAG))}function constant(value){return function(){return value}}function defaultTo(value,defaultValue){return value==null||value!==value?defaultValue:value}var flow=createFlow();var flowRight=createFlow(true);function identity(value){return value}function iteratee(func){return baseIteratee(typeof func=="function"?func:baseClone(func,CLONE_DEEP_FLAG))}function matches(source){return baseMatches(baseClone(source,CLONE_DEEP_FLAG))}function matchesProperty(path,srcValue){return baseMatchesProperty(path,baseClone(srcValue,CLONE_DEEP_FLAG))}var method=baseRest(function(path,args){return function(object){return baseInvoke(object,path,args)}});var methodOf=baseRest(function(object,args){return function(path){return baseInvoke(object,path,args)}});function mixin(object,source,options){var props=keys(source),methodNames=baseFunctions(source,props);if(options==null&&!(isObject(source)&&(methodNames.length||!props.length))){options=source;source=object;object=this;methodNames=baseFunctions(source,keys(source))}var chain=!(isObject(options)&&"chain"in options)||!!options.chain,isFunc=isFunction(object);arrayEach(methodNames,function(methodName){var func=source[methodName];object[methodName]=func;if(isFunc){object.prototype[methodName]=function(){var chainAll=this.__chain__;if(chain||chainAll){var result=object(this.__wrapped__),actions=result.__actions__=copyArray(this.__actions__);actions.push({func:func,args:arguments,thisArg:object});result.__chain__=chainAll;return result}return func.apply(object,arrayPush([this.value()],arguments))}}});return object}function noConflict(){if(root._===this){root._=oldDash}return this}function noop(){}function nthArg(n){n=toInteger(n);return baseRest(function(args){return baseNth(args,n)})}var over=createOver(arrayMap);var overEvery=createOver(arrayEvery);var overSome=createOver(arraySome);function property(path){return isKey(path)?baseProperty(toKey(path)):basePropertyDeep(path)}function propertyOf(object){return function(path){return object==null?undefined:baseGet(object,path)}}var range=createRange();var rangeRight=createRange(true);function stubArray(){return[]}function stubFalse(){return false}function stubObject(){return{}}function stubString(){return""}function stubTrue(){return true}function times(n,iteratee){n=toInteger(n);if(n<1||n>MAX_SAFE_INTEGER){return[]}var index=MAX_ARRAY_LENGTH,length=nativeMin(n,MAX_ARRAY_LENGTH);iteratee=getIteratee(iteratee);n-=MAX_ARRAY_LENGTH;var result=baseTimes(length,iteratee);while(++index<n){iteratee(index)}return result}function toPath(value){if(isArray(value)){return arrayMap(value,toKey)}return isSymbol(value)?[value]:copyArray(stringToPath(toString(value)))}function uniqueId(prefix){var id=++idCounter;return toString(prefix)+id}var add=createMathOperation(function(augend,addend){return augend+addend},0);var ceil=createRound("ceil");var divide=createMathOperation(function(dividend,divisor){return dividend/divisor},1);var floor=createRound("floor");function max(array){return array&&array.length?baseExtremum(array,identity,baseGt):undefined}function maxBy(array,iteratee){return array&&array.length?baseExtremum(array,getIteratee(iteratee,2),baseGt):undefined}function mean(array){return baseMean(array,identity)}function meanBy(array,iteratee){return baseMean(array,getIteratee(iteratee,2))}function min(array){return array&&array.length?baseExtremum(array,identity,baseLt):undefined}function minBy(array,iteratee){return array&&array.length?baseExtremum(array,getIteratee(iteratee,2),baseLt):undefined}var multiply=createMathOperation(function(multiplier,multiplicand){return multiplier*multiplicand},1);var round=createRound("round");var subtract=createMathOperation(function(minuend,subtrahend){return minuend-subtrahend},0);function sum(array){return array&&array.length?baseSum(array,identity):0}function sumBy(array,iteratee){return array&&array.length?baseSum(array,getIteratee(iteratee,2)):0}lodash.after=after;lodash.ary=ary;lodash.assign=assign;lodash.assignIn=assignIn;lodash.assignInWith=assignInWith;lodash.assignWith=assignWith;lodash.at=at;lodash.before=before;lodash.bind=bind;lodash.bindAll=bindAll;lodash.bindKey=bindKey;lodash.castArray=castArray;lodash.chain=chain;lodash.chunk=chunk;lodash.compact=compact;lodash.concat=concat;lodash.cond=cond;lodash.conforms=conforms;lodash.constant=constant;lodash.countBy=countBy;lodash.create=create;lodash.curry=curry;lodash.curryRight=curryRight;lodash.debounce=debounce;lodash.defaults=defaults;lodash.defaultsDeep=defaultsDeep;lodash.defer=defer;lodash.delay=delay;lodash.difference=difference;lodash.differenceBy=differenceBy;lodash.differenceWith=differenceWith;lodash.drop=drop;lodash.dropRight=dropRight;lodash.dropRightWhile=dropRightWhile;lodash.dropWhile=dropWhile;lodash.fill=fill;lodash.filter=filter;lodash.flatMap=flatMap;lodash.flatMapDeep=flatMapDeep;lodash.flatMapDepth=flatMapDepth;lodash.flatten=flatten;lodash.flattenDeep=flattenDeep;lodash.flattenDepth=flattenDepth;lodash.flip=flip;lodash.flow=flow;lodash.flowRight=flowRight;lodash.fromPairs=fromPairs;lodash.functions=functions;lodash.functionsIn=functionsIn;lodash.groupBy=groupBy;lodash.initial=initial;lodash.intersection=intersection;lodash.intersectionBy=intersectionBy;lodash.intersectionWith=intersectionWith;lodash.invert=invert;lodash.invertBy=invertBy;lodash.invokeMap=invokeMap;lodash.iteratee=iteratee;lodash.keyBy=keyBy;lodash.keys=keys;lodash.keysIn=keysIn;lodash.map=map;lodash.mapKeys=mapKeys;lodash.mapValues=mapValues;lodash.matches=matches;lodash.matchesProperty=matchesProperty;lodash.memoize=memoize;lodash.merge=merge;lodash.mergeWith=mergeWith;lodash.method=method;lodash.methodOf=methodOf;lodash.mixin=mixin;lodash.negate=negate;lodash.nthArg=nthArg;lodash.omit=omit;lodash.omitBy=omitBy;lodash.once=once;lodash.orderBy=orderBy;lodash.over=over;lodash.overArgs=overArgs;lodash.overEvery=overEvery;lodash.overSome=overSome;lodash.partial=partial;lodash.partialRight=partialRight;lodash.partition=partition;lodash.pick=pick;lodash.pickBy=pickBy;lodash.property=property;lodash.propertyOf=propertyOf;lodash.pull=pull;lodash.pullAll=pullAll;lodash.pullAllBy=pullAllBy;lodash.pullAllWith=pullAllWith;lodash.pullAt=pullAt;lodash.range=range;lodash.rangeRight=rangeRight;lodash.rearg=rearg;lodash.reject=reject;lodash.remove=remove;lodash.rest=rest;lodash.reverse=reverse;lodash.sampleSize=sampleSize;lodash.set=set;lodash.setWith=setWith;lodash.shuffle=shuffle;lodash.slice=slice;lodash.sortBy=sortBy;lodash.sortedUniq=sortedUniq;lodash.sortedUniqBy=sortedUniqBy;lodash.split=split;lodash.spread=spread;lodash.tail=tail;lodash.take=take;lodash.takeRight=takeRight;lodash.takeRightWhile=takeRightWhile;lodash.takeWhile=takeWhile;lodash.tap=tap;lodash.throttle=throttle;lodash.thru=thru;lodash.toArray=toArray;lodash.toPairs=toPairs;lodash.toPairsIn=toPairsIn;lodash.toPath=toPath;lodash.toPlainObject=toPlainObject;lodash.transform=transform;lodash.unary=unary;lodash.union=union;lodash.unionBy=unionBy;lodash.unionWith=unionWith;lodash.uniq=uniq;lodash.uniqBy=uniqBy;lodash.uniqWith=uniqWith;lodash.unset=unset;lodash.unzip=unzip;lodash.unzipWith=unzipWith;lodash.update=update;lodash.updateWith=updateWith;lodash.values=values;lodash.valuesIn=valuesIn;lodash.without=without;lodash.words=words;lodash.wrap=wrap;lodash.xor=xor;lodash.xorBy=xorBy;lodash.xorWith=xorWith;lodash.zip=zip;lodash.zipObject=zipObject;lodash.zipObjectDeep=zipObjectDeep;lodash.zipWith=zipWith;lodash.entries=toPairs;lodash.entriesIn=toPairsIn;lodash.extend=assignIn;lodash.extendWith=assignInWith;mixin(lodash,lodash);lodash.add=add;lodash.attempt=attempt;lodash.camelCase=camelCase;lodash.capitalize=capitalize;lodash.ceil=ceil;lodash.clamp=clamp;lodash.clone=clone;lodash.cloneDeep=cloneDeep;lodash.cloneDeepWith=cloneDeepWith;lodash.cloneWith=cloneWith;lodash.conformsTo=conformsTo;lodash.deburr=deburr;lodash.defaultTo=defaultTo;lodash.divide=divide;lodash.endsWith=endsWith;lodash.eq=eq;lodash.escape=escape;lodash.escapeRegExp=escapeRegExp;lodash.every=every;lodash.find=find;lodash.findIndex=findIndex;lodash.findKey=findKey;lodash.findLast=findLast;lodash.findLastIndex=findLastIndex;lodash.findLastKey=findLastKey;lodash.floor=floor;lodash.forEach=forEach;lodash.forEachRight=forEachRight;lodash.forIn=forIn;lodash.forInRight=forInRight;lodash.forOwn=forOwn;lodash.forOwnRight=forOwnRight;lodash.get=get;lodash.gt=gt;lodash.gte=gte;lodash.has=has;lodash.hasIn=hasIn;lodash.head=head;lodash.identity=identity;lodash.includes=includes;lodash.indexOf=indexOf;lodash.inRange=inRange;lodash.invoke=invoke;lodash.isArguments=isArguments;lodash.isArray=isArray;lodash.isArrayBuffer=isArrayBuffer;lodash.isArrayLike=isArrayLike;lodash.isArrayLikeObject=isArrayLikeObject;lodash.isBoolean=isBoolean;lodash.isBuffer=isBuffer;lodash.isDate=isDate;lodash.isElement=isElement;lodash.isEmpty=isEmpty;lodash.isEqual=isEqual;lodash.isEqualWith=isEqualWith;lodash.isError=isError;lodash.isFinite=isFinite;lodash.isFunction=isFunction;lodash.isInteger=isInteger;lodash.isLength=isLength;lodash.isMap=isMap;lodash.isMatch=isMatch;lodash.isMatchWith=isMatchWith;lodash.isNaN=isNaN;lodash.isNative=isNative;lodash.isNil=isNil;lodash.isNull=isNull;lodash.isNumber=isNumber;lodash.isObject=isObject;lodash.isObjectLike=isObjectLike;lodash.isPlainObject=isPlainObject;lodash.isRegExp=isRegExp;lodash.isSafeInteger=isSafeInteger;lodash.isSet=isSet;lodash.isString=isString;lodash.isSymbol=isSymbol;lodash.isTypedArray=isTypedArray;lodash.isUndefined=isUndefined;lodash.isWeakMap=isWeakMap;lodash.isWeakSet=isWeakSet;lodash.join=join;lodash.kebabCase=kebabCase;lodash.last=last;lodash.lastIndexOf=lastIndexOf;lodash.lowerCase=lowerCase;lodash.lowerFirst=lowerFirst;lodash.lt=lt;lodash.lte=lte;lodash.max=max;lodash.maxBy=maxBy;lodash.mean=mean;lodash.meanBy=meanBy;lodash.min=min;lodash.minBy=minBy;lodash.stubArray=stubArray;lodash.stubFalse=stubFalse;lodash.stubObject=stubObject;lodash.stubString=stubString;lodash.stubTrue=stubTrue;lodash.multiply=multiply;lodash.nth=nth;lodash.noConflict=noConflict;lodash.noop=noop;lodash.now=now;lodash.pad=pad;lodash.padEnd=padEnd;lodash.padStart=padStart;lodash.parseInt=parseInt;lodash.random=random;lodash.reduce=reduce;lodash.reduceRight=reduceRight;lodash.repeat=repeat;lodash.replace=replace;lodash.result=result;lodash.round=round;lodash.runInContext=runInContext;lodash.sample=sample;lodash.size=size;lodash.snakeCase=snakeCase;lodash.some=some;lodash.sortedIndex=sortedIndex;lodash.sortedIndexBy=sortedIndexBy;lodash.sortedIndexOf=sortedIndexOf;lodash.sortedLastIndex=sortedLastIndex;lodash.sortedLastIndexBy=sortedLastIndexBy;lodash.sortedLastIndexOf=sortedLastIndexOf;lodash.startCase=startCase;lodash.startsWith=startsWith;lodash.subtract=subtract;lodash.sum=sum;lodash.sumBy=sumBy;lodash.template=template;lodash.times=times;lodash.toFinite=toFinite;lodash.toInteger=toInteger;lodash.toLength=toLength;lodash.toLower=toLower;lodash.toNumber=toNumber;lodash.toSafeInteger=toSafeInteger;lodash.toString=toString;lodash.toUpper=toUpper;lodash.trim=trim;lodash.trimEnd=trimEnd;lodash.trimStart=trimStart;lodash.truncate=truncate;lodash.unescape=unescape;lodash.uniqueId=uniqueId;lodash.upperCase=upperCase;lodash.upperFirst=upperFirst;lodash.each=forEach;lodash.eachRight=forEachRight;lodash.first=head;mixin(lodash,function(){var source={};baseForOwn(lodash,function(func,methodName){if(!hasOwnProperty.call(lodash.prototype,methodName)){source[methodName]=func}});return source}(),{chain:false});lodash.VERSION=VERSION;arrayEach(["bind","bindKey","curry","curryRight","partial","partialRight"],function(methodName){lodash[methodName].placeholder=lodash});arrayEach(["drop","take"],function(methodName,index){LazyWrapper.prototype[methodName]=function(n){n=n===undefined?1:nativeMax(toInteger(n),0);var result=this.__filtered__&&!index?new LazyWrapper(this):this.clone();if(result.__filtered__){result.__takeCount__=nativeMin(n,result.__takeCount__)}else{result.__views__.push({size:nativeMin(n,MAX_ARRAY_LENGTH),type:methodName+(result.__dir__<0?"Right":"")})}return result};LazyWrapper.prototype[methodName+"Right"]=function(n){return this.reverse()[methodName](n).reverse()}});arrayEach(["filter","map","takeWhile"],function(methodName,index){var type=index+1,isFilter=type==LAZY_FILTER_FLAG||type==LAZY_WHILE_FLAG;LazyWrapper.prototype[methodName]=function(iteratee){var result=this.clone();result.__iteratees__.push({iteratee:getIteratee(iteratee,3),type:type});result.__filtered__=result.__filtered__||isFilter;return result}});arrayEach(["head","last"],function(methodName,index){var takeName="take"+(index?"Right":"");LazyWrapper.prototype[methodName]=function(){return this[takeName](1).value()[0]}});arrayEach(["initial","tail"],function(methodName,index){var dropName="drop"+(index?"":"Right");LazyWrapper.prototype[methodName]=function(){return this.__filtered__?new LazyWrapper(this):this[dropName](1)}});LazyWrapper.prototype.compact=function(){return this.filter(identity)};LazyWrapper.prototype.find=function(predicate){return this.filter(predicate).head()};LazyWrapper.prototype.findLast=function(predicate){return this.reverse().find(predicate)};LazyWrapper.prototype.invokeMap=baseRest(function(path,args){if(typeof path=="function"){return new LazyWrapper(this)}return this.map(function(value){return baseInvoke(value,path,args)})});LazyWrapper.prototype.reject=function(predicate){return this.filter(negate(getIteratee(predicate)))};LazyWrapper.prototype.slice=function(start,end){start=toInteger(start);var result=this;if(result.__filtered__&&(start>0||end<0)){return new LazyWrapper(result)}if(start<0){result=result.takeRight(-start)}else if(start){result=result.drop(start)}if(end!==undefined){end=toInteger(end);result=end<0?result.dropRight(-end):result.take(end-start)}return result};LazyWrapper.prototype.takeRightWhile=function(predicate){return this.reverse().takeWhile(predicate).reverse()};LazyWrapper.prototype.toArray=function(){return this.take(MAX_ARRAY_LENGTH)};baseForOwn(LazyWrapper.prototype,function(func,methodName){var checkIteratee=/^(?:filter|find|map|reject)|While$/.test(methodName),isTaker=/^(?:head|last)$/.test(methodName),lodashFunc=lodash[isTaker?"take"+(methodName=="last"?"Right":""):methodName],retUnwrapped=isTaker||/^find/.test(methodName);if(!lodashFunc){return}lodash.prototype[methodName]=function(){var value=this.__wrapped__,args=isTaker?[1]:arguments,isLazy=value instanceof LazyWrapper,iteratee=args[0],useLazy=isLazy||isArray(value);var interceptor=function(value){var result=lodashFunc.apply(lodash,arrayPush([value],args));return isTaker&&chainAll?result[0]:result};if(useLazy&&checkIteratee&&typeof iteratee=="function"&&iteratee.length!=1){isLazy=useLazy=false}var chainAll=this.__chain__,isHybrid=!!this.__actions__.length,isUnwrapped=retUnwrapped&&!chainAll,onlyLazy=isLazy&&!isHybrid;if(!retUnwrapped&&useLazy){value=onlyLazy?value:new LazyWrapper(this);var result=func.apply(value,args);result.__actions__.push({func:thru,args:[interceptor],thisArg:undefined});return new LodashWrapper(result,chainAll)}if(isUnwrapped&&onlyLazy){return func.apply(this,args)}result=this.thru(interceptor);return isUnwrapped?isTaker?result.value()[0]:result.value():result}});arrayEach(["pop","push","shift","sort","splice","unshift"],function(methodName){var func=arrayProto[methodName],chainName=/^(?:push|sort|unshift)$/.test(methodName)?"tap":"thru",retUnwrapped=/^(?:pop|shift)$/.test(methodName);lodash.prototype[methodName]=function(){var args=arguments;if(retUnwrapped&&!this.__chain__){var value=this.value();return func.apply(isArray(value)?value:[],args)}return this[chainName](function(value){return func.apply(isArray(value)?value:[],args)})}});baseForOwn(LazyWrapper.prototype,function(func,methodName){var lodashFunc=lodash[methodName];if(lodashFunc){var key=lodashFunc.name+"",names=realNames[key]||(realNames[key]=[]);names.push({name:methodName,func:lodashFunc})}});realNames[createHybrid(undefined,WRAP_BIND_KEY_FLAG).name]=[{name:"wrapper",func:undefined}];LazyWrapper.prototype.clone=lazyClone;LazyWrapper.prototype.reverse=lazyReverse;LazyWrapper.prototype.value=lazyValue;lodash.prototype.at=wrapperAt;lodash.prototype.chain=wrapperChain;lodash.prototype.commit=wrapperCommit;lodash.prototype.next=wrapperNext;lodash.prototype.plant=wrapperPlant;lodash.prototype.reverse=wrapperReverse;lodash.prototype.toJSON=lodash.prototype.valueOf=lodash.prototype.value=wrapperValue;lodash.prototype.first=lodash.prototype.head;if(symIterator){lodash.prototype[symIterator]=wrapperToIterator}return lodash};var _=runInContext();if(typeof define=="function"&&typeof define.amd=="object"&&define.amd){root._=_;define(function(){return _})}else if(freeModule){(freeModule.exports=_)._=_;freeExports._=_}else{root._=_}}).call(this)}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],125:[function(require,module,exports){arguments[4][1][0].apply(exports,arguments)},{dup:1,pseudomap:128,util:254,yallist:150}],126:[function(require,module,exports){(function(global){var performance=global.performance||{};var present=function(){var names=["now","webkitNow","msNow","mozNow","oNow"];while(names.length){var name=names.shift();if(name in performance){return performance[name].bind(performance)}}var dateNow=Date.now||function(){return(new Date).getTime()};var navigationStart=(performance.timing||{}).navigationStart||dateNow();return function(){return dateNow()-navigationStart}}();present.performanceNow=performance.now;present.noConflict=function(){performance.now=present.performanceNow};present.conflict=function(){performance.now=present};present.conflict();module.exports=present}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],127:[function(require,module,exports){module.exports=PriorityQueue;function PriorityQueue(comparator){this._comparator=comparator||PriorityQueue.DEFAULT_COMPARATOR;this._elements=[]}PriorityQueue.DEFAULT_COMPARATOR=function(a,b){if(typeof a==="number"&&typeof b==="number"){return a-b}else{a=a.toString();b=b.toString();if(a==b)return 0;return a>b?1:-1}};PriorityQueue.prototype.isEmpty=function(){return this.size()===0};PriorityQueue.prototype.peek=function(){if(this.isEmpty())throw new Error("PriorityQueue is empty");return this._elements[0]};PriorityQueue.prototype.deq=function(){var first=this.peek();var last=this._elements.pop();var size=this.size();if(size===0)return first;this._elements[0]=last;var current=0;while(current<size){var largest=current;var left=2*current+1;var right=2*current+2;if(left<size&&this._compare(left,largest)>=0){largest=left}if(right<size&&this._compare(right,largest)>=0){largest=right}if(largest===current)break;this._swap(largest,current);current=largest}return first};PriorityQueue.prototype.enq=function(element){var size=this._elements.push(element);var current=size-1;while(current>0){var parent=Math.floor((current-1)/2);if(this._compare(current,parent)<=0)break;this._swap(parent,current);current=parent}return size};PriorityQueue.prototype.size=function(){return this._elements.length};PriorityQueue.prototype.forEach=function(fn){return this._elements.forEach(fn)};PriorityQueue.prototype._compare=function(a,b){return this._comparator(this._elements[a],this._elements[b])};PriorityQueue.prototype._swap=function(a,b){var aux=this._elements[a];this._elements[a]=this._elements[b];this._elements[b]=aux}},{}],128:[function(require,module,exports){arguments[4][3][0].apply(exports,arguments)},{"./pseudomap":129,_process:251,dup:3}],129:[function(require,module,exports){arguments[4][4][0].apply(exports,arguments)},{dup:4}],130:[function(require,module,exports){var alea=require("./lib/alea");var xor128=require("./lib/xor128");var xorwow=require("./lib/xorwow");var xorshift7=require("./lib/xorshift7");var xor4096=require("./lib/xor4096");var tychei=require("./lib/tychei");var sr=require("./seedrandom");sr.alea=alea;sr.xor128=xor128;sr.xorwow=xorwow;sr.xorshift7=xorshift7;sr.xor4096=xor4096;sr.tychei=tychei;module.exports=sr},{"./lib/alea":131,"./lib/tychei":132,"./lib/xor128":133,"./lib/xor4096":134,"./lib/xorshift7":135,"./lib/xorwow":136,"./seedrandom":137}],131:[function(require,module,exports){(function(global,module,define){function Alea(seed){var me=this,mash=Mash();me.next=function(){var t=2091639*me.s0+me.c*2.3283064365386963e-10;me.s0=me.s1;me.s1=me.s2;return me.s2=t-(me.c=t|0)};me.c=1;me.s0=mash(" ");me.s1=mash(" ");me.s2=mash(" ");me.s0-=mash(seed);if(me.s0<0){me.s0+=1}me.s1-=mash(seed);if(me.s1<0){me.s1+=1}me.s2-=mash(seed);if(me.s2<0){me.s2+=1}mash=null}function copy(f,t){t.c=f.c;t.s0=f.s0;t.s1=f.s1;t.s2=f.s2;return t}function impl(seed,opts){var xg=new Alea(seed),state=opts&&opts.state,prng=xg.next;prng.int32=function(){return xg.next()*4294967296|0};prng.double=function(){return prng()+(prng()*2097152|0)*1.1102230246251565e-16};prng.quick=prng;if(state){if(typeof state=="object")copy(state,xg);prng.state=function(){return copy(xg,{})}}return prng}function Mash(){var n=4022871197;var mash=function(data){data=data.toString();for(var i=0;i<data.length;i++){n+=data.charCodeAt(i);var h=.02519603282416938*n;n=h>>>0;h-=n;h*=n;n=h>>>0;h-=n;n+=h*4294967296}return(n>>>0)*2.3283064365386963e-10};return mash}if(module&&module.exports){module.exports=impl}else if(define&&define.amd){define(function(){return impl})}else{this.alea=impl}})(this,typeof module=="object"&&module,typeof define=="function"&&define)},{}],132:[function(require,module,exports){(function(global,module,define){function XorGen(seed){var me=this,strseed="";me.next=function(){var b=me.b,c=me.c,d=me.d,a=me.a;b=b<<25^b>>>7^c;c=c-d|0;d=d<<24^d>>>8^a;a=a-b|0;me.b=b=b<<20^b>>>12^c;me.c=c=c-d|0;me.d=d<<16^c>>>16^a;return me.a=a-b|0};me.a=0;me.b=0;me.c=2654435769|0;me.d=1367130551;if(seed===Math.floor(seed)){me.a=seed/4294967296|0;me.b=seed|0}else{strseed+=seed}for(var k=0;k<strseed.length+20;k++){me.b^=strseed.charCodeAt(k)|0;me.next()}}function copy(f,t){t.a=f.a;t.b=f.b;t.c=f.c;t.d=f.d;return t}function impl(seed,opts){var xg=new XorGen(seed),state=opts&&opts.state,prng=function(){return(xg.next()>>>0)/4294967296};prng.double=function(){do{var top=xg.next()>>>11,bot=(xg.next()>>>0)/4294967296,result=(top+bot)/(1<<21)}while(result===0);return result};prng.int32=xg.next;prng.quick=prng;if(state){if(typeof state=="object")copy(state,xg);prng.state=function(){return copy(xg,{})}}return prng}if(module&&module.exports){module.exports=impl}else if(define&&define.amd){define(function(){return impl})}else{this.tychei=impl}})(this,typeof module=="object"&&module,typeof define=="function"&&define)},{}],133:[function(require,module,exports){(function(global,module,define){function XorGen(seed){var me=this,strseed="";me.x=0;me.y=0;me.z=0;me.w=0;me.next=function(){var t=me.x^me.x<<11;me.x=me.y;me.y=me.z;me.z=me.w;return me.w^=me.w>>>19^t^t>>>8};if(seed===(seed|0)){me.x=seed}else{strseed+=seed}for(var k=0;k<strseed.length+64;k++){me.x^=strseed.charCodeAt(k)|0;me.next()}}function copy(f,t){t.x=f.x;t.y=f.y;t.z=f.z;t.w=f.w;return t}function impl(seed,opts){var xg=new XorGen(seed),state=opts&&opts.state,prng=function(){return(xg.next()>>>0)/4294967296};prng.double=function(){do{var top=xg.next()>>>11,bot=(xg.next()>>>0)/4294967296,result=(top+bot)/(1<<21)}while(result===0);return result};prng.int32=xg.next;prng.quick=prng;if(state){if(typeof state=="object")copy(state,xg);prng.state=function(){return copy(xg,{})}}return prng}if(module&&module.exports){module.exports=impl}else if(define&&define.amd){define(function(){return impl})}else{this.xor128=impl}})(this,typeof module=="object"&&module,typeof define=="function"&&define)},{}],134:[function(require,module,exports){(function(global,module,define){function XorGen(seed){var me=this;me.next=function(){var w=me.w,X=me.X,i=me.i,t,v;me.w=w=w+1640531527|0;v=X[i+34&127];t=X[i=i+1&127];v^=v<<13;t^=t<<17;v^=v>>>15;t^=t>>>12;v=X[i]=v^t;me.i=i;return v+(w^w>>>16)|0};function init(me,seed){var t,v,i,j,w,X=[],limit=128;if(seed===(seed|0)){v=seed;seed=null}else{seed=seed+"\0";v=0;limit=Math.max(limit,seed.length)}for(i=0,j=-32;j<limit;++j){if(seed)v^=seed.charCodeAt((j+32)%seed.length);if(j===0)w=v;v^=v<<10;v^=v>>>15;v^=v<<4;v^=v>>>13;if(j>=0){w=w+1640531527|0;t=X[j&127]^=v+w;i=0==t?i+1:0}}if(i>=128){X[(seed&&seed.length||0)&127]=-1}i=127;for(j=4*128;j>0;--j){v=X[i+34&127];t=X[i=i+1&127];v^=v<<13;t^=t<<17;v^=v>>>15;t^=t>>>12;X[i]=v^t}me.w=w;me.X=X;me.i=i}init(me,seed)}function copy(f,t){t.i=f.i;t.w=f.w;t.X=f.X.slice();return t}function impl(seed,opts){if(seed==null)seed=+new Date;var xg=new XorGen(seed),state=opts&&opts.state,prng=function(){return(xg.next()>>>0)/4294967296};prng.double=function(){do{var top=xg.next()>>>11,bot=(xg.next()>>>0)/4294967296,result=(top+bot)/(1<<21)}while(result===0);return result};prng.int32=xg.next;prng.quick=prng;if(state){if(state.X)copy(state,xg);prng.state=function(){return copy(xg,{})}}return prng}if(module&&module.exports){module.exports=impl}else if(define&&define.amd){define(function(){return impl})}else{this.xor4096=impl}})(this,typeof module=="object"&&module,typeof define=="function"&&define)},{}],135:[function(require,module,exports){(function(global,module,define){function XorGen(seed){var me=this;me.next=function(){var X=me.x,i=me.i,t,v,w;t=X[i];t^=t>>>7;v=t^t<<24;t=X[i+1&7];v^=t^t>>>10;t=X[i+3&7];v^=t^t>>>3;t=X[i+4&7];v^=t^t<<7;t=X[i+7&7];t=t^t<<13;v^=t^t<<9;X[i]=v;me.i=i+1&7;return v};function init(me,seed){var j,w,X=[];if(seed===(seed|0)){w=X[0]=seed}else{seed=""+seed;for(j=0;j<seed.length;++j){X[j&7]=X[j&7]<<15^seed.charCodeAt(j)+X[j+1&7]<<13}}while(X.length<8)X.push(0);for(j=0;j<8&&X[j]===0;++j);if(j==8)w=X[7]=-1;else w=X[j];me.x=X;me.i=0;for(j=256;j>0;--j){me.next()}}init(me,seed)}function copy(f,t){t.x=f.x.slice();t.i=f.i;return t}function impl(seed,opts){if(seed==null)seed=+new Date;var xg=new XorGen(seed),state=opts&&opts.state,prng=function(){return(xg.next()>>>0)/4294967296};prng.double=function(){do{var top=xg.next()>>>11,bot=(xg.next()>>>0)/4294967296,result=(top+bot)/(1<<21)}while(result===0);return result};prng.int32=xg.next;prng.quick=prng;if(state){if(state.x)copy(state,xg);prng.state=function(){return copy(xg,{})}}return prng}if(module&&module.exports){module.exports=impl}else if(define&&define.amd){define(function(){return impl})}else{this.xorshift7=impl}})(this,typeof module=="object"&&module,typeof define=="function"&&define)},{}],136:[function(require,module,exports){(function(global,module,define){function XorGen(seed){var me=this,strseed="";me.next=function(){var t=me.x^me.x>>>2;me.x=me.y;me.y=me.z;me.z=me.w;me.w=me.v;return(me.d=me.d+362437|0)+(me.v=me.v^me.v<<4^(t^t<<1))|0};me.x=0;me.y=0;me.z=0;me.w=0;me.v=0;if(seed===(seed|0)){me.x=seed}else{strseed+=seed}for(var k=0;k<strseed.length+64;k++){me.x^=strseed.charCodeAt(k)|0;if(k==strseed.length){me.d=me.x<<10^me.x>>>4}me.next()}}function copy(f,t){t.x=f.x;t.y=f.y;t.z=f.z;t.w=f.w;t.v=f.v;t.d=f.d;return t}function impl(seed,opts){var xg=new XorGen(seed),state=opts&&opts.state,prng=function(){return(xg.next()>>>0)/4294967296};prng.double=function(){do{var top=xg.next()>>>11,bot=(xg.next()>>>0)/4294967296,result=(top+bot)/(1<<21)}while(result===0);return result};prng.int32=xg.next;prng.quick=prng;if(state){if(typeof state=="object")copy(state,xg);prng.state=function(){return copy(xg,{})}}return prng}if(module&&module.exports){module.exports=impl}else if(define&&define.amd){define(function(){return impl})}else{this.xorwow=impl}})(this,typeof module=="object"&&module,typeof define=="function"&&define)},{}],137:[function(require,module,exports){(function(pool,math){var global=this,width=256,chunks=6,digits=52,rngname="random",startdenom=math.pow(width,chunks),significance=math.pow(2,digits),overflow=significance*2,mask=width-1,nodecrypto;function seedrandom(seed,options,callback){var key=[];options=options==true?{entropy:true}:options||{};var shortseed=mixkey(flatten(options.entropy?[seed,tostring(pool)]:seed==null?autoseed():seed,3),key);var arc4=new ARC4(key);var prng=function(){var n=arc4.g(chunks),d=startdenom,x=0;while(n<significance){n=(n+x)*width;d*=width;x=arc4.g(1)}while(n>=overflow){n/=2;d/=2;x>>>=1}return(n+x)/d};prng.int32=function(){return arc4.g(4)|0};prng.quick=function(){return arc4.g(4)/4294967296};prng.double=prng;mixkey(tostring(arc4.S),pool);return(options.pass||callback||function(prng,seed,is_math_call,state){if(state){if(state.S){copy(state,arc4)}prng.state=function(){return copy(arc4,{})}}if(is_math_call){math[rngname]=prng;return seed}else return prng})(prng,shortseed,"global"in options?options.global:this==math,options.state)}math["seed"+rngname]=seedrandom;function ARC4(key){var t,keylen=key.length,me=this,i=0,j=me.i=me.j=0,s=me.S=[];if(!keylen){key=[keylen++]}while(i<width){s[i]=i++}for(i=0;i<width;i++){s[i]=s[j=mask&j+key[i%keylen]+(t=s[i])];s[j]=t}(me.g=function(count){var t,r=0,i=me.i,j=me.j,s=me.S;while(count--){t=s[i=mask&i+1];r=r*width+s[mask&(s[i]=s[j=mask&j+t])+(s[j]=t)]}me.i=i;me.j=j;return r})(width)}function copy(f,t){t.i=f.i;t.j=f.j;t.S=f.S.slice();return t}function flatten(obj,depth){var result=[],typ=typeof obj,prop;if(depth&&typ=="object"){for(prop in obj){try{result.push(flatten(obj[prop],depth-1))}catch(e){}}}return result.length?result:typ=="string"?obj:obj+"\0"}function mixkey(seed,key){var stringseed=seed+"",smear,j=0;while(j<stringseed.length){key[mask&j]=mask&(smear^=key[mask&j]*19)+stringseed.charCodeAt(j++)}return tostring(key)}function autoseed(){try{var out;if(nodecrypto&&(out=nodecrypto.randomBytes)){out=out(width)}else{out=new Uint8Array(width);(global.crypto||global.msCrypto).getRandomValues(out)}return tostring(out)}catch(e){var browser=global.navigator,plugins=browser&&browser.plugins;return[+new Date,global,plugins,global.screen,tostring(pool)]}}function tostring(a){return String.fromCharCode.apply(0,a)}mixkey(math.random(),pool);if(typeof module=="object"&&module.exports){module.exports=seedrandom;try{nodecrypto=require("crypto")}catch(ex){}}else if(typeof define=="function"&&define.amd){define(function(){return seedrandom})}})([],Math)},{crypto:249}],138:[function(require,module,exports){arguments[4][54][0].apply(exports,arguments)},{"./util":147,dup:54}],139:[function(require,module,exports){arguments[4][55][0].apply(exports,arguments)},{"./base64":140,dup:55}],140:[function(require,module,exports){arguments[4][56][0].apply(exports,arguments)},{dup:56}],141:[function(require,module,exports){arguments[4][57][0].apply(exports,arguments)},{dup:57}],142:[function(require,module,exports){arguments[4][58][0].apply(exports,arguments)},{"./util":147,dup:58}],143:[function(require,module,exports){arguments[4][59][0].apply(exports,arguments)},{dup:59}],144:[function(require,module,exports){var util=require("./util");var binarySearch=require("./binary-search");var ArraySet=require("./array-set").ArraySet;var base64VLQ=require("./base64-vlq");var quickSort=require("./quick-sort").quickSort;function SourceMapConsumer(aSourceMap){var sourceMap=aSourceMap;if(typeof aSourceMap==="string"){sourceMap=JSON.parse(aSourceMap.replace(/^\)\]\}'/,""))}return sourceMap.sections!=null?new IndexedSourceMapConsumer(sourceMap):new BasicSourceMapConsumer(sourceMap)}SourceMapConsumer.fromSourceMap=function(aSourceMap){return BasicSourceMapConsumer.fromSourceMap(aSourceMap)};SourceMapConsumer.prototype._version=3;SourceMapConsumer.prototype.__generatedMappings=null;Object.defineProperty(SourceMapConsumer.prototype,"_generatedMappings",{get:function(){if(!this.__generatedMappings){this._parseMappings(this._mappings,this.sourceRoot)}return this.__generatedMappings}});SourceMapConsumer.prototype.__originalMappings=null;Object.defineProperty(SourceMapConsumer.prototype,"_originalMappings",{get:function(){if(!this.__originalMappings){this._parseMappings(this._mappings,this.sourceRoot)}return this.__originalMappings}});SourceMapConsumer.prototype._charIsMappingSeparator=function SourceMapConsumer_charIsMappingSeparator(aStr,index){var c=aStr.charAt(index);return c===";"||c===","};SourceMapConsumer.prototype._parseMappings=function SourceMapConsumer_parseMappings(aStr,aSourceRoot){throw new Error("Subclasses must implement _parseMappings")};SourceMapConsumer.GENERATED_ORDER=1;SourceMapConsumer.ORIGINAL_ORDER=2;SourceMapConsumer.GREATEST_LOWER_BOUND=1;SourceMapConsumer.LEAST_UPPER_BOUND=2;SourceMapConsumer.prototype.eachMapping=function SourceMapConsumer_eachMapping(aCallback,aContext,aOrder){var context=aContext||null;var order=aOrder||SourceMapConsumer.GENERATED_ORDER;var mappings;switch(order){case SourceMapConsumer.GENERATED_ORDER:mappings=this._generatedMappings;break;case SourceMapConsumer.ORIGINAL_ORDER:mappings=this._originalMappings;break;default:throw new Error("Unknown order of iteration.")}var sourceRoot=this.sourceRoot;mappings.map(function(mapping){var source=mapping.source===null?null:this._sources.at(mapping.source);if(source!=null&&sourceRoot!=null){source=util.join(sourceRoot,source)}return{source:source,generatedLine:mapping.generatedLine,generatedColumn:mapping.generatedColumn,originalLine:mapping.originalLine,originalColumn:mapping.originalColumn,name:mapping.name===null?null:this._names.at(mapping.name)}},this).forEach(aCallback,context)};SourceMapConsumer.prototype.allGeneratedPositionsFor=function SourceMapConsumer_allGeneratedPositionsFor(aArgs){var line=util.getArg(aArgs,"line");var needle={source:util.getArg(aArgs,"source"),originalLine:line,originalColumn:util.getArg(aArgs,"column",0)};if(this.sourceRoot!=null){needle.source=util.relative(this.sourceRoot,needle.source)}if(!this._sources.has(needle.source)){return[]}needle.source=this._sources.indexOf(needle.source);var mappings=[];var index=this._findMapping(needle,this._originalMappings,"originalLine","originalColumn",util.compareByOriginalPositions,binarySearch.LEAST_UPPER_BOUND);if(index>=0){var mapping=this._originalMappings[index];if(aArgs.column===undefined){var originalLine=mapping.originalLine;while(mapping&&mapping.originalLine===originalLine){mappings.push({line:util.getArg(mapping,"generatedLine",null),column:util.getArg(mapping,"generatedColumn",null),lastColumn:util.getArg(mapping,"lastGeneratedColumn",null)});mapping=this._originalMappings[++index]}}else{var originalColumn=mapping.originalColumn;while(mapping&&mapping.originalLine===line&&mapping.originalColumn==originalColumn){mappings.push({line:util.getArg(mapping,"generatedLine",null),column:util.getArg(mapping,"generatedColumn",null),lastColumn:util.getArg(mapping,"lastGeneratedColumn",null)});mapping=this._originalMappings[++index]}}}return mappings};exports.SourceMapConsumer=SourceMapConsumer;function BasicSourceMapConsumer(aSourceMap){var sourceMap=aSourceMap;if(typeof aSourceMap==="string"){sourceMap=JSON.parse(aSourceMap.replace(/^\)\]\}'/,""))}var version=util.getArg(sourceMap,"version");var sources=util.getArg(sourceMap,"sources");var names=util.getArg(sourceMap,"names",[]);var sourceRoot=util.getArg(sourceMap,"sourceRoot",null);var sourcesContent=util.getArg(sourceMap,"sourcesContent",null);var mappings=util.getArg(sourceMap,"mappings");var file=util.getArg(sourceMap,"file",null);if(version!=this._version){throw new Error("Unsupported version: "+version)}sources=sources.map(String).map(util.normalize).map(function(source){return sourceRoot&&util.isAbsolute(sourceRoot)&&util.isAbsolute(source)?util.relative(sourceRoot,source):source});this._names=ArraySet.fromArray(names.map(String),true);this._sources=ArraySet.fromArray(sources,true);this.sourceRoot=sourceRoot;this.sourcesContent=sourcesContent;this._mappings=mappings;this.file=file}BasicSourceMapConsumer.prototype=Object.create(SourceMapConsumer.prototype);BasicSourceMapConsumer.prototype.consumer=SourceMapConsumer;BasicSourceMapConsumer.fromSourceMap=function SourceMapConsumer_fromSourceMap(aSourceMap){var smc=Object.create(BasicSourceMapConsumer.prototype);var names=smc._names=ArraySet.fromArray(aSourceMap._names.toArray(),true);var sources=smc._sources=ArraySet.fromArray(aSourceMap._sources.toArray(),true);smc.sourceRoot=aSourceMap._sourceRoot;smc.sourcesContent=aSourceMap._generateSourcesContent(smc._sources.toArray(),smc.sourceRoot);smc.file=aSourceMap._file;var generatedMappings=aSourceMap._mappings.toArray().slice();var destGeneratedMappings=smc.__generatedMappings=[];var destOriginalMappings=smc.__originalMappings=[];for(var i=0,length=generatedMappings.length;i<length;i++){var srcMapping=generatedMappings[i];var destMapping=new Mapping;destMapping.generatedLine=srcMapping.generatedLine;destMapping.generatedColumn=srcMapping.generatedColumn;if(srcMapping.source){destMapping.source=sources.indexOf(srcMapping.source);destMapping.originalLine=srcMapping.originalLine;destMapping.originalColumn=srcMapping.originalColumn;if(srcMapping.name){destMapping.name=names.indexOf(srcMapping.name)}destOriginalMappings.push(destMapping)}destGeneratedMappings.push(destMapping)}quickSort(smc.__originalMappings,util.compareByOriginalPositions);return smc};BasicSourceMapConsumer.prototype._version=3;Object.defineProperty(BasicSourceMapConsumer.prototype,"sources",{get:function(){return this._sources.toArray().map(function(s){return this.sourceRoot!=null?util.join(this.sourceRoot,s):s},this)}});function Mapping(){this.generatedLine=0;this.generatedColumn=0;this.source=null;this.originalLine=null;this.originalColumn=null;this.name=null}BasicSourceMapConsumer.prototype._parseMappings=function SourceMapConsumer_parseMappings(aStr,aSourceRoot){var generatedLine=1;var previousGeneratedColumn=0;var previousOriginalLine=0;var previousOriginalColumn=0;var previousSource=0;var previousName=0;var length=aStr.length;var index=0;var cachedSegments={};var temp={};var originalMappings=[];var generatedMappings=[];var mapping,str,segment,end,value;while(index<length){if(aStr.charAt(index)===";"){generatedLine++;index++;previousGeneratedColumn=0}else if(aStr.charAt(index)===","){index++}else{mapping=new Mapping;mapping.generatedLine=generatedLine;for(end=index;end<length;end++){if(this._charIsMappingSeparator(aStr,end)){break}}str=aStr.slice(index,end);segment=cachedSegments[str];if(segment){index+=str.length}else{segment=[];while(index<end){base64VLQ.decode(aStr,index,temp);value=temp.value;index=temp.rest;segment.push(value)}if(segment.length===2){throw new Error("Found a source, but no line and column")}if(segment.length===3){throw new Error("Found a source and line, but no column")}cachedSegments[str]=segment}mapping.generatedColumn=previousGeneratedColumn+segment[0];previousGeneratedColumn=mapping.generatedColumn;if(segment.length>1){mapping.source=previousSource+segment[1];previousSource+=segment[1];mapping.originalLine=previousOriginalLine+segment[2];previousOriginalLine=mapping.originalLine;mapping.originalLine+=1;mapping.originalColumn=previousOriginalColumn+segment[3];previousOriginalColumn=mapping.originalColumn;if(segment.length>4){mapping.name=previousName+segment[4];previousName+=segment[4]}}generatedMappings.push(mapping);if(typeof mapping.originalLine==="number"){originalMappings.push(mapping)}}}quickSort(generatedMappings,util.compareByGeneratedPositionsDeflated);this.__generatedMappings=generatedMappings;quickSort(originalMappings,util.compareByOriginalPositions);this.__originalMappings=originalMappings};BasicSourceMapConsumer.prototype._findMapping=function SourceMapConsumer_findMapping(aNeedle,aMappings,aLineName,aColumnName,aComparator,aBias){if(aNeedle[aLineName]<=0){throw new TypeError("Line must be greater than or equal to 1, got "+aNeedle[aLineName])}if(aNeedle[aColumnName]<0){throw new TypeError("Column must be greater than or equal to 0, got "+aNeedle[aColumnName])}return binarySearch.search(aNeedle,aMappings,aComparator,aBias)};BasicSourceMapConsumer.prototype.computeColumnSpans=function SourceMapConsumer_computeColumnSpans(){for(var index=0;index<this._generatedMappings.length;++index){var mapping=this._generatedMappings[index];if(index+1<this._generatedMappings.length){var nextMapping=this._generatedMappings[index+1];if(mapping.generatedLine===nextMapping.generatedLine){mapping.lastGeneratedColumn=nextMapping.generatedColumn-1;continue}}mapping.lastGeneratedColumn=Infinity}};BasicSourceMapConsumer.prototype.originalPositionFor=function SourceMapConsumer_originalPositionFor(aArgs){var needle={generatedLine:util.getArg(aArgs,"line"),generatedColumn:util.getArg(aArgs,"column")};var index=this._findMapping(needle,this._generatedMappings,"generatedLine","generatedColumn",util.compareByGeneratedPositionsDeflated,util.getArg(aArgs,"bias",SourceMapConsumer.GREATEST_LOWER_BOUND));if(index>=0){var mapping=this._generatedMappings[index];if(mapping.generatedLine===needle.generatedLine){var source=util.getArg(mapping,"source",null);if(source!==null){source=this._sources.at(source);if(this.sourceRoot!=null){source=util.join(this.sourceRoot,source)}}var name=util.getArg(mapping,"name",null);if(name!==null){name=this._names.at(name)}return{source:source,line:util.getArg(mapping,"originalLine",null),column:util.getArg(mapping,"originalColumn",null),name:name}}}return{source:null,line:null,column:null,name:null}};BasicSourceMapConsumer.prototype.hasContentsOfAllSources=function BasicSourceMapConsumer_hasContentsOfAllSources(){if(!this.sourcesContent){return false}return this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some(function(sc){return sc==null})};BasicSourceMapConsumer.prototype.sourceContentFor=function SourceMapConsumer_sourceContentFor(aSource,nullOnMissing){if(!this.sourcesContent){return null}if(this.sourceRoot!=null){aSource=util.relative(this.sourceRoot,aSource)}if(this._sources.has(aSource)){return this.sourcesContent[this._sources.indexOf(aSource)]}var url;if(this.sourceRoot!=null&&(url=util.urlParse(this.sourceRoot))){var fileUriAbsPath=aSource.replace(/^file:\/\//,"");if(url.scheme=="file"&&this._sources.has(fileUriAbsPath)){return this.sourcesContent[this._sources.indexOf(fileUriAbsPath)]}if((!url.path||url.path=="/")&&this._sources.has("/"+aSource)){return this.sourcesContent[this._sources.indexOf("/"+aSource)]}}if(nullOnMissing){return null}else{throw new Error('"'+aSource+'" is not in the SourceMap.')}};BasicSourceMapConsumer.prototype.generatedPositionFor=function SourceMapConsumer_generatedPositionFor(aArgs){var source=util.getArg(aArgs,"source");if(this.sourceRoot!=null){source=util.relative(this.sourceRoot,source)}if(!this._sources.has(source)){return{line:null,column:null,lastColumn:null}}source=this._sources.indexOf(source);var needle={source:source,originalLine:util.getArg(aArgs,"line"),originalColumn:util.getArg(aArgs,"column")};var index=this._findMapping(needle,this._originalMappings,"originalLine","originalColumn",util.compareByOriginalPositions,util.getArg(aArgs,"bias",SourceMapConsumer.GREATEST_LOWER_BOUND));if(index>=0){var mapping=this._originalMappings[index];if(mapping.source===needle.source){return{line:util.getArg(mapping,"generatedLine",null),column:util.getArg(mapping,"generatedColumn",null),lastColumn:util.getArg(mapping,"lastGeneratedColumn",null)}}}return{line:null,column:null,lastColumn:null}};exports.BasicSourceMapConsumer=BasicSourceMapConsumer;function IndexedSourceMapConsumer(aSourceMap){var sourceMap=aSourceMap;if(typeof aSourceMap==="string"){sourceMap=JSON.parse(aSourceMap.replace(/^\)\]\}'/,""))}var version=util.getArg(sourceMap,"version");var sections=util.getArg(sourceMap,"sections");if(version!=this._version){throw new Error("Unsupported version: "+version)}this._sources=new ArraySet;this._names=new ArraySet;var lastOffset={line:-1,column:0};this._sections=sections.map(function(s){if(s.url){throw new Error("Support for url field in sections not implemented.")}var offset=util.getArg(s,"offset");var offsetLine=util.getArg(offset,"line");var offsetColumn=util.getArg(offset,"column");if(offsetLine<lastOffset.line||offsetLine===lastOffset.line&&offsetColumn<lastOffset.column){throw new Error("Section offsets must be ordered and non-overlapping.")}lastOffset=offset;return{generatedOffset:{generatedLine:offsetLine+1,generatedColumn:offsetColumn+1},consumer:new SourceMapConsumer(util.getArg(s,"map"))}})}IndexedSourceMapConsumer.prototype=Object.create(SourceMapConsumer.prototype);IndexedSourceMapConsumer.prototype.constructor=SourceMapConsumer;IndexedSourceMapConsumer.prototype._version=3;Object.defineProperty(IndexedSourceMapConsumer.prototype,"sources",{get:function(){var sources=[];for(var i=0;i<this._sections.length;i++){for(var j=0;j<this._sections[i].consumer.sources.length;j++){sources.push(this._sections[i].consumer.sources[j])}}return sources}});IndexedSourceMapConsumer.prototype.originalPositionFor=function IndexedSourceMapConsumer_originalPositionFor(aArgs){var needle={generatedLine:util.getArg(aArgs,"line"),generatedColumn:util.getArg(aArgs,"column")};var sectionIndex=binarySearch.search(needle,this._sections,function(needle,section){var cmp=needle.generatedLine-section.generatedOffset.generatedLine;if(cmp){return cmp}return needle.generatedColumn-section.generatedOffset.generatedColumn});var section=this._sections[sectionIndex];if(!section){return{source:null,line:null,column:null,name:null}}return section.consumer.originalPositionFor({line:needle.generatedLine-(section.generatedOffset.generatedLine-1),column:needle.generatedColumn-(section.generatedOffset.generatedLine===needle.generatedLine?section.generatedOffset.generatedColumn-1:0),bias:aArgs.bias})};IndexedSourceMapConsumer.prototype.hasContentsOfAllSources=function IndexedSourceMapConsumer_hasContentsOfAllSources(){return this._sections.every(function(s){return s.consumer.hasContentsOfAllSources()})};IndexedSourceMapConsumer.prototype.sourceContentFor=function IndexedSourceMapConsumer_sourceContentFor(aSource,nullOnMissing){for(var i=0;i<this._sections.length;i++){var section=this._sections[i];var content=section.consumer.sourceContentFor(aSource,true);if(content){return content}}if(nullOnMissing){return null}else{throw new Error('"'+aSource+'" is not in the SourceMap.')}};IndexedSourceMapConsumer.prototype.generatedPositionFor=function IndexedSourceMapConsumer_generatedPositionFor(aArgs){for(var i=0;i<this._sections.length;i++){var section=this._sections[i];if(section.consumer.sources.indexOf(util.getArg(aArgs,"source"))===-1){continue}var generatedPosition=section.consumer.generatedPositionFor(aArgs);if(generatedPosition){var ret={line:generatedPosition.line+(section.generatedOffset.generatedLine-1),column:generatedPosition.column+(section.generatedOffset.generatedLine===generatedPosition.line?section.generatedOffset.generatedColumn-1:0)};return ret}}return{line:null,column:null}};IndexedSourceMapConsumer.prototype._parseMappings=function IndexedSourceMapConsumer_parseMappings(aStr,aSourceRoot){this.__generatedMappings=[];this.__originalMappings=[];for(var i=0;i<this._sections.length;i++){var section=this._sections[i];var sectionMappings=section.consumer._generatedMappings;for(var j=0;j<sectionMappings.length;j++){var mapping=sectionMappings[j];var source=section.consumer._sources.at(mapping.source);if(section.consumer.sourceRoot!==null){source=util.join(section.consumer.sourceRoot,source)}this._sources.add(source);source=this._sources.indexOf(source);var name=section.consumer._names.at(mapping.name);this._names.add(name);name=this._names.indexOf(name);var adjustedMapping={source:source,generatedLine:mapping.generatedLine+(section.generatedOffset.generatedLine-1),generatedColumn:mapping.generatedColumn+(section.generatedOffset.generatedLine===mapping.generatedLine?section.generatedOffset.generatedColumn-1:0),originalLine:mapping.originalLine,originalColumn:mapping.originalColumn,name:name};this.__generatedMappings.push(adjustedMapping);if(typeof adjustedMapping.originalLine==="number"){this.__originalMappings.push(adjustedMapping)}}}quickSort(this.__generatedMappings,util.compareByGeneratedPositionsDeflated);quickSort(this.__originalMappings,util.compareByOriginalPositions)};exports.IndexedSourceMapConsumer=IndexedSourceMapConsumer},{"./array-set":138,"./base64-vlq":139,"./binary-search":141,"./quick-sort":143,"./util":147}],145:[function(require,module,exports){var base64VLQ=require("./base64-vlq");var util=require("./util");var ArraySet=require("./array-set").ArraySet;var MappingList=require("./mapping-list").MappingList;function SourceMapGenerator(aArgs){if(!aArgs){aArgs={}}this._file=util.getArg(aArgs,"file",null);this._sourceRoot=util.getArg(aArgs,"sourceRoot",null);this._skipValidation=util.getArg(aArgs,"skipValidation",false);this._sources=new ArraySet;this._names=new ArraySet;this._mappings=new MappingList;this._sourcesContents=null}SourceMapGenerator.prototype._version=3;SourceMapGenerator.fromSourceMap=function SourceMapGenerator_fromSourceMap(aSourceMapConsumer){var sourceRoot=aSourceMapConsumer.sourceRoot;var generator=new SourceMapGenerator({file:aSourceMapConsumer.file,sourceRoot:sourceRoot});aSourceMapConsumer.eachMapping(function(mapping){var newMapping={generated:{line:mapping.generatedLine,column:mapping.generatedColumn}};if(mapping.source!=null){newMapping.source=mapping.source;if(sourceRoot!=null){newMapping.source=util.relative(sourceRoot,newMapping.source)}newMapping.original={line:mapping.originalLine,column:mapping.originalColumn};if(mapping.name!=null){newMapping.name=mapping.name}}generator.addMapping(newMapping)});aSourceMapConsumer.sources.forEach(function(sourceFile){var content=aSourceMapConsumer.sourceContentFor(sourceFile);if(content!=null){generator.setSourceContent(sourceFile,content)}});return generator};SourceMapGenerator.prototype.addMapping=function SourceMapGenerator_addMapping(aArgs){var generated=util.getArg(aArgs,"generated");var original=util.getArg(aArgs,"original",null);var source=util.getArg(aArgs,"source",null);var name=util.getArg(aArgs,"name",null);if(!this._skipValidation){this._validateMapping(generated,original,source,name)}if(source!=null){source=String(source);if(!this._sources.has(source)){this._sources.add(source)}}if(name!=null){name=String(name);if(!this._names.has(name)){this._names.add(name)}}this._mappings.add({generatedLine:generated.line,generatedColumn:generated.column,originalLine:original!=null&&original.line,originalColumn:original!=null&&original.column,source:source,name:name})};SourceMapGenerator.prototype.setSourceContent=function SourceMapGenerator_setSourceContent(aSourceFile,aSourceContent){var source=aSourceFile;if(this._sourceRoot!=null){source=util.relative(this._sourceRoot,source)}if(aSourceContent!=null){if(!this._sourcesContents){this._sourcesContents=Object.create(null)}this._sourcesContents[util.toSetString(source)]=aSourceContent}else if(this._sourcesContents){delete this._sourcesContents[util.toSetString(source)];if(Object.keys(this._sourcesContents).length===0){this._sourcesContents=null}}};SourceMapGenerator.prototype.applySourceMap=function SourceMapGenerator_applySourceMap(aSourceMapConsumer,aSourceFile,aSourceMapPath){var sourceFile=aSourceFile;if(aSourceFile==null){if(aSourceMapConsumer.file==null){throw new Error("SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, "+'or the source map\'s "file" property. Both were omitted.')}sourceFile=aSourceMapConsumer.file}var sourceRoot=this._sourceRoot;if(sourceRoot!=null){sourceFile=util.relative(sourceRoot,sourceFile)}var newSources=new ArraySet;var newNames=new ArraySet;this._mappings.unsortedForEach(function(mapping){if(mapping.source===sourceFile&&mapping.originalLine!=null){var original=aSourceMapConsumer.originalPositionFor({line:mapping.originalLine,column:mapping.originalColumn});if(original.source!=null){mapping.source=original.source;if(aSourceMapPath!=null){mapping.source=util.join(aSourceMapPath,mapping.source)}if(sourceRoot!=null){mapping.source=util.relative(sourceRoot,mapping.source)}mapping.originalLine=original.line;mapping.originalColumn=original.column;if(original.name!=null){mapping.name=original.name}}}var source=mapping.source;if(source!=null&&!newSources.has(source)){newSources.add(source)}var name=mapping.name;if(name!=null&&!newNames.has(name)){newNames.add(name)}},this);this._sources=newSources;this._names=newNames;aSourceMapConsumer.sources.forEach(function(sourceFile){var content=aSourceMapConsumer.sourceContentFor(sourceFile);if(content!=null){if(aSourceMapPath!=null){sourceFile=util.join(aSourceMapPath,sourceFile)}if(sourceRoot!=null){sourceFile=util.relative(sourceRoot,sourceFile)}this.setSourceContent(sourceFile,content)}},this)};SourceMapGenerator.prototype._validateMapping=function SourceMapGenerator_validateMapping(aGenerated,aOriginal,aSource,aName){if(aOriginal&&typeof aOriginal.line!=="number"&&typeof aOriginal.column!=="number"){throw new Error("original.line and original.column are not numbers -- you probably meant to omit "+"the original mapping entirely and only map the generated position. If so, pass "+"null for the original mapping instead of an object with empty or null values.")}if(aGenerated&&"line"in aGenerated&&"column"in aGenerated&&aGenerated.line>0&&aGenerated.column>=0&&!aOriginal&&!aSource&&!aName){return}else if(aGenerated&&"line"in aGenerated&&"column"in aGenerated&&aOriginal&&"line"in aOriginal&&"column"in aOriginal&&aGenerated.line>0&&aGenerated.column>=0&&aOriginal.line>0&&aOriginal.column>=0&&aSource){return}else{throw new Error("Invalid mapping: "+JSON.stringify({generated:aGenerated,source:aSource,original:aOriginal,name:aName}))}};SourceMapGenerator.prototype._serializeMappings=function SourceMapGenerator_serializeMappings(){var previousGeneratedColumn=0;var previousGeneratedLine=1;var previousOriginalColumn=0;var previousOriginalLine=0;var previousName=0;var previousSource=0;var result="";var next;var mapping;var nameIdx;var sourceIdx;var mappings=this._mappings.toArray();for(var i=0,len=mappings.length;i<len;i++){mapping=mappings[i];next="";if(mapping.generatedLine!==previousGeneratedLine){previousGeneratedColumn=0;while(mapping.generatedLine!==previousGeneratedLine){next+=";";previousGeneratedLine++}}else{if(i>0){if(!util.compareByGeneratedPositionsInflated(mapping,mappings[i-1])){continue}next+=","}}next+=base64VLQ.encode(mapping.generatedColumn-previousGeneratedColumn);previousGeneratedColumn=mapping.generatedColumn;if(mapping.source!=null){sourceIdx=this._sources.indexOf(mapping.source);next+=base64VLQ.encode(sourceIdx-previousSource);previousSource=sourceIdx;next+=base64VLQ.encode(mapping.originalLine-1-previousOriginalLine);previousOriginalLine=mapping.originalLine-1;next+=base64VLQ.encode(mapping.originalColumn-previousOriginalColumn);previousOriginalColumn=mapping.originalColumn;if(mapping.name!=null){nameIdx=this._names.indexOf(mapping.name);next+=base64VLQ.encode(nameIdx-previousName);previousName=nameIdx}}result+=next}return result};SourceMapGenerator.prototype._generateSourcesContent=function SourceMapGenerator_generateSourcesContent(aSources,aSourceRoot){return aSources.map(function(source){if(!this._sourcesContents){return null}if(aSourceRoot!=null){source=util.relative(aSourceRoot,source)}var key=util.toSetString(source);return Object.prototype.hasOwnProperty.call(this._sourcesContents,key)?this._sourcesContents[key]:null},this)};SourceMapGenerator.prototype.toJSON=function SourceMapGenerator_toJSON(){var map={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};if(this._file!=null){map.file=this._file}if(this._sourceRoot!=null){map.sourceRoot=this._sourceRoot}if(this._sourcesContents){map.sourcesContent=this._generateSourcesContent(map.sources,map.sourceRoot)}return map};SourceMapGenerator.prototype.toString=function SourceMapGenerator_toString(){return JSON.stringify(this.toJSON())};exports.SourceMapGenerator=SourceMapGenerator},{"./array-set":138,"./base64-vlq":139,"./mapping-list":142,"./util":147}],146:[function(require,module,exports){var SourceMapGenerator=require("./source-map-generator").SourceMapGenerator;var util=require("./util");var REGEX_NEWLINE=/(\r?\n)/;var NEWLINE_CODE=10;var isSourceNode="$$$isSourceNode$$$";function SourceNode(aLine,aColumn,aSource,aChunks,aName){this.children=[];this.sourceContents={};this.line=aLine==null?null:aLine;this.column=aColumn==null?null:aColumn;this.source=aSource==null?null:aSource;this.name=aName==null?null:aName;this[isSourceNode]=true;if(aChunks!=null)this.add(aChunks)}SourceNode.fromStringWithSourceMap=function SourceNode_fromStringWithSourceMap(aGeneratedCode,aSourceMapConsumer,aRelativePath){var node=new SourceNode;var remainingLines=aGeneratedCode.split(REGEX_NEWLINE);var remainingLinesIndex=0;var shiftNextLine=function(){var lineContents=getNextLine();var newLine=getNextLine()||"";return lineContents+newLine;function getNextLine(){return remainingLinesIndex<remainingLines.length?remainingLines[remainingLinesIndex++]:undefined}};var lastGeneratedLine=1,lastGeneratedColumn=0;var lastMapping=null;aSourceMapConsumer.eachMapping(function(mapping){if(lastMapping!==null){if(lastGeneratedLine<mapping.generatedLine){addMappingWithCode(lastMapping,shiftNextLine());lastGeneratedLine++;lastGeneratedColumn=0}else{var nextLine=remainingLines[remainingLinesIndex];var code=nextLine.substr(0,mapping.generatedColumn-lastGeneratedColumn);remainingLines[remainingLinesIndex]=nextLine.substr(mapping.generatedColumn-lastGeneratedColumn);lastGeneratedColumn=mapping.generatedColumn;addMappingWithCode(lastMapping,code);lastMapping=mapping;return}}while(lastGeneratedLine<mapping.generatedLine){node.add(shiftNextLine());lastGeneratedLine++}if(lastGeneratedColumn<mapping.generatedColumn){var nextLine=remainingLines[remainingLinesIndex];node.add(nextLine.substr(0,mapping.generatedColumn));remainingLines[remainingLinesIndex]=nextLine.substr(mapping.generatedColumn);lastGeneratedColumn=mapping.generatedColumn}lastMapping=mapping},this);if(remainingLinesIndex<remainingLines.length){if(lastMapping){addMappingWithCode(lastMapping,shiftNextLine())}node.add(remainingLines.splice(remainingLinesIndex).join(""))}aSourceMapConsumer.sources.forEach(function(sourceFile){var content=aSourceMapConsumer.sourceContentFor(sourceFile);if(content!=null){if(aRelativePath!=null){sourceFile=util.join(aRelativePath,sourceFile)}node.setSourceContent(sourceFile,content)}});return node;function addMappingWithCode(mapping,code){if(mapping===null||mapping.source===undefined){node.add(code)}else{var source=aRelativePath?util.join(aRelativePath,mapping.source):mapping.source;node.add(new SourceNode(mapping.originalLine,mapping.originalColumn,source,code,mapping.name))}}};SourceNode.prototype.add=function SourceNode_add(aChunk){if(Array.isArray(aChunk)){aChunk.forEach(function(chunk){this.add(chunk)},this)}else if(aChunk[isSourceNode]||typeof aChunk==="string"){if(aChunk){this.children.push(aChunk)}}else{throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+aChunk)}return this};SourceNode.prototype.prepend=function SourceNode_prepend(aChunk){if(Array.isArray(aChunk)){for(var i=aChunk.length-1;i>=0;i--){this.prepend(aChunk[i])}}else if(aChunk[isSourceNode]||typeof aChunk==="string"){this.children.unshift(aChunk)}else{throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+aChunk)}return this};SourceNode.prototype.walk=function SourceNode_walk(aFn){var chunk;for(var i=0,len=this.children.length;i<len;i++){chunk=this.children[i];if(chunk[isSourceNode]){chunk.walk(aFn)}else{if(chunk!==""){aFn(chunk,{source:this.source,line:this.line,column:this.column,name:this.name})}}}};SourceNode.prototype.join=function SourceNode_join(aSep){var newChildren;var i;var len=this.children.length;if(len>0){newChildren=[];for(i=0;i<len-1;i++){newChildren.push(this.children[i]);newChildren.push(aSep)}newChildren.push(this.children[i]);this.children=newChildren}return this};SourceNode.prototype.replaceRight=function SourceNode_replaceRight(aPattern,aReplacement){var lastChild=this.children[this.children.length-1];if(lastChild[isSourceNode]){lastChild.replaceRight(aPattern,aReplacement)}else if(typeof lastChild==="string"){this.children[this.children.length-1]=lastChild.replace(aPattern,aReplacement)}else{this.children.push("".replace(aPattern,aReplacement))}return this};SourceNode.prototype.setSourceContent=function SourceNode_setSourceContent(aSourceFile,aSourceContent){this.sourceContents[util.toSetString(aSourceFile)]=aSourceContent};SourceNode.prototype.walkSourceContents=function SourceNode_walkSourceContents(aFn){for(var i=0,len=this.children.length;i<len;i++){if(this.children[i][isSourceNode]){this.children[i].walkSourceContents(aFn)}}var sources=Object.keys(this.sourceContents);for(var i=0,len=sources.length;i<len;i++){aFn(util.fromSetString(sources[i]),this.sourceContents[sources[i]])}};SourceNode.prototype.toString=function SourceNode_toString(){var str="";this.walk(function(chunk){str+=chunk});return str};SourceNode.prototype.toStringWithSourceMap=function SourceNode_toStringWithSourceMap(aArgs){var generated={code:"",line:1,column:0};var map=new SourceMapGenerator(aArgs);var sourceMappingActive=false;var lastOriginalSource=null;var lastOriginalLine=null;var lastOriginalColumn=null;var lastOriginalName=null;this.walk(function(chunk,original){generated.code+=chunk;if(original.source!==null&&original.line!==null&&original.column!==null){if(lastOriginalSource!==original.source||lastOriginalLine!==original.line||lastOriginalColumn!==original.column||lastOriginalName!==original.name){map.addMapping({source:original.source,original:{line:original.line,column:original.column},generated:{line:generated.line,column:generated.column},name:original.name})}lastOriginalSource=original.source;lastOriginalLine=original.line;lastOriginalColumn=original.column;lastOriginalName=original.name;sourceMappingActive=true}else if(sourceMappingActive){map.addMapping({generated:{line:generated.line,column:generated.column}});lastOriginalSource=null;sourceMappingActive=false}for(var idx=0,length=chunk.length;idx<length;idx++){if(chunk.charCodeAt(idx)===NEWLINE_CODE){generated.line++;generated.column=0;if(idx+1===length){lastOriginalSource=null;sourceMappingActive=false}else if(sourceMappingActive){map.addMapping({source:original.source,original:{line:original.line,column:original.column},generated:{line:generated.line,column:generated.column},name:original.name})}}else{generated.column++}}});this.walkSourceContents(function(sourceFile,sourceContent){map.setSourceContent(sourceFile,sourceContent)});return{code:generated.code,map:map}};exports.SourceNode=SourceNode},{"./source-map-generator":145,"./util":147}],147:[function(require,module,exports){function getArg(aArgs,aName,aDefaultValue){if(aName in aArgs){return aArgs[aName]}else if(arguments.length===3){return aDefaultValue}else{throw new Error('"'+aName+'" is a required argument.')}}exports.getArg=getArg;var urlRegexp=/^(?:([\w+\-.]+):)?\/\/(?:(\w+:\w+)@)?([\w.]*)(?::(\d+))?(\S*)$/;var dataUrlRegexp=/^data:.+\,.+$/;function urlParse(aUrl){var match=aUrl.match(urlRegexp);if(!match){return null}return{scheme:match[1],auth:match[2],host:match[3],port:match[4],path:match[5]}}exports.urlParse=urlParse;function urlGenerate(aParsedUrl){var url="";if(aParsedUrl.scheme){url+=aParsedUrl.scheme+":"}url+="//";if(aParsedUrl.auth){url+=aParsedUrl.auth+"@"}if(aParsedUrl.host){url+=aParsedUrl.host}if(aParsedUrl.port){url+=":"+aParsedUrl.port}if(aParsedUrl.path){url+=aParsedUrl.path}return url}exports.urlGenerate=urlGenerate;function normalize(aPath){var path=aPath;var url=urlParse(aPath);if(url){if(!url.path){return aPath}path=url.path}var isAbsolute=exports.isAbsolute(path);var parts=path.split(/\/+/);for(var part,up=0,i=parts.length-1;i>=0;i--){part=parts[i];if(part==="."){parts.splice(i,1)}else if(part===".."){up++}else if(up>0){if(part===""){parts.splice(i+1,up);up=0}else{parts.splice(i,2);up--}}}path=parts.join("/");if(path===""){path=isAbsolute?"/":"."}if(url){url.path=path;return urlGenerate(url)}return path}exports.normalize=normalize;function join(aRoot,aPath){if(aRoot===""){aRoot="."}if(aPath===""){aPath="."}var aPathUrl=urlParse(aPath);var aRootUrl=urlParse(aRoot);if(aRootUrl){aRoot=aRootUrl.path||"/"}if(aPathUrl&&!aPathUrl.scheme){if(aRootUrl){aPathUrl.scheme=aRootUrl.scheme}return urlGenerate(aPathUrl)}if(aPathUrl||aPath.match(dataUrlRegexp)){return aPath}if(aRootUrl&&!aRootUrl.host&&!aRootUrl.path){aRootUrl.host=aPath;return urlGenerate(aRootUrl)}var joined=aPath.charAt(0)==="/"?aPath:normalize(aRoot.replace(/\/+$/,"")+"/"+aPath);if(aRootUrl){aRootUrl.path=joined;return urlGenerate(aRootUrl)}return joined}exports.join=join;exports.isAbsolute=function(aPath){return aPath.charAt(0)==="/"||!!aPath.match(urlRegexp)};function relative(aRoot,aPath){if(aRoot===""){aRoot="."}aRoot=aRoot.replace(/\/$/,"");var level=0;while(aPath.indexOf(aRoot+"/")!==0){var index=aRoot.lastIndexOf("/");if(index<0){return aPath}aRoot=aRoot.slice(0,index);if(aRoot.match(/^([^\/]+:\/)?\/*$/)){return aPath}++level}return Array(level+1).join("../")+aPath.substr(aRoot.length+1)}exports.relative=relative;var supportsNullProto=function(){var obj=Object.create(null);return!("__proto__"in obj)}();function identity(s){return s}function toSetString(aStr){if(isProtoString(aStr)){return"$"+aStr}return aStr}exports.toSetString=supportsNullProto?identity:toSetString;function fromSetString(aStr){if(isProtoString(aStr)){return aStr.slice(1)}return aStr}exports.fromSetString=supportsNullProto?identity:fromSetString;function isProtoString(s){if(!s){return false}var length=s.length;if(length<9){return false}if(s.charCodeAt(length-1)!==95||s.charCodeAt(length-2)!==95||s.charCodeAt(length-3)!==111||s.charCodeAt(length-4)!==116||s.charCodeAt(length-5)!==111||s.charCodeAt(length-6)!==114||s.charCodeAt(length-7)!==112||s.charCodeAt(length-8)!==95||s.charCodeAt(length-9)!==95){return false}for(var i=length-10;i>=0;i--){if(s.charCodeAt(i)!==36){return false}}return true}function compareByOriginalPositions(mappingA,mappingB,onlyCompareOriginal){var cmp=mappingA.source-mappingB.source;if(cmp!==0){return cmp}cmp=mappingA.originalLine-mappingB.originalLine;if(cmp!==0){return cmp}cmp=mappingA.originalColumn-mappingB.originalColumn;if(cmp!==0||onlyCompareOriginal){return cmp}cmp=mappingA.generatedColumn-mappingB.generatedColumn;if(cmp!==0){return cmp}cmp=mappingA.generatedLine-mappingB.generatedLine;if(cmp!==0){return cmp}return mappingA.name-mappingB.name}exports.compareByOriginalPositions=compareByOriginalPositions;function compareByGeneratedPositionsDeflated(mappingA,mappingB,onlyCompareGenerated){var cmp=mappingA.generatedLine-mappingB.generatedLine;if(cmp!==0){return cmp}cmp=mappingA.generatedColumn-mappingB.generatedColumn;if(cmp!==0||onlyCompareGenerated){return cmp}cmp=mappingA.source-mappingB.source;if(cmp!==0){return cmp}cmp=mappingA.originalLine-mappingB.originalLine;if(cmp!==0){return cmp}cmp=mappingA.originalColumn-mappingB.originalColumn;if(cmp!==0){return cmp}return mappingA.name-mappingB.name}exports.compareByGeneratedPositionsDeflated=compareByGeneratedPositionsDeflated;function strcmp(aStr1,aStr2){if(aStr1===aStr2){return 0}if(aStr1>aStr2){return 1}return-1}function compareByGeneratedPositionsInflated(mappingA,mappingB){var cmp=mappingA.generatedLine-mappingB.generatedLine;if(cmp!==0){return cmp}cmp=mappingA.generatedColumn-mappingB.generatedColumn;if(cmp!==0){return cmp}cmp=strcmp(mappingA.source,mappingB.source);if(cmp!==0){return cmp}cmp=mappingA.originalLine-mappingB.originalLine;if(cmp!==0){return cmp}cmp=mappingA.originalColumn-mappingB.originalColumn;if(cmp!==0){return cmp}return strcmp(mappingA.name,mappingB.name)}exports.compareByGeneratedPositionsInflated=compareByGeneratedPositionsInflated},{}],148:[function(require,module,exports){arguments[4][64][0].apply(exports,arguments)},{"./lib/source-map-consumer":144,"./lib/source-map-generator":145,"./lib/source-node":146,dup:64}],149:[function(require,module,exports){exports.get=function(belowFn){var oldLimit=Error.stackTraceLimit;Error.stackTraceLimit=Infinity;var dummyObject={};var v8Handler=Error.prepareStackTrace;Error.prepareStackTrace=function(dummyObject,v8StackTrace){return v8StackTrace};Error.captureStackTrace(dummyObject,belowFn||exports.get);var v8StackTrace=dummyObject.stack;Error.prepareStackTrace=v8Handler;Error.stackTraceLimit=oldLimit;return v8StackTrace};exports.parse=function(err){if(!err.stack){return[]}var self=this;var lines=err.stack.split("\n").slice(1);return lines.map(function(line){if(line.match(/^\s*[-]{4,}$/)){return self._createParsedCallSite({fileName:line,lineNumber:null,functionName:null,typeName:null,methodName:null,columnNumber:null,native:null})}var lineMatch=line.match(/at (?:(.+)\s+)?\(?(?:(.+?):(\d+):(\d+)|([^)]+))\)?/);if(!lineMatch){return}var object=null;var method=null;var functionName=null;var typeName=null;var methodName=null;var isNative=lineMatch[5]==="native";if(lineMatch[1]){var methodMatch=lineMatch[1].match(/([^\.]+)(?:\.(.+))?/);object=methodMatch[1];method=methodMatch[2];functionName=lineMatch[1];typeName="Object"}if(method){typeName=object;methodName=method}if(method==="<anonymous>"){methodName=null;functionName=""}var properties={fileName:lineMatch[2]||null,lineNumber:parseInt(lineMatch[3],10)||null,functionName:functionName,typeName:typeName,methodName:methodName,columnNumber:parseInt(lineMatch[4],10)||null,native:isNative};return self._createParsedCallSite(properties)}).filter(function(callSite){return!!callSite})};exports._createParsedCallSite=function(properties){var methods={};for(var property in properties){var prefix="get";if(property==="native"){prefix="is"}var method=prefix+property.substr(0,1).toUpperCase()+property.substr(1);(function(property){methods[method]=function(){return properties[property]}})(property)}var callSite=Object.create(methods);for(var property in properties){callSite[property]=properties[property]}return callSite}},{}],150:[function(require,module,exports){module.exports=Yallist;Yallist.Node=Node;Yallist.create=Yallist;function Yallist(list){var self=this;if(!(self instanceof Yallist)){self=new Yallist}self.tail=null;self.head=null;self.length=0;if(list&&typeof list.forEach==="function"){list.forEach(function(item){self.push(item)})}else if(arguments.length>0){for(var i=0,l=arguments.length;i<l;i++){self.push(arguments[i])}}return self}Yallist.prototype.removeNode=function(node){if(node.list!==this){throw new Error("removing node which does not belong to this list")}var next=node.next;var prev=node.prev;if(next){next.prev=prev}if(prev){prev.next=next}if(node===this.head){this.head=next}if(node===this.tail){this.tail=prev}node.list.length--;node.next=null;node.prev=null;node.list=null};Yallist.prototype.unshiftNode=function(node){if(node===this.head){return}if(node.list){node.list.removeNode(node)}var head=this.head;node.list=this;node.next=head;if(head){head.prev=node}this.head=node;if(!this.tail){this.tail=node}this.length++};Yallist.prototype.pushNode=function(node){if(node===this.tail){return}if(node.list){node.list.removeNode(node)}var tail=this.tail;node.list=this;node.prev=tail;if(tail){tail.next=node}this.tail=node;if(!this.head){this.head=node}this.length++};Yallist.prototype.push=function(){for(var i=0,l=arguments.length;i<l;i++){push(this,arguments[i])}return this.length};Yallist.prototype.unshift=function(){for(var i=0,l=arguments.length;i<l;i++){unshift(this,arguments[i])}return this.length};Yallist.prototype.pop=function(){if(!this.tail){return undefined}var res=this.tail.value;this.tail=this.tail.prev;if(this.tail){this.tail.next=null}else{this.head=null}this.length--;return res};Yallist.prototype.shift=function(){if(!this.head){return undefined}var res=this.head.value;this.head=this.head.next;if(this.head){this.head.prev=null}else{this.tail=null}this.length--;return res};Yallist.prototype.forEach=function(fn,thisp){thisp=thisp||this;for(var walker=this.head,i=0;walker!==null;i++){fn.call(thisp,walker.value,i,this);walker=walker.next}};Yallist.prototype.forEachReverse=function(fn,thisp){thisp=thisp||this;for(var walker=this.tail,i=this.length-1;walker!==null;i--){fn.call(thisp,walker.value,i,this);walker=walker.prev}};Yallist.prototype.get=function(n){for(var i=0,walker=this.head;walker!==null&&i<n;i++){walker=walker.next}if(i===n&&walker!==null){return walker.value}};Yallist.prototype.getReverse=function(n){for(var i=0,walker=this.tail;walker!==null&&i<n;i++){walker=walker.prev}if(i===n&&walker!==null){return walker.value}};Yallist.prototype.map=function(fn,thisp){thisp=thisp||this;var res=new Yallist;for(var walker=this.head;walker!==null;){res.push(fn.call(thisp,walker.value,this));walker=walker.next}return res};Yallist.prototype.mapReverse=function(fn,thisp){thisp=thisp||this;var res=new Yallist;for(var walker=this.tail;walker!==null;){res.push(fn.call(thisp,walker.value,this));walker=walker.prev}return res};Yallist.prototype.reduce=function(fn,initial){var acc;var walker=this.head;if(arguments.length>1){acc=initial}else if(this.head){walker=this.head.next;acc=this.head.value}else{throw new TypeError("Reduce of empty list with no initial value")}for(var i=0;walker!==null;i++){acc=fn(acc,walker.value,i);walker=walker.next}return acc};Yallist.prototype.reduceReverse=function(fn,initial){var acc;var walker=this.tail;if(arguments.length>1){acc=initial}else if(this.tail){walker=this.tail.prev;acc=this.tail.value}else{throw new TypeError("Reduce of empty list with no initial value")}for(var i=this.length-1;walker!==null;i--){acc=fn(acc,walker.value,i);walker=walker.prev}return acc};Yallist.prototype.toArray=function(){var arr=new Array(this.length);for(var i=0,walker=this.head;walker!==null;i++){arr[i]=walker.value;walker=walker.next}return arr};Yallist.prototype.toArrayReverse=function(){var arr=new Array(this.length);for(var i=0,walker=this.tail;walker!==null;i++){arr[i]=walker.value;walker=walker.prev}return arr};Yallist.prototype.slice=function(from,to){to=to||this.length;if(to<0){to+=this.length}from=from||0;if(from<0){from+=this.length}var ret=new Yallist;if(to<from||to<0){return ret}if(from<0){from=0}if(to>this.length){to=this.length}for(var i=0,walker=this.head;walker!==null&&i<from;i++){walker=walker.next}for(;walker!==null&&i<to;i++,walker=walker.next){ret.push(walker.value)}return ret};Yallist.prototype.sliceReverse=function(from,to){to=to||this.length;if(to<0){to+=this.length}from=from||0;if(from<0){from+=this.length}var ret=new Yallist;if(to<from||to<0){return ret}if(from<0){from=0}if(to>this.length){to=this.length}for(var i=this.length,walker=this.tail;walker!==null&&i>to;i--){walker=walker.prev}for(;walker!==null&&i>from;i--,walker=walker.prev){ret.push(walker.value)}return ret};Yallist.prototype.reverse=function(){var head=this.head;var tail=this.tail;for(var walker=head;walker!==null;walker=walker.prev){var p=walker.prev;walker.prev=walker.next;walker.next=p}this.head=tail;this.tail=head;return this};function push(self,item){self.tail=new Node(item,self.tail,null,self);if(!self.head){self.head=self.tail}self.length++}function unshift(self,item){self.head=new Node(item,null,self.head,self);if(!self.tail){self.tail=self.head}self.length++}function Node(value,prev,next,list){if(!(this instanceof Node)){return new Node(value,prev,next,list)}this.list=list;this.value=value;if(prev){prev.next=this;this.prev=prev}else{this.prev=null}if(next){next.prev=this;this.next=next}else{this.next=null}}},{}],151:[function(require,module,exports){"use strict";var _=require("lodash");var ad=require("adnn/ad");var Tensor=require("./tensor");var special=require("./math/special");var valueRec=function(x){if(typeof x==="number"||x instanceof Tensor){return x}else if(ad.isLifted(x)){return x.x}else if(_.isArray(x)){return _.map(x,valueRec)}else if(_.isObject(x)&&!_.isFunction(x)){var proto=Object.getPrototypeOf(x);var y=_.mapValues(x,valueRec);return _.assign(Object.create(proto),y)}else{return x}};ad.valueRec=valueRec;ad.tensor.logGamma=ad.newUnaryFunction({OutputType:Tensor,name:"logGamma",forward:function(a){return a.logGamma()},backward:function(a){var n=a.x.length;while(n--){a.dx.data[n]+=special.digamma(a.x.data[n])*this.dx.data[n]}}});ad.scalar.logGamma=ad.newUnaryFunction({OutputType:Number,name:"logGamma",forward:function(a){return special.logGamma(a)},backward:function(a){return a.dx+=special.digamma(a.x)*this.dx}});ad.scalar.plus=function(x){if(ad.isLifted(x)&&typeof ad.value(x)==="number"){return x}else{return+x}};ad.tensor["__Tensor"]=Tensor;module.exports=ad},{"./math/special":219,"./tensor":231,"adnn/ad":14,lodash:124}],152:[function(require,module,exports){"use strict";var assert=require("assert");var _=require("lodash");var util=require("../util");var ad=require("../ad");var dists=require("../dists");var CountAggregator=function(onlyMAP){this.onlyMAP=onlyMAP;this.max={value:undefined,score:-Infinity};this.samples=[]};CountAggregator.prototype.add=function(value,score){if(this.onlyMAP){assert.ok(score!==undefined,"A score is required to compute the MAP.");if(score>this.max.score){this.max.value=value;this.max.score=score}}else{var obj=score===undefined?{value:value}:{value:value,score:score};this.samples.push(obj)}};CountAggregator.prototype.toDist=function(){if(this.onlyMAP){this.samples=[this.max]}return new dists.SampleBasedMarginal({samples:this.samples,numSamples:this.samples.length})};module.exports=CountAggregator},{"../ad":151,"../dists":169,"../util":246,assert:248,lodash:124}],153:[function(require,module,exports){"use strict";var ad=require("../ad");var assert=require("assert");var _=require("lodash");var dists=require("../dists");var util=require("../util");var numeric=require("../math/numeric");var ScoreAggregator=function(){this.dist={}};Object.defineProperties(ScoreAggregator.prototype,{size:{get:function(){return _.size(this.dist)}}});ScoreAggregator.prototype.add=function(value,score){if(ad.scalar.peq(score,ad.scalar.neg(Infinity))){return}var key=util.serialize(value);if(ad.scalar.peq(this.dist[key],undefined)){this.dist[key]={score:ad.scalar.neg(Infinity),val:value}}this.dist[key].score=numeric.logaddexp(this.dist[key].score,score)};function normalize(dist){var logNorm=_.reduce(dist,function(acc,obj){return numeric.logaddexp(acc,obj.score)},ad.scalar.neg(Infinity));return _.mapValues(dist,function(obj){return{val:obj.val,prob:ad.scalar.exp(ad.scalar.sub(obj.score,logNorm))}})}ScoreAggregator.prototype.toDist=function(){return new dists.Marginal({dist:normalize(this.dist)})};module.exports=ScoreAggregator},{"../ad":151,"../dists":169,"../math/numeric":218,"../util":246,assert:248,lodash:124}],154:[function(require,module,exports){(function(global){"use strict";var _=require("lodash");var esprima=require("esprima");var escodegen=require("escodegen");var webppl=require("./main");var optimize=require("./transforms/optimize").optimize;var naming=require("./transforms/naming").naming;var thunkify=require("./syntax").thunkify;var cps=require("./transforms/cps").cps;var errors=require("./errors/browser");var util=require("./util");var version="v0.9.11-12c8394";var packages=[{name:"webppl-timeit",js:{identifier:"webpplTimeit",path:require("/Users/jkhartshorne/Documents/Teaching/probmods2/node_modules/webppl-timeit")},headers:[],wppl:[{code:"var timeit = function(thunk) {\n  var t0 = webpplTimeit.now();\n  var value = thunk();\n  var t1 = webpplTimeit.now();\n  return {\n    value: value,\n    runtimeInMilliseconds: t1 - t0\n  }\n}\n\nvar sleep = function(ms) {\n  webpplTimeit.sleep(ms);\n}\n",filename:"webppl-timeit/src/timeit.wppl"}],version:"v0.3.0-12c8394"},{name:"webppl-dp",js:{identifier:"webpplDp",path:require("/Users/jkhartshorne/Documents/Teaching/probmods2/node_modules/webppl-dp")},headers:[],wppl:[{code:"var dp = {\n  cache: webpplDp.cache\n};\n",filename:"webppl-dp/src/dp.wppl"}],version:"v0.1.1-12c8394"},{name:"webppl-agents",js:{identifier:"webpplAgents",path:require("/Users/jkhartshorne/Documents/Teaching/probmods2/node_modules/webppl-agents")},headers:[],wppl:[{code:"var extend = function(base, ext) {\n  return _.extend({}, base, ext);\n};\n\nvar isPOMDPWithManifestLatent = function(obj){\n  return (_.has(obj, 'transition') &&\n          _.has(obj, 'observe') &&\n          _.has(obj, 'manifestStateToActions'));\n};\n\nvar stateHasManifestLatent = function (state){\n  return (_.has(state, 'latentState') &&\n          _.has(state, 'manifestState') &&\n          _.isFinite(state.manifestState.timeLeft));\n};\n",filename:"webppl-agents/src/utils/utils.wppl"},{code:"// TODO: looks like if you have named features in a gridworld, then\n// they have to be terminal (or at terminal after *timeAtRestaurant*\n// is exceeded). we should change this so that features can be\n// non-terminal.\n\n\nvar inGrid_ = function(gridMap, loc) {\n  return (loc[0] >= 0 && loc[0] < gridMap.xLim &&\n    loc[1] >= 0 && loc[1] < gridMap.yLim);\n}\n\n\nvar isBlockedLoc = function(gridMap, loc) {\n  var getFeature = gridMap.feature;\n  var feature = getFeature({\n    loc: loc\n  });\n  return feature === '#';\n}\n\n\nvar isAllowedState_ = function(gridMap, loc) {\n  return (inGrid_(gridMap, loc)) && !isBlockedLoc(gridMap, loc);\n};\n\n\nvar advanceStateTime = function(state) {\n  return extend(state, {\n    timeLeft: state.timeLeft - 1,\n    terminateAfterAction: state.timeLeft - 1 > 1 ? state.terminateAfterAction : true,\n    previousLoc: state.loc\n  });\n};\n\n\nvar addPrevious = function(state) {\n  return extend(state, {\n    previousLoc: state.loc\n  });\n};\n\n\nvar advanceRestaurant = function(state, maxTimeAtRestaurant) {\n  var timeAtRestaurant = ((state.timeAtRestaurant === undefined) ? 0 :\n                          state.timeAtRestaurant + 1);\n  var state = extend(state, { timeAtRestaurant });\n  if (state.timeAtRestaurant < maxTimeAtRestaurant - 1) {\n    return state;\n  } else {\n    return extend(state, { terminateAfterAction: true });\n  }\n};\n\n\nvar moveState = function(gridMap, state, action) {\n  var loc = state.loc;\n  var gridTransition = {\n    l: [loc[0] - 1, loc[1]],\n    r: [loc[0] + 1, loc[1]],\n    u: [loc[0], loc[1] + 1],\n    d: [loc[0], loc[1] - 1]\n  };\n\n  var possibleNextLoc = gridTransition[action];\n  assert.ok(possibleNextLoc != undefined, 'action was not found');\n\n  var nextLoc = isAllowedState_(gridMap, possibleNextLoc) ? possibleNextLoc : loc;\n  return extend(state, {\n    loc: nextLoc\n  });\n};\n\n\nvar makeGridTransition_ = function(gridMap, options) {\n  return function(state, action) {\n    var getFeature = gridMap.feature;\n    var state = options.noReverse ? addPrevious(state) : state;\n    var state = !getFeature(state).name ? advanceStateTime(state) : state;\n\n    var state = !getFeature(state).name ? moveState(gridMap, state, action) : state;\n    var state = getFeature(state).name ? advanceRestaurant(state, options.maxTimeAtRestaurant) : state;\n\n    return state;\n  };\n};\n\n\nvar makeNoisyGridTransition_ = function(gridMap, options, transitionNoiseProb) {\n  var deterministicTransition = makeGridTransition_(gridMap, options);\n  // If agent selects *key*, with *transitionNoiseProb* they do one of the two\n  // orthogonal actions\n  var noiseActionTable = {\n    u: ['l', 'r'],\n    d: ['l', 'r'],\n    l: ['u', 'd'],\n    r: ['u', 'd']\n  };\n\n  return function(state, action) {\n    return flip(1 - transitionNoiseProb) ? deterministicTransition(state, action) :\n      deterministicTransition(state, uniformDraw(noiseActionTable[action]));\n  };\n};\n\n\nvar makeGridMap = function(rfeatures) {\n  var features = rfeatures.reverse();\n  return {\n    features: features,\n    xLim: features[0].length,\n    yLim: features.length,\n    feature: function(state) {\n      return features[state.loc[1]][state.loc[0]];\n    }\n  };\n};\n\n\nvar makeGridWorldDeterministic = function(features, options) {\n  var defaults = {\n    noReverse: false,\n    maxTimeAtRestaurant: 1\n  };\n  var options = extend(defaults, options);\n\n  var gridMap = makeGridMap(features);\n\n  var transition = makeGridTransition_(gridMap, options);\n  var actions = ['l', 'r', 'u', 'd'];\n\n  var stateToActions = function(state) {\n\n    var possibleActions = filter(function(action) {\n      var newState = transition(state, action);\n      if (options.noReverse &&\n        state.previousLoc &&\n        state.previousLoc[0] === newState.loc[0] && state.previousLoc[1] === newState.loc[1]) {\n        return false;\n      }\n      return state.loc[0] !== newState.loc[0] || state.loc[1] !== newState.loc[1];\n    }, actions);\n\n    if (possibleActions.length > 0) {\n      return possibleActions;\n    } else {\n      return [actions[0]];\n    }\n  };\n\n  return extend(gridMap, { transition, actions, stateToActions });\n};\n\n\nvar makeNoisyGridworld = function(features, inputOptions, transitionNoiseProb) {\n  var defaults = {\n    noReverse: false,\n    maxTimeAtRestaurant: 1\n  };\n\n  var options = extend(defaults, inputOptions);\n  var gridMap = makeGridMap(features);\n\n  var transition = makeNoisyGridTransition_(gridMap, options,\n    transitionNoiseProb);\n  var actions = ['l', 'r', 'u', 'd'];\n\n  var stateToActions = function(state) {\n    var possibleActions = filter(function(action) {\n      // if noReverse, check that MAP of newState doesn't reverse you\n      var transitionDist = Infer({\n        method: 'enumerate'\n      }, function() {\n        return transition(state, action);\n      });\n      var likelyNewState = MAP(transitionDist).val;\n      if (options.noReverse && state.previousLoc &&\n        state.previousLoc[0] === likelyNewState.loc[0] &&\n        state.previousLoc[1] === likelyNewState.loc[1]) {\n        return false;\n      } else {\n        return state.loc[0] !== likelyNewState.loc[0] ||\n          state.loc[1] !== likelyNewState.loc[1];\n      }\n    }, actions);\n\n\n    if (possibleActions.length > 0) {\n      return possibleActions;\n    } else {\n      return [actions[0]];\n    }\n  };\n\n  return extend(gridMap, { transition, actions, stateToActions });\n};\n\n\nvar makeGridWorldMDP = function(options) {\n\n  var defaults = {\n    noReverse: false,\n    maxTimeAtRestaurant: 1,\n    transitionNoiseProbability: 0,\n    start: [0, 0],\n    totalTime: 2\n  };\n\n  var options = extend(defaults, options);\n\n  map(function(el) {\n    assert.ok(_.isString(el) || _.isString(el.name), 'grid is invalid')\n  }, _.flatten(options.grid));\n\n  assert.ok(options.totalTime >= 1,\n            'totalTime is invalid');\n  assert.ok(options.transitionNoiseProbability <= 1,\n            'transitionNoiseProbability is invalid');\n  assert.ok(options.start.length == 2,\n            'start is invalid');\n\n  var world = (\n    (options.transitionNoiseProbability == 0) ?\n    makeGridWorldDeterministic(options.grid, options) :\n    makeNoisyGridworld(options.grid, options, options.transitionNoiseProbability));\n\n  var startState = {\n    loc: options.start,\n    terminateAfterAction: false,\n    timeLeft: options.totalTime\n  };\n\n  // assumes that utilities are only defined on named features and timeCost\n  // doesnt work for the hyperbolic case\n  var makeUtilityFunction = function(utilityTable) {\n    assert.ok(utilityTable.hasOwnProperty('timeCost'),\n              'makeUtilityFunction utilityTable lacks timeCost');\n    return function(state, action) {\n      var getFeature = world.feature;\n      var feature = getFeature(state);\n\n      if (feature.name) {\n        return utilityTable[feature.name];\n      }\n      return utilityTable.timeCost;\n    };\n  };\n\n  return { world, startState, makeUtilityFunction };\n\n};\n",filename:"webppl-agents/src/environments/makeGridWorldMDP.wppl"},{code:"// Stochastic bandit POMDP constructor: outputs Bandit environments\n// whose prizes are strings or numbers.\n\n// The latent state stores each arm's Dist over prizes, and the\n// manifest state location contains the reward gained after the\n// previous arm pull.\n\n\nvar inSupport = function(x, dist){\n  return _.isFinite(dist.score(x));\n};\n\n\nvar makeBanditStartState = function(numberOfTrials, armToPrizeDist) {\n  return {\n    manifestState: {\n      loc: 'start',\n      timeLeft: numberOfTrials,\n      terminateAfterAction: false // numberOfTrials == 1\n    },\n    latentState: armToPrizeDist\n  };\n};\n\n\nvar makeBanditWorld = function(numberOfArms) {\n  var actions = _.range(numberOfArms);\n\n  var advanceTime = function(manifestState) {\n    var newTimeLeft = manifestState.timeLeft - 1;\n    var terminateAfterAction = (newTimeLeft === 1);\n    return extend(manifestState, {timeLeft: newTimeLeft,\n  \t\t\t\t  terminateAfterAction: terminateAfterAction});\n  };\n  \n  var manifestStateToActions = function(manifestState) {return actions;};\n\n  var transition = function(state, action){\n    \n    assert.ok(state.latentState[action].sample,\n              'bandit transition: latent state has no Dist for given action');\n    \n    // figure out what the prize is\n    var prize = sample(state.latentState[action]);\n\n    // make the new location the prize, advance the time\n    var manifestStateWithReward = extend(state.manifestState, {loc: prize});\n    var newManifestState = advanceTime(manifestStateWithReward);\n\n    return {\n      manifestState: newManifestState,\n      latentState: state.latentState\n    };\n  };\n\n  var observe = function(state){\n    // in beliefAgent, the observation here will be augmented with an \n    // observation of the manifest state, and belief updating will depend on\n    // both that full observation and the action the agent took. This is all the\n    // agent needs to update, so there is no need to have an observation here.\n    // However, if we make the observation 'noObservation', the agent will not\n    // update its beliefs, which is bad, so we arbitrarily set the observation\n    // to always be 0.\n    return 0;\n  };\n\n  return {\n    manifestStateToActions: manifestStateToActions,\n    transition: transition,\n    observe: observe\n  };\n};\n\n\nvar makeBanditPOMDP = function(options) {\n\n  assert.ok(_.has(options, 'numberOfArms') &&\n            _.has(options, 'armToPrizeDist') &&\n            _.has(options, 'numberOfTrials'),\n\t    'makeBanditPOMDP args: options does not contain one or more' +\n            ' of numberOfArms, armToPrizeDist, and numberOfTrials');\n\n  var numberOfArms = options.numberOfArms;\n  var armToPrizeDist = options.armToPrizeDist;\n  var numberOfTrials = options.numberOfTrials;\n  var numericalPrizes = options.numericalPrizes;\n  var prizeToUtility = options.prizeToUtility;\n  \n  // ensure that armToPrizeDist has an entry for every arm\n  mapN(function(arm){\n    assert.ok(_.has(armToPrizeDist, arm.toString()),\n\t      'makeBandit: arm ' + arm + ' has no entry in armToPrizeDist');\n  }, numberOfArms);\n  \n  // ensure that armToPrizeDist has an Dist for every arm\n  mapN(function(arm){\n    assert.ok(armToPrizeDist[arm.toString()].sample,\n\t      'makeBandit: arm ' + arm + ' has no Dist in armToPrizeDist');\n  }, numberOfArms);\n\n  // ensure that prizes are numerical iff numericalPrizes is true,\n  // and strings iff numericalPrizes is false\n  // also, if numericalPrizes is false, and prizeToUtility is defined, ensure\n  // that every prize has a utility\n  if (numericalPrizes) {\n    var supportIsNumeric = function(arm) {\n      var dist = armToPrizeDist[arm];\n      map(function(x){\n\tassert.ok(_.isFinite(x) && inSupport(x, dist),\n\t\t  'makeBandit: some prizes are non-numeric but numericalPrizes is true');\n      }, dist.support());\n    };\n\n    mapN(supportIsNumeric, numberOfArms);\n    \n  } else {\n    var supportIsStringy = function(arm) {\n      var dist = armToPrizeDist[arm];\n      map(function(x){\n\tassert.ok(_.isString(x) && inSupport(x, dist),\n\t\t  'makeBandit: some prizes are not strings but numericalPrizes is false');\n      }, dist.support());\n    };\n\n    mapN(supportIsStringy, numberOfArms);\n  }\n  \n  var world = makeBanditWorld(numberOfArms);\n  var startState = makeBanditStartState(numberOfTrials, armToPrizeDist);\n\n  return { world, startState, armToPrizeDist, numericalPrizes, numberOfArms };\n};\n",filename:"webppl-agents/src/environments/makeBanditPOMDP.wppl"},{code:"// function that builds a gridworld POMDP\n\n// arg is a gridworld MDP, which is an object with features (an array of\n// arrays of the features at each point), xLim, yLim, feature (a function of\n// a (manifest) state that returns the features of that state), transition\n// (a transition function on manifest states), actions, and stateToActions.\n// noReverse must be false in the MDP.\n\n// manifest states in this POMDP are objects with loc (an array of two\n// numbers), timeLeft, terminateAfterAction, and timeAtRestraurant - the same as states in gridworld MDPs.\n// latent states are an object listing whether each restaurant type is open.\n// transition acts the same as in gridworld MDPs, not touching the latent state,\n// unless the transition would take the agent into a closed restaurant, in which\n// case the agent stays put.\n// observe tells the agent which adjacent restaurants are open. If the agent is not\n// adjacent to any restaurants, they get 'noObservation'.\n\n\nvar makeGridWorldPOMDP = function(options) {\n\n  var gridworld = makeGridWorldMDP(options).world;\n\n  var actions = gridworld.actions;\n  var feature = gridworld.feature;\n\n  // returns an array of restaurants that neighbour a state\n  var neighbourRestaurants = function(manifestState) {\n    var loc = manifestState.loc;\n    var updateStateLoc = function(manifestState, newLoc) {\n      return extend(manifestState, {\n        loc: newLoc\n      });\n    };\n\n    var potentialneighbourStates = [\n      updateStateLoc(manifestState, [loc[0] - 1, loc[1]]),\n      updateStateLoc(manifestState, [loc[0] + 1, loc[1]]),\n      updateStateLoc(manifestState, [loc[0], loc[1] + 1]),\n      updateStateLoc(manifestState, [loc[0], loc[1] - 1]),\n    ];\n\n    var neighbourStates = filter(function(manifestState) {\n      return inGrid_(gridworld, manifestState.loc);\n    }, potentialneighbourStates);\n\n    var isRestaurant = function(manifestState) {\n      return feature(manifestState).name;\n    };\n\n    return filter(isRestaurant, neighbourStates);\n  };\n\n  // returns a subobject of latentState that gives the status of adjacent restaurants\n  var observe = function(state) {\n    var neighbourRests = neighbourRestaurants(state.manifestState);\n    if (_.isEmpty(neighbourRests)) {\n      return 'noObservation';\n    } else {\n      var restaurantNames = map(function(manifestState) {\n        return feature(manifestState).name;\n      }, neighbourRests);\n\n      return map(function(name) {\n          return [name, state.latentState[name]];\n        },\n        restaurantNames);\n    }\n  };\n\n  var _mdpTransition = gridworld.transition;\n  var mdpTransition = function(state, action) {\n    // transition the manifest state as it would be transitioned in the gridworld\n    // mdp, leave the latent state alone\n    var newManifestState = _mdpTransition(state.manifestState, action);\n    return {\n      manifestState: newManifestState,\n      latentState: state.latentState\n    };\n  };\n\n  var transition = function(state, action) {\n    assert.ok(stateHasManifestLatent(state), 'transition state arg');\n\n    var proposedNewState = mdpTransition(state, action);\n    var newFeatureName = feature(proposedNewState.manifestState).name;\n\n    // if proposedNewState is a restaurant that is closed, stay put, but increment\n    // time. otherwise, change to proposed new state.\n    if (newFeatureName && !proposedNewState.latentState[newFeatureName]) {\n      return {\n        manifestState: advanceStateTime(state.manifestState),\n        latentState: state.latentState\n      };\n    } else {\n      return proposedNewState;\n    }\n  };\n\n  var manifestStateToActions = function(manifestState) {\n    var neighbourRestaurantArray = neighbourRestaurants(manifestState);\n    if (neighbourRestaurantArray.length == 0) {\n      var manifestStateToActions_ = gridworld.stateToActions;\n      return manifestStateToActions_(manifestState);\n    } else {\n      return gridworld.actions;\n    }\n  };\n\n  return {\n    manifestStateToActions: manifestStateToActions,\n    transition: transition,\n    observe: observe,\n    feature: feature,\n    MDPWorld: gridworld\n  };\n};\n\n\nvar inferGridWorldPOMDP = function(world, startState, baseParams, trueAgentParams, prior, agentTypeAndFunctions, trajectoryOrOffPolicy, numRejectionSamples) {\n\n  var makeAgent = agentTypeAndFunctions.makeAgent;\n  var simulate = agentTypeAndFunctions.simulate;\n  var beliefOrBeliefDelay = agentTypeAndFunctions.type;\n\n  var isJointPrior = prior.isJoint;\n\n  // try just not defining things instead of having them as 'undefined'\n  var jointPrior = isJointPrior ? prior.jointPrior : undefined;\n  var priorUtilityTable = isJointPrior ? undefined : prior.priorUtilityTable;\n  var priorAgentPrior = isJointPrior ? undefined : prior.priorAgentPrior;\n\n  if (isJointPrior) {\n    assert.ok(stateHasManifestLatent(startState) && jointPrior.sample,\n      'inferGridworld args');\n  } else {\n    assert.ok(stateHasManifestLatent(startState) &&\n      priorUtilityTable.sample &&\n      priorAgentPrior.sample,\n      'inferGridworld args');\n  }\n\n  assert.ok(trajectoryOrOffPolicy == 'trajectory' || trajectoryOrOffPolicy == 'offPolicy',\n    'trajectoryOrOffPolicy is not valid');\n\n  assert.ok(_.isNumber(numRejectionSamples) && isPOMDPWithManifestLatent(world), 'inferGridWorld args');\n\n  // get observations using trueAgentParams\n  var agent = makeAgent(trueAgentParams, world);\n  var observedStateAction = simulatePOMDP(startState, world, agent, 'stateAction');\n  var observe = agent.POMDPFunctions.observe;\n\n  assert.ok(stateHasManifestLatent(observedStateAction[0][0]), 'fullstate in trajectory for inferGridWorld');\n\n  return Infer({\n    method: 'enumerate'\n  }, function() {\n    var utilityAndPrior = isJointPrior ? sample(jointPrior) : null;\n\n    var utilityTable = isJointPrior ? utilityAndPrior.utilityTable :\n      sample(priorUtilityTable);\n    var utility = makeRestaurantUtilityFunction(world, utilityTable);\n\n    var priorBelief = isJointPrior ? utilityAndPrior.priorBelief :\n      sample(priorAgentPrior);\n\n    var params = extend(baseParams, {\n      utility: utility,\n      priorBelief: priorBelief\n    });\n\n    var agent = makeAgent(params, world);\n    var agentAct = agent.act;\n    var agentUpdateBelief = agent.updateBelief;\n\n    // Factor on whole sampled trajectory (SLOW IF TRANSITIONS NOT DETERMINISTIC OR IF NUM SAMPLES HIGH)\n    var factorOnTrajectory = function() {\n      var trajectoryDist = Infer({\n        method: 'rejection',\n        samples: numRejectionSamples\n      }, function() {\n        return simulatePOMDP(startState, world, agent, 'states')\n      });\n      factor(trajectoryDist.score(map(first, observedStateAction)));\n    };\n\n    // Move agent through observed sequence\n    var factorSequenceOffPolicy = function(currentBelief, previousAction, timeIndex) {\n      if (timeIndex < observedStateAction.length) {\n\n        // Go to next world state and sample observation from that state\n        var state = observedStateAction[timeIndex][0];\n        var observation = observe(state);\n\n        // Update agent's internal state and get action Dist\n        var delay = 0;\n        var nextBelief = beliefOrBeliefDelay == 'belief' ?\n          agentUpdateBelief(currentBelief, observation, previousAction) :\n          agentUpdateBelief(currentBelief, observation, previousAction, delay);\n\n\n        var nextActionDist = beliefOrBeliefDelay == 'belief' ?\n          agentAct(nextBelief) : agentAct(nextBelief, delay);\n\n        var observedAction = observedStateAction[timeIndex][1];\n\n        factor(nextActionDist.score(observedAction));\n\n        // condition on next world state, passing through updated internal state\n        factorSequenceOffPolicy(nextBelief, observedAction, timeIndex + 1);\n      }\n    };\n\n    var doInfer = (trajectoryOrOffPolicy == 'trajectory') ? factorOnTrajectory() :\n      factorSequenceOffPolicy(priorBelief, 'noAction', 0);\n\n    return { utilityTable, priorBelief };\n  });\n};\n",filename:"webppl-agents/src/environments/makeGridWorldPOMDP.wppl"},{code:"var hasProperties = function(object, listProperties) {\n  assert.ok(_.isObject(object) && _.isArray(listProperties), 'fail hasProperties');\n  return _.every(map(\n    function(property) {\n      return _.has(object, property);\n    }, listProperties));\n};\n\n\nvar makeMDPAgentOptimal = function(params, world) {\n  // *params* should be an object containing *utility*, a utility function, and\n  // *alpha*, which regulates the agent's softmax noise.\n  map(function(s) {\n    assert.ok(params.hasOwnProperty(s), 'makeMDPAgent args');\n  }, ['utility', 'alpha']);\n\n  var stateToActions = world.stateToActions;\n  var transition = world.transition;\n  var utility = params.utility;\n  var alpha = params.alpha;\n\n  var act = dp.cache(\n    function(state) {\n      return Infer({\n        method: 'enumerate'\n      }, function() {\n        var action = uniformDraw(stateToActions(state));\n        var eu = expectedUtility(state, action);\n        factor(alpha * eu);\n        return action;\n      });\n    });\n\n  var expectedUtility = dp.cache(\n    function(state, action) {\n      var u = utility(state, action);\n      if (state.terminateAfterAction) {\n        return u;\n      } else {\n        return u + expectation(Infer({\n          method: 'enumerate'\n        }, function() {\n          var nextState = transition(state, action);\n          var nextAction = sample(act(nextState));\n          return expectedUtility(nextState, nextAction);\n        }));\n      }\n    });\n\n  return {\n    params,\n    expectedUtility,\n    act\n  };\n};\n\n\nvar makeMDPAgentHyperbolic = function(params, world) {\n  assert.ok(hasProperties(params, ['utility', 'alpha', 'discount', 'sophisticatedOrNaive']),\n            'makeMDPAgentHyperbolic params');\n\n  var stateToActions = world.stateToActions;\n  var transition = world.transition;\n  var utility = params.utility;\n\n  // we can specify a discount function so that our 'hyperbolic' agent can\n  // actually be an exponential discounter (or some other kind of discounter)\n  var paramsDiscountFunction = params.discountFunction;\n\n  var discountFunction = (\n    paramsDiscountFunction ||\n    function(delay) {\n      return 1 / (1 + params.discount * delay);\n    });\n\n  var isNaive = params.sophisticatedOrNaive == 'naive';\n\n  var act = dp.cache(\n    function(state, delay) {\n      var delay = delay ? delay : 0; //make sure delay is never 'undefined'\n\n      return Infer({\n        method: 'enumerate'\n      }, function() {\n        var action = uniformDraw(stateToActions(state));\n        var eu = expectedUtility(state, action, delay);\n        factor(params.alpha * eu);\n        return action;\n      });\n    });\n\n  var expectedUtility = dp.cache(\n    function(state, action, delay) {\n      var u = discountFunction(delay) * utility(state, action);\n      assert.ok(!_.isUndefined(u),\n        \"utility undefined\" + JSON.stringify([state, action, delay, utility(state, action)]));\n\n      if (state.terminateAfterAction) {\n        return u;\n      } else {\n        return u + expectation(Infer({\n          method: 'enumerate'\n        }, function() {\n          var nextState = transition(state, action);\n          var perceivedDelay = isNaive ? delay + 1 : 0;\n          var nextAction = sample(act(nextState, perceivedDelay));\n          return expectedUtility(nextState, nextAction, delay + 1);\n        }));\n      }\n    });\n\n  return {\n    params,\n    expectedUtility,\n    act\n  };\n};\n\n\nvar isOptimalMDPAgent = function(agentParams) {\n  var optimalProperties = function() {\n    return !(_.has(agentParams, 'discount') ||\n      _.has(agentParams, 'discountFunction') ||\n      _.has(agentParams, 'sophisticatedOrNaive'));\n  };\n  return _.isUndefined(agentParams.optimal) ? optimalProperties() : agentParams.optimal;\n};\n\n\nvar makeMDPAgent = function(params, world) {\n  return (isOptimalMDPAgent(params) ?\n          makeMDPAgentOptimal(params, world) :\n          makeMDPAgentHyperbolic(params, world));\n};\n",filename:"webppl-agents/src/agents/makeMDPAgent.wppl"},{code:"// HELPER FUNCTIONS\nvar hasUtilityPriorBelief = function(agentParams) {\n  if (_.has(agentParams, 'utility') && _.has(agentParams, 'priorBelief')) {\n    var utility = agentParams.utility;\n    var priorBelief = agentParams.priorBelief;\n    return _.isFunction(utility);\n  }\n  return false;\n};\n\n\nvar hasTransitionObserve = function(world) {\n  if (_.has(world, 'transition') && _.has(world, 'observe')) {\n    var transition = world.transition;\n    var observe = world.observe;\n    return _.isFunction(transition) && _.isFunction(observe);\n  }\n  return false;\n};\n\n\n// Test whether belief has right form for fastUpdateBelief, i.e. it's not\n// an Dist but an object with 'manifestState' and 'latentStateDist' properties\nvar isDistOverLatent = function(belief) {\n  return (\n    _.has(belief, 'manifestState') &&\n    _.has(belief, 'latentStateDist') &&\n    !_.has(belief, 'support') &&\n    belief.latentStateDist.sample);\n};\n\n\n// Convert priorBelief from Dist over full states to Dist over latents\nvar toDistOverLatent = function(belief) {\n  var manifestState = belief.support()[0].manifestState;\n  var latentStateDist = Infer({\n    method: 'enumerate'\n  }, function() {\n    return sample(belief).latentState;\n  })\n  return {\n    manifestState: manifestState,\n    latentStateDist: latentStateDist\n  };\n};\n\n\n// Construct functions needed for running the POMDP agent\n// Most of the code is for the manifest-latent optimization\n\nvar getPOMDPFunctions = function(params, world) {\n\n  // Sample a state from belief: works for general states and manifestLatent states.\n  var sampleBelief = function(belief) {\n    if (isDistOverLatent(belief)) {\n      return {\n        manifestState: belief.manifestState,\n        latentState: sample(belief.latentStateDist)\n      };\n    } else {\n      return sample(belief);\n    };\n  };\n\n\n  // ----------------------------\n  // Manifest-latent Optimization\n\n  // Helper functions\n\n  var getBeliefToActions = function(manifestStateToActions) {\n    return function(belief) {\n      var manifestState = isDistOverLatent(belief) ? belief.manifestState :\n          sample(belief).manifestState;\n      return manifestStateToActions(manifestState);\n    };\n  };\n\n  var getFullObserve = function(observeLatent) {\n    return function(state) {\n      return {\n        manifestState: state.manifestState,\n        observation: observeLatent(state)\n      };\n    };\n  };\n\n  // Agent gets an obervation in starting state without having taken an action\n  var isNullAction = function(action) {\n    return action == 'noAction';\n  };\n\n  // Optimized belief update for manifest/latent POMDPs\n  var getUpdateBeliefManifestLatent = function(transition, observe) {\n\n    var isDeltaDist = function(dist) {\n      return dist.support().length === 1;\n    };\n\n    return dp.cache(\n      function(belief_, observation, action) {\n\n        // If belief has form of \"Dist over {manifest:, latent:}\" then we convert\n        // to form of \"{manifest:, Dist over latent}\".\n        var belief = isDistOverLatent(belief_) ? belief_ : toDistOverLatent(belief_);\n\n        // we set the manifest state to the observed manifest state\n        var newManifestState = observation.manifestState;\n\n        // Don't update latent when you don't need to\n        if (observation.observation === 'noObservation' ||\n            isDeltaDist(belief.latentStateDist)) {\n          return extend(belief, {\n            manifestState: newManifestState\n          });\n        } else {\n\n          // Sample latent, update state, compare predicted observation from state\n          // to actual observation.\n\n          var newLatentDist = Infer({\n            method: 'enumerate'\n          }, function() {\n            var latentState = sample(belief.latentStateDist);\n            var state = {\n              manifestState: belief.manifestState,\n              latentState\n            };\n            var predictedNextState = isNullAction(action) ? state : transition(state, action);\n            var predictedObservation = observe(predictedNextState);\n\n            condition(_.isEqual(predictedObservation, observation));\n            return latentState;\n          });\n\n          return {\n            manifestState: newManifestState,\n            latentStateDist: newLatentDist\n          };\n        }\n      });\n  };\n\n\n  // updateBelief function for general POMDPs (no manifest/latent structure)\n  var getUpdateBeliefSimple = function(transition, observe) {\n    return dp.cache(\n      function(belief, observation, action) {\n        return Infer({\n          method: 'enumerate'\n        }, function() {\n          var state = sample(belief);\n          var predictedNextState = isNullAction(action) ? state : transition(state, action);\n          var predictedObservation = observe(predictedNextState);\n          condition(_.isEqual(predictedObservation, observation));\n          return predictedNextState;\n        });\n      });\n  };\n\n\n  var useManifestLatent = !_.isUndefined(params.useManifestLatent) ?\n      params.useManifestLatent :\n      stateHasManifestLatent(sampleBelief(params.priorBelief))\n\n  if (useManifestLatent) {\n    assert.ok(stateHasManifestLatent(sampleBelief(params.priorBelief)),\n              'state is not manifestLatent in form')\n  }\n\n\n  if (useManifestLatent) {\n    var observe = getFullObserve(world.observe);\n    return {\n      sampleBelief: sampleBelief,\n      useManifestLatent: true,\n      observe: observe,\n      beliefToActions: getBeliefToActions(world.manifestStateToActions),\n      updateBelief: getUpdateBeliefManifestLatent(world.transition, observe),\n      shouldTerminate: function(state) {\n        return state.manifestState.terminateAfterAction;\n      }\n    };\n  };\n\n  return {\n    sampleBelief: sampleBelief,\n    useManifestLatent: false,\n    observe: world.observe,\n    beliefToActions: world.beliefToActions,\n    updateBelief: getUpdateBeliefSimple(world.transition, world.observe),\n    shouldTerminate: function(state) {\n      return state.terminateAfterAction;\n    }\n  };\n};\n\n\n// --------------------------------------------------------------------\n// Optimal POMDP agent\n\nvar makePOMDPAgentOptimal = function(params, world) {\n  assert.ok(hasUtilityPriorBelief(params) && hasTransitionObserve(world),\n            'makePOMDPAgent params and world');\n\n  // set defaults\n  var defaults = {\n    recurseOnStateOrBelief: 'belief',\n    alpha: 1000,\n  };\n\n  var params = extend(defaults, params);\n\n  var utility = params.utility;\n  var transition = world.transition;\n  var POMDPFunctions = getPOMDPFunctions(params, world);\n\n  var observe = POMDPFunctions.observe;\n  var beliefToActions = POMDPFunctions.beliefToActions;\n  var updateBelief = POMDPFunctions.updateBelief;\n  var shouldTerminate = POMDPFunctions.shouldTerminate;\n  var sampleBelief = POMDPFunctions.sampleBelief;\n\n\n  // RECURSE ON BELIEF (BELLMAN STYLE)\n  var act = dp.cache(\n    function(belief) {\n      return Infer({\n        method: 'enumerate'\n      }, function() {\n        var action = uniformDraw(beliefToActions(belief));\n        var eu = expectedUtilityBelief(belief, action);\n        factor(params.alpha * eu);\n        return action;\n      });\n    });\n\n  var expectedUtilityBelief = dp.cache(\n    function(belief, action) {\n      return expectation(\n        Infer({\n          method: 'enumerate'\n        }, function() {\n          var state = sampleBelief(belief);\n          var u = utility(state, action);\n          assert.ok(_.isFinite(utility(state, action)), 'utility is not finite. state: ' +\n                    JSON.stringify(state));\n          if (shouldTerminate(state)) {\n            return u;\n          } else {\n            var nextState = transition(state, action);\n            var nextObservation = observe(nextState);\n            var nextBelief = updateBelief(belief, nextObservation, action);\n            var nextAction = sample(act(nextBelief));\n\n            var futureU = expectedUtilityBelief(nextBelief, nextAction);\n            return u + futureU;\n          }\n        }));\n    });\n\n\n  // RECURSE ON STATE (FIXES THE LATENT STATE)\n  var act_recState = dp.cache(\n    function(belief) {\n      return Infer({\n        method: 'enumerate'\n      }, function() {\n        var action = uniformDraw(beliefToActions(belief));\n        var eu = expectedUtilityBelief_recState(belief, action);\n        factor(params.alpha * eu);\n        return action;\n      });\n    });\n\n  var expectedUtilityBelief_recState = dp.cache(\n    function(belief, action) {\n      return expectation(\n        Infer({\n          method: 'enumerate'\n        }, function() {\n          var state = sampleBelief(belief);\n          return expectedUtilityState_recState(belief, state, action);\n        }));\n    });\n\n  var expectedUtilityState_recState = dp.cache(\n    function(belief, state, action) {\n      return expectation( // need this for caching\n        Infer({\n          method: 'enumerate'\n        }, function() {\n          var u = utility(state, action);\n          assert.ok(_.isFinite(utility(state, action)), 'utility is not finite. state: ' +\n                    JSON.stringify(state));\n          if (shouldTerminate(state)) {\n            return u;\n          } else {\n            var nextState = transition(state, action);\n            var nextObservation = observe(nextState);\n            var nextBelief = updateBelief(belief, nextObservation, action);\n            var nextAction = sample(act(nextBelief));\n            var futureU = expectedUtilityState_recState(nextBelief, nextState, nextAction);\n            return u + futureU;\n          }\n        }));\n    });\n\n  var act = params.recurseOnStateOrBelief === 'belief' ? act : act_recState;\n  var expectedUtilityBelief = params.recurseOnStateOrBelief === 'belief' ?\n      expectedUtilityBelief : expectedUtilityBelief_recState;\n\n  return {\n    act: act,\n    expectedUtilityBelief: expectedUtilityBelief,\n    params: params,\n    updateBelief: updateBelief,\n    POMDPFunctions: POMDPFunctions,\n  };\n};\n\n\n// --------------------------------------------------------------------\n// Sub-optimal POMDP agent\n\nvar makePOMDPAgentDelay = function(params, world) {\n\n  assert.ok(hasUtilityPriorBelief(params) && hasTransitionObserve(world),\n            'makePOMDPAgent params and world');\n\n  var defaults = {\n    alpha: 1000,\n    recurseOnStateOrBelief: 'belief',\n    discount: 0,\n    sophisticatedOrNaive: 'naive',\n    noDelays: true,\n    updateMyopic: false,\n    rewardMyopic: false\n  };\n\n  var params = extend(defaults, params);\n\n  if (params.rewardMyopic || params.updateMyopic) {\n    assert.ok(params.noDelays === false && params.sophisticatedOrNaive === 'naive',\n              'rewardMyopic and updateMyopic require Naive agent with delays');\n  }\n\n  assert.ok(params.rewardMyopic === false || params.updateMyopic === false,\n            \"one of rewardMyopic and updateMyopic must be false\");\n\n  // Variables for methods\n  var transition = world.transition;\n  var utility = params.utility;\n\n  var POMDPFunctions = getPOMDPFunctions(params, world);\n  var observe = POMDPFunctions.observe;\n  var beliefToActions = POMDPFunctions.beliefToActions;\n  var sampleBelief = POMDPFunctions.sampleBelief;\n\n  var _updateBelief = POMDPFunctions.updateBelief;\n\n  var updateBelief = function(belief, observation, action, delay) {\n    if (params.updateMyopic && (delay > params.updateMyopic.bound)) {\n\n      // update manifestState (assuming no possibility that isNullAction(action))\n      var nextBelief = Infer({\n        method: 'enumerate'\n      }, function() {\n        var state = sampleBelief(belief);\n        return transition(state, action);\n      });\n      return POMDPFunctions.useManifestLatent ? toDistOverLatent(nextBelief) : nextBelief;\n\n    } else {\n      return _updateBelief(belief, observation, action);\n    };\n  };\n\n\n  // Update the *delay* parameter in *expectedUtility* for sampling\n  // actions and future utilities\n  var transformDelay = function(delay) {\n    var table = {\n      naive: delay + 1,\n      sophisticated: 0\n    };\n    return params.noDelays ? 0 : table[params.sophisticatedOrNaive];\n  };\n\n  var incrementDelay = function(delay) {\n    return params.noDelays ? 0 : delay + 1;\n  };\n\n  // Define the discount function to be used\n  var discountFunction = params.discountFunction ? params.discountFunction :\n      function(delay) {\n        return 1.0 / (1 + params.discount * delay);\n      };\n\n  // Termination condition for *expectedUtility*\n  var shouldTerminate = function(state, delay) {\n    var terminateAfterAction = POMDPFunctions.useManifestLatent ?\n        state.manifestState.terminateAfterAction :\n        state.terminateAfterAction;\n\n    if (terminateAfterAction) {\n      return true;\n    }\n    if (params.rewardMyopic) {\n      return delay >= params.rewardMyopic.bound;\n    }\n    return false;\n  };\n\n\n  // RECURSE ON BELIEF (BELLMAN STYLE)\n  var act = dp.cache(\n    function(belief, delay) {\n      assert.ok(_.isFinite(delay), 'act: delay non-finite. delay: ' + delay);\n      return Infer({\n        method: 'enumerate'\n      }, function() {\n        var action = uniformDraw(beliefToActions(belief));\n        var eu = expectedUtilityBelief(belief, action, delay);\n        factor(params.alpha * eu);\n        return action;\n      });\n    });\n\n  var expectedUtilityBelief = dp.cache(\n    function(belief, action, delay) {\n      return expectation(\n        Infer({\n          method: 'enumerate'\n        }, function() {\n          var state = sampleBelief(belief);\n          assert.ok(_.isFinite(utility(state, action)), 'utility is not finite. state: ' +\n                    JSON.stringify(state));\n          var u = discountFunction(delay) * utility(state, action);\n\n          if (shouldTerminate(state, delay)) {\n            return u;\n          } else {\n            var nextState = transition(state, action);\n\n            var nextObservation = observe(nextState);\n            var transformedDelay = transformDelay(delay);\n\n            var nextBelief = updateBelief(belief, nextObservation, action, transformedDelay);\n            var nextAction = sample(act(nextBelief, transformedDelay));\n\n            var futureU = expectedUtilityBelief(nextBelief, nextAction, incrementDelay(delay));\n            return u + futureU;\n          }\n        }));\n    });\n\n  // RECURSE ON STATE (FIXES THE LATENT STATE)\n  var act_recState = dp.cache(\n    function(belief, delay) {\n      assert.ok(_.isFinite(delay), 'act: delay non-finite. delay: ' + delay);\n      return Infer({\n        method: 'enumerate'\n      }, function() {\n        var action = uniformDraw(beliefToActions(belief));\n        var eu = expectedUtilityBelief_recState(belief, action, delay);\n        factor(params.alpha * eu);\n        return action;\n      });\n    });\n\n  var expectedUtilityBelief_recState = dp.cache(\n    function(belief, action, delay) {\n      return expectation(\n        Infer({\n          method: 'enumerate'\n        }, function() {\n          var state = sampleBelief(belief);\n          return expectedUtilityState_recState(belief, state, action, delay);\n        }));\n    });\n\n  var expectedUtilityState_recState = dp.cache(\n    function(belief, state, action, delay) {\n      return expectation( // need this for caching\n        Infer({\n          method: 'enumerate'\n        }, function() {\n          assert.ok(_.isFinite(utility(state, action)), 'utility is not finite. state: ' +\n                    JSON.stringify(state));\n          var u = discountFunction(delay) * utility(state, action);\n          if (shouldTerminate(state, delay)) {\n            return u;\n          } else {\n            var nextState = transition(state, action);\n            var nextObservation = observe(nextState);\n            var transformedDelay = transformDelay(delay);\n            var nextBelief = updateBelief(belief, nextObservation, action,\n                                          transformedDelay);\n            var nextAction = sample(act_recState(nextBelief, transformedDelay));\n            var futureU = expectedUtilityState_recState(nextBelief, nextState,\n                                                        nextAction,\n                                                        incrementDelay(delay));\n            return u + futureU;\n          }\n        }));\n    });\n\n  var act = params.recurseOnStateOrBelief === 'belief' ? act : act_recState;\n  var expectedUtility = params.recurseOnStateOrBelief === 'belief' ?\n      expectedUtilityBelief : expectedUtilityBelief_recState;\n\n  return { act, updateBelief, expectedUtility, params, POMDPFunctions };\n};\n\n\n// General POMDP wrappers\n\nvar isOptimalPOMDPAgent = function(agentParams) {\n  var optimalProperties = function() {\n    return !(_.has(agentParams, 'noDelays') ||\n             _.has(agentParams, 'discount') ||\n             _.has(agentParams, 'myopic-observations'));\n  }\n  return _.isUndefined(agentParams.optimal) ? optimalProperties() : agentParams.optimal;\n};\n\nvar isManualPOMDPAgent = function(agentParams) {\n  return (_.has(agentParams, 'act') &&\n          _.has(agentParams, 'updateBelief') &&\n          _.has(agentParams, 'params') &&\n          _.has(agentParams.params, 'priorBelief'));\n}\n\nvar makePOMDPAgent = function(params, world) {\n  if (isManualPOMDPAgent(params)) {\n    return extend(params, {\n      POMDPFunctions: getPOMDPFunctions(params.params, world)\n    });\n  } else {\n    return (isOptimalPOMDPAgent(params) ?\n            makePOMDPAgentOptimal(params, world) :\n            makePOMDPAgentDelay(params, world));\n  }\n};\n",filename:"webppl-agents/src/agents/makePOMDPAgent.wppl"},{code:"var simulateMDPAgentOptimal = function(startState, world, agent, outputType) {\n  // if outputType is undefined, default to states\n  var act = agent.act;\n  var transition = world.transition;\n  var outputType = outputType ? outputType : 'states';\n\n  var selectOutput = function(state, action) {\n    var table = {\n      states: state,\n      actions: action,\n      stateAction: [state, action]\n    };\n    return table[outputType];\n  };\n\n  var sampleSequence = function(state) {\n    var action = sample(act(state));\n    var nextState = transition(state, action);\n    var out = selectOutput(state, action);\n    return state.terminateAfterAction ? [out] :\n      [out].concat(sampleSequence(nextState));\n  };\n  return sampleSequence(startState);\n};\n\n\nvar simulateMDPAgentHyperbolic = function(startState, world, agent, outputType) {\n  var act = agent.act;\n  var expectedUtility = agent.expectedUtility;\n  var transition = world.transition;\n  var outputType = outputType ? outputType : 'states';\n\n  var selectOutput = function(state, action) {\n    var table = {\n      states: state,\n      actions: action,\n      stateAction: [state, action]\n    };\n    return table[outputType];\n  };\n\n  var sampleSequence = function(state) {\n    var delay = 0;\n    var action = sample(act(state, delay));\n    var nextState = transition(state, action);\n    var out = selectOutput(state, action);\n    return state.terminateAfterAction ? [out] : [out].concat(sampleSequence(nextState));\n  };\n  return sampleSequence(startState);\n};\n\n\nvar simulateMDP = function(startState, world, agent, outputType) {\n  var params = agent.params;\n  if (isOptimalMDPAgent(params)) {\n    return simulateMDPAgentOptimal(startState, world, agent, outputType)\n  } else {\n    return simulateMDPAgentHyperbolic(startState, world, agent, outputType)\n  }\n};\n",filename:"webppl-agents/src/simulation/simulateMDP.wppl"},{code:"var getSimulateFunction = function(beliefOrBeliefDelay) {\n\n  //TODO add test that agent's prior contains the true startState\n\n  assert.ok(_.includes(['belief', 'beliefDelay'], beliefOrBeliefDelay),\n            'getSimulateFunction invalid input: ' + beliefOrBeliefDelay);\n\n\n  var useDelays = beliefOrBeliefDelay == 'beliefDelay';\n\n\n  return function(startState, world, agent, outputType) {\n    var useManifestLatent = agent.POMDPFunctions.useManifestLatent;\n\n    var totalTime = useManifestLatent ? startState.manifestState.timeLeft : startState.timeLeft;\n\n    //assert.ok(isPOMDPState(startState), 'simulateBeliefDelayAgent args');\n    var validOutputTypes = ['states', 'actions', 'stateAction',\n                            'stateBelief', 'stateObservationAction'];\n    assert.ok(_.includes(validOutputTypes, outputType),\n              \"outputType '\" + outputType + \"' not in \" + JSON.stringify(validOutputTypes));\n\n    var terminateAfterAction = (useManifestLatent ?\n                                startState.manifestState.terminateAfterAction :\n                                startState.terminateAfterAction);\n    assert.ok(totalTime > 1 || startState.manifestState.terminateAfterAction,\n              'if totalTime==1, must also terminateAfterAction');\n\n    // agent methods\n    var agentAct = agent.act;\n    var agentUpdateBelief = agent.updateBelief;\n    var priorBelief = agent.params.priorBelief;\n\n\n    // world methods\n    var transition = world.transition;\n    var observe = agent.POMDPFunctions.observe;\n    var shouldTerminate = agent.POMDPFunctions.shouldTerminate;\n\n    var selectOutput = function(state, observation, action, belief) {\n      var table = {\n        states: state,\n        actions: action,\n        stateAction: [state, action],\n        stateBelief: [state, belief],\n        stateObservationAction: {\n          state: state,\n          observation: observation,\n          action: action\n        }\n      };\n      return table[outputType];\n    };\n\n\n    var sampleSequence = function(state, priorBelief, action) {\n\n      var observation = observe(state);\n      var delay = 0;\n\n      var belief = useDelays ? agentUpdateBelief(priorBelief, observation,\n                                                 action, delay) :\n          agentUpdateBelief(priorBelief, observation, action);\n\n      var action = useDelays ? sample(agentAct(belief, delay)) :\n          sample(agentAct(belief));\n\n      var output = [selectOutput(state, observation, action, belief)];\n\n      if (shouldTerminate(state)) {\n        return output;\n      } else {\n        var nextState = transition(state, action);\n        return output.concat(sampleSequence(nextState, belief, action));\n      }\n    };\n    var startAction = 'noAction';\n    return sampleSequence(startState, priorBelief, startAction);\n  };\n};\n\nvar simulatePOMDPAgent = getSimulateFunction('belief');\nvar simulatePOMDPAgentDelay = getSimulateFunction('beliefDelay');\n\n\nvar simulatePOMDP = function(startState, world, agent, outputType) {\n  var params = agent.params;\n  if (isOptimalPOMDPAgent(params)) {\n    return simulatePOMDPAgent(startState, world, agent, outputType)\n  } else {\n    return simulatePOMDPAgentDelay(startState, world, agent, outputType);\n  }\n};\n",filename:"webppl-agents/src/simulation/simulatePOMDP.wppl"},{code:'var GridWorld = webpplAgents; // reference to the exports of gridworld-viz.js\n\nif (typeof viz !== "undefined") {\n  // make GridWorld.viz also available as viz.gridworld\n  _.extend(viz, { gridworld: webpplAgents.draw });\n}\n',filename:"webppl-agents/src/visualization/gridworld.wppl"},{code:"var extend = function(base, ext){\n  return _.extend({}, base, ext);\n};\n",filename:"webppl-agents/src/extra/extend.wppl"},{code:"var getMarginalObject = function(dist,key){\n  return Infer({ model() {\n    var s = sample(dist);\n    var keys = _.keys(s);\n    var omitKeys = filter(function(el){return el !== key;}, keys);\n    return _.omit(s,omitKeys);\n  }});\n};\n",filename:"webppl-agents/src/extra/getMarginalObject.wppl"},{code:"var _makeRestaurantUtilityFunction = function(world, utilityTable) {\n  assert.ok(_.has(utilityTable, 'Veg') && _.has(utilityTable, 'timeCost'),\n    '_makeRestaurantUtilityFunction: Veg or timeCost is missing');\n\n  var getFeatureName = function(state) {\n    var getFeature = world.feature;\n    return isPOMDPWithManifestLatent(world) ? getFeature(state.manifestState).name :\n      getFeature(state).name;\n  };\n\n  var defaultTimeCost = -.01;\n\n  return function(state, action) {\n    var name = getFeatureName(state);\n\n    // compute whether there are \"double utilities\" (for hyperbolic discounting case)\n    var pairs = utilityTable['Veg'].length == 2;\n\n    if (name) {\n      return pairs ? utilityTable[name][state.timeAtRestaurant] : utilityTable[name];\n    }\n    return utilityTable.timeCost || defaultTimeCost;\n  };\n};\n\n\nvar getRestaurantHyperbolicInfer = function() {\n\n  var factorSequence = function(agentAction, observedStateAction) {\n    map(function(stateAction) {\n      var state = stateAction[0];\n      var action = stateAction[1];\n      factor(agentAction(state, 0).score(action));\n    }, observedStateAction);\n  };\n\n\n  var getPosterior = function(world, prior, observedStateAction, repeatObservations) {\n    var Infer = Enumerate;\n    var priorUtilityTable = prior.utility;\n    var priorDiscounting = prior.discounting;\n    var priorAlpha = prior.alpha;\n\n    return Infer(function() {\n      var utilityTable = priorUtilityTable();\n      var discounting = priorDiscounting();\n      var alpha = priorAlpha();\n\n      var agent = makeMDPAgent({\n        utility: _makeRestaurantUtilityFunction(world, utilityTable),\n        alpha: alpha,\n        discount: discounting.discount,\n        sophisticatedOrNaive: discounting.sophisticatedOrNaive\n      }, world);\n      var agentAction = agent.act;\n\n      factorSequence(agentAction, observedStateAction);\n\n      if (!_.isUndefined(repeatObservations)) {\n        repeat(repeatObservations, function() {\n          factorSequence(agentAction, observedStateAction);\n        });\n      }\n\n      var vegMinusDonut = sum(utilityTable['Veg']) - sum(utilityTable['Donut N']);\n      var donutNGreaterDonutS = sum(utilityTable['Donut S']) < sum(utilityTable['Donut N']);\n\n      var dis = function(d) {\n        return 1 / (1 + discounting.discount * d);\n      };\n      var disUDonut = function(d) {\n        return dis(d) * utilityTable['Donut N'][0] + dis(d + 1) * utilityTable['Donut N'][1];\n      };\n      var disUVeg = function(d) {\n        return dis(d) * utilityTable['Veg'][0] + dis(d + 1) * utilityTable['Veg'][1];\n      };\n      var donutTempting = (disUDonut(4) < disUVeg(6)) && (disUDonut(0) > disUVeg(2));\n\n      return {\n        utility: utilityTable,\n        discount: discounting.discount,\n        alpha: alpha,\n        sophisticatedOrNaive: discounting.sophisticatedOrNaive,\n        vegMinusDonut: vegMinusDonut,\n        donutNGreaterDonutS: donutNGreaterDonutS,\n        timeCost: utilityTable.timeCost,\n        donutTempting: donutTempting\n      };\n    });\n  };\n\n  return { getPosterior };\n};\n",filename:"webppl-agents/src/extra/getRestaurantHyperbolicInfer.wppl"},{code:"var makeBanditStartState = function(numberOfTrials, armToPrizeDist) {\n  return {\n    manifestState: {\n      loc: 'start',\n      timeLeft: numberOfTrials,\n      terminateAfterAction: false\n    },\n    latentState: armToPrizeDist\n  };\n};\n",filename:"webppl-agents/src/extra/makeBanditStartState.wppl"},{code:"var numericBanditUtility = function(state, action) {\n  var prize = state.manifestState.loc;\n  return prize === 'start' ? 0 : prize;\n};\n\n\nvar makeStringBanditUtility = function(prizeToUtility) {\n  return function(state, action) {\n    var prize = state.manifestState.loc;\n    return prize === 'start' ? 0 : prizeToUtility[prize];\n  };\n};\n\n\nvar makeBanditUtility = function(bandit, prizeToUtility) {\n  if (bandit.numericalPrizes) {\n    return numericBanditUtility;\n  } else {\n    var prizesHaveUtilities = function(arm) {\n      var armToPrizeDist = bandit.armToPrizeDist;\n      var dist = armToPrizeDist[arm];\n      map(function(x) {\n        assert.ok(_.isFinite(prizeToUtility[x]) && inSupport(x, dist),\n                  'makeBandit: some prizes do not have utilities');\n      }, dist.support());\n    };\n\n    mapN(prizesHaveUtilities, bandit.numberOfArms);\n\n    return makeStringBanditUtility(prizeToUtility);\n  }\n};\n\n\nvar getMakeAgentFunction = function(beliefOrBeliefDelay) {\n  assert.ok(_.includes(['belief', 'beliefDelay'], beliefOrBeliefDelay),\n            'getMakeAgentFunction invalid input:   ' + beliefOrBeliefDelay);\n\n  if (beliefOrBeliefDelay == 'beliefDelay') {\n    return makePOMDPAgentDelay;\n  } else {\n    return makePOMDPAgentOptimal;\n  }\n};\n\n\nvar makeBanditAgent = function(agentParams, bandit, beliefOrBeliefDelay,\n                               prizeToUtility) {\n\n  var priorBelief = agentParams.priorBelief;\n  var numericalPrizes = bandit.numericalPrizes;\n\n  if (isDistOverLatent(priorBelief)) {\n    assert.ok(_.isEqual(priorBelief.manifestState,\n                        bandit.startState.manifestState),\n              'makeBanditAgent: priorBelief has wrong start manifestState');\n  } else {\n    assert.ok(priorBelief.sample,\n              'makeBanditAgent: priorBelief is neither an Dist nor an object' +\n              ' containing a manifest state and a latentStateDist');\n    assert.ok(_.isEqual(sample(priorBelief).manifestState,\n                        bandit.startState.manifestState),\n              'makeBanditAgent: priorBelief has wrong start manifestState');\n  }\n\n  var utility = makeBanditUtility(bandit, prizeToUtility);\n\n  var makeAgent = getMakeAgentFunction(beliefOrBeliefDelay);\n\n  return makeAgent(extend(agentParams, { utility }),\n                   bandit.world);\n};\n",filename:"webppl-agents/src/extra/makeBanditAgent.wppl"},{code:"// Inference by sampling full trajectories or by doing 'off policy' inference\nvar inferBandit = function(bandit, baseAgentParams, prior, observedStateAction,\n                           trajectoryOrOffPolicy, numRejectionSamples, beliefOrBeliefDelay) {\n  var world = bandit.world;\n  var startState = bandit.startState;\n  var numericPrizes = bandit.numericPrizes;\n\n  //var simulate = getSimulateFunction(beliefOrBeliefDelay);\n\n  var priorPrizeToUtility = prior.priorPrizeToUtility || false;\n  var priorAgentPrior = prior.priorAgentPrior;\n  var priorRewardMyopic = prior.priorRewardMyopic || false;\n\n  assert.ok(isPOMDPWithManifestLatent(world) && stateHasManifestLatent(startState) &&\n            priorAgentPrior.sample,\n            'inferBandit args: \\n\\n startState ' + startState +\n            ' \\n\\n priorAgentPrior' + priorAgentPrior);\n  assert.ok(trajectoryOrOffPolicy === 'trajectory' ||\n            trajectoryOrOffPolicy === 'offPolicy',\n            'inferBandit args: trajectoryOrOffPolicy bad');\n  assert.ok(stateHasManifestLatent(observedStateAction[0][0]),\n            'inferBandit args: observedStateAction first entry of first entry not a POMDP state');\n\n  if (priorPrizeToUtility) {\n    assert.ok(priorPrizeToUtility.sample,\n              'inferBandit args: priorPrizeToUtility defined but not an Dist');\n  }\n\n  if (priorRewardMyopic) {\n    assert.ok(priorRewardMyopic.sample,\n              'inferBandit args: priorMyopia defined but not an Dist');\n  }\n\n\n  return Infer({\n    method: 'enumerate'\n  }, function() {\n    // priors and makeAgent are specific to bandits\n    var prizeToUtility = priorPrizeToUtility ? sample(priorPrizeToUtility) :\n        undefined;\n    var priorBelief = sample(priorAgentPrior);\n    var rewardMyopicUpdate = priorRewardMyopic ? {\n      rewardMyopic: sample(priorRewardMyopic)\n    } : {};\n    var newAgentParams = extend(baseAgentParams, extend({ priorBelief },\n                                                        rewardMyopicUpdate));\n\n    var agent = makeBanditAgent(newAgentParams, bandit, beliefOrBeliefDelay,\n                                prizeToUtility);\n    var agentAct = agent.act;\n    var agentUpdateBelief = agent.updateBelief;\n    var observe = agent.POMDPFunctions.observe;\n\n    // Factor on whole sampled trajectory (SLOW IF NOT DETERMINISTIC AND NUM SAMPLES HIGH)\n    var factorOnTrajectory = function() {\n      var trajectoryDist = Infer({\n        method: 'rejection',\n        samples: numRejectionSamples\n      }, function() {\n        return simulatePOMDP(startState, world, agent, 'states');\n      });\n      factor(trajectoryDist.score(map(first, observedStateAction)));\n    };\n\n    // Move agent through observed sequence \n    var factorSequenceOffPolicy = function(currentBelief, previousAction, timeIndex) {\n      if (timeIndex < observedStateAction.length) {\n\n        // Go to next world state and sample observation from that state\n        var state = observedStateAction[timeIndex][0];\n        var observation = observe(state);\n\n        // Update agent's internal state and get action Dist\n        var delay = 0;\n        var nextBelief = beliefOrBeliefDelay == 'belief' ?\n            agentUpdateBelief(currentBelief, observation, previousAction) :\n            agentUpdateBelief(currentBelief, observation, previousAction, delay);\n\n\n        var nextActionDist = beliefOrBeliefDelay == 'belief' ?\n            agentAct(nextBelief) : agentAct(nextBelief, delay);\n\n        var observedAction = observedStateAction[timeIndex][1];\n        factor(nextActionDist.score(observedAction));\n\n        // condition on next world state, passing through updated internal state\n        factorSequenceOffPolicy(nextBelief, observedAction, timeIndex + 1);\n      }\n    };\n\n    var doInfer = (trajectoryOrOffPolicy == 'trajectory') ? factorOnTrajectory() :\n        factorSequenceOffPolicy(priorBelief, 'noAction', 0);\n\n    var bound = newAgentParams.rewardMyopic ? newAgentParams.rewardMyopic.bound : 0;\n    return { prizeToUtility, priorBelief, rewardMyopicBound: bound };\n  });\n};\n",filename:"webppl-agents/src/extra/inferBandit.wppl"},{code:"// a 'bandit gridworld' is a gridworld POMDP where all restaurants are open,\n// but the agent doesn't know the quality of the food. The manifest states are\n// the same as the states of gridworld MDPs, and the latent state is an object\n// associating restaurant names to the quality of food of that chain (which is\n// assumed to be the agent's utility). When an agent is next to a restaurant, it\n// observes the food quality of that chain (perhaps by looking through the\n// window and seeing how much the patrons like their food).\n// since the structure of bandit gridworld is so similar to that of a gridworld\n// pomdp, we can just use that, and only update the transition function and\n// manifestStateToActions (since we don't need to worry about transitioning\n// into restaurants that are closed)\nvar makeBanditGridWorld = function(options) {\n\n  var gridworldPOMDP = makeGridWorldPOMDP(options);\n  var gridworld = gridworldPOMDP.MDPWorld;\n\n  var mdpTransition = gridworld.transition;\n  var transition = function(state, action) {\n    assert.ok(stateHasManifestLatent(state), 'transition state arg');\n    // transition the manifest state as it would be transitioned in the gridworld\n    // mdp, leave the latent state alone\n    var newManifestState = mdpTransition(state.manifestState, action);\n    return {\n      manifestState: newManifestState,\n      latentState: state.latentState\n    };\n  };\n\n  var manifestStateToActions = gridworld.stateToActions;\n\n  return extend(gridworldPOMDP, {\n    transition: transition,\n    manifestStateToActions: manifestStateToActions\n  });\n\n};\n\nvar makeBanditGridWorldUtility = function(feature, timeCost) {\n  return function(state, action) {\n    var stateFeatureName = feature(state.manifestState).name;\n    if (stateFeatureName) {\n      return state.latentState[stateFeatureName];\n    } else {\n      return timeCost;\n    }\n  };\n};\n\n\nvar makeRestaurantSearchMDPOptions = function(options_) {\n  var A = { name: 'A' };\n  var B = { name: 'B' };\n  var C = { name: 'C' };\n  var D = { name: 'D' };\n  var E = { name: 'E' };\n\n  var options = options_ || {};\n\n  var grid = [\n    ['#', ' ', ' ', '#'],\n    [C, ' ', ' ', '#'],\n    ['#', ' ', '#', '#'],\n    ['#', ' ', B, '#'],\n    [A, ' ', '#', '#'],\n    ['#', ' ', '#', D],\n    ['#', ' ', ' ', ' '],\n    ['#', '#', '#', E]\n  ];\n\n  return extend(options, { grid, noReverse: true });\n};\n\n// start state for restaurant search pomdp\nvar restaurantSearchStartState = {\n  manifestState: {\n    loc: [1, 2],\n    timeLeft: 17,\n    terminateAfterAction: false\n  },\n  latentState: {\n    A: 3,\n    B: 3,\n    C: 4,\n    D: 5,\n    E: 0\n  }\n};\n\n\nvar makeRestaurantSearchPOMDP = function() {\n  var options = makeRestaurantSearchMDPOptions()\n  var world = makeBanditGridWorld(options);\n  var startState = restaurantSearchStartState;\n\n  var feature = world.feature;\n  var makeUtilityFunction = function(timeCost) {\n    return makeBanditGridWorldUtility(feature, timeCost);\n  };\n\n  return {\n    mdp: world.MDPWorld,\n    world: world,\n    startState: startState,\n    makeUtilityFunction: makeUtilityFunction\n  };\n};\n\n",filename:"webppl-agents/src/extra/makeRestaurantSearchPOMDP.wppl"}],version:"v1.0.0-12c8394"},{name:"webppl-nn",js:{identifier:"webpplNn",path:require("/Users/jkhartshorne/Documents/Teaching/probmods2/node_modules/webppl-nn")},headers:[],wppl:[{code:"// This is a first attempt at providing a method for running bits of\n// optimized programs. I think we can do more/better though.\n\n// Calling the regular function `fn` evaluates the function, sampling\n// from the target. Calling the result of usingParams(fn) evaluates\n// the function sampling from the guide.\n\nvar usingGuide = function(fn) {\n  return function() {\n    var args = arguments;\n    sample(Infer({method: 'forward', samples: 1, guide: true, model() {\n      return ad.valueRec(apply(fn, args));\n    }}));\n  };\n};\n\nvar checkNetName = function(name) {\n  return webpplNn.checkNetName(name);\n};\n\nvar mergeObj = function(o1, o2) {\n  return _.assign({}, o1, o2);\n};\n\n// ==================================================\n// Model Parameters\n// ==================================================\n\nvar parameterModel = function(getPrior) {\n  return function(paramOpts) {\n    return sample(getPrior(paramOpts), {guide() {\n      return Delta({v: param(paramOpts)});\n    }});\n  };\n};\n\n// var modelParam = parameterModel(constF(ImproperUniform()));\n\n// The function returned by e.g. modelParamL2(0.1) is analogous the\n// WebPPL's `modelParam`.\n\n// TODO: Consider calling this sampleParamL2 or similar, to hint at\n// the differences between model parameters and `param`?\n\nvar modelParamL2 = function(sigma) {\n  return parameterModel(function(paramOpts) {\n    return (paramOpts && paramOpts.dims) ?\n        TensorGaussian({mu: 0, sigma, dims: paramOpts.dims}) :\n        Gaussian({mu: 0, sigma});\n  });\n};\n\n// ==================================================\n// Neural Networks\n// ==================================================\n\nvar dims = function(x) {\n  return ad.value(x).dims;\n};\n\nvar concat = function(arr) {\n  var t = T.concat(arr);\n  return T.reshape(t, [dims(t)[0], 1]);\n};\n\nvar idMatrix = function(n) {\n  return webpplNn.idMatrix(n);\n};\n\nvar oneHot = function(index, length) {\n  return webpplNn.oneHot(index, length);\n};\n\nvar softplus = function(x) {\n  return T.log(T.add(T.exp(x), 1));\n};\n\nvar softmax = function(x) {\n  return T.softmax(x);\n};\n\nvar squishToProbSimplex = function(x) {\n  return dists.squishToProbSimplex(x);\n};\n\nvar sigmoid = function(x) {\n  return T.sigmoid(x);\n};\n\nvar tanh = function(x) {\n  return T.tanh(x);\n};\n\nvar relu = function(x) {\n  return webpplNn.relu(x);\n};\n\nvar lrelu = function(x) {\n  return webpplNn.lrelu(x);\n};\n\n// Compose several functions in right to left order.\n// stack([f, g, h]) == compose(f, compose(g, h))\nvar stack = function(arr) {\n  return reduce(compose, idF, arr);\n};\n\n// Nets created with \"linear\" default to using a weight initialization\n// based on \"Understanding the difficulty of training deep feedforward\n// neural networks\", often called Xavier initialization.\n\n// TODO: This initialization scheme may not be suitable for asymmetric\n// non-linearities.\n\nvar xavier = function(dims) {\n  assert.ok(dims.length === 2, 'Xavier initialization is only defined for matrices.');\n  var nin = dims[0];\n  var nout = dims[1];\n  var sigma = Math.sqrt(2 / (nin + nout));\n  return tensorGaussian({mu: 0, sigma, dims});\n};\n\n// I switched to creating parameters when a net is constructed rather\n// than when it is used, primarily for the following reason:\n\n// If the parameters are created when the net is used, then it is not\n// possible to use a net that uses model parameters from within\n// Enumerate nested within Optimize. (Because this would attempt to\n// sample the parameters from within Enumerate.) By creating the\n// parameters in the constructor, users have the flexibility required\n// to create a network within `Optimize` and then use the network\n// within nested `Enumerate`.\n\n// Further, making this change also allowed me to remove the cached\n// implementation of model parameters, which existed primarily to\n// support lazy parameter creation. This is probably a good thing,\n// since using this caching across coroutine boundaries seems iffy.\n// For example, even if it was correct, you can imagine been in a\n// situation where you call modelParamL2 within Optimize and later\n// within a nested Enumerate. This would have worked because of\n// caching. But if the call within Optimize is removed, the call\n// within the nested Enumerate will start to fail. (As it is now\n// attempts to sample from a continuous distribution within\n// Enumerate.) This kind of non-local effect is unpleaseant to deal\n// with and best avoided.\n\nvar linear = function(name, maybeArgs) {\n  checkNetName(name);\n  var args = maybeArgs || {};\n  var nin = args.in;\n  var nout = args.out;\n  assert.ok(Number.isInteger(nin), 'Argument \"in\" should be an integer.');\n  assert.ok(Number.isInteger(nout), 'Argument \"out\" should be an integer.');\n  var nnparam = args.param || param;\n  var init = args.init || xavier;\n  var w = nnparam({name, dims: [nout, nin], init});\n  return function(x) {\n    return T.dot(w, x);\n  };\n};\n\n// TODO: It seems pretty common to not apply regularization to biases.\n// Is that important? What would it look like here?\n\nvar bias = function(name, maybeArgs) {\n  checkNetName(name);\n  var args = maybeArgs || {};\n  var nnparam = args.param || param;\n  var initb = _.has(args, 'initb') ? args.initb : 0;\n  assert.ok(_.isNumber(initb), 'Initial bias should be a number.');\n  var nout = args.out;\n  assert.ok(Number.isInteger(nout), 'Argument \"out\" should be an integer.');\n  var b = nnparam({name, dims: [nout, 1], mu: initb, sigma: 0});\n  return function(x) {\n    assert.ok(dims(x)[0] === nout,\n              'Input vector has unexpected dimension.');\n    return T.add(x, b);\n  };\n};\n\nvar affine = function(name, maybeArgs) {\n  checkNetName(name);\n  return compose(\n    bias(name + 'b', maybeArgs),\n    linear(name + 'w', maybeArgs));\n};\n",filename:"webppl-nn/src/nn.wppl"},{code:"// Center and rescale the input. Typical usage is to put this after a\n// linear layer and follow it with a bias and non-linearity, yielding\n// \"Layer normalization\".\n\n// https://arxiv.org/abs/1607.06450\n\nvar layerNorm = function(name, maybeArgs) {\n  checkNetName(name);\n  var args = maybeArgs || {};\n  var nnparam = args.param || param;\n  var nout = args.out;\n  assert.ok(Number.isInteger(nout), 'Argument \"out\" should be an integer.');\n  // Gain parameters.\n  var g = nnparam({name: name + 'g', dims: [nout, 1], mu: 1, sigma: 0});\n  return function(a) {\n    assert.ok(dims(a)[0] === nout,\n              'Input vector has unexpected dimension.');\n    var mu = T.sumreduce(a) / nout;\n    var acentered = T.sub(a, mu);\n    var sd = Math.sqrt(T.sumreduce(T.pow(acentered, 2)) / nout);\n    assert.ok(ad.value(sd) > 0, 'Standard deviation of activations is not positive');\n    return T.mul(T.div(g, sd), acentered);\n  };\n};\n\n// TODO: You can imagine having a convenient way to do a restricted\n// kind of composition of network constructors, where we assume the\n// sub nets are stacked, and each take the same nout param. (Also\n// requires more consistency in the interface of current constructors,\n// e.g. we'd need to do something i like have a version of bias that\n// takes a dummy nout param.) This could be useful for passing novel\n// constructors to gru/lstm etc.\n\nvar affineWithLayerNorm = function(name, maybeArgs) {\n  checkNetName(name);\n  return stack([\n    bias(name + 'b', maybeArgs),\n    layerNorm(name + 'ln', maybeArgs),\n    linear(name + 'w', maybeArgs)\n  ]);\n};\n\n// Linear layer with weight normalization.\n// https://arxiv.org/abs/1602.07868\n\n// It's not clear how we could do the data dependent init., so we\n// resort to Xavier initialization. Is this sensible? The problem is\n// this might be used as part of a recurrent net (which is problematic\n// for the reason mentioned in the paper) and because we don't have a\n// straight-forward way of looking at a 'batch' from here.\n\n// Does it make sense to apply regularization v here, given that we\n// already normalize the length of the row vectors of v? In practice,\n// regularization seems to have a much stronger effect on this\n// parameterization. (You can see this with L2 prior by comparing this\n// with the linear layer on the ml-classifier example.) Removing the\n// prior from v seems to make a difference here.\n\n// Note: When I tried parameterizing g in log space the ml-classifier\n// example often failed to work well. I don't know why.\n\nvar linearWeightNorm = function(name, maybeArgs) {\n  checkNetName(name);\n  var args = maybeArgs || {};\n  var nnparam = args.param || param;\n  var init = args.init || xavier;\n  var nin = args.in;\n  var nout = args.out;\n  assert.ok(Number.isInteger(nin), 'Argument \"in\" should be an integer.');\n  assert.ok(Number.isInteger(nout), 'Argument \"out\" should be an integer.');\n  var g = nnparam({name: name + 'g', dims: [nout, 1], mu: 1, sigma: 0}); // gain\n  var v = nnparam({name: name + 'v', dims: [nout, nin], init});\n  return function(x) {\n    var norm = T.sqrt(webpplNn.sumreduce0(T.pow(v, 2)));\n    return T.mul(T.div(g, norm), T.dot(v, x));\n  };\n};\n\nvar affineWeightNorm = function(name, maybeArgs) {\n  checkNetName(name);\n  return compose(bias(name + 'b', maybeArgs),\n                 linearWeightNorm(name + 'wn', maybeArgs));\n};\n",filename:"webppl-nn/src/normalization.wppl"},{code:"// Traditional RNN\n\nvar rnn = function(name, maybeArgs) {\n  checkNetName(name);\n  var args = maybeArgs || {};\n  var hdim = args.hdim;\n  var xdim = args.xdim;\n  assert.ok(Number.isInteger(hdim), 'Argument \"hdim\" should be an integer.');\n  assert.ok(Number.isInteger(xdim), 'Argument \"xdim\" should be an integer.');\n  var ctor = args.ctor || affine;\n  var output = args.output || tanh;\n  var nargs = mergeObj(args, {in: hdim + xdim, out: hdim});\n  var net = stack([output, ctor(name, nargs), concat]);\n  return function(hprev, x) {\n    assert.ok(dims(hprev)[0] === hdim,\n              'Previous hidden vector has unexpected dimension');\n    assert.ok(dims(x)[0] === xdim,\n              'Input vector has unexpected dimension');\n    return net([hprev, x]);\n  };\n};\n\n// Gated Recurrent Unit\n\n// This is similar to the variant described in \"Empirical Evaluation\n// of Gated Recurrent Neural Networks on Sequence Modeling\", which\n// computes the candidate activation in a slightly different way from\n// the original paper.\n\n// https://arxiv.org/abs/1412.3555\n\nvar gru = function(name, maybeArgs) {\n  checkNetName(name);\n  var args = maybeArgs || {};\n  var hdim = args.hdim;\n  var xdim = args.xdim;\n  assert.ok(Number.isInteger(hdim), 'Argument \"hdim\" should be an integer.');\n  assert.ok(Number.isInteger(xdim), 'Argument \"xdim\" should be an integer.');\n  var ctor = args.ctor || affine;\n  var nargs = mergeObj(args, {in: hdim + xdim, out: hdim});\n  var update = compose(sigmoid, ctor(name + 'update', nargs));\n  var reset = compose(sigmoid, ctor(name + 'reset', nargs));\n  var candidate = compose(tanh, ctor(name + 'candidate', nargs));\n  return function(hprev, x) {\n    assert.ok(dims(hprev)[0] === hdim,\n              'Previous hidden vector has unexpected dimension');\n    assert.ok(dims(x)[0] === xdim,\n              'Input vector has unexpected dimension');\n    var hprevx = concat([hprev, x]);\n    var r = reset(hprevx);\n    var z = update(hprevx);\n    var cand = candidate(concat([T.mul(hprev, r), x]));\n    var oneminusz = T.add(T.neg(z), 1);\n    return T.add(T.mul(oneminusz, hprev), T.mul(z, cand));\n  };\n};\n\n// Long Short Term Memory\n\n// This is similar to the variant described in \"Generating sequences\n// with recurrent neural networks\" (Graves 2013). The difference is\n// that here there are no 'peep-hole' connections. i.e. The previous\n// memory state is not (currently) passed as input to the forget,\n// input, output gates.\n\n// https://arxiv.org/abs/1308.0850\n\nvar lstm = function(name, maybeArgs) {\n  checkNetName(name);\n  var args = maybeArgs || {};\n  var hdim = args.hdim;\n  var xdim = args.xdim;\n  // hdim is the total dimension of the state. i.e. memory + hidden\n  // state vectors. Setting things up this way makes it easy to swap\n  // between gru and lstm.\n  assert.ok(Number.isInteger(hdim) && (hdim % 2 === 0),\n            'Argument \"hdim\" should be an even integer.');\n  assert.ok(Number.isInteger(xdim), 'Argument \"xdim\" should be an integer.');\n\n  var dim = hdim / 2; // Dimension of memory and hidden state.\n  var nargs = mergeObj(args, {in: dim + xdim, out: dim});\n  // It's said that initializing the biases of the forget gate to a\n  // value greater than 0 is a good idea. This is so that the output\n  // is close to one at the start of optimization, ensuring\n  // information is passed along. This is mentioned in e.g. \"An\n  // Empirical Exploration of Recurrent Network Architectures\".\n  var forget = compose(\n    sigmoid,\n    affine(name + 'forget', mergeObj(nargs, {initb: 1})));\n  var input = compose(sigmoid, affine(name + 'input', nargs));\n  var output = compose(sigmoid, affine(name + 'output', nargs));\n  var candidate = compose(tanh, affine(name + 'candidate', nargs));\n  return function(prev, x) {\n    // For compatibility with the interface of e.g. gru we combine the\n    // memory and hidden state into a single vector, prev.\n    assert.ok(dims(prev)[0] === hdim,\n              'Previous state vector has unexpected dimension');\n    assert.ok(dims(x)[0] === xdim,\n              'Input vector has unexpected dimension');\n    var cprev = T.reshape(T.range(prev, 0, dim), [dim, 1]);\n    var hprev = T.reshape(T.range(prev, dim, hdim), [dim, 1]);\n    var hprevx = concat([hprev, x]);\n    var f = forget(hprevx);\n    var i = input(hprevx);\n    var o = output(hprevx);\n    var cand = candidate(hprevx);\n    var c = T.add(T.mul(f, cprev), T.mul(i, cand));\n    var h = T.mul(o, tanh(c));\n    return concat([c, h]);\n  };\n};\n",filename:"webppl-nn/src/recurrent.wppl"}],version:"v0.0.1-12c8394"}];var load=_.once(function(){packages.forEach(function(pkg){if(pkg.js){global[pkg.js.identifier]=pkg.js.path}pkg.headers.forEach(webppl.requireHeaderWrapper)});var bundles=webppl.parsePackageCode(packages);return bundles});function prepare(codeAndAssets,k,options){options=util.mergeDefaults(options,{filename:"webppl:program",errorHandlers:[]});var extraHandlers=options.debug?[errors.debugHandler(options.filename)]:[];options.errorHandlers=extraHandlers.concat(options.errorHandlers);return webppl.prepare(codeAndAssets,k,options)}function run(code,k,options){var codeAndAssets=compile(code,options);prepare(codeAndAssets,k,options).run()}function compile(code,options){options=options||{};var optionsExtended=_.extend({bundles:load()},options);return webppl.compile(code,optionsExtended)}function webpplCPS(code){var programAst=esprima.parse(code);var newProgramAst=optimize(cps(thunkify(programAst)));return escodegen.generate(newProgramAst)}function webpplNaming(code){var programAst=esprima.parse(code);var newProgramAst=naming(thunkify(programAst)).ast;return escodegen.generate(newProgramAst)}global.webppl={prepare:prepare,run:run,compile:compile,cps:webpplCPS,naming:webpplNaming,version:version,packages:packages}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./errors/browser":186,"./main":215,"./syntax":230,"./transforms/cps":237,"./transforms/naming":239,"./transforms/optimize":240,"./util":246,"/Users/jkhartshorne/Documents/Teaching/probmods2/node_modules/webppl-agents":5,"/Users/jkhartshorne/Documents/Teaching/probmods2/node_modules/webppl-dp":6,"/Users/jkhartshorne/Documents/Teaching/probmods2/node_modules/webppl-nn":8,"/Users/jkhartshorne/Documents/Teaching/probmods2/node_modules/webppl-timeit":9,escodegen:53,esprima:111,lodash:124}],155:[function(require,module,exports){"use strict";var ad=require("../ad");var _=require("lodash");var util=require("../util");var inspect=require("util").inspect;function Distribution(){}Distribution.prototype={toJSON:function(){throw new Error("Not implemented")},inspect:function(depth,options){if(_.has(this,"params")){if(this.print){return this.print()}else{return[this.meta.name,"(",inspect(this.params),")"].join("")}}else{var opts=options?_.clone(options):{};opts.customInspect=false;return inspect(this,opts)}},toString:function(){return this.inspect()},isContinuous:false,constructor:Distribution};function isDist(x){return x instanceof Distribution}function clone(dist){return new dist.constructor(dist.params)}var finiteSupport={MAP:function(){var map={score:-Infinity};this.support().forEach(function(val){var score=this.score(val);if(score>map.score){map={val:val,score:score}}},this);return map},entropy:function(){return _.reduce(this.support(),function(memo,x){var score=this.score(x);return ad.scalar.sub(memo,ad.scalar.peq(score,ad.scalar.neg(Infinity))?0:ad.scalar.mul(ad.scalar.exp(score),score))}.bind(this),0)},toJSON:function(){var support=this.support();var probs=support.map(function(s){return Math.exp(this.score(s))},this);return{probs:probs,support:support}}};var continuousSupport={isContinuous:true};var noHMC={noHMC:true};var methodNames=["sample","score","support","print","base","transform"];function makeDistributionType(options){options=util.mergeDefaults(options,{mixins:[]});["name","params"].forEach(function(name){if(!_.has(options,name)){console.log(options);throw new Error("makeDistributionType: "+name+" is required.")}});if(options.score){var originalScoreFn=options.score;options.score=function(val){if(arguments.length!==1){throw new Error("The score method of "+this.meta.name+" expected 1 argument but received "+arguments.length+".")}return originalScoreFn.call(this,val)}}var parameterNames=_.map(options.params,"name");var parameterTypes=_.map(options.params,function(param){if(_.has(param,"type")&&!(param.type&&param.type.check)){throw new Error("Invalid type given for parameter "+param.name+" of "+options.name+".")}return param.type});var parameterOptionalFlags=_.map(options.params,"optional");var extraConstructorFn=options.constructor;var dist=function(params,skipParamChecks){params=params||{};if(!skipParamChecks){parameterNames.forEach(function(p,i){if(params.hasOwnProperty(p)){var type=parameterTypes[i];if(type&&!type.check(ad.valueRec(params[p]))){throw new Error('Parameter "'+p+'" should be of type "'+type.desc+'".')}}else{if(!parameterOptionalFlags[i]){throw new Error('Parameter "'+p+'" missing from '+this.meta.name+" distribution.")}}},this)}this.params=params;if(extraConstructorFn!==undefined){extraConstructorFn.call(this)}};dist.prototype=Object.create(Distribution.prototype);dist.prototype.constructor=dist;dist.prototype.meta=_.pick(options,"name","desc","params","nodoc","nohelper","wikipedia");_.assign.apply(_,[dist.prototype].concat(options.mixins));_.assign(dist.prototype,_.pick(options,methodNames));["sample","score"].forEach(function(method){if(!dist.prototype[method]){throw new Error('makeDistributionType: method "'+method+'" not defined for '+options.name)}});return dist}module.exports={makeDistributionType:makeDistributionType,finiteSupport:finiteSupport,continuousSupport:continuousSupport,noHMC:noHMC,isDist:isDist,clone:clone}},{"../ad":151,"../util":246,lodash:124,util:254}],156:[function(require,module,exports){"use strict";var ad=require("../ad");var base=require("./base");var util=require("../util");var types=require("../types");var Bernoulli=base.makeDistributionType({name:"Bernoulli",desc:"Distribution over ``{true, false}``",params:[{name:"p",desc:"success probability",type:types.unitInterval}],wikipedia:true,mixins:[base.finiteSupport],sample:function(){return util.random()<ad.value(this.params.p)},score:function(val){if(ad.scalar.pneq(val,true)&&ad.scalar.pneq(val,false)){return ad.scalar.neg(Infinity)}return val?ad.scalar.log(this.params.p):ad.scalar.log(ad.scalar.sub(1,this.params.p))},support:function(){return[true,false]}});module.exports={Bernoulli:Bernoulli}},{"../ad":151,"../types":245,"../util":246,"./base":155}],157:[function(require,module,exports){"use strict";var ad=require("../ad");var base=require("./base");var types=require("../types");var util=require("../util");var gaussian=require("./gaussian");function expGammaSample(shape,scale){if(shape<1){var r;r=expGammaSample(1+shape,scale)+Math.log(util.random())/shape;if(r===-Infinity){util.warn("log gamma sample underflow, rounded to nearest representable support value");return-Number.MAX_VALUE}return r}var x,v,u,log_v;var d=shape-1/3;var c=1/Math.sqrt(9*d);while(true){do{x=gaussian.sample(0,1);v=1+c*x}while(v<=0);log_v=3*Math.log(v);v=v*v*v;u=util.random();if(u<1-.331*x*x*x*x||Math.log(u)<.5*x*x+d*(1-v+Math.log(v))){return Math.log(scale)+Math.log(d)+log_v}}}function expGammaScore(shape,scale,val){var x=val;return ad.scalar.sub(ad.scalar.sub(ad.scalar.sub(ad.scalar.mul(ad.scalar.sub(shape,1),x),ad.scalar.div(ad.scalar.exp(x),scale)),ad.scalar.logGamma(shape)),ad.scalar.mul(shape,ad.scalar.log(scale)))}function logBeta(a,b){return ad.scalar.sub(ad.scalar.add(ad.scalar.logGamma(a),ad.scalar.logGamma(b)),ad.scalar.logGamma(ad.scalar.add(a,b)))}function sample(a,b){var log_x=expGammaSample(a,1);var log_y=expGammaSample(b,1);var v=1/(1+Math.exp(log_y-log_x));if(v===0){util.warn("beta sample underflow, rounded to nearest representable support value");v=Number.MIN_VALUE}else if(v===1){util.warn("beta sample overflow, rounded to nearest representable support value");v=1-Number.EPSILON/2}return v}var Beta=base.makeDistributionType({name:"Beta",desc:"Distribution over ``[0, 1]``",params:[{name:"a",desc:"shape",type:types.positiveReal},{name:"b",desc:"shape",type:types.positiveReal}],wikipedia:true,mixins:[base.continuousSupport],sample:function(){return sample(ad.value(this.params.a),ad.value(this.params.b))},score:function(x){var a=this.params.a;var b=this.params.b;return ad.scalar.gt(x,0)&&ad.scalar.lt(x,1)?ad.scalar.sub(ad.scalar.add(ad.scalar.mul(ad.scalar.sub(a,1),ad.scalar.log(x)),ad.scalar.mul(ad.scalar.sub(b,1),ad.scalar.log(ad.scalar.sub(1,x)))),logBeta(a,b)):ad.scalar.neg(Infinity)},support:function(){return{lower:0,upper:1}}});module.exports={Beta:Beta,sample:sample}},{"../ad":151,"../types":245,"../util":246,"./base":155,"./gaussian":167}],158:[function(require,module,exports){"use strict";var ad=require("../ad");var _=require("lodash");var base=require("./base");var types=require("../types");var util=require("../util");var beta=require("./beta");function lnfactExact(x){if(ad.scalar.lt(x,0)){throw new Error(ad.scalar.add("lnfactExact called on negative argument ",x))}if(ad.scalar.lt(x,1)){x=1}var t=0;while(ad.scalar.gt(x,1)){t=ad.scalar.add(t,ad.scalar.log(x));x=ad.scalar.sub(x,1)}return t}function sample(p,n){var k=0;var N=10;var a,b;while(n>N){a=Math.floor(1+n/2);b=1+n-a;var x=beta.sample(a,b);if(x>=p){n=a-1;p/=x}else{k+=a;n=b-1;p=(p-x)/(1-x)}}var u;for(var i=0;i<n;i++){u=util.random();if(u<p){k++}}return k||0}var Binomial=base.makeDistributionType({name:"Binomial",desc:"Distribution over the number of successes for ``n`` independent ``Bernoulli({p: p})`` trials.",params:[{name:"p",desc:"success probability",type:types.unitInterval},{name:"n",desc:"number of trials",type:types.positiveInt}],wikipedia:true,mixins:[base.finiteSupport],sample:function(){return sample(ad.value(this.params.p),this.params.n)},score:function(val){var p=this.params.p;var n=this.params.n;if(!(ad.scalar.peq(typeof val,"number")&&ad.scalar.geq(val,0)&&ad.scalar.leq(val,n)&&ad.scalar.peq(val%1,0))){return ad.scalar.neg(Infinity)}var logNumPermutations=0;var m,o;if(ad.scalar.lt(val,ad.scalar.sub(n,val))){m=val;o=ad.scalar.sub(n,val)}else{m=ad.scalar.sub(n,val);o=val}for(var i=ad.scalar.add(o,1);ad.scalar.leq(i,n);i++){logNumPermutations=ad.scalar.add(logNumPermutations,ad.scalar.log(i))}logNumPermutations=ad.scalar.sub(logNumPermutations,lnfactExact(m));return ad.scalar.add(ad.scalar.add(logNumPermutations,ad.scalar.eq(val,0)?0:ad.scalar.mul(val,ad.scalar.log(p))),ad.scalar.eq(ad.scalar.sub(n,val),0)?0:ad.scalar.mul(ad.scalar.sub(n,val),ad.scalar.log(ad.scalar.sub(1,p))))},support:function(){return _.range(0,this.params.n+1)}});module.exports={Binomial:Binomial,sample:sample}},{"../ad":151,"../types":245,"../util":246,"./base":155,"./beta":157,lodash:124}],159:[function(require,module,exports){"use strict";var ad=require("../ad");var _=require("lodash");var base=require("./base");var types=require("../types");var util=require("../util");var numeric=require("../math/numeric");var Marginal=require("./marginal").Marginal;var T=ad.tensor;var Categorical=base.makeDistributionType({name:"Categorical",desc:"Distribution over elements of ``vs`` with ``P(vs[i])`` proportional to ``ps[i]``. "+"``ps`` may be omitted, in which case a uniform distribution over ``vs`` is returned.",params:[{name:"ps",desc:"probabilities (can be unnormalized)",type:types.nonNegativeVectorOrRealArray,optional:true},{name:"vs",desc:"support",type:types.array(types.any)}],wikipedia:true,mixins:[base.finiteSupport],constructor:function(){if(ad.scalar.peq(this.params.ps,undefined)){this.params={ps:_.fill(Array(this.params.vs.length),1),vs:this.params.vs}}var ps=this.params.ps;var vs=this.params.vs;if(ad.scalar.pneq(vs.length,ad.value(ps).length)){throw new Error("Parameters ps and vs should have the same length.")}if(ad.scalar.peq(vs.length,0)){throw new Error("Parameters ps and vs should have length > 0.")}var dist={};var norm=_.isArray(ps)?numeric.sum(ps):T.sumreduce(ps);for(var i in vs){var val=vs[i];var k=util.serialize(val);if(!_.has(dist,k)){dist[k]={val:val,prob:0}}dist[k].prob=ad.scalar.add(dist[k].prob,ad.scalar.div(_.isArray(ps)?ps[i]:T.get(ps,i),norm))}this.marginal=new Marginal({dist:dist})},sample:function(){return this.marginal.sample()},score:function(val){return this.marginal.score(val)},support:function(){return this.marginal.support()}});module.exports={Categorical:Categorical}},{"../ad":151,"../math/numeric":218,"../types":245,"../util":246,"./base":155,"./marginal":175,lodash:124}],160:[function(require,module,exports){"use strict";var ad=require("../ad");var base=require("./base");var types=require("../types");var util=require("../util");var numeric=require("../math/numeric");var Uniform=require("./uniform").Uniform;var LOG_PI=numeric.LOG_PI;var Cauchy=base.makeDistributionType({name:"Cauchy",desc:"Distribution over ``[-Infinity, Infinity]``",params:[{name:"location",desc:"",type:types.unboundedReal},{name:"scale",desc:"",type:types.positiveReal}],wikipedia:true,mixins:[base.continuousSupport],sample:function(){var u=util.random();return ad.value(this.params.location)+ad.value(this.params.scale)*Math.tan(Math.PI*(u-.5))},score:function(x){var scale=this.params.scale;var location=this.params.location;return ad.scalar.sub(ad.scalar.sub(ad.scalar.neg(LOG_PI),ad.scalar.log(scale)),ad.scalar.log(ad.scalar.add(1,ad.scalar.pow(ad.scalar.div(ad.scalar.sub(x,location),scale),2))))},base:function(){return new Uniform({a:0,b:1})},transform:function(x){var location=this.params.location;var scale=this.params.scale;return ad.scalar.add(location,ad.scalar.mul(scale,ad.scalar.tan(ad.scalar.mul(ad.scalar.PI,ad.scalar.sub(x,.5)))))}});module.exports={Cauchy:Cauchy}},{"../ad":151,"../math/numeric":218,"../types":245,"../util":246,"./base":155,"./uniform":185}],161:[function(require,module,exports){"use strict";var ad=require("../ad");var base=require("./base");var types=require("../types");var Delta=base.makeDistributionType({name:"Delta",desc:"Discrete distribution that assigns probability one to the single "+"element in its support. This is only useful in special circumstances as sampling "+"from ``Delta({v: val})`` can be replaced with ``val`` itself. Furthermore, a ``Delta`` "+"distribution parameterized by a random choice should not be used with MCMC based inference, "+"as doing so produces incorrect results.",params:[{name:"v",desc:"support element",type:types.any}],mixins:[base.finiteSupport],sample:function(){return ad.value(this.params.v)},score:function(val){return ad.value(val)===ad.value(this.params.v)?0:-Infinity},support:function(){return[this.params.v]},base:function(){return this},transform:function(x){return this.params.v}});module.exports={Delta:Delta}},{"../ad":151,"../types":245,"./base":155}],162:[function(require,module,exports){"use strict";var ad=require("../ad");var base=require("./base");var types=require("../types");var util=require("../util");var Tensor=require("../tensor");var numeric=require("../math/numeric");var gaussian=require("./gaussian");var TensorGaussian=require("./tensorGaussian").TensorGaussian;var LOG_2PI=numeric.LOG_2PI;function sample(mu,sigma){var dims=mu.dims;var x=new Tensor(dims);var n=x.length;while(n--){x.data[n]=gaussian.sample(mu.data[n],sigma.data[n])}return x}function score(mu,sigma,x){var _x=ad.value(x);var _mu=ad.value(mu);if(!util.isTensor(_x)||!util.tensorEqDims(_x,_mu)){return-Infinity}var d=_mu.length;var dLog2Pi=d*LOG_2PI;var logDetCov=ad.scalar.mul(2,ad.tensor.sumreduce(ad.tensor.log(sigma)));var z=ad.tensor.div(ad.tensor.sub(x,mu),sigma);return ad.scalar.mul(-.5,ad.scalar.add(dLog2Pi,ad.scalar.add(logDetCov,ad.tensor.sumreduce(ad.tensor.mul(z,z)))))}var DiagCovGaussian=base.makeDistributionType({name:"DiagCovGaussian",desc:"A distribution over tensors in which each element is independent and Gaussian distributed, "+"with its own mean and standard deviation. i.e. A multivariate Gaussian distribution with "+"diagonal covariance matrix. The distribution is over tensors that have the same shape as the "+"parameters ``mu`` and ``sigma``, which in turn must have the same shape as each other.",params:[{name:"mu",desc:"mean",type:types.unboundedTensor},{name:"sigma",desc:"standard deviations",type:types.positiveTensor}],mixins:[base.continuousSupport],constructor:function(){var _mu=ad.value(this.params.mu);var _sigma=ad.value(this.params.sigma);if(!util.tensorEqDims(_mu,_sigma)){throw new Error(this.meta.name+": mu and sigma should be the same shape.")}},sample:function(){return sample(ad.value(this.params.mu),ad.value(this.params.sigma))},score:function(x){return score(this.params.mu,this.params.sigma,x)},base:function(){var dims=ad.value(this.params.mu).dims;return new TensorGaussian({mu:0,sigma:1,dims:dims})},transform:function(x){var mu=this.params.mu;var sigma=this.params.sigma;return ad.tensor.add(ad.tensor.mul(sigma,x),mu)}});module.exports={DiagCovGaussian:DiagCovGaussian,sample:sample,score:score}},{"../ad":151,"../math/numeric":218,"../tensor":231,"../types":245,"../util":246,"./base":155,"./gaussian":167,"./tensorGaussian":183}],163:[function(require,module,exports){"use strict";var ad=require("../ad");var base=require("./base");var types=require("../types");var util=require("../util");var Tensor=require("../tensor");var gamma=require("./gamma");function sample(alpha){var n=alpha.dims[0];var ssum=0;var theta=new Tensor([n,1]);var t;for(var i=0;i<n;i++){t=gamma.sample(alpha.data[i],1);theta.data[i]=t;ssum+=t}for(var j=0;j<n;j++){theta.data[j]/=ssum;if(theta.data[j]===0){theta.data[j]=Number.MIN_VALUE}if(theta.data[j]===1){theta.data[j]=1-Number.EPSILON/2}}return theta}function score(alpha,val){var _val=ad.value(val);var _alpha=ad.value(alpha);if(!util.isVector(_val)||!util.tensorEqDim0(_val,_alpha)){return-Infinity}return ad.scalar.add(ad.tensor.sumreduce(ad.tensor.sub(ad.tensor.mul(ad.tensor.sub(alpha,1),ad.tensor.log(val)),ad.tensor.logGamma(alpha))),ad.scalar.logGamma(ad.tensor.sumreduce(alpha)))}var Dirichlet=base.makeDistributionType({name:"Dirichlet",desc:"Distribution over probability vectors. "+"If ``alpha`` has length ``d`` then the distribution "+"is over probability vectors of length ``d``.",params:[{name:"alpha",desc:"concentration",type:types.positiveVector}],wikipedia:true,mixins:[base.continuousSupport,base.noHMC],sample:function(){return sample(ad.value(this.params.alpha))},score:function(val){return score(this.params.alpha,val)}});module.exports={Dirichlet:Dirichlet}},{"../ad":151,"../tensor":231,"../types":245,"../util":246,"./base":155,"./gamma":166}],164:[function(require,module,exports){"use strict";var ad=require("../ad");var _=require("lodash");var base=require("./base");var types=require("../types");var util=require("../util");var numeric=require("../math/numeric");var T=ad.tensor;function sample(theta,thetaSum){if(thetaSum===undefined){thetaSum=numeric._sum(theta)}var x=util.random()*thetaSum;var k=theta.length;var probAccum=0;for(var i=0;i<k;i++){probAccum+=theta[i];if(x<probAccum){return i}}return k-1}function scoreVector(val,probs,norm){return ad.scalar.log(ad.scalar.div(T.get(probs,val),norm))}function scoreArray(val,probs,norm){return ad.scalar.log(ad.scalar.div(probs[val],norm))}function inSupport(val,dim){return val===Math.floor(val)&&0<=val&&val<dim}function toUnliftedArray(x){return _.isArray(x)?x.map(ad.value):ad.value(x).data}var Discrete=base.makeDistributionType({name:"Discrete",desc:"Distribution over ``{0,1,...,ps.length-1}`` with P(i) proportional to ``ps[i]``",params:[{name:"ps",desc:"probabilities (can be unnormalized)",type:types.nonNegativeVectorOrRealArray}],wikipedia:"Categorical_distribution",mixins:[base.finiteSupport],constructor:function(){if(_.isArray(this.params.ps)){this.norm=numeric.sum(this.params.ps);this.scoreFn=scoreArray;this.dim=this.params.ps.length}else{this.norm=T.sumreduce(this.params.ps);this.scoreFn=scoreVector;this.dim=ad.value(this.params.ps).length}},sample:function(){return sample(toUnliftedArray(this.params.ps),ad.value(this.norm))},score:function(val){if(inSupport(val,this.dim)){return this.scoreFn(val,this.params.ps,this.norm)}else{return-Infinity}},support:function(){return _.range(this.dim)}});module.exports={Discrete:Discrete,sample:sample}},{"../ad":151,"../math/numeric":218,"../types":245,"../util":246,"./base":155,lodash:124}],165:[function(require,module,exports){"use strict";var ad=require("../ad");var base=require("./base");var types=require("../types");var util=require("../util");var Uniform=require("./uniform").Uniform;var Exponential=base.makeDistributionType({name:"Exponential",desc:"Distribution over ``[0, Infinity]``",params:[{name:"a",desc:"rate",type:types.positiveReal}],wikipedia:true,mixins:[base.continuousSupport],sample:function(){var u=util.random();return Math.log(u)/(-1*ad.value(this.params.a))},score:function(val){return ad.scalar.geq(val,0)?ad.scalar.sub(ad.scalar.log(this.params.a),ad.scalar.mul(this.params.a,val)):ad.scalar.neg(Infinity)},base:function(){return new Uniform({a:0,b:1})},transform:function(x){return ad.scalar.div(ad.scalar.log(x),ad.scalar.neg(this.params.a))},support:function(){return{lower:0,upper:Infinity}}});module.exports={Exponential:Exponential}},{"../ad":151,"../types":245,"../util":246,"./base":155,"./uniform":185}],166:[function(require,module,exports){"use strict";var ad=require("../ad");var base=require("./base");var types=require("../types");var util=require("../util");var gaussian=require("./gaussian");function sample(shape,scale){if(shape<1){var r;r=sample(1+shape,scale)*Math.pow(util.random(),1/shape);if(r===0){util.warn("gamma sample underflow, rounded to nearest representable support value");return Number.MIN_VALUE}return r}var x,v,u;var d=shape-1/3;var c=1/Math.sqrt(9*d);while(true){do{x=gaussian.sample(0,1);v=1+c*x}while(v<=0);v=v*v*v;u=util.random();if(u<1-.331*x*x*x*x||Math.log(u)<.5*x*x+d*(1-v+Math.log(v))){return scale*d*v}}}var Gamma=base.makeDistributionType({name:"Gamma",desc:"Distribution over positive reals.",params:[{name:"shape",desc:"",type:types.positiveReal},{name:"scale",desc:"",type:types.positiveReal}],wikipedia:true,mixins:[base.continuousSupport],sample:function(){return sample(ad.value(this.params.shape),ad.value(this.params.scale))},score:function(x){var shape=this.params.shape;var scale=this.params.scale;return ad.scalar.sub(ad.scalar.sub(ad.scalar.sub(ad.scalar.mul(ad.scalar.sub(shape,1),ad.scalar.log(x)),ad.scalar.div(x,scale)),ad.scalar.logGamma(shape)),ad.scalar.mul(shape,ad.scalar.log(scale)))},support:function(){return{lower:0,upper:Infinity}}});module.exports={Gamma:Gamma,sample:sample}},{"../ad":151,"../types":245,"../util":246,"./base":155,"./gaussian":167}],167:[function(require,module,exports){"use strict";var ad=require("../ad");var base=require("./base");var types=require("../types");var util=require("../util");var numeric=require("../math/numeric");var LOG_2PI=numeric.LOG_2PI;function sample(mu,sigma){var u,v,x,y,q;do{u=1-util.random();v=1.7156*(util.random()-.5);x=u-.449871;y=Math.abs(v)+.386595;q=x*x+y*(.196*y-.25472*x)}while(q>=.27597&&(q>.27846||v*v>-4*u*u*Math.log(u)));return mu+sigma*v/u}function score(mu,sigma,x){return ad.scalar.mul(ad.scalar.neg(.5),ad.scalar.add(ad.scalar.add(LOG_2PI,ad.scalar.mul(2,ad.scalar.log(sigma))),ad.scalar.div(ad.scalar.mul(ad.scalar.sub(x,mu),ad.scalar.sub(x,mu)),ad.scalar.mul(sigma,sigma))))}var Gaussian=base.makeDistributionType({name:"Gaussian",desc:"Distribution over reals.",params:[{name:"mu",desc:"mean",type:types.unboundedReal},{name:"sigma",desc:"standard deviation",type:types.positiveReal}],wikipedia:"Normal_distribution",mixins:[base.continuousSupport],sample:function(){return sample(ad.value(this.params.mu),ad.value(this.params.sigma))},score:function(x){return score(this.params.mu,this.params.sigma,x)},base:function(){return new Gaussian({mu:0,sigma:1})},transform:function(x){var mu=this.params.mu;var sigma=this.params.sigma;return ad.scalar.add(ad.scalar.mul(sigma,x),mu)}});module.exports={Gaussian:Gaussian,sample:sample,score:score}},{"../ad":151,"../math/numeric":218,"../types":245,"../util":246,"./base":155}],168:[function(require,module,exports){"use strict";var ad=require("../ad");var base=require("./base");var ImproperUniform=base.makeDistributionType({name:"ImproperUniform",desc:"Improper continuous uniform distribution which has probability one everywhere.",params:[],nodoc:true,nohelper:true,mixins:[base.continuousSupport],sample:function(){throw new Error("cannot sample from this improper distribution.")},score:function(val){return 0}});module.exports={ImproperUniform:ImproperUniform}},{"../ad":151,"./base":155}],169:[function(require,module,exports){"use strict";var ad=require("../ad");var _=require("lodash");var util=require("../util");var base=require("./base");var distributions=_.chain([["Bernoulli",require("./bernoulli")],["Beta",require("./beta")],["Binomial",require("./binomial")],["Categorical",require("./categorical")],["Cauchy",require("./cauchy")],["Delta",require("./delta")],["DiagCovGaussian",require("./diagCovGaussian")],["Dirichlet",require("./dirichlet")],["Discrete",require("./discrete")],["Exponential",require("./exponential")],["Gamma",require("./gamma")],["Gaussian",require("./gaussian")],["ImproperUniform",require("./improperUniform")],["IspNormal",require("./ispNormal")],["KDE",require("./kde")],["Laplace",require("./laplace")],["LogisticNormal",require("./logisticNormal")],["LogitNormal",require("./logitNormal")],["Marginal",require("./marginal")],["Mixture",require("./mixture")],["Multinomial",require("./multinomial")],["MultivariateBernoulli",require("./multivariateBernoulli")],["MultivariateGaussian",require("./multivariateGaussian")],["Poisson",require("./poisson")],["RandomInteger",require("./randomInteger")],["SampleBasedMarginal",require("./sampleBasedMarginal")],["TensorGaussian",require("./tensorGaussian")],["TensorLaplace",require("./tensorLaplace")],["Uniform",require("./uniform")]]).fromPairs().mapValues(function(module,name){return module[name]}).value();function metadata(){return _.chain(distributions).toPairs().sortBy(function(pair){return pair[0]}).map(function(pair){return pair[1]}).map(function(dist){return dist.prototype.meta}).value()}var wpplFns=_.chain(distributions).mapValues(function(ctor){return function(s,k,a,params){if(arguments.length>4){throw new Error("Too many arguments. Distributions take at most one argument.")}return k(s,new ctor(params))}}).mapKeys(function(ctor,name){return"make"+name}).value();var serialize=function(dist){return util.serialize(dist)};var deserialize=function(JSONString){var obj=util.deserialize(JSONString);if(!obj.probs||!obj.support){throw new Error("Cannot deserialize a non-distribution JSON object: "+JSONString)}return new distributions.Categorical({ps:obj.probs,vs:obj.support})};module.exports=_.assign({metadata:metadata,isDist:base.isDist,clone:base.clone,serialize:serialize,deserialize:deserialize},distributions,wpplFns)},{"../ad":151,"../util":246,"./base":155,"./bernoulli":156,"./beta":157,"./binomial":158,"./categorical":159,"./cauchy":160,"./delta":161,"./diagCovGaussian":162,"./dirichlet":163,"./discrete":164,"./exponential":165,"./gamma":166,"./gaussian":167,"./improperUniform":168,"./ispNormal":170,"./kde":171,"./laplace":172,"./logisticNormal":173,"./logitNormal":174,"./marginal":175,"./mixture":176,"./multinomial":177,"./multivariateBernoulli":178,"./multivariateGaussian":179,"./poisson":180,"./randomInteger":181,"./sampleBasedMarginal":182,"./tensorGaussian":183,"./tensorLaplace":184,"./uniform":185,lodash:124}],170:[function(require,module,exports){"use strict";var ad=require("../ad");var base=require("./base");var types=require("../types");var gaussian=require("./gaussian");var Gaussian=gaussian.Gaussian;var IspNormal=base.makeDistributionType({name:"IspNormal",nodoc:true,desc:"A distribution over positive reals obtained by mapping a Gaussian "+"distributed variable through the softplus function.",params:[{name:"mu",desc:"location",type:types.unboundedReal},{name:"sigma",desc:"scale",type:types.positiveReal}],mixins:[base.continuousSupport],sample:function(){var mu=ad.value(this.params.mu);var sigma=ad.value(this.params.sigma);return Math.log(Math.exp(gaussian.sample(mu,sigma))+1)},score:function(val){var mu=this.params.mu;var sigma=this.params.sigma;var x=ad.scalar.log(ad.scalar.sub(ad.scalar.exp(val),1));return ad.scalar.sub(ad.scalar.add(gaussian.score(mu,sigma,x),val),x)},base:function(){return new Gaussian({mu:0,sigma:1})},transform:function(x){var mu=this.params.mu;var sigma=this.params.sigma;return ad.scalar.log(ad.scalar.add(ad.scalar.exp(ad.scalar.add(ad.scalar.mul(x,sigma),mu)),1))},support:function(){return{lower:0,upper:Infinity}}});module.exports={IspNormal:IspNormal}},{"../ad":151,"../types":245,"./base":155,"./gaussian":167}],171:[function(require,module,exports){"use strict";var ad=require("../ad");var _=require("lodash");var base=require("./base");var types=require("../types");var util=require("../util");var Tensor=require("../tensor");var stats=require("../math/statistics");var numeric=require("../math/numeric");var gaussian=require("./gaussian");var diagCovGaussian=require("./diagCovGaussian");var kernels={gaussian:{dataType:types.unboundedReal,widthType:types.positiveReal,sample:gaussian.sample,score:gaussian.score,defaultWidth:function(data){var sd=stats.sd(data);var n=data.length;var width=1.06*sd*Math.pow(n,-.2);return width}},mvGaussian:{dataType:types.unboundedVector,widthType:types.positiveVectorCB,sample:diagCovGaussian.sample,score:diagCovGaussian.score,defaultWidth:function(data){var d=data[0].dims[0];var n=data.length;var mean=data.reduce(function(acc,x){return acc.add(x)}).div(n);var sd=data.reduce(function(acc,x){return acc.add(x.sub(mean).pow(2))},new Tensor(data[0].dims)).div(n).sqrt();return sd.mul(Math.pow(4/(d+2),1/(d+4))*Math.pow(n,-1/(d+4)))}}};var KDE=base.makeDistributionType({name:"KDE",desc:"A distribution based on a kernel density estimate of ``data``. "+"A Gaussian kernel is used, and both real and vector valued data are supported. "+"When the data are vector valued, ``width`` should be a vector specifying the kernel "+"width for each dimension of the data. "+"When ``width`` is omitted, Silverman's rule of thumb "+"is used to select a kernel width. This rule assumes the data are "+"approximately Gaussian distributed. When this assumption does not hold, a ``width`` "+"should be specified in order to obtain sensible results.",params:[{name:"data",desc:"data array"},{name:"width",desc:"kernel width",optional:true}],wikipedia:"Kernel_density_estimation",nohelper:true,mixins:[base.continuousSupport],constructor:function(){if(!_.isArray(this.params.data)||_.isEmpty(this.params.data)){throw new Error('Parameter "data" should be a non-empty array.')}var data=this.params.data;this.kernel=_.find(kernels,function(kernel){return kernel.dataType.check(data[0])});if(!this.kernel){throw new Error('Parameter "data" should be an array of reals or vectors.')}if(this.params.width===undefined){this.params.width=this.kernel.defaultWidth(this.params.data)}if(!this.kernel.widthType.check(this.params.width)){throw new Error('Parameter "width" should be of type '+this.kernel.widthType.desc)}},sample:function(){var data=this.params.data;var width=this.params.width;var x=data[Math.floor(util.random()*data.length)];return this.kernel.sample(x,width)},score:function(val){var data=this.params.data;var width=this.params.width;var n=data.length;var kernel=this.kernel;return data.reduce(function(acc,x){return numeric.logaddexp(acc,kernel.score(x,width,val))},-Infinity)-Math.log(n)}});module.exports={KDE:KDE}},{"../ad":151,"../math/numeric":218,"../math/statistics":220,"../tensor":231,"../types":245,"../util":246,"./base":155,"./diagCovGaussian":162,"./gaussian":167,lodash:124}],172:[function(require,module,exports){"use strict";var ad=require("../ad");var base=require("./base");var types=require("../types");var util=require("../util");function sample(location,scale){var z=util.random();var u=z-.5;return location-scale*Math.sign(u)*Math.log(1-2*Math.abs(u))}function score(location,scale,x){return ad.scalar.mul(ad.scalar.neg(1),ad.scalar.add(ad.scalar.log(ad.scalar.mul(2,scale)),ad.scalar.div(ad.scalar.abs(ad.scalar.sub(x,location)),scale)))}var Laplace=base.makeDistributionType({name:"Laplace",desc:"Distribution over ``[-Infinity, Infinity]``",params:[{name:"location",desc:"",type:types.unboundedReal},{name:"scale",desc:"",type:types.positiveReal}],wikipedia:true,mixins:[base.continuousSupport],sample:function(){return sample(ad.value(this.params.location),ad.value(this.params.scale))},score:function(val){return score(this.params.location,this.params.scale,val)},base:function(){return new Laplace({location:0,scale:1})},transform:function(x){var location=this.params.location;var scale=this.params.scale;return ad.scalar.add(ad.scalar.mul(scale,x),location)},support:function(){return{lower:-Infinity,upper:Infinity}}});module.exports={Laplace:Laplace,sample:sample}},{"../ad":151,"../types":245,"../util":246,"./base":155}],173:[function(require,module,exports){"use strict";var ad=require("../ad");var base=require("./base");var types=require("../types");var util=require("../util");var numeric=require("../math/numeric");var diagCovGaussian=require("./diagCovGaussian");var TensorGaussian=require("./tensorGaussian").TensorGaussian;var LogisticNormal=base.makeDistributionType({name:"LogisticNormal",desc:"A distribution over probability vectors obtained by transforming a random variable "+"drawn from ``DiagCovGaussian({mu: mu, sigma: sigma})``. If ``mu`` and ``sigma`` have length ``d`` "+"then the distribution is over probability vectors of length ``d+1``.",params:[{name:"mu",desc:"mean",type:types.unboundedVector},{name:"sigma",desc:"standard deviations",type:types.positiveVector}],wikipedia:"Logit-normal_distribution#Multivariate_generalization",mixins:[base.continuousSupport,base.noHMC],constructor:function(){var _mu=ad.value(this.params.mu);var _sigma=ad.value(this.params.sigma);if(!util.tensorEqDim0(_mu,_sigma)){throw new Error(this.meta.name+": mu and sigma should have the same length.")}},sample:function(){return numeric.squishToProbSimplex(diagCovGaussian.sample(ad.value(this.params.mu),ad.value(this.params.sigma)))},score:function(val){var mu=this.params.mu;var sigma=this.params.sigma;var _mu=ad.value(mu);var _val=ad.value(val);if(!util.isVector(_val)||_val.dims[0]-1!==_mu.dims[0]){return-Infinity}var d=_mu.dims[0];var u=ad.tensor.reshape(ad.tensor.range(val,0,d),[d,1]);var u_last=ad.tensor.get(val,d);var inv=ad.tensor.log(ad.tensor.div(u,u_last));var normScore=diagCovGaussian.score(mu,sigma,inv);return ad.scalar.sub(normScore,ad.tensor.sumreduce(ad.tensor.log(val)))},base:function(){var dims=ad.value(this.params.mu).dims;return new TensorGaussian({mu:0,sigma:1,dims:dims})},transform:function(x){var mu=this.params.mu;var sigma=this.params.sigma;return numeric.squishToProbSimplex(ad.tensor.add(ad.tensor.mul(sigma,x),mu))}});module.exports={LogisticNormal:LogisticNormal}},{"../ad":151,"../math/numeric":218,"../types":245,"../util":246,"./base":155,"./diagCovGaussian":162,"./tensorGaussian":183}],174:[function(require,module,exports){"use strict";var ad=require("../ad");var base=require("./base");var types=require("../types");var gaussian=require("./gaussian");var Gaussian=gaussian.Gaussian;var LogitNormal=base.makeDistributionType({name:"LogitNormal",desc:"A distribution over ``(a,b)`` obtained by scaling and shifting a standard logit-normal.",params:[{name:"mu",desc:"location",type:types.unboundedReal},{name:"sigma",desc:"scale",type:types.positiveReal},{name:"a",desc:"lower bound",type:types.unboundedReal},{name:"b",desc:"upper bound (>a)",type:types.unboundedReal}],wikipedia:"Logit-normal_distribution",mixins:[base.continuousSupport],sample:function(){var a=ad.value(this.params.a);var b=ad.value(this.params.b);var mu=ad.value(this.params.mu);var sigma=ad.value(this.params.sigma);var x=gaussian.sample(mu,sigma);return ad.scalar.sigmoid(x)*(b-a)+a},score:function(val){var a=this.params.a;var b=this.params.b;var y=ad.scalar.div(ad.scalar.sub(val,a),ad.scalar.sub(b,a));var x=ad.scalar.log(ad.scalar.div(y,ad.scalar.sub(1,y)));var gaussScore=gaussian.score(this.params.mu,this.params.sigma,x);return ad.scalar.sub(gaussScore,ad.scalar.log(ad.scalar.mul(ad.scalar.mul(y,ad.scalar.sub(1,y)),ad.scalar.sub(b,a))))},base:function(){return new Gaussian({mu:0,sigma:1})},transform:function(x){var a=this.params.a;var b=this.params.b;var mu=this.params.mu;var sigma=this.params.sigma;return ad.scalar.add(ad.scalar.mul(ad.scalar.sigmoid(ad.scalar.add(ad.scalar.mul(x,sigma),mu)),ad.scalar.sub(b,a)),a)},support:function(){return{lower:this.params.a,upper:this.params.b}}});module.exports={LogitNormal:LogitNormal}},{"../ad":151,"../types":245,"./base":155,"./gaussian":167}],175:[function(require,module,exports){"use strict";var ad=require("../ad");var _=require("lodash");var assert=require("assert");var util=require("../util");var base=require("./base");var Marginal=base.makeDistributionType({name:"Marginal",nodoc:true,nohelper:true,params:[{name:"dist"}],mixins:[base.finiteSupport],constructor:function(){var norm=_.reduce(this.params.dist,function(acc,obj){return ad.scalar.add(acc,obj.prob)},0);assert.ok(ad.scalar.lt(ad.scalar.abs(ad.scalar.sub(1,norm)),1e-8),"Expected marginal distribution to be normalized.");this.supp=_.map(this.params.dist,function(obj){return obj.val});this.getDist=function(){return this.params.dist}},sample:function(){var x=util.random();var dist=this.params.dist;var probAccum=0;for(var i in dist){if(dist.hasOwnProperty(i)){probAccum=ad.scalar.add(probAccum,dist[i].prob);if(ad.scalar.lt(x,probAccum)){return dist[i].val}}}return this.params.dist[i].val},score:function(val){var obj=this.params.dist[util.serialize(val)];return obj?ad.scalar.log(obj.prob):ad.scalar.neg(Infinity)},support:function(){return this.supp},print:function(){return print(this.params.dist)}});function print(dist){return"Marginal:\n"+_.map(dist,function(obj,val){return[val,obj.prob]}).sort(function(a,b){return b[1]-a[1]}).map(function(pair){return"    "+pair[0]+" : "+pair[1]}).join("\n")}module.exports={Marginal:Marginal,print:print}},{"../ad":151,"../util":246,"./base":155,assert:248,lodash:124}],176:[function(require,module,exports){"use strict";var ad=require("../ad");var _=require("lodash");var base=require("./base");var types=require("../types");var numeric=require("../math/numeric");var util=require("../util");var Discrete=require("./discrete").Discrete;function continuousSupportEq(s1,s2){return s1===s2||s1!==undefined&&s2!==undefined&&s1.lower===s2.lower&&s1.upper===s2.upper}function unionDiscreteSupports(supports){return _.chain(supports).flatten().uniqWith(supportElemEq).value()}function supportElemEq(x,y){return util.serialize(x)===util.serialize(y)}var Mixture=base.makeDistributionType({name:"Mixture",desc:"A finite mixture of distributions. "+"The component distributions should be either all discrete or all continuous. "+"All continuous distributions should share a common support.",params:[{name:"dists",desc:"array of component distributions"},{name:"ps",desc:"component probabilities (can be unnormalized)",type:types.nonNegativeVectorOrRealArray}],wikipedia:false,constructor:function(){var dists=this.params.dists;var ps=this.params.ps;if(!_.isArray(dists)){throw new Error("Parameter dists should be an array.")}if(dists.length!==ad.value(ps).length){throw new Error("Parameters ps and dists should have the same length.")}if(dists.length===0){throw new Error("Parameters ps and dists should be non-empty.")}if(!_.every(dists,base.isDist)){throw new Error("Parameter dists should be an array of distributions.")}this.isContinuous=dists[0].isContinuous;var support_0=this.isContinuous?dists[0].support&&dists[0].support():undefined;for(var i=1;i<dists.length;i++){var dist_i=dists[i];if(dist_i.isContinuous!==this.isContinuous){throw new Error("Mixtures combining discrete and continuous distributions are not supported.")}if(this.isContinuous){var support_i=dist_i.support&&dist_i.support();if(!continuousSupportEq(support_0,support_i)){throw new Error("All continuous distributions should have the same support.")}}}if(this.isContinuous){this.support=support_0&&_.constant(support_0)}else{this.support=function(){return unionDiscreteSupports(_.invokeMap(dists,"support"))}}this.indicatorDist=new Discrete({ps:ps},true)},sample:function(){var i=this.indicatorDist.sample();return this.params.dists[i].sample()},score:function(val){var dists=this.params.dists;var s=ad.scalar.neg(Infinity);for(var i=0;ad.scalar.lt(i,dists.length);i++){s=numeric.logaddexp(s,ad.scalar.add(this.indicatorDist.score(i),dists[i].score(val)))}return s}});module.exports={Mixture:Mixture}},{"../ad":151,"../math/numeric":218,"../types":245,"../util":246,"./base":155,"./discrete":164,lodash:124}],177:[function(require,module,exports){"use strict";var ad=require("../ad");var _=require("lodash");var base=require("./base");var types=require("../types");var numeric=require("../math/numeric");var discrete=require("./discrete");function zeros(n){var a=new Array(n);for(var i=0;i<n;i++){a[i]=0}return a}function sample(theta,n){var a=zeros(theta.length);for(var i=0;i<n;i++){a[discrete.sample(theta)]++}return a}var Multinomial=base.makeDistributionType({name:"Multinomial",desc:"Distribution over counts for ``n`` independent ``Discrete({ps: ps})`` trials.",params:[{name:"ps",desc:"probabilities",type:types.probabilityArray},{name:"n",desc:"number of trials",type:types.positiveInt}],wikipedia:true,mixins:[base.finiteSupport],sample:function(){return sample(this.params.ps.map(ad.value),this.params.n)},score:function(val){if(ad.scalar.pneq(numeric.sum(val),this.params.n)){return ad.scalar.neg(Infinity)}var x=[];var y=[];for(var i=0;ad.scalar.lt(i,this.params.ps.length);i++){x[i]=numeric.lnfact(val[i]);y[i]=ad.scalar.peq(val[i],0)?0:ad.scalar.mul(val[i],ad.scalar.log(this.params.ps[i]))}return ad.scalar.add(ad.scalar.sub(numeric.lnfact(this.params.n),numeric.sum(x)),numeric.sum(y))},support:function(){var combinations=allDiscreteCombinations(this.params.n,this.params.ps,[],0);var toHist=function(l){return buildHistogramFromCombinations(l,this.params.ps)}.bind(this);var hists=combinations.map(toHist);return hists}});function allDiscreteCombinations(k,states,got,pos){var support=[];if(got.length==k){return[_.clone(got)]}for(var i=pos;i<states.length;i++){got.push(i);support=support.concat(allDiscreteCombinations(k,states,got,i));got.pop()}return support}function buildHistogramFromCombinations(samples,states){var stateIndices=_.range(states.length);var zeroHist=_.chain(stateIndices).map(function(i){return[i,0]}).object().value();var hist=_.defaults(_.countBy(samples),zeroHist);var array=_.sortBy(hist,function(val,key){return key});return array}module.exports={Multinomial:Multinomial}},{"../ad":151,"../math/numeric":218,"../types":245,"./base":155,"./discrete":164,lodash:124}],178:[function(require,module,exports){"use strict";var ad=require("../ad");var _=require("lodash");var assert=require("assert");var base=require("./base");var types=require("../types");var util=require("../util");var Tensor=require("../tensor");function mvBernoulliScore(ps,x){var _x=ad.value(x);var _ps=ad.value(ps);if(!util.isVector(_x)||!util.tensorEqDim0(_x,_ps)){return-Infinity}var xSub1=ad.tensor.sub(x,1);var pSub1=ad.tensor.sub(ps,1);return ad.tensor.sumreduce(ad.tensor.log(ad.tensor.add(ad.tensor.mul(x,ps),ad.tensor.mul(xSub1,pSub1))))}var MultivariateBernoulli=base.makeDistributionType({name:"MultivariateBernoulli",desc:"Distribution over a vector of independent Bernoulli variables. Each element "+"of the vector takes on a value in ``{0, 1}``. Note that this differs from ``Bernoulli`` which "+"has support ``{true, false}``.",params:[{name:"ps",desc:"probabilities",type:types.unitIntervalVector}],mixins:[base.finiteSupport],sample:function(){var ps=ad.value(this.params.ps);var d=ps.dims[0];var x=new Tensor([d,1]);var n=x.length;while(n--){x.data[n]=util.random()<ps.data[n]}return x},score:function(x){return mvBernoulliScore(this.params.ps,x)},support:function(){var dims=this.params.ps.dims;var d=dims[0];var n=Math.pow(2,d);return _.times(n,function(x){return new Tensor(dims).fromFlatArray(toBinaryArray(x,d))})}});function toBinaryArray(x,length){assert.ok(x>=0&&x<Math.pow(2,length));var arr=[];for(var i=0;i<length;i++){arr.push(x%2);x=x>>1}return arr}module.exports={MultivariateBernoulli:MultivariateBernoulli}},{"../ad":151,"../tensor":231,"../types":245,"../util":246,"./base":155,assert:248,lodash:124}],179:[function(require,module,exports){"use strict";var ad=require("../ad");var base=require("./base");var types=require("../types");var util=require("../util");var Tensor=require("../tensor");var numeric=require("../math/numeric");var gaussian=require("./gaussian");var TensorGaussian=require("./tensorGaussian").TensorGaussian;var T=ad.tensor;var LOG_2PI=numeric.LOG_2PI;function sample(mu,cov){var d=mu.dims[0];var z=new Tensor([d,1]);for(var i=0;i<d;i++){z.data[i]=gaussian.sample(0,1)}var L=cov.cholesky();return L.dot(z).add(mu)}function score(mu,cov,x){var _x=ad.value(x);var _mu=ad.value(mu);if(!util.isVector(_x)||!util.tensorEqDim0(_x,_mu)){return-Infinity}var d=_mu.dims[0];var dLog2Pi=d*LOG_2PI;var det=ad.tensor.determinant(cov);if(ad.value(det)<=0){throw new Error("The covariance matrix is not positive definite.")}var logDetCov=ad.scalar.log(det);var z=ad.tensor.sub(x,mu);var zT=ad.tensor.transpose(z);var prec=ad.tensor.inverse(cov);return ad.scalar.mul(-.5,ad.scalar.add(dLog2Pi,ad.scalar.add(logDetCov,ad.tensor.get(ad.tensor.dot(ad.tensor.dot(zT,prec),z),0))))}var MultivariateGaussian=base.makeDistributionType({name:"MultivariateGaussian",desc:"Multivariate Gaussian distribution with full covariance matrix. "+"If ``mu`` has length d and ``cov`` is a ``d``-by-``d`` matrix, "+"then the distribution is over vectors of length ``d``.",params:[{name:"mu",desc:"mean",type:types.unboundedVector},{name:"cov",desc:"covariance",type:types.posDefMatrix}],wikipedia:"Multivariate_normal_distribution",mixins:[base.continuousSupport],constructor:function(){var _mu=ad.value(this.params.mu);var _cov=ad.value(this.params.cov);if(!util.tensorEqDim0(_mu,_cov)){throw new Error(this.meta.name+": dimension mismatch between mu and cov.")}},sample:function(){return sample(ad.value(this.params.mu),ad.value(this.params.cov))},score:function(val){return score(this.params.mu,this.params.cov,val)},base:function(){var dims=ad.value(this.params.mu).dims;return new TensorGaussian({mu:0,sigma:1,dims:dims})},transform:function(x){var mu=this.params.mu;var cov=this.params.cov;var L=T.cholesky(cov);return T.add(T.dot(L,x),mu)}});module.exports={MultivariateGaussian:MultivariateGaussian}},{"../ad":151,"../math/numeric":218,"../tensor":231,"../types":245,"../util":246,"./base":155,"./gaussian":167,"./tensorGaussian":183}],180:[function(require,module,exports){"use strict";var ad=require("../ad");var base=require("./base");var types=require("../types");var util=require("../util");var numeric=require("../math/numeric");var gamma=require("./gamma");var binomial=require("./binomial");function sample(mu){var k=0;while(mu>10){var m=Math.floor(7/8*mu);var x=gamma.sample(m,1);if(x>=mu){return k+binomial.sample(mu/x,m-1)}else{mu-=x;k+=m}}var emu=Math.exp(-mu);var p=1;do{p*=util.random();k++}while(p>emu);return k-1}var Poisson=base.makeDistributionType({name:"Poisson",desc:"Distribution over integers.",params:[{name:"mu",desc:"mean",type:types.positiveReal}],wikipedia:true,sample:function(){return sample(ad.value(this.params.mu))},score:function(val){return ad.scalar.sub(ad.scalar.sub(ad.scalar.mul(val,ad.scalar.log(this.params.mu)),this.params.mu),numeric.lnfact(val))}});module.exports={Poisson:Poisson,sample:sample}},{"../ad":151,"../math/numeric":218,"../types":245,"../util":246,"./base":155,"./binomial":158,"./gamma":166}],181:[function(require,module,exports){"use strict";var ad=require("../ad");var _=require("lodash");var base=require("./base");var types=require("../types");var util=require("../util");var RandomInteger=base.makeDistributionType({name:"RandomInteger",desc:"Uniform distribution over ``{0,1,...,n-1}``",params:[{name:"n",desc:"number of possible values",type:types.positiveInt}],wikipedia:"Uniform_distribution_(discrete)",mixins:[base.finiteSupport],sample:function(){return Math.floor(util.random()*this.params.n)},score:function(val){var inSupport=ad.scalar.peq(val,ad.scalar.floor(val))&&ad.scalar.leq(0,val)&&ad.scalar.lt(val,this.params.n);return inSupport?ad.scalar.neg(ad.scalar.log(this.params.n)):ad.scalar.neg(Infinity)},support:function(){return _.range(this.params.n)}});module.exports={RandomInteger:RandomInteger}},{"../ad":151,"../types":245,"../util":246,"./base":155,lodash:124}],182:[function(require,module,exports){"use strict";var ad=require("../ad");var _=require("lodash");var base=require("./base");var util=require("../util");var marginal=require("./marginal");var SampleBasedMarginal=base.makeDistributionType({name:"SampleBasedMarginal",nodoc:true,nohelper:true,params:[{name:"samples"}],mixins:[base.finiteSupport],constructor:function(){if(!_.isArray(this.params.samples)||this.params.samples.length===0){throw new Error("Expected samples to be a non-empty array.")}this.samples=this.params.samples;this.getDist=function(){if(this._cacheddist){return this._cacheddist}else{var dist={};this.params.samples.forEach(function(obj){var val=obj.value;var key=util.serialize(val);if(dist[key]===undefined){dist[key]={val:val,prob:0}}dist[key].prob+=1});var n=this.params.samples.length;_.each(dist,function(obj){obj.prob/=n});this._cacheddist=dist;return dist}}},sample:function(){var n=this.params.samples.length;return this.params.samples[Math.floor(util.random()*n)].value},score:function(val){var key=util.serialize(val);var obj=this.getDist()[key];return obj===undefined?-Infinity:Math.log(obj.prob)},support:function(){if(this.params.samples.length===1){return[this.params.samples[0].value]}else if(this._cachedsupport){return this._cachedsupport}else{var support=_.map(this.getDist(),_.property("val"));this._cachedsupport=support;return support}},print:function(){return marginal.print(this.getDist())}});module.exports={SampleBasedMarginal:SampleBasedMarginal}},{"../ad":151,"../util":246,"./base":155,"./marginal":175,lodash:124}],183:[function(require,module,exports){"use strict";var ad=require("../ad");var _=require("lodash");var base=require("./base");var types=require("../types");var util=require("../util");var Tensor=require("../tensor");var numeric=require("../math/numeric");var gaussian=require("./gaussian");var LOG_2PI=numeric.LOG_2PI;function sample(mu,sigma,dims){var x=new Tensor(dims);var n=x.length;while(n--){x.data[n]=gaussian.sample(mu,sigma)}return x}function score(mu,sigma,dims,x){var _x=ad.value(x);if(!util.isTensor(_x)||!_.isEqual(_x.dims,dims)){return-Infinity}var d=_x.length;var dLog2Pi=d*LOG_2PI;var _2dLogSigma=ad.scalar.mul(2*d,ad.scalar.log(sigma));var sigma2=ad.scalar.pow(sigma,2);var xSubMu=ad.tensor.sub(x,mu);var z=ad.scalar.div(ad.tensor.sumreduce(ad.tensor.mul(xSubMu,xSubMu)),sigma2);return ad.scalar.mul(-.5,ad.scalar.sum(dLog2Pi,_2dLogSigma,z))}var TensorGaussian=base.makeDistributionType({name:"TensorGaussian",desc:"Distribution over a tensor of independent Gaussian variables.",params:[{name:"mu",desc:"mean",type:types.unboundedReal},{name:"sigma",desc:"standard deviation",type:types.positiveReal},{name:"dims",desc:"dimension of tensor",type:types.array(types.positiveInt)}],mixins:[base.continuousSupport],sample:function(){var mu=ad.value(this.params.mu);var sigma=ad.value(this.params.sigma);var dims=this.params.dims;return sample(mu,sigma,dims)},score:function(x){return score(this.params.mu,this.params.sigma,this.params.dims,x)},base:function(){var dims=this.params.dims;return new TensorGaussian({mu:0,sigma:1,dims:dims})},transform:function(x){var mu=this.params.mu;var sigma=this.params.sigma;return ad.tensor.add(ad.tensor.mul(x,sigma),mu)}});module.exports={TensorGaussian:TensorGaussian,sample:sample}},{"../ad":151,"../math/numeric":218,"../tensor":231,"../types":245,"../util":246,"./base":155,"./gaussian":167,lodash:124}],184:[function(require,module,exports){"use strict";var ad=require("../ad");var _=require("lodash");var base=require("./base");var types=require("../types");var util=require("../util");var Tensor=require("../tensor");var laplace=require("./laplace");var T=ad.tensor;function sample(location,scale,dims){var x=new Tensor(dims);var n=x.length;while(n--){x.data[n]=laplace.sample(location,scale)}return x}function score(location,scale,dims,x){var _x=ad.value(x);if(!util.isTensor(_x)||!_.isEqual(_x.dims,dims)){return ad.scalar.neg(Infinity)}var l=_x.length;var ln2b=ad.scalar.mul(l,ad.scalar.log(ad.scalar.mul(2,scale)));var xMuB=ad.scalar.div(T.sumreduce(T.abs(T.sub(x,location))),scale);return ad.scalar.mul(ad.scalar.neg(1),ad.scalar.add(ln2b,xMuB))}var TensorLaplace=base.makeDistributionType({name:"TensorLaplace",desc:"Distribution over a tensor of independent Laplace variables.",params:[{name:"location",desc:"",type:types.unboundedReal},{name:"scale",desc:"",type:types.positiveReal},{name:"dims",desc:"dimension of tensor",type:types.array(types.positiveInt)}],mixins:[base.continuousSupport],sample:function(){var location=ad.value(this.params.location);var scale=ad.value(this.params.scale);var dims=this.params.dims;return sample(location,scale,dims)},score:function(x){return score(this.params.location,this.params.scale,this.params.dims,x)},base:function(){var dims=this.params.dims;return new TensorLaplace({location:0,scale:1,dims:dims})},transform:function(x){var location=this.params.location;var scale=this.params.scale;return ad.tensor.add(ad.tensor.mul(x,scale),location)}});module.exports={TensorLaplace:TensorLaplace}},{"../ad":151,"../tensor":231,"../types":245,"../util":246,"./base":155,"./laplace":172,lodash:124}],185:[function(require,module,exports){"use strict";var ad=require("../ad");var base=require("./base");var types=require("../types");var util=require("../util");var Uniform=base.makeDistributionType({name:"Uniform",desc:"Continuous uniform distribution over ``[a, b]``",params:[{name:"a",desc:"lower bound",type:types.unboundedReal},{name:"b",desc:"upper bound (>a)",type:types.unboundedReal}],wikipedia:"Uniform_distribution_(continuous)",mixins:[base.continuousSupport],sample:function(){var u=util.random();return(1-u)*ad.value(this.params.a)+u*ad.value(this.params.b)},score:function(val){if(ad.scalar.lt(val,this.params.a)||ad.scalar.gt(val,this.params.b)){return ad.scalar.neg(Infinity)}return ad.scalar.neg(ad.scalar.log(ad.scalar.sub(this.params.b,this.params.a)))},support:function(){return{lower:this.params.a,upper:this.params.b}}});module.exports={Uniform:Uniform}},{"../ad":151,"../types":245,"../util":246,"./base":155}],186:[function(require,module,exports){"use strict";var _=require("lodash");var errors=require("./errors");var parseV8=require("./parsers").parseV8;function isChrome(){return window.chrome&&window.chrome.runtime}function extendErrorChrome(error,fileName){var stack=errors.recoverStack(error,parseV8);var entry=_.find(stack,{fileName:fileName});error.wpplError=entry}function debugHandler(fileName){return function(error){if(error instanceof Error&&isChrome()){extendErrorChrome(error,fileName)}throw error}}module.exports={debugHandler:debugHandler}},{"./errors":187,"./parsers":188,lodash:124}],187:[function(require,module,exports){"use strict";var assert=require("assert");var _=require("lodash");var SourceMap=require("source-map");var util=require("../util");function extendError(error,assets,currentAddress){if(error instanceof Error){error.sourceMap=assets.sourceMap;error.wpplCallStack=addressToWpplCallStack(currentAddress.value,assets.addressMap);error.wpplRuntimeError=true}}function addressToStack(address){if(address===undefined){return[]}var addUnderscore=function(s){return"_"+s};var split=address.split("_").slice(1).map(addUnderscore);split.reverse();return split}function addressToWpplCallStack(address,addressMap){var stack=addressToStack(address);return _.chain(stack).map(function(id){var loc=addressMap[id];return loc&&loc.start&&{fileName:loc.source,lineNumber:loc.start.line,columnNumber:loc.start.column,native:false,webppl:true,name:loc.name,id:id}}).filter().value()}function recoverStack(error,parseStack){return _.flow([parseStack,filterJsStackTrace,function(s){return sourceMapJsStackTrace(s,error.sourceMap)},function(s){return s.concat(error.wpplCallStack)}])(error)}function filterJsStackTrace(stackTrace){var ix=_.findIndex(stackTrace,_.matches({webppl:true}));return ix>=0?stackTrace.slice(0,ix+1):stackTrace}function filterGensym(name){return name===null||name.slice(0,7)==="_result"?null:name}function sourceMapJsStackTrace(stackTrace,sourceMap){var map=new SourceMap.SourceMapConsumer(sourceMap);return _.chain(stackTrace).map(function(entry){if(entry.webppl){var pos=map.originalPositionFor({line:entry.lineNumber,column:entry.columnNumber});if(positionPopulated(pos)){return{fileName:pos.source,lineNumber:pos.line,columnNumber:pos.column,native:entry.native,webppl:true,name:filterGensym(pos.name)}}else{return null}}else{return entry}}).filter().value()}function positionPopulated(pos){return pos.source!==null&&pos.line!==null&&pos.column!==null}module.exports={recoverStack:recoverStack,extendError:extendError}},{"../util":246,assert:248,lodash:124,"source-map":148}],188:[function(require,module,exports){"use strict";var assert=require("assert");var _=require("lodash");var stackTrace=require("stack-trace");function parseV8(error){assert.ok(error instanceof Error);var parsed=stackTrace.parse(error);return parsed.map(function(entry){var e=_.pick(entry,"fileName","lineNumber","columnNumber","native");e.webppl=entry.fileName==="<anonymous>";if(entry.columnNumber!==null){e.columnNumber=entry.columnNumber-1}e.name=null;return e})}module.exports={parseV8:parseV8}},{assert:248,lodash:124,"stack-trace":149}],189:[function(require,module,exports){"use strict";var _=require("lodash");var util=require("./util");var Tensor=require("./tensor");var ad=require("./ad");var dists=require("./dists");var params=require("./params/params");var numeric=require("./math/numeric");var T=ad.tensor;function notAllowed(fn){return function(){throw new Error(fn+" cannot be used within the guide.")}}var sampleNotAllowed=notAllowed("sample");var factorNotAllowed=notAllowed("factor");function guideCoroutine(env){return{sample:sampleNotAllowed,factor:factorNotAllowed,incrementalize:env.defaultCoroutine.incrementalize,oldCoroutine:env.coroutine,_guide:true}}function runInCoroutine(coroutine,env,k,f){var prevCoroutine=env.coroutine;env.coroutine=coroutine;return f(function(s,val){env.coroutine=prevCoroutine;return k(s,val)})}function runThunk(thunk,env,s,a,k){if(!_.isFunction(thunk)){throw new Error("The guide is expected to be a function.")}return runInCoroutine(guideCoroutine(env),env,k,function(k){return thunk(s,function(s2,val){return function(){return k(s2,val)}},a+"_guide")})}function runDistThunk(thunk,env,s,a,k){return runThunk(thunk,env,s,a,function(s2,dist){if(!dists.isDist(dist)){throw new Error("The guide did not return a distribution.")}return k(s2,dist)})}function runDistThunkCond(s,k,a,env,maybeThunk,alternate){return maybeThunk?runDistThunk(maybeThunk,env,s,a,k):alternate(s,k,a)}function getDist(maybeThunk,noAutoGuide,targetDist,env,s,a,k){return runDistThunkCond(s,k,a,env,maybeThunk,function(s,k,a){return k(s,noAutoGuide?null:independent(targetDist,a,env))})}function independent(targetDist,sampleAddress,env){util.warn("Using the default guide distribution for one or more choices.",true);var relativeAddress=util.relativizeAddress(params.baseAddress(env),sampleAddress);var baseName=relativeAddress+"$mf$"+targetDist.meta.name+"$";var distSpec=spec(targetDist);var guideParams=_.mapValues(distSpec.params,function(spec,name){return _.has(spec,"param")?makeParam(spec.param,name,baseName,env):spec.const});return new distSpec.type(guideParams)}function makeParam(paramSpec,paramName,baseName,env){var dims=paramSpec.dims;var squish=paramSpec.squish;var name=baseName+paramName;var param=registerParam(env,name,dims);if(squish){param=squish(param)}if(dims.length===1&&dims[0]===1){param=ad.tensor.get(param,0)}return param}function registerParam(env,name,dims){if(!params.exists(name)){params.create(name,new Tensor(dims))}return params.fetch(name,env)}function spec(targetDist){if(targetDist instanceof dists.Dirichlet){return dirichletSpec(targetDist)}else if(targetDist instanceof dists.TensorGaussian){return tensorGaussianSpec(targetDist)}else if(targetDist instanceof dists.Uniform){return uniformSpec(targetDist)}else if(targetDist instanceof dists.Gamma){return gammaSpec(targetDist)}else if(targetDist instanceof dists.Beta){return betaSpec(targetDist)}else if(targetDist instanceof dists.Discrete){return discreteSpec(ad.value(targetDist.params.ps).length)}else if(targetDist instanceof dists.RandomInteger){return discreteSpec(targetDist.params.n)}else if(targetDist instanceof dists.Binomial){return discreteSpec(targetDist.params.n+1)}else if(targetDist instanceof dists.MultivariateGaussian||targetDist instanceof dists.Mixture||targetDist instanceof dists.Marginal||targetDist instanceof dists.SampleBasedMarginal){throwAutoGuideError(targetDist)}else{return defaultSpec(targetDist)}}function throwAutoGuideError(targetDist){var msg="Cannot automatically generate a guide for a "+targetDist.meta.name+" distribution.";throw new Error(msg)}function defaultSpec(targetDist){var params=_.map(targetDist.meta.params,function(paramMeta){var name=paramMeta.name;var targetParam=ad.value(targetDist.params[name]);return[name,paramSpec(paramMeta.type,targetParam)]});return{type:targetDist.constructor,params:_.fromPairs(params)}}function paramSpec(type,targetParam){switch(type.name){case"real":return{param:{dims:[1],squish:squishToInterval(type.bounds)}};case"vector":case"vectorOrRealArray":return{param:{dims:[targetParam.length,1],squish:squishToInterval(type.bounds)}};case"tensor":return{param:{dims:targetParam.dims,squish:squishToInterval(type.bounds)}};case"int":return{const:targetParam};case"array":if(type.elementType.name==="any"||type.elementType.name==="int"){return{const:targetParam}}else{throw paramSpecError(type)}default:throw paramSpecError(type)}}function paramSpecError(type){var msg="Can't generate specification for parameter of type \""+type.name+'".';return new Error(msg)}function dirichletSpec(targetDist){var d=ad.value(targetDist.params.alpha).length-1;return{type:dists.LogisticNormal,params:{mu:{param:{dims:[d,1]}},sigma:{param:{dims:[d,1],squish:squishTo(0,Infinity)}}}}}function tensorGaussianSpec(targetDist){var dims=targetDist.params.dims;return{type:dists.DiagCovGaussian,params:{mu:{param:{dims:dims}},sigma:{param:{dims:dims,squish:squishTo(0,Infinity)}}}}}function uniformSpec(targetDist){return{type:dists.LogitNormal,params:{a:{const:targetDist.params.a},b:{const:targetDist.params.b},mu:{param:{dims:[1]}},sigma:{param:{dims:[1],squish:squishTo(0,Infinity)}}}}}function betaSpec(targetDist){return{type:dists.LogitNormal,params:{a:{const:0},b:{const:1},mu:{param:{dims:[1]}},sigma:{param:{dims:[1],squish:squishTo(0,Infinity)}}}}}function gammaSpec(targetDist){return{type:dists.IspNormal,params:{mu:{param:{dims:[1]}},sigma:{param:{dims:[1],squish:squishTo(0,Infinity)}}}}}function discreteSpec(dim){return{type:dists.Discrete,params:{ps:{param:{dims:[dim-1,1],squish:numeric.squishToProbSimplex}}}}}function softplus(x){return T.log(T.add(T.exp(x),1))}function squishTo(a,b){if(a===-Infinity&&b===Infinity){throw new Error("Squishing not required here.")}if(a===-Infinity){return function(x){var y=softplus(x);return T.add(T.neg(y),b)}}else if(b===Infinity){return function(x){var y=softplus(x);return T.add(y,a)}}else{return function(x){var y=T.sigmoid(x);return T.add(T.mul(y,b-a),a)}}}function squishToInterval(interval){return interval&&interval.isBounded?squishTo(interval.low,interval.high):null}module.exports={independent:independent,runThunk:runThunk,getDist:getDist}},{"./ad":151,"./dists":169,"./math/numeric":218,"./params/params":223,"./tensor":231,"./util":246,lodash:124}],190:[function(require,module,exports){var util=require("./util");var FUNCTION="function",STRING="string",UNDEFINED=undefined;function toStr(obj){return typeof obj==STRING?obj:""+obj}function hashObject(obj){var hashCode;if(typeof obj==STRING){return obj}else if(typeof obj.hashCode==FUNCTION){hashCode=obj.hashCode();return typeof hashCode==STRING?hashCode:hashObject(hashCode)}else{return toStr(obj)}}function merge(o1,o2){for(var i in o2){if(o2.hasOwnProperty(i)){o1[i]=o2[i]}}}function equals_fixedValueHasEquals(fixedValue,variableValue){return fixedValue.equals(variableValue)}function equals_fixedValueNoEquals(fixedValue,variableValue){return typeof variableValue.equals==FUNCTION?variableValue.equals(fixedValue):fixedValue===variableValue}function createKeyValCheck(kvStr){return function(kv){if(kv===null){throw new Error("null is not a valid "+kvStr)}else if(kv===UNDEFINED){throw new Error(kvStr+" must not be undefined")}}}var checkKey=createKeyValCheck("key"),checkValue=createKeyValCheck("value");function Bucket(hash,firstKey,firstValue,equalityFunction){this[0]=hash;this.entries=[];this.addEntry(firstKey,firstValue);if(equalityFunction!==null){this.getEqualityFunction=function(){return equalityFunction}}}var EXISTENCE=0,ENTRY=1,ENTRY_INDEX_AND_VALUE=2;function createBucketSearcher(mode){return function(key){var i=this.entries.length,entry,equals=this.getEqualityFunction(key);while(i--){entry=this.entries[i];if(equals(key,entry[0])){switch(mode){case EXISTENCE:return true;case ENTRY:return entry;case ENTRY_INDEX_AND_VALUE:return[i,entry[1]]}}}return false}}function createBucketLister(entryProperty){return function(aggregatedArr){var startIndex=aggregatedArr.length;for(var i=0,entries=this.entries,len=entries.length;i<len;++i){aggregatedArr[startIndex+i]=entries[i][entryProperty]}}}Bucket.prototype={getEqualityFunction:function(searchValue){return typeof searchValue.equals==FUNCTION?equals_fixedValueHasEquals:equals_fixedValueNoEquals},getEntryForKey:createBucketSearcher(ENTRY),getEntryAndIndexForKey:createBucketSearcher(ENTRY_INDEX_AND_VALUE),removeEntryForKey:function(key){var result=this.getEntryAndIndexForKey(key);if(result){this.entries.splice(result[0],1);return result[1]}return null},addEntry:function(key,value){this.entries.push([key,value])},keys:createBucketLister(0),values:createBucketLister(1),getEntries:function(destEntries){var startIndex=destEntries.length;for(var i=0,entries=this.entries,len=entries.length;i<len;++i){destEntries[startIndex+i]=entries[i].slice(0)}},containsKey:createBucketSearcher(EXISTENCE),containsValue:function(value){var entries=this.entries,i=entries.length;while(i--){if(value===entries[i][1]){return true}}return false}};function searchBuckets(buckets,hash){var i=buckets.length,bucket;while(i--){bucket=buckets[i];if(hash===bucket[0]){return i}}return null}function getBucketForHash(bucketsByHash,hash){var bucket=bucketsByHash[hash];return bucket&&bucket instanceof Bucket?bucket:null}function Hashtable(){var buckets=[];var bucketsByHash={};var properties={replaceDuplicateKey:true,hashCode:hashObject,equals:null};var size=0;var biggestBucket=null;var arg0=arguments[0],arg1=arguments[1];if(arg1!==UNDEFINED){properties.hashCode=arg0;properties.equals=arg1}else if(arg0!==UNDEFINED){merge(properties,arg0)}var hashCode=properties.hashCode,equals=properties.equals;this.properties=properties;this.put=function(key,value){checkKey(key);checkValue(value);var hash=hashCode(key),bucket,bucketEntry,oldValue=null;bucket=getBucketForHash(bucketsByHash,hash);if(bucket){bucketEntry=bucket.getEntryForKey(key);if(bucketEntry){if(properties.replaceDuplicateKey){bucketEntry[0]=key}oldValue=bucketEntry[1];bucketEntry[1]=value}else{bucket.addEntry(key,value);size++;if(biggestBucket===null||bucket.entries.length>biggestBucket.entries.length)biggestBucket=bucket}}else{bucket=new Bucket(hash,key,value,equals);buckets.push(bucket);bucketsByHash[hash]=bucket;size++;if(biggestBucket===null||bucket.entries.length>biggestBucket.entries.length)biggestBucket=bucket}return oldValue};this.get=function(key){checkKey(key);var hash=hashCode(key);var bucket=getBucketForHash(bucketsByHash,hash);if(bucket){var bucketEntry=bucket.getEntryForKey(key);if(bucketEntry){return bucketEntry[1]}}return null};this.containsKey=function(key){checkKey(key);var bucketKey=hashCode(key);var bucket=getBucketForHash(bucketsByHash,bucketKey);return bucket?bucket.containsKey(key):false};this.containsValue=function(value){checkValue(value);var i=buckets.length;while(i--){if(buckets[i].containsValue(value)){return true}}return false};this.clear=function(){buckets.length=0;bucketsByHash={};size=0;biggestBucket=null};this.isEmpty=function(){return!buckets.length};var createBucketAggregator=function(bucketFuncName){return function(){var aggregated=[],i=buckets.length;while(i--){buckets[i][bucketFuncName](aggregated)}return aggregated}};this.keys=createBucketAggregator("keys");this.values=createBucketAggregator("values");this.entries=createBucketAggregator("getEntries");this.remove=function(key){checkKey(key);var hash=hashCode(key),bucketIndex,oldValue=null;var bucket=getBucketForHash(bucketsByHash,hash);if(bucket){oldValue=bucket.removeEntryForKey(key);if(oldValue!==null){if(bucket.entries.length==0){bucketIndex=searchBuckets(buckets,hash);buckets.splice(bucketIndex,1);delete bucketsByHash[hash]}size--;if(biggestBucket===bucket){if(buckets.length===0)biggestBucket=null;else{biggestBucket=buckets[0];var i=buckets.length;while(i--){if(buckets[i].entries.length>biggestBucket.entries.length)biggestBucket=buckets[i]}}}}}return oldValue};this.equals=function(hashtable){var keys,key,val,count=size;if(count==hashtable.size){keys=this.keys();while(count--){key=keys[count];val=hashtable.get(key);if(val===null||val!==this.get(key)){return false}}return true}return false};this.getRandom=function(){var L=biggestBucket.entries.length;while(true){var bi=Math.floor(util.random()*buckets.length);var bucket=buckets[bi];var p=Math.floor(util.random()*L);if(p<bucket.entries.length)return bucket.entries[p][1]}}}Hashtable.prototype={each:function(callback){var entries=this.entries(),i=entries.length,entry;while(i--){entry=entries[i];callback(entry[0],entry[1])}},putAll:function(hashtable,conflictCallback){var entries=hashtable.entries();var entry,key,value,thisValue,i=entries.length;var hasConflictCallback=typeof conflictCallback==FUNCTION;while(i--){entry=entries[i];key=entry[0];value=entry[1];if(hasConflictCallback&&(thisValue=this.get(key))){value=conflictCallback(key,thisValue,value)}this.put(key,value)}},clone:function(){var clone=new Hashtable(this.properties);clone.putAll(this);return clone}};Hashtable.prototype.toQueryString=function(){var entries=this.entries(),i=entries.length,entry;var parts=[];while(i--){entry=entries[i];parts[i]=encodeURIComponent(toStr(entry[0]))+"="+encodeURIComponent(toStr(entry[1]))}return parts.join("&")};module.exports={Hashtable:Hashtable}},{"./util":246}],191:[function(require,module,exports){(function(process,global){"use strict";var assert=require("assert");var _=require("lodash");var nn=require("adnn/nn");try{var util=require("./util");var dists=require("./dists");var enumerate=require("./inference/enumerate");var mcmc=require("./inference/mcmc");var asyncpf=require("./inference/asyncpf");var pmcmc=require("./inference/pmcmc");var smc=require("./inference/smc");var rejection=require("./inference/rejection");var incrementalmh=require("./inference/incrementalmh");var optimize=require("./inference/optimize");var forwardSample=require("./inference/forwardSample");var checkSampleAfterFactor=require("./inference/checkSampleAfterFactor");var dreamSample=require("./inference/dream/sample");var headerUtils=require("./headerUtils");var params=require("./params/header");var Query=require("./query").Query;var ad=require("./ad");var Tensor=require("./tensor");var numeric=require("./math/numeric")}catch(e){if(e.code==="MODULE_NOT_FOUND"){console.error(e.message);console.error("Run ./scripts/adify and try again.");process.exit()}else{throw e}}module.exports=function(env){env.defaultCoroutine={sample:function(s,k,a,dist){return k(s,dist.sample())},factor:function(){throw new Error("factor allowed only inside inference.")},exit:function(s,r){return r},incrementalize:function(s,k,a,fn,args){var args=[s,k,a].concat(args);return fn.apply(global,args)},isParamBase:true,a:""};env.reset=function(){env.coroutine=env.defaultCoroutine};env.reset();env.sample=function(s,k,a,dist,options){if(!dists.isDist(dist)){throw new Error('sample() expected a distribution but received "'+JSON.stringify(dist)+'".')}for(var name in options){if(name!=="guide"&&name!=="driftKernel"&&name!=="noAutoGuide"&&name!=="reparam"){throw new Error('Unknown option "'+name+'" passed to sample.')}}return env.coroutine.sample(s,k,a,dist,options)};env.factor=function(s,k,a,score){var _score=ad.value(score);if(typeof _score!=="number"||isNaN(_score)){throw new Error("The score argument is not a number.")}return env.coroutine.factor(s,k,a,score)};env.observe=function(s,k,a,dist,val,options){if(typeof env.coroutine.observe==="function"){return env.coroutine.observe(s,k,a,dist,val,options)}else{if(val!==undefined){var factorK=function(s){return k(s,val)};return env.factor(s,factorK,a,dist.score(val))}else{return env.sample(s,k,a,dist,options)}}};env.sampleWithFactor=function(s,k,a,dist,scoreFn){if(typeof env.coroutine.sampleWithFactor==="function"){return env.coroutine.sampleWithFactor(s,k,a,dist,scoreFn)}else{var sampleK=function(s,v){var scoreK=function(s,sc){var factorK=function(s){return k(s,v)};return env.factor(s,factorK,a+"swf2",sc)};return scoreFn(s,scoreK,a+"swf1",v)};return env.sample(s,sampleK,a,dist)}};env.exit=function(s,retval){return env.coroutine.exit(s,retval)};env.incrementalize=function(s,k,a,fn,args){args=args||[];return env.coroutine.incrementalize(s,k,a,fn,args)};env.query=new Query;var exports={_top:util.runningInBrowser()?window:global};function addExports(obj){_.extend(exports,obj)}addExports({factor:env.factor,sample:env.sample,sampleWithFactor:env.sampleWithFactor,observe:env.observe,incrementalize:env.incrementalize,query:env.query});addExports({_:_,util:util,assert:assert,ad:ad,nn:nn,T:ad.tensor,dists:dists,numeric:numeric});var headerModules=[enumerate,asyncpf,mcmc,incrementalmh,pmcmc,smc,rejection,optimize,forwardSample,dreamSample,checkSampleAfterFactor,headerUtils,params];headerModules.forEach(function(mod){addExports(mod(env))});return exports}}).call(this,require("_process"),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./ad":151,"./dists":169,"./headerUtils":192,"./inference/asyncpf":193,"./inference/checkSampleAfterFactor":194,"./inference/dream/sample":197,"./inference/enumerate":201,"./inference/forwardSample":203,"./inference/incrementalmh":205,"./inference/mcmc":208,"./inference/optimize":210,"./inference/pmcmc":211,"./inference/rejection":212,"./inference/smc":213,"./math/numeric":218,"./params/header":222,"./query":229,"./tensor":231,"./util":246,_process:251,"adnn/nn":16,assert:248,lodash:124}],192:[function(require,module,exports){(function(global){"use strict";var _=require("lodash");var serialize=require("./util").serialize;var Tensor=require("./tensor");var LRU=require("lru-cache");var ad=require("./ad");var assert=require("assert");var runThunk=require("./guide").runThunk;module.exports=function(env){function display(s,k,a,x){return k(s,console.log(ad.valueRec(x)))}var dp={};dp.cache=function(f,maxSize){var c=LRU(maxSize);var cf=function(s,k,a){var args=Array.prototype.slice.call(arguments,3);if(_.some(args,ad.isLifted)){throw new Error("Cannot cache functions of scalar/tensor arguments "+"when performing automatic differentiation.")}var stringedArgs=serialize(args);if(c.has(stringedArgs)){return k(s,c.get(stringedArgs))}else{var newk=function(s,r){if(c.has(stringedArgs)){console.log("Already in cache:",stringedArgs);if(serialize(c.get(stringedArgs))!==serialize(r)){console.log("OLD AND NEW CACHE VALUE DIFFER!");console.log("Old value:",c.get(stringedArgs));console.log("New value:",r)}}c.set(stringedArgs,r);if(!maxSize&&c.length===1e4){console.log(c.length+" function calls have been cached.");console.log("The size of the cache can be limited by calling cache(f, maxSize).")}return k(s,r)};return f.apply(this,[s,newk,a].concat(args))}};cf.cache=c;return cf};function cache(s,k,a,f,maxSize){return k(s,dp.cache(f,maxSize))}function apply(s,k,a,wpplFn,args){return wpplFn.apply(global,[s,k,a].concat(args))}function notAllowed(fn,name){return function(){throw new Error(fn+" is not allowed in "+name+".")}}function makeDeterministicCoroutine(name){return{sample:notAllowed("sample",name),factor:notAllowed("factor",name),incrementalize:env.defaultCoroutine.incrementalize,oldCoroutine:env.coroutine}}function applyd(s,k,a,wpplFn,args,name){var coroutine=env.coroutine;env.coroutine=makeDeterministicCoroutine(name);return apply(s,function(s,val){env.coroutine=coroutine;return k(s,val)},a,wpplFn,args)}var __uniqueid=0;var _Fn={tag:function(fn,lexid,freevarvals){fn.__lexid=lexid;fn.__uniqueid=__uniqueid++;fn.__freeVarVals=freevarvals;return fn}};var _addr={save:function(obj,address){obj.value=address}};var zeros=function(s,k,a,dims){return k(s,new Tensor(dims))};var ones=function(s,k,a,dims){return k(s,new Tensor(dims).fill(1))};function mapData(s,k,a,opts,obsFn){opts=opts||{};var data=opts.data;if(!_.isArray(data)){throw new Error("mapData: No data given.")}var ret=env.coroutine.mapDataFetch?env.coroutine.mapDataFetch(data,opts,a):{data:data,ix:null};var ix=ret.ix;var finalData=ret.data;var address=ret.address||a;assert.ok(ix===null||_.isArray(ix)&&ix.length===finalData.length,"Unexpected value returned by mapDataFetch.");var doReturn=finalData===data;return cpsMapData(s,function(s,v){if(env.coroutine.mapDataFinal){env.coroutine.mapDataFinal(a)}return k(s,doReturn?v:undefined)},address,finalData,ix,obsFn)}function cpsMapData(s,k,a,data,indices,f,acc,i){i=i===undefined?0:i;acc=acc===undefined?[]:acc;var length=indices===null?data.length:indices.length;if(i===length){return k(s,acc)}else{var ix=indices===null?i:indices[i];if(env.coroutine.mapDataEnter){env.coroutine.mapDataEnter()}return f(s,function(s,v){if(env.coroutine.mapDataLeave){env.coroutine.mapDataLeave()}return function(){return cpsMapData(s,k,a,data,indices,f,acc.concat([v]),i+1)}},a.concat("_$$"+ix),data[i],ix)}}function guide(s,k,a,thunk){if(env.coroutine.guideRequired){return runThunk(thunk,env,s,a,function(s2,val){return k(s2)})}else{return k(s)}}return{display:display,cache:cache,dp:dp,apply:apply,applyd:applyd,_Fn:_Fn,_addr:_addr,zeros:zeros,ones:ones,mapData:mapData,guide:guide}}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./ad":151,"./guide":189,"./tensor":231,"./util":246,assert:248,lodash:124,"lru-cache":125}],193:[function(require,module,exports){"use strict";var _=require("lodash");var util=require("../util");var numeric=require("../math/numeric");var CountAggregator=require("../aggregation/CountAggregator");module.exports=function(env){function copyOneParticle(particle){return{continuation:particle.continuation,weight:particle.weight,completed:particle.completed,factorIndex:particle.factorIndex,value:particle.value,numChildrenToSpawn:1,multiplicity:particle.multiplicity,store:_.clone(particle.store)}}function initParticle(s,cont){return{continuation:cont,weight:0,completed:false,factorIndex:undefined,value:undefined,numChildrenToSpawn:0,multiplicity:1,store:_.clone(s)}}function AsyncPF(s,k,a,wpplFn,options){this.numParticles=0;this.bufferSize=options.bufferSize==undefined?options.particles:options.bufferSize;this.initNumParticles=Math.floor(this.bufferSize*(1/2));this.exitK=function(s){return wpplFn(s,env.exit,a)};this.store=s;this.buffer=[];for(var i=0;i<this.initNumParticles;i++){this.buffer.push(initParticle(this.store,this.exitK))}this.obsWeights={};this.exitedParticles=0;this.hist=new CountAggregator;this.k=k;this.oldCoroutine=env.coroutine;env.coroutine=this;this.oldStore=_.clone(s)}AsyncPF.prototype.run=function(numP){this.numParticles=numP==undefined?this.numParticles:this.numParticles+numP;var p,launchP;var i=Math.floor((this.buffer.length+1)*util.random());if(i==this.buffer.length){p=initParticle(this.store,this.exitK)}else{launchP=this.buffer[i];if(launchP.numChildrenToSpawn>1){p=copyOneParticle(launchP);launchP.numChildrenToSpawn-=1}else{p=launchP;this.buffer=util.deleteIndex(this.buffer,i)}}this.activeParticle=p;return p.continuation(p.store)};AsyncPF.prototype.sample=function(s,cc,a,dist){return cc(s,dist.sample())};AsyncPF.prototype.factor=function(s,cc,a,score){this.activeParticle.weight+=score;this.activeParticle.continuation=cc;this.activeParticle.store=s;var fi=this.activeParticle.factorIndex;var newFI=fi==undefined?0:fi+1;this.activeParticle.factorIndex=newFI;this.branching(newFI);return this.run()};AsyncPF.prototype.branching=function(factorIndex){var lk=this.obsWeights[factorIndex];if(lk==undefined){var det={wbar:this.activeParticle.weight,mnk:1};this.obsWeights[factorIndex]=[det];this.activeParticle.numChildrenToSpawn=1}else{var currMultiplicity=this.activeParticle.multiplicity;var currWeight=this.activeParticle.weight;var denom=lk.length+currMultiplicity;var prevWBar=lk[lk.length-1].wbar;var wbar=-Math.log(denom)+numeric._logsumexp([Math.log(lk.length)+prevWBar,Math.log(currMultiplicity)+currWeight]);if(wbar>0)throw new Error("Positive weight!!");var logRatio=currWeight-wbar;var numChildrenAndWeight=[];if(logRatio<0){numChildrenAndWeight=Math.log(util.random())<logRatio?[1,wbar]:[0,-Infinity]}else{var totalChildren=0;for(var v=0;v<lk.length;v++)totalChildren+=lk[v].mnk;var minK=Math.min(this.numParticles,lk.length);var rnk=isNaN(logRatio)?1:Math.exp(logRatio);var clampedRnk=totalChildren<=minK?Math.ceil(rnk):Math.floor(rnk);numChildrenAndWeight=[clampedRnk,currWeight-Math.log(clampedRnk)]}var det2={wbar:wbar,mnk:numChildrenAndWeight[0]};this.obsWeights[factorIndex]=lk.concat([det2]);if(numChildrenAndWeight[0]>0){if(this.buffer.length<this.bufferSize){this.activeParticle.numChildrenToSpawn=numChildrenAndWeight[0];this.activeParticle.weight=numChildrenAndWeight[1]}else{this.activeParticle.multiplicity*=numChildrenAndWeight[0];this.activeParticle.numChildrenToSpawn=1;this.activeParticle.weight=numChildrenAndWeight[1]}this.buffer.push(this.activeParticle)}}};AsyncPF.prototype.exit=function(s,retval){this.activeParticle.value=retval;this.activeParticle.completed=true;this.activeParticle.weight+=Math.log(this.activeParticle.multiplicity);this.exitedParticles+=1;this.hist.add(retval);if(this.exitedParticles<this.numParticles){return this.run()}else{var dist=this.hist.toDist();var lastFactorIndex=this.activeParticle.factorIndex;var olk=this.obsWeights[lastFactorIndex];var Kn=_.reduce(olk,function(a,b){return a+b.mnk},0);dist.normalizationConstant=Math.log(Kn)-Math.log(this.numParticles)+olk[olk.length-1].wbar;var currCoroutine=this;dist.continue=function(s,k,a,numP){currCoroutine.k=k;currCoroutine.oldCoroutine=env.coroutine;env.coroutine=currCoroutine;currCoroutine.oldStore=_.clone(s);return currCoroutine.run(numP)};env.coroutine=this.oldCoroutine;return this.k(this.oldStore,dist)}};AsyncPF.prototype.incrementalize=env.defaultCoroutine.incrementalize;function asyncPF(s,cc,a,wpplFn,options){options=options||{};return new AsyncPF(s,cc,a,wpplFn,options).run(options.particles)}return{AsyncPF:asyncPF}}},{"../aggregation/CountAggregator":152,"../math/numeric":218,"../util":246,lodash:124}],194:[function(require,module,exports){"use strict";var _=require("lodash");var util=require("../util");var ad=require("../ad");module.exports=function(env){function CheckSampleAfterFactor(s,k,a,wpplFn,options){this.opts={samples:1};this.wpplFn=wpplFn;this.s=s;this.k=k;this.a=a;this.hasFactor=false;this.hasSampleAfterFactor=false;this.oldCoroutine=env.coroutine;env.coroutine=this}CheckSampleAfterFactor.prototype={run:function(){return util.cpsLoop(this.opts.samples,function(i,next){return this.wpplFn(_.clone(this.s),function(s,val){return next()},this.a)}.bind(this),function(){env.coroutine=this.oldCoroutine;return this.k(this.s,this.hasSampleAfterFactor)}.bind(this))},sample:function(s,k,a,dist,options){if(this.hasFactor){this.hasSampleAfterFactor=true}return k(s,dist.sample())},factor:function(s,k,a,score){if(!this.hasFactor){this.hasFactor=true}return k(s)},incrementalize:env.defaultCoroutine.incrementalize,constructor:CheckSampleAfterFactor};return{CheckSampleAfterFactor:function(){var coroutine=Object.create(CheckSampleAfterFactor.prototype);CheckSampleAfterFactor.apply(coroutine,arguments);return coroutine.run()}}}},{"../ad":151,"../util":246,lodash:124}],195:[function(require,module,exports){"use strict";var util=require("../../util");var paramStruct=require("../../params/struct");module.exports=function(env){var dreamSample=require("./sample")(env).dreamSample;var dreamGradients=require("./gradients")(env);return function(options){var opts=util.mergeDefaults(options,{samples:1},"dream");return function(wpplFn,s,a,state,step,cont){var objVal=0;var grad={};return util.cpsLoop(opts.samples,function(i,next){return dreamSample(s,function(s,record){return dreamGradients(wpplFn,record,s,a,function(g,objVal_i){paramStruct.addEq(grad,g);objVal+=objVal_i;return next()})},a,wpplFn)},function(){paramStruct.divEq(grad,opts.samples);objVal/=opts.samples;return cont(grad,objVal)})}}}},{"../../params/struct":228,"../../util":246,"./gradients":196,"./sample":197}],196:[function(require,module,exports){"use strict";var ad=require("../../ad");var assert=require("assert");var _=require("lodash");var guide=require("../../guide");module.exports=function(env){function dreamGradients(wpplFn,record,s,a,cont){this.wpplFn=wpplFn;this.record=record;this.s=s;this.a=a;this.cont=cont;this.guideRequired=true;this.isParamBase=true;this.insideMapData=false;this.oldCoroutine=env.coroutine;env.coroutine=this}dreamGradients.prototype={run:function(){return this.estimateGradient(function(grad,objVal){env.coroutine=this.oldCoroutine;return this.cont(grad,objVal)}.bind(this))},estimateGradient:function(cont){this.paramsSeen={};this.logq=0;return this.wpplFn(_.clone(this.s),function(s,val){var objective=ad.scalar.neg(this.logq);if(ad.isLifted(objective)){objective.backprop()}var grads=_.mapValues(this.paramsSeen,ad.derivative);return cont(grads,ad.scalar.neg(ad.value(this.logq)))}.bind(this),this.a)},sample:function(s,k,a,dist,options){options=options||{};var choice=this.record.trace.findChoice(a);assert.ok(ad.scalar.pneq(choice,undefined),"dream: No entry for this choice in the trace.");var val=choice.val;if(this.insideMapData){return guide.getDist(options.guide,options.noAutoGuide,dist,env,s,a,function(s,guideDist){if(!guideDist){throw new Error("dream: No guide distribution specified.")}this.logq=ad.scalar.add(this.logq,guideDist.score(val));return k(s,val)}.bind(this))}else{return k(s,val)}},factor:function(s,k,a,score){return k(s)},mapDataFetch:function(data,opts,a){if(this.insideMapData){throw new Error("dream: nested mapData is not supported by this estimator.")}this.insideMapData=true;return{data:this.record.data,ix:null,address:ad.scalar.add(a,"_dream")}},mapDataFinal:function(){this.insideMapData=false},incrementalize:env.defaultCoroutine.incrementalize,constructor:dreamGradients};return function(){var coroutine=Object.create(dreamGradients.prototype);dreamGradients.apply(coroutine,arguments);return coroutine.run()}}},{"../../ad":151,"../../guide":189,assert:248,lodash:124}],197:[function(require,module,exports){"use strict";var _=require("lodash");var util=require("../../util");var Trace=require("../../trace");var guide=require("../../guide");module.exports=function(env){function dreamSample(s,k,a,wpplFn){this.wpplFn=wpplFn;this.s=s;this.k=k;this.a=a;var trace=new Trace(this.wpplFn,s,env.exit,a);this.record={trace:trace,data:[]};this.guideRequired=true;this.isParamBase=true;this.insideMapData=false;this.oldCoroutine=env.coroutine;env.coroutine=this}dreamSample.prototype={run:function(){return this.wpplFn(_.clone(this.s),function(s,val){env.coroutine=this.oldCoroutine;return this.k(this.s,this.record)}.bind(this),this.a)},sample:function(s,k,a,dist,options){var sampleFn=this.insideMapData?this.sampleLocal:this.sampleGlobal;return sampleFn.call(this,s,a,dist,options,function(s,val){this.record.trace.addChoice(dist,val,a,s,k,options);return k(s,val)}.bind(this))},sampleLocal:function(s,a,targetDist,options,k){return k(s,targetDist.sample())},sampleGlobal:function(s,a,dist,options,k){options=options||{};return guide.getDist(options.guide,options.noAutoGuide,dist,env,s,a,function(s,guideDist){if(!guideDist){throw new Error("dream: No guide distribution specified.")}return k(s,guideDist.sample())})},factor:function(s,k,a){throw new Error("dream: factor not supported, use observe instead.")},observe:function(s,k,a,dist,options){if(!this.insideMapData){throw new Error("dream: observe can only be used within mapData with this estimator.")}var val=dist.sample();this.observations.push(val);return k(s,val)},mapDataEnter:function(){this.observations=[]},mapDataLeave:function(){if(_.isEmpty(this.observations)){throw new Error("dream: expected at least one observation to be made.")}var datum=this.observations.length===1?this.observations[0]:this.observations;this.record.data.push(datum)},mapDataFetch:function(data,opts,a){if(this.insideMapData){throw new Error("dream: nested mapData is not supported by this estimator.")}this.insideMapData=true;this.guideRequired=false;var batchSize=_.has(opts,"dreamBatchSize")?opts.dreamBatchSize:1;if(!(util.isInteger(batchSize)&&batchSize>=0)){throw new Error("dream: dreamBatchSize should be a non negative integer.")}if(_.isEmpty(data)){throw new Error("dream: data should be non empty.")}var ix=_.times(batchSize,function(){return Math.floor(util.random()*data.length)});var batch=_.at(data,ix);return{data:batch,ix:null,address:a+"_dream"}},mapDataFinal:function(){this.insideMapData=false;this.guideRequired=true},incrementalize:env.defaultCoroutine.incrementalize,constructor:dreamSample};return{dreamSample:function(){var coroutine=Object.create(dreamSample.prototype);dreamSample.apply(coroutine,arguments);return coroutine.run()}}}},{"../../guide":189,"../../trace":232,"../../util":246,lodash:124}],198:[function(require,module,exports){"use strict";var util=require("../util");module.exports=function(env){var applyd=require("../headerUtils")(env).applyd;function getProposalDist(s,a,dist,options,prevVal,k){if(options&&options.driftKernel){return applyd(s,k,a,options.driftKernel,[prevVal],"drift kernel")}else{return k(s,dist)}}function proposalWarning(priorDist){util.warn("Proposal from drift kernel has zero probability under "+priorDist.meta.name+" prior.")}return{getProposalDist:getProposalDist,proposalWarning:proposalWarning}}},{"../headerUtils":192,"../util":246}],199:[function(require,module,exports){"use strict";var ad=require("../ad");var _=require("lodash");var assert=require("assert");var util=require("../util");var paramStruct=require("../params/struct");var guide=require("../guide");var graph=require("./elbograph");var RootNode=graph.RootNode;var SampleNode=graph.SampleNode;var FactorNode=graph.FactorNode;var SplitNode=graph.SplitNode;var JoinNode=graph.JoinNode;module.exports=function(env){function makeELBOEstimator(options){options=util.mergeDefaults(options,{samples:1,avgBaselines:true,avgBaselineDecay:.9,dumpGraph:false,debugWeights:false},"ELBO");return function(wpplFn,s,a,state,step,cont){return new ELBO(wpplFn,s,a,options,state,step,cont).run()}}function ELBO(wpplFn,s,a,options,state,step,cont){this.opts=options;this.step=step;this.state=state;this.cont=cont;this.wpplFn=wpplFn;this.s=s;this.a=a;this.guideRequired=true;this.isParamBase=true;this.mapDataStack=[{multiplier:1}];this.mapDataIx={};if(!_.has(this.state,"baselines")){this.state.baselines={}}this.baselineUpdates={};this.oldCoroutine=env.coroutine;env.coroutine=this}function top(stack){return stack[stack.length-1]}function checkScoreIsFinite(score,source){var _score=ad.value(score);if(!isFinite(_score)){var msg="ELBO: The score of the previous sample under the "+source+" program was "+_score+".";if(_.isNaN(_score)){msg+=" Reducing the step size may help."}throw new Error(msg)}}ELBO.prototype={run:function(){var elbo=0;var grad={};return util.cpsLoop(this.opts.samples,function(i,next){this.iter=i;return this.estimateGradient(function(g,elbo_i){paramStruct.addEq(grad,g);elbo+=elbo_i;return next()})}.bind(this),function(){paramStruct.divEq(grad,this.opts.samples);elbo/=this.opts.samples;this.updateBaselines();env.coroutine=this.oldCoroutine;return this.cont(grad,elbo)}.bind(this))},estimateGradient:function(cont){this.paramsSeen={};this.nodes=[];var root=new RootNode;this.prevNode=root;this.nodes.push(root);return this.wpplFn(_.clone(this.s),function(){graph.propagateWeights(this.nodes);if(this.step===0&&this.iter===0&&this.opts.dumpGraph){var dot=graph.generateDot(this.nodes);fs.writeFileSync("deps.dot",dot)}var ret=this.buildObjective();if(ad.isLifted(ret.objective)){ret.objective.backprop()}var grads=_.mapValues(this.paramsSeen,ad.derivative);return cont(grads,ret.elbo)}.bind(this),this.a)},buildObjective:function(){var rootNode=this.nodes[0];assert.ok(rootNode instanceof RootNode);assert.ok(_.isNumber(rootNode.weight));var objective=this.nodes.reduce(function(acc,node){if(node instanceof SampleNode&&node.reparam){return ad.scalar.add(acc,ad.scalar.mul(node.multiplier,ad.scalar.sub(node.logq,node.logp)))}else if(node instanceof SampleNode){var weight=node.weight;assert.ok(_.isNumber(weight));var b=this.computeBaseline(node.address,weight);return ad.scalar.add(acc,ad.scalar.mul(node.multiplier,ad.scalar.sub(ad.scalar.mul(node.logq,ad.scalar.sub(weight,b)),node.logp)))}else if(node instanceof FactorNode){return ad.scalar.sub(acc,ad.scalar.mul(node.multiplier,node.score))}else{return acc}}.bind(this),0);var elbo=ad.scalar.neg(rootNode.weight);return{objective:objective,elbo:elbo}},computeBaseline:function(address,weight){if(!this.opts.avgBaselines){return 0}var baselines=this.state.baselines;var baselineUpdates=this.baselineUpdates;if(!_.has(baselineUpdates,address)){baselineUpdates[address]={n:1,mean:weight}}else{var prev=baselineUpdates[address];var n=prev.n+1;var mean=(prev.n*prev.mean+weight)/n;baselineUpdates[address].n=n;baselineUpdates[address].mean=mean}return _.has(baselines,address)?baselines[address]:weight*.99},updateBaselines:function(){var decay=this.opts.avgBaselineDecay;var baselines=this.state.baselines;_.each(this.baselineUpdates,function(obj,address){baselines[address]=_.has(baselines,address)?decay*baselines[address]+(1-decay)*obj.mean:obj.mean},this)},sample:function(s,k,a,dist,options){options=options||{};return guide.getDist(options.guide,options.noAutoGuide,dist,env,s,a,function(s,guideDist){if(!guideDist){throw new Error("ELBO: No guide distribution to optimize.")}var ret=this.sampleGuide(guideDist,options);var val=ret.val;var logp=dist.score(val);var logq=guideDist.score(val);checkScoreIsFinite(logp,"target");checkScoreIsFinite(logq,"guide");var m=top(this.mapDataStack).multiplier;var node=new SampleNode(this.prevNode,logp,logq,ret.reparam,a,dist,guideDist,val,m,this.opts.debugWeights);this.prevNode=node;this.nodes.push(node);return k(s,val)}.bind(this))},sampleGuide:function(dist,options){var val,reparam;if((!_.has(options,"reparam")||options.reparam)&&dist.base&&dist.transform){var baseDist=dist.base();var z=baseDist.sample();val=dist.transform(z);reparam=true}else if(options.reparam&&!(dist.base&&dist.transform)){throw dist+" does not support reparameterization."}else{val=dist.sample();reparam=false}if(dist.isContinuous&&(!dist.base||!dist.transform)){var msg="Warning: Continuous distribution "+dist.meta.name+" does not support reparameterization.";util.warn(msg,true)}return{val:val,reparam:reparam}},factor:function(s,k,a,score,name){if(!isFinite(ad.value(score))){throw new Error("ELBO: factor score is not finite.")}var m=top(this.mapDataStack).multiplier;var node=new FactorNode(this.prevNode,score,m,this.opts.debugWeights);this.prevNode=node;this.nodes.push(node);return k(s)},mapDataFetch:function(data,opts,address){var batchSize=opts.batchSize!==undefined?opts.batchSize:data.length;var minBatchSize=_.isEmpty(data)?0:1;var maxBatchSize=data.length;if(!(util.isInteger(batchSize)&&minBatchSize<=batchSize&&batchSize<=maxBatchSize)){throw new Error("ELBO: Invalid batchSize.")}var ix;if(_.has(this.mapDataIx,address)){ix=this.mapDataIx[address]}else{if(batchSize===data.length){ix=null}else{ix=_.times(batchSize,function(){return Math.floor(util.random()*data.length)})}this.mapDataIx[address]=ix}var batch=ix===null?data:_.at(data,ix);if(batchSize>0){var joinNode=new JoinNode;var splitNode=new SplitNode(this.prevNode,batchSize,data.length,joinNode);this.nodes.push(splitNode);var thisM=data.length/batchSize;var prevM=top(this.mapDataStack).multiplier;var multiplier=thisM*prevM;this.mapDataStack.push({splitNode:splitNode,joinNode:joinNode,multiplier:multiplier})}else{this.mapDataStack.push(null)}return{data:batch,ix:ix}},mapDataEnter:function(){this.prevNode=top(this.mapDataStack).splitNode},mapDataLeave:function(){top(this.mapDataStack).joinNode.parents.push(this.prevNode)},mapDataFinal:function(address){var top=this.mapDataStack.pop();if(top!==null){var joinNode=top.joinNode;this.prevNode=joinNode;this.nodes.push(joinNode)}},incrementalize:env.defaultCoroutine.incrementalize,constructor:ELBO};return makeELBOEstimator}},{"../ad":151,"../guide":189,"../params/struct":228,"../util":246,"./elbograph":200,assert:248,lodash:124}],200:[function(require,module,exports){"use strict";var ad=require("../ad");var nodeid=0;function RootNode(){this.id=nodeid++;this.parents=[];this.weight=0}function SampleNode(parent,logp,logq,reparam,address,targetDist,guideDist,value,multiplier,debug){this.id=nodeid++;var _logp=ad.value(logp);var _logq=ad.value(logq);this.parents=[parent];this.logp=logp;this.logq=logq;this.weight=debug?1:_logq-_logp;this.reparam=reparam;this.address=address;this.multiplier=multiplier;this.targetDist=targetDist}SampleNode.prototype.label=function(){return[this.targetDist.meta.name+"("+this.id+")","w="+this.weight,"m="+this.multiplier].join("\\n")};function FactorNode(parent,score,multiplier,debug){this.id=nodeid++;var _score=ad.value(score);this.parents=[parent];this.score=score;this.weight=debug?1:-_score;this.multiplier=multiplier}FactorNode.prototype.label=function(){return["Factor"+"("+this.id+")","w="+this.weight,"m="+this.multiplier].join("\\n")};function SplitNode(parent,batchSize,n,joinNode){this.id=nodeid++;this.parents=[parent];this.batchSize=batchSize;this.n=n;this.joinNode=joinNode;this.weight=0}function JoinNode(){this.id=nodeid++;this.parents=[];this.weight=0}function propagateWeights(nodes){var i=nodes.length;while(--i){var node=nodes[i];if(node instanceof SplitNode){node.weight=node.n/node.batchSize*node.weight-(node.n-1)*node.joinNode.weight}node.parents.forEach(function(parent){parent.weight+=node.weight})}}var edge=function(parent,child){return"  "+parent.id+" -> "+child.id+";"};var shape=function(node,shape){return"  "+node.id+' [shape = "'+shape+'"]'};var label=function(node){return"  "+node.id+' [label = "'+node.label()+'"]'};function generateDot(nodes){var edges=[];var append=function(x){edges.push(x)};nodes.forEach(function(node){if(node instanceof FactorNode){append(shape(node,"box"))}if(node instanceof RootNode||node instanceof JoinNode||node instanceof SplitNode){append(shape(node,"point"))}if(node.label){append(label(node))}node.parents.forEach(function(parent){append(edge(parent,node))})});return"digraph {\n"+edges.join("\n")+"\n}\n"}module.exports={RootNode:RootNode,SampleNode:SampleNode,FactorNode:FactorNode,SplitNode:SplitNode,JoinNode:JoinNode,propagateWeights:propagateWeights,generateDot:generateDot}},{"../ad":151}],201:[function(require,module,exports){"use strict";var ad=require("../ad");var _=require("lodash");var PriorityQueue=require("priorityqueuejs");var util=require("../util");var ScoreAggregator=require("../aggregation/ScoreAggregator");module.exports=function(env){function Enumerate(store,k,a,wpplFn,options){options=util.mergeDefaults(options,{maxExecutions:Infinity,strategy:undefined,throwOnError:true,maxRuntimeInMS:Infinity,maxEnumTreeSize:Infinity},"Enumerate");this.throwOnError=options.throwOnError;this.maxRuntimeInMS=options.maxRuntimeInMS;this.startTime=Date.now();this.firstPath=true;this.levelSizes=[];this.maxExecutions=options.maxExecutions;this.score=0;this.marginal=new ScoreAggregator;this.numCompletedExecutions=0;this.store=store;this.k=k;this.a=a;this.wpplFn=wpplFn;var strategy=strategies[options.strategy]||defaultStrategy(options.maxExecutions);this.queue=strategy.makeQ();this.oldCoroutine=env.coroutine;env.coroutine=this}Enumerate.prototype.run=function(){return this.wpplFn(_.clone(this.store),env.exit,this.a)};Enumerate.prototype.error=function(errType){var err=new Error(errType);if(this.throwOnError){throw err}else{return this.k(this.store,err)}};Enumerate.prototype.nextInQueue=function(){var nextState=this.queue.deq();this.score=nextState.score;return nextState.continuation(nextState.store,nextState.value)};Enumerate.prototype.enqueueContinuation=function(continuation,value,score,store){var state={continuation:continuation,value:value,score:score,store:_.clone(store)};this.queue.enq(state)};var getSupport=function(dist,cont){if(dist.isContinuous||!dist.support){console.error(dist);return env.coroutine.error("Enumerate can only be used with distributions that have finite support.")}var supp=dist.support();if(ad.scalar.peq(supp.length,0)){console.error(dist);return env.coroutine.error("Enumerate encountered a distribution with empty support.")}return cont(supp)};Enumerate.prototype.sample=function(store,k,a,dist){return getSupport(dist,function(support){if(isFinite(this.maxRuntimeInMS)){if(ad.scalar.gt(ad.scalar.sub(Date.now(),this.startTime),this.maxRuntimeInMS)){return this.error(ad.scalar.add("Enumerate timeout: max time was set to ",this.maxRuntimeInMS))}}if(isFinite(this.maxEnumTreeSize)){this.levelSizes.push(support.length)}_.each(support,function(value){this.enqueueContinuation(k,value,ad.scalar.add(this.score,dist.score(value)),store)}.bind(this));return this.nextInQueue()}.bind(this))};Enumerate.prototype.factor=function(s,k,a,score){this.score=ad.scalar.add(this.score,score);if(ad.scalar.peq(this.score,ad.scalar.neg(Infinity))){return this.exit()}return k(s)};Enumerate.prototype.sampleWithFactor=function(store,k,a,dist,scoreFn){return getSupport(dist,function(support){return util.cpsForEach(function(value,i,support,nextK){return scoreFn(store,function(store,extraScore){var score=ad.scalar.add(ad.scalar.add(env.coroutine.score,dist.score(value)),extraScore);env.coroutine.enqueueContinuation(k,value,score,store);return nextK()},a,value)},function(){return env.coroutine.nextInQueue()},support)})};var estimateEnumTreeSize=function(sizes){var numNodes=1;var enumTreeSize=1;for(var i in sizes){numNodes=ad.scalar.mul(numNodes,sizes[i]);enumTreeSize=ad.scalar.add(enumTreeSize,numNodes)}return enumTreeSize};Enumerate.prototype.exit=function(s,retval){if(isFinite(this.maxEnumTreeSize)){if(this.firstPath){this.firstPath=false;var estimatedTreeSize=estimateEnumTreeSize(this.levelSizes);if(ad.scalar.gt(estimatedTreeSize,this.maxEnumTreeSize)){return this.error(ad.scalar.add(estimatedTreeSize," computations ahead."))}}}this.marginal.add(retval,this.score);this.numCompletedExecutions=ad.scalar.add(this.numCompletedExecutions,1);if(ad.scalar.gt(this.queue.size(),0)&&ad.scalar.lt(this.numCompletedExecutions,this.maxExecutions)){return this.nextInQueue()}else{if(ad.scalar.peq(this.marginal.size,0)){return this.error("All paths explored by Enumerate have probability zero.")}env.coroutine=this.oldCoroutine;return this.k(this.store,this.marginal.toDist())}};Enumerate.prototype.incrementalize=env.defaultCoroutine.incrementalize;var strategies={likelyFirst:{makeQ:function(){return new PriorityQueue(function(a,b){return ad.scalar.sub(a.score,b.score)})}},depthFirst:{makeQ:function(){var q=[];q.size=function(){return q.length};q.enq=q.push;q.deq=q.pop;return q}},breadthFirst:{makeQ:function(){var q=[];q.size=function(){return q.length};q.enq=q.push;q.deq=q.shift;return q}}};function defaultStrategy(maxExecutions){return strategies[_.isFinite(maxExecutions)?"likelyFirst":"depthFirst"]}return{Enumerate:function(s,k,a,wpplFn,options){return new Enumerate(s,k,a,wpplFn,options).run()}}}},{"../ad":151,"../aggregation/ScoreAggregator":153,"../util":246,lodash:124,priorityqueuejs:127}],202:[function(require,module,exports){"use strict";var ad=require("../ad");var _=require("lodash");var assert=require("assert");var util=require("../util");var paramStruct=require("../params/struct");var guide=require("../guide");module.exports=function(env){function makeEUBOEstimator(options){options=util.mergeDefaults(options,{batchSize:1,traces:undefined},"EUBO");if(!options.traces){throw"Example traces required."}if(options.batchSize<=0||options.batchSize>options.traces.length){throw"Invalid batchSize."}return function(wpplFn,s,a,state,step,cont){return new EUBO(wpplFn,s,a,options,state,step,cont).run()}}function EUBO(wpplFn,s,a,options,state,step,cont){this.opts=options;this.traces=this.opts.traces;this.cont=cont;this.wpplFn=wpplFn;this.s=s;this.a=a;this.guideRequired=true;this.isParamBase=true;this.oldCoroutine=env.coroutine;env.coroutine=this}EUBO.prototype={run:function(){var eubo=0;var grad={};var traces=sampleMiniBatch(this.traces,this.opts.batchSize);return util.cpsForEach(function(trace,i,traces,next){return this.estimateGradient(trace,function(g,eubo_i){paramStruct.addEq(grad,g);eubo+=eubo_i;return next()})}.bind(this),function(){paramStruct.divEq(grad,traces.length);eubo/=traces.length;env.coroutine=this.oldCoroutine;return this.cont(grad,eubo)}.bind(this),traces)},estimateGradient:function(trace,cont){this.trace=trace;this.paramsSeen={};this.logq=0;return this.wpplFn(_.clone(this.s),function(){var objective=ad.scalar.neg(this.logq);objective.backprop();var grads=_.mapValues(this.paramsSeen,ad.derivative);var logp=ad.value(trace.score);var logq=ad.value(this.logq);return cont(grads,ad.scalar.sub(logp,logq))}.bind(this),this.a)},sample:function(s,k,a,dist,options){options=options||{};return guide.getDist(options.guide,options.noAutoGuide,dist,env,s,a,function(s,guideDist){if(!guideDist){throw new Error("EUBO: No guide distribution to optimize.")}var rel=util.relativizeAddress(this.a,a);var guideVal=this.trace.findChoice(ad.scalar.add(this.trace.baseAddress,rel)).val;assert.notStrictEqual(guideVal,undefined);var _guideVal=ad.value(guideVal);this.logq=ad.scalar.add(this.logq,guideDist.score(_guideVal));return k(s,_guideVal)}.bind(this))},factor:function(s,k,a,score){return k(s)},incrementalize:env.defaultCoroutine.incrementalize,constructor:EUBO};function sampleMiniBatch(data,batchSize){if(data.length===batchSize){return data}else{var miniBatch=[];_.times(batchSize,function(){var ix=Math.floor(util.random()*data.length);miniBatch.push(data[ix])});return miniBatch}}return makeEUBOEstimator}},{"../ad":151,"../guide":189,"../params/struct":228,"../util":246,assert:248,lodash:124}],203:[function(require,module,exports){"use strict";var _=require("lodash");var util=require("../util");var numeric=require("../math/numeric");var CountAggregator=require("../aggregation/CountAggregator");var ad=require("../ad");var guide=require("../guide");module.exports=function(env){function RunForward(s,k,a,wpplFn,sampleGuide){this.s=s;this.k=k;this.a=a;this.wpplFn=wpplFn;this.sampleGuide=sampleGuide;this.guideRequired=sampleGuide;this.isParamBase=true;this.score=0;this.logWeight=0;this.oldCoroutine=env.coroutine;env.coroutine=this}RunForward.prototype={run:function(){return this.wpplFn(_.clone(this.s),function(s,val){env.coroutine=this.oldCoroutine;var ret={val:val,score:this.score,logWeight:this.logWeight};return this.k(this.s,ret)}.bind(this),this.a)},sample:function(s,k,a,dist,options){var cont=function(s,dist){var val=dist.sample();this.score+=dist.score(val);return k(s,val)}.bind(this);if(this.sampleGuide){options=options||{};return guide.getDist(options.guide,options.noAutoGuide,dist,env,s,a,function(s,maybeGuideDist){return cont(s,maybeGuideDist||dist)})}else{return cont(s,dist)}},factor:function(s,k,a,score){if(!this.sampleGuide){var msg="Note that factor, condition and observe statements are "+"ignored when forward sampling.";util.warn(msg,true)}this.logWeight+=ad.value(score);return k(s)},incrementalize:env.defaultCoroutine.incrementalize,constructor:RunForward};function runForward(){var coroutine=Object.create(RunForward.prototype);RunForward.apply(coroutine,arguments);return coroutine.run()}function ForwardSample(s,k,a,wpplFn,options){var opts=util.mergeDefaults(options,{samples:100,guide:false,onlyMAP:false,verbose:false},"ForwardSample");var hist=new CountAggregator(opts.onlyMAP);var logWeights=[];return util.cpsLoop(opts.samples,function(i,next){return runForward(s,function(s,ret){logWeights.push(ret.logWeight);hist.add(ret.val,ret.score);return next()},a,wpplFn,opts.guide)},function(){var dist=hist.toDist();if(!opts.guide){dist.normalizationConstant=numeric._logsumexp(logWeights)-Math.log(opts.samples)}return k(s,dist)})}function extractVal(k){return function(s,obj){return k(s,obj.val)}}return{ForwardSample:ForwardSample,forward:function(s,k,a,model){return runForward(s,extractVal(k),a,model,false)},forwardGuide:function(s,k,a,model){return runForward(s,extractVal(k),a,model,true)}}}},{"../ad":151,"../aggregation/CountAggregator":152,"../guide":189,"../math/numeric":218,"../util":246,lodash:124}],204:[function(require,module,exports){"use strict";var _=require("lodash");var assert=require("assert");var util=require("../util");var gaussian=require("../dists/gaussian");var tensorGaussian=require("../dists/tensorGaussian");var Trace=require("../trace");var ad=require("../ad");var Tensor=require("../tensor");var generic=require("../math/genericArithmetic");var addEq=generic.addEq;var add=generic.add;var mul=generic.mul;var sum=generic.sum;module.exports=function(env){function makeHMCKernel(options){options=util.mergeDefaults(options,{steps:5,stepSize:.1},"HMC kernel");assert.ok(options.steps>0);var kernel=function(cont,oldTrace,runOpts){return new HMCKernel(cont,oldTrace,options,runOpts).run()};kernel.adRequired=true;return kernel}function HMCKernel(cont,oldTrace,options,runOpts){this.steps=options.steps;this.stepSize=options.stepSize;runOpts=util.mergeDefaults(runOpts,{exitFactor:0});this.exitFactor=runOpts.exitFactor;this.cont=cont;this.oldTrace=oldTrace;this.a=oldTrace.baseAddress;this.oldCoroutine=env.coroutine;env.coroutine=this}HMCKernel.prototype.sample=function(s,k,a,dist,options){var prevChoice=this.prevTrace.findChoice(a);if(!prevChoice){throw new Error("HMC does not support structural continuous variables.")}var val;if(dist.isContinuous){if(dist.noHMC){throw new Error("HMC does not yet support the "+dist.meta.name+" distribution")}var prevVal=ad.value(prevChoice.val);var _val=add(prevVal,mul(this.momentum[a],this.stepSize));if(dist.support){var support=dist.support();var lower=support.lower;var upper=support.upper;while(_val<lower||_val>upper){if(_val<lower){_val=lower+(lower-_val);this.momentum[a]*=-1}if(_val>upper){_val=upper-(_val-upper);this.momentum[a]*=-1}}}val=ad.lift(_val)}else{val=prevChoice.val}this.trace.addChoice(dist,val,a,s,k,options);return k(s,val)};HMCKernel.prototype.factor=function(s,k,a,score){this.trace.numFactors+=1;this.trace.score=ad.scalar.add(this.trace.score,score);if(this.trace.numFactors===this.exitFactor){this.trace.saveContinuation(s,k);return this.exit(s,undefined,true)}return k(s)};HMCKernel.prototype.run=function(){var numChoices=this.oldTrace.choices.reduce(function(acc,c){return acc+(c.dist.isContinuous?1:0)},0);if(numChoices===0){return this.continue(this.oldTrace)}if(ad.isLifted(this.oldTrace.score)){this.oldTrace.score.zeroDerivatives()}this.momentum=sampleMomentum(this.oldTrace);var oldH=computeH(this.oldTrace,this.momentum);this.momentumStep(this.oldTrace,.5);return util.cpsIterate(this.steps-1,this.oldTrace,this.leapFrogStep.bind(this),function(trace){return this.positionStep(function(finalTrace){this.momentumStep(finalTrace,.5);var newH=computeH(finalTrace,this.momentum);var p=Math.min(1,Math.exp(newH-oldH));var accept=util.random()<p;return this.finish(accept?finalTrace:this.oldTrace,accept)}.bind(this),trace)}.bind(this))};function stdGaussianSampleLike(x){return x instanceof Tensor?tensorGaussian.sample(0,1,x.dims):gaussian.sample(0,1)}function sampleMomentum(trace){var momentum={};_.each(trace.choices,function(choice){if(choice.dist.isContinuous){momentum[choice.address]=stdGaussianSampleLike(ad.value(choice.val))}});return momentum}HMCKernel.prototype.leapFrogStep=function(cont,trace){return this.positionStep(function(newTrace){this.momentumStep(newTrace,1);return cont(newTrace)}.bind(this),trace)};HMCKernel.prototype.positionStep=function(cont,trace){this.prevTrace=trace;this.trace=this.prevTrace.fresh();this.positionStepCont=cont;env.query.clear();return this.trace.continue()};HMCKernel.prototype.exit=function(k,val,earlyExit){if(!earlyExit){this.trace.complete(val)}else{assert(this.trace.store);assert(this.trace.k);assert(!this.trace.isComplete())}var cont=this.positionStepCont;this.positionStepCont=undefined;return cont(this.trace)};HMCKernel.prototype.momentumStep=function(trace,scaleFactor){if(ad.isLifted(trace.score)){trace.score.backprop();var stepSize=this.stepSize*scaleFactor;_.each(trace.choices,function(choice){if(choice.dist.isContinuous){this.momentum[choice.address]=addEq(this.momentum[choice.address],mul(ad.derivative(choice.val),stepSize))}}.bind(this))}};function computeH(trace,momentum){var score=ad.value(trace.score);var kinetic=.5*_.reduce(momentum,function(memo,p){return memo+sum(mul(p,p))},0);var x=score-kinetic;return x}HMCKernel.prototype.finish=function(trace,accepted){assert(_.isBoolean(accepted));if(accepted&&trace.value===env.query){trace.value=env.query.getTable()}if(this.oldTrace.info){var oldInfo=this.oldTrace.info;trace.info={accepted:oldInfo.accepted+accepted,total:oldInfo.total+1}}return this.continue(trace)};HMCKernel.prototype.continue=function(trace){env.coroutine=this.oldCoroutine;return this.cont(trace)};HMCKernel.prototype.incrementalize=env.defaultCoroutine.incrementalize;return makeHMCKernel}},{"../ad":151,"../dists/gaussian":167,"../dists/tensorGaussian":183,"../math/genericArithmetic":216,"../tensor":231,"../trace":232,"../util":246,assert:248,lodash:124}],205:[function(require,module,exports){(function(global){"use strict";var _=require("lodash");var assert=require("assert");var util=require("../util");var Hashtable=require("../hashtable").Hashtable;var Query=require("../query").Query;var CountAggregator=require("../aggregation/CountAggregator");module.exports=function(env){var drift=require("./driftKernel")(env);var DEBUG=0;function debuglog(debuglevel){if(DEBUG>=debuglevel){var args=Array.prototype.slice.call(arguments,1);console.log.apply(console,args)}}function tabbedlog(debuglevel,depth){if(DEBUG>=debuglevel){var args=Array.prototype.slice.call(arguments,2);var pad="";for(var i=0;i<depth;i++)pad+="  ";pad+="["+depth+"] ";console.log.apply(console,[pad].concat(args))}}function touch(node){if(!node.__snapshot){node.coroutine.touch(node);node.__snapshot={reachable:true}}}function updateProperty(node,prop,val){touch(node);if(!node.__snapshot[prop])node.__snapshot[prop]=node[prop];node[prop]=val}function hasSnapshotForProperty(node,prop){return node.__snapshot!==undefined&&node.__snapshot[prop]!==undefined}function restoreSnapshot(node){for(var prop in node.__snapshot){node[prop]=node.__snapshot[prop]}node.__snapshot=undefined}function discardSnapshot(node){node.__snapshot=undefined}function DistNode(coroutine,parent,s,k,a,dist,args){this.coroutine=coroutine;this.store=_.clone(s);this.continuation=k;this.address=a;this.dist=dist;this.args=args;this.parent=parent;this.depth=parent.depth+1;this.index=parent.nextChildIdx;this.reachable=true;this.needsUpdate=false;this.val=dist.sample();this.score=0;this.rescore();this.coroutine.addDist(this)}DistNode.prototype.print=function(){tabbedlog(0,this.depth,"DistNode",this.dist,this.val,this.reachable?"":"!!UNREACHABLE!!")};DistNode.prototype.execute=function(){tabbedlog(4,this.depth,"execute distribution");if(this.needsUpdate){tabbedlog(4,this.depth,"yes, dist changed");tabbedlog(5,this.depth,"old dist:",this.__snapshot?this.__snapshot.dist:undefined,"new dist:",this.dist);this.needsUpdate=false;this.rescore()}else{tabbedlog(4,this.depth,"no, dist has not changed");tabbedlog(5,this.depth,"dist:",this.dist)}if(this.score===-Infinity){tabbedlog(4,this.depth,"score became -Infinity; bailing out early");return this.coroutine.exit()}else{return this.kontinue()}};DistNode.prototype.registerInputChanges=function(s,k,dist,args){updateProperty(this,"store",_.clone(s));updateProperty(this,"continuation",k);updateProperty(this,"index",this.parent.nextChildIdx);updateProperty(this,"args",args);this.reachable=true;if(!distEqual(dist,this.dist)){this.needsUpdate=true;updateProperty(this,"dist",dist)}};DistNode.prototype.kontinue=function(){this.parent.notifyChildExecuted(this);return this.continuation(_.clone(this.store),this.val)};DistNode.prototype.killDescendantLeaves=function(){this.coroutine.removeDist(this)};DistNode.prototype.propose=function(){var oldval=this.val;var sampleOptions=this.args[0];return drift.getProposalDist(this.store,this.address,this.dist,sampleOptions,oldval,function(s,fwdPropDist){var newval=fwdPropDist.sample();tabbedlog(4,this.depth,"proposing change to distribution.","oldval:",oldval,"newval:",newval);if(oldval===newval){tabbedlog(4,this.depth,"proposal didn't change value; bailing out early");tabbedlog(5,this.depth,"value:",this.val);return this.coroutine.exit()}else{updateProperty(this,"store",_.clone(this.store));updateProperty(this,"val",newval);this.rescore();if(this.score===-Infinity&&_.has(sampleOptions,"driftKernel")){drift.proposalWarning(this.dist)}return drift.getProposalDist(s,this.address,this.dist,sampleOptions,newval,function(s,rvsPropDist){this.coroutine.rvsPropLP=rvsPropDist.score(oldval);this.coroutine.fwdPropLP=fwdPropDist.score(newval);tabbedlog(1,this.depth,"initial rvsPropLP:",this.coroutine.rvsPropLP,"initial fwdPropLP:",this.coroutine.fwdPropLP);this.needsUpdate=false;if(this.coroutine.doFullRerun){for(var node=this.parent;node!==null;node=node.parent)node.needsUpdate=true;return this.coroutine.runFromStart()}else{this.parent.notifyChildChanged(this);this.coroutine.restoreStackUpTo(this.parent);return this.execute()}}.bind(this))}}.bind(this))};DistNode.prototype.rescore=function(){var oldscore=this.score;updateProperty(this,"score",this.dist.score(this.val));this.coroutine.score+=this.score-oldscore};function distEqual(dist1,dist2){return dist1.constructor===dist2.constructor&&distParamsEqual(dist1.params,dist2.params)}function distParamsEqual(p1,p2){if(p1===p2){return true}for(var k in p1){if(p1.hasOwnProperty(k)){var v1=p1[k],v2=p2[k];if(typeof v1==="number"){if(v1!==v2){return false}}else if(_.isArray(v1)){if(!_.isEqual(v1,v2)){return false}}else{return false}}}return true}function FactorNode(coroutine,parent,s,k,a,unused,args){this.coroutine=coroutine;this.store=s;this.continuation=k;this.address=a;this.parent=parent;this.depth=parent.depth+1;this.index=parent.nextChildIdx;this.reachable=true;this.rescore(0,args[0]);tabbedlog(3,this.depth,"new factor")}FactorNode.prototype.print=function(){tabbedlog(0,this.depth,"FactorNode",this.reachable?"":"!!UNREACHABLE!!")};FactorNode.prototype.execute=function(){if(this.score===-Infinity){tabbedlog(4,this.depth,"score became -Infinity; bailing out early");return this.coroutine.exit()}else{return this.kontinue()}};FactorNode.prototype.registerInputChanges=function(s,k,unused,args){updateProperty(this,"store",s);updateProperty(this,"continuation",k);updateProperty(this,"index",this.parent.nextChildIdx);this.reachable=true;if(this.score!==args[0])this.rescore(this.score,args[0])};FactorNode.prototype.kontinue=function(){this.parent.notifyChildExecuted(this);return this.continuation(this.store)};FactorNode.prototype.killDescendantLeaves=function(){tabbedlog(3,this.depth,"kill factor",this.address);this.coroutine.score-=this.score};FactorNode.prototype.rescore=function(oldscore,score){updateProperty(this,"score",score);this.coroutine.score+=score-oldscore};function storesEqual(s1,s2){var prop;for(prop in s1){if(s1[prop]!==s2[prop])return false}for(prop in s2){if(s1[prop]!==s2[prop])return false}return true}var fnEquivCache={};function fnsEqual(f1,f2){if(f1===f2)return true;if(f1.__lexid===undefined||f2.__lexid===undefined)return false;if(f1.__lexid===f2.__lexid){var key=JSON.stringify([f1.__uniqueid,f2.__uniqueid]);var val=fnEquivCache[key];if(val===undefined){val=true;for(var i=0;i<f1.__freeVarVals.length;i++){var v1=f1.__freeVarVals[i];var v2=f2.__freeVarVals[i];var eq=_.isFunction(v1)&&_.isFunction(v2)?fnsEqual(v1,v2):v1===v2;if(!eq){val=false;break}}fnEquivCache[key]=val}return val}return false}function FunctionNode(coroutine,parent,s,k,a,fn,args){this.coroutine=coroutine;this.continuation=k;this.address=a;this.func=fn;this.parent=parent;this.depth=parent?parent.depth+1:0;this.index=parent?parent.nextChildIdx:undefined;this.children=[];this.nextChildIdx=0;this.reachable=true;this.needsUpdate=true;this.inStore=_.clone(s);this.args=args;this.initialized=false;this.retval=undefined;this.outStore=null}FunctionNode.prototype.print=function(){tabbedlog(0,this.depth,"FunctionNode",this.args,this.retval,this.reachable?"":"!!UNREACHABLE!!");for(var i=0;i<this.children.length;i++)this.children[i].print()};FunctionNode.prototype.execute=function(){tabbedlog(4,this.depth,"execute function");if(this.needsUpdate){if(this.initialized)this.coroutine.cacheAdapter.registerMiss(this);tabbedlog(4,this.depth,"yes, function args changed; executing");tabbedlog(5,this.depth,"old args:",this.__snapshot?this.__snapshot.args:undefined,"new args:",this.args);this.needsUpdate=false;this.coroutine.nodeStack.push(this);this.nextChildIdx=0;var nchildren=this.children.length;for(var i=0;i<nchildren;i++){touch(this.children[i]);this.children[i].reachable=false}tabbedlog(4,this.depth,"Children marked unreachable on execute:",nchildren);var coroutine=this.coroutine;var continuation=this.continuation;var address=this.address;this.entered=true;return this.func.apply(global,[this.inStore,function(s,retval){if(!coroutine.cacheAdapter.shouldCache(address))return continuation(s,retval);var that=coroutine.nodeStack.pop();tabbedlog(4,that.depth,"continue from function");that.initialized=true;var newchildren=[];var nchildren=that.children.length;var ii=0;for(var i=0;i<nchildren;i++){var child=that.children[i];if(!child.reachable)child.killDescendantLeaves();else{updateProperty(child,"index",ii++);newchildren.push(child)}}updateProperty(that,"children",newchildren);if(!that.entered&&that.retval===retval&&storesEqual(that.outStore,s)){tabbedlog(4,that.depth,"bailing b/c function return val not changed");tabbedlog(5,that.depth,"return val:",retval);coroutine.cacheAdapter.registerHit(that);return coroutine.exit()}if(!that.entered&&that.parent!==null)that.parent.notifyChildChanged(that);if(!that.entered)coroutine.cacheAdapter.registerMiss(that);that.entered=false;tabbedlog(4,that.depth,"function return val has changed, or cannot bail");tabbedlog(5,that.depth,"old ret val:",that.retval,"new ret val:",retval);updateProperty(that,"retval",retval);updateProperty(that,"outStore",_.clone(s));return that.kontinue()},this.address].concat(this.args))}else{this.coroutine.cacheAdapter.registerHit(this);tabbedlog(4,this.depth,"no, function args have not changed; continuing");tabbedlog(5,this.depth,"args:",this.args);return this.kontinue()}};FunctionNode.prototype.registerInputChanges=function(s,k,fn,args){updateProperty(this,"continuation",k);if(this.parent)updateProperty(this,"index",this.parent.nextChildIdx);this.reachable=true;if(!fnsEqual(fn,this.func)){this.needsUpdate=true;updateProperty(this,"func",fn)}if(this.args.length!==args.length){this.needsUpdate=true;updateProperty(this,"args",args)}else{var i=args.length;for(var i=0;i<args.length;i++){if(args[i]!==this.args[i]){this.needsUpdate=true;updateProperty(this,"args",args);break}}}if(!storesEqual(this.inStore,s)){this.needsUpdate=true;updateProperty(this,"inStore",_.clone(s))}};FunctionNode.prototype.killDescendantLeaves=function(){tabbedlog(3,this.depth,"kill function (and all descendant leaves)",this.address);var stack=[this];while(stack.length>0){var node=stack.pop();if(node.score!==undefined)node.killDescendantLeaves();else{var n=node.children.length;while(n--)stack.push(node.children[n])}}};FunctionNode.prototype.kontinue=function(){if(this.parent!==null)this.parent.notifyChildExecuted(this);return this.continuation(_.clone(this.outStore),this.retval)};FunctionNode.prototype.notifyChildExecuted=function(child){this.nextChildIdx=child.index+1};FunctionNode.prototype.notifyChildChanged=function(child){var nchildren=this.children.length;var totalmarked=0;for(var i=child.index+1;i<nchildren;i++){touch(this.children[i]);this.children[i].reachable=false;totalmarked++}tabbedlog(4,this.depth,"Children marked unreachable on child change:",totalmarked)};FunctionNode.prototype.removeFromCache=function(){if(this.parent.children[this.index]===this){var n=this.children.length;for(var i=0;i<n;i++){var child=this.children[i];child.parent=this.parent;child.index=this.index+i;var stack=[child];while(stack.length>0){var node=stack.pop();node.depth--;if(node.children){var nn=node.children.length;while(nn--)stack.push(node.children[nn])}}}for(var i=this.index+1;i<this.parent.children.length;i++){this.parent.children[i].index=i+n-1}this.children.unshift(this.index,1);Array.prototype.splice.apply(this.parent.children,this.children)}};function ArrayDistMasterList(){this.distNodes=[]}ArrayDistMasterList.prototype.size=function(){return this.distNodes.length};ArrayDistMasterList.prototype.oldSize=function(){return this.oldDistNodes===undefined?undefined:this.oldDistNodes.length};ArrayDistMasterList.prototype.addDist=function(node){this.distNodes.push(node)};ArrayDistMasterList.prototype.removeDist=function(node){touch(node);node.reachable=false};ArrayDistMasterList.prototype.preProposal=function(){this.oldDistNodes=this.distNodes.slice()};ArrayDistMasterList.prototype.postProposal=function(){this.distNodes=_.filter(this.distNodes,function(node){return node.reachable})};ArrayDistMasterList.prototype.getRandom=function(){var idx=Math.floor(util.random()*this.distNodes.length);return this.distNodes[idx]};ArrayDistMasterList.prototype.restoreOnReject=function(){this.distNodes=this.oldDistNodes};function HashtableDistMasterList(){this.distNodeMap=new Hashtable;this.distsAdded=[];this.distsRemoved=[];this.numDists=0}HashtableDistMasterList.prototype.size=function(){return this.numDists};HashtableDistMasterList.prototype.oldSize=function(){return this.oldNumDists};HashtableDistMasterList.prototype.addDist=function(node){this.distNodeMap.put(node.address,node);this.distsAdded.push(node);this.numDists++};HashtableDistMasterList.prototype.removeDist=function(node){this.distNodeMap.remove(node.address);this.distsRemoved.push(node);this.numDists--};HashtableDistMasterList.prototype.preProposal=function(){this.oldNumDists=this.numDists;this.distsAdded=[];this.distsRemoved=[]};HashtableDistMasterList.prototype.postProposal=function(){};HashtableDistMasterList.prototype.getRandom=function(){return this.distNodeMap.getRandom()};HashtableDistMasterList.prototype.restoreOnReject=function(){this.numDists=this.oldNumDists;var n=this.distsAdded.length;while(n--){var node=this.distsAdded[n];this.distNodeMap.remove(node.address)}n=this.distsRemoved.length;while(n--){var node=this.distsRemoved[n];this.distNodeMap.put(node.address,node)}};HashtableDistMasterList.prototype.checkConsistency=function(tag){for(var i=0;i<this.distsAdded.length;i++){var addr=this.distsAdded[i].address;if(!this.distNodeMap.get(addr))throw new Error("WTF - hash table doesn't contain node "+addr+" that we added ("+tag+")")}for(var i=0;i<this.distsRemoved.length;i++){var addr=this.distsRemoved[i].address;if(this.distNodeMap.get(addr))throw new Error("WTF - hash table contains node "+addr+" that we removed ("+tag+")")}};function CacheAdapter(minHitRate,fuseLength,iterFuseLength){this.minHitRate=minHitRate;this.fuseLength=fuseLength;this.iterFuseLength=iterFuseLength;this.addrToId={};this.stats={};this.idsToRemove={};this.hasIdsToRemove=false}CacheAdapter.prototype.id=function(addr){var id=this.addrToId[addr];if(id===undefined){var arr=addr.split("_");id=arr[arr.length-1];this.addrToId[addr]=id}return id};CacheAdapter.prototype.getStats=function(addr){var id=this.id(addr);var stats=this.stats[id];if(stats===undefined){stats={shouldCache:true,hits:0,total:0};this.stats[id]=stats}return stats};CacheAdapter.prototype.shouldCache=function(addr){return this.getStats(addr).shouldCache};CacheAdapter.prototype.registerHit=function(node){var stats=this.getStats(node.address);stats.hits++;stats.total++;if(node.parent!==null&&node.coroutine.totalIterations-node.coroutine.iterations>this.iterFuseLength&&stats.total>=this.fuseLength&&stats.hits/stats.total<this.minHitRate){this.idsToRemove[this.id(node.address)]=true;this.hasIdsToRemove=true}};CacheAdapter.prototype.registerMiss=function(node){var stats=this.getStats(node.address);stats.total++;if(node.parent!==null&&node.coroutine.totalIterations-node.coroutine.iterations>this.iterFuseLength&&stats.total>=this.fuseLength&&stats.hits/stats.total<this.minHitRate){this.idsToRemove[this.id(node.address)]=true;this.hasIdsToRemove=true}};CacheAdapter.prototype.adapt=function(cacheRoot){if(this.hasIdsToRemove){for(var id in this.idsToRemove){var s=this.stats[id];debuglog(5,"Cache adapter removing nodes w/ id",id,"hit rate:",s.hits/s.total);this.stats[id].shouldCache=false}var stack=[cacheRoot];while(stack.length>0){var node=stack.pop();if(node.children!==undefined){var n=node.children.length;while(n--)stack.push(node.children[n])}if(this.idsToRemove[this.id(node.address)]){node.removeFromCache()}}this.idsToRemove={};this.hasIdsToRemove=false;if(DEBUG>=6){debuglog(6,"=== Post-adaptation cache status ===");cacheRoot.print()}}};CacheAdapter.prototype.report=function(){for(var id in this.stats){console.log(id,":",this.stats[id])}};function IncrementalMH(s,k,a,wpplFn,opts){opts=util.mergeDefaults(opts,{samples:1,dontAdapt:false,debuglevel:0,verbose:false,doFullRerun:false,onlyMAP:false,cacheMinHitRate:1e-8,cacheFuseLength:50,lag:0,cacheIterFuseLength:10,burn:0,verboseLag:1},"IncrementalMH");if(opts.doFullRerun)opts.dontAdapt=true;DEBUG=opts.debuglevel;this.verbose=opts.verbose;this.k=k;this.oldStore=s;this.iterations=opts.samples*(opts.lag+1)+opts.burn;this.wpplFn=wpplFn;this.s=s;this.a=a;this.aggregator=new CountAggregator(opts.onlyMAP);this.totalIterations=this.iterations;this.acceptedProps=0;this.lag=opts.lag;this.burn=opts.burn;this.verboseLag=opts.verboseLag;this.doFullRerun=opts.doFullRerun;this.doAdapt=!opts.dontAdapt;this.cacheAdapter=new CacheAdapter(opts.cacheMinHitRate,opts.cacheFuseLength,opts.cacheIterFuseLength);this.oldCoroutine=env.coroutine;env.coroutine=this}IncrementalMH.prototype.run=function(){this.cacheRoot=null;this.distMasterList=new HashtableDistMasterList;this.touchedNodes=[];this.score=0;this.fwdPropLP=0;this.rvsPropLP=0;this.query=new Query;env.query.clear();debuglog(1,"-------------------------------------");debuglog(1,"RUN FROM START");return this.runFromStart()};IncrementalMH.prototype.runFromStart=function(){this.nodeStack=[];return this.incrementalize(this.s,env.exit,this.a,this.wpplFn,[])};IncrementalMH.prototype.factor=function(s,k,a,score){return this.cachelookup(FactorNode,s,k,a,null,[score]).execute()};IncrementalMH.prototype.sample=function(s,k,a,dist,options,name){var n=this.cachelookup(DistNode,s,k,a,dist,[options]);n.name=name;return n.execute()};IncrementalMH.prototype.touch=function(node){this.touchedNodes.push(node)};function acceptProb(currScore,oldScore,currN,oldN,rvsPropLP,fwdPropLP){if(oldScore===undefined){return 1}if(currScore===-Infinity)return 0;debuglog(1,"currScore:",currScore,"oldScore",oldScore);debuglog(1,"rvsPropLP:",rvsPropLP,"fwdPropLP:",fwdPropLP);var fw=-Math.log(oldN)+fwdPropLP;var bw=-Math.log(currN)+rvsPropLP;var p=Math.exp(currScore-oldScore+bw-fw);assert.ok(!isNaN(p));var acceptance=Math.min(1,p);return acceptance}IncrementalMH.prototype.isInitialized=function(){return this.iterations<this.totalIterations};IncrementalMH.prototype.exit=function(){if(this.iterations>0){if(!this.isInitialized()&&this.score===-Infinity){return this.run()}else{var iternum=this.totalIterations-this.iterations;debuglog(1,"iteration",iternum);if(this.verbose&&this.iterations%this.verboseLag===0){if(iternum>this.burn){console.log("IncrementalMH iteration "+(iternum-this.burn)+" / "+(this.totalIterations-this.burn))}else{console.log("IncrementalMH burnin "+iternum+" / "+this.burn)}}this.iterations--;this.distMasterList.postProposal();debuglog(2,"Num vars:",this.distMasterList.size());debuglog(2,"Touched nodes:",this.touchedNodes.length);var acceptance=acceptProb(this.score,this.oldScore,this.distMasterList.size(),this.distMasterList.oldSize(),this.rvsPropLP,this.fwdPropLP);debuglog(1,"num vars:",this.distMasterList.size(),"old num vars:",this.distMasterList.oldSize());debuglog(1,"acceptance prob:",acceptance);if(util.random()>=acceptance){debuglog(1,"REJECT");this.score=this.oldScore;var n=this.touchedNodes.length;while(n--)restoreSnapshot(this.touchedNodes[n]);this.distMasterList.restoreOnReject()}else{debuglog(1,"ACCEPT");var n=this.touchedNodes.length;while(n--)discardSnapshot(this.touchedNodes[n]);this.acceptedProps++;this.query.addAll(env.query)}env.query.clear();var val=this.cacheRoot.retval;debuglog(1,"return val:",val);if(iternum%(this.lag+1)===0&&iternum>=this.burn){if(val===env.query)val=this.query.getTable();this.aggregator.add(val,this.score)}if(DEBUG>=6){debuglog(6,"=== Cache status ===");this.cacheRoot.print()}if(this.doAdapt)this.cacheAdapter.adapt(this.cacheRoot);if(this.distMasterList.numDists>0){this.oldScore=this.score;this.distMasterList.preProposal();this.touchedNodes=[];this.fwdPropLP=0;this.rvsPropLP=0;var propnode=this.distMasterList.getRandom();debuglog(1,"----------------------------------------------------------------------");debuglog(1,"PROPOSAL","type:",propnode.dist,"address:",propnode.address);return propnode.propose()}else{return this.runFromStart()}}}else{var k=this.k;env.coroutine=this.oldCoroutine;if(DEBUG>=5){console.log("Acceptance ratio: "+this.acceptedProps/this.totalIterations);this.cacheAdapter.report()}return k(this.oldStore,this.aggregator.toDist())}};IncrementalMH.prototype.incrementalize=function(s,k,a,fn,args){if(this.cacheAdapter.shouldCache(a))return this.cachelookup(FunctionNode,s,k,a,fn,args).execute();else return env.defaultCoroutine.incrementalize(s,k,a,fn,args)};IncrementalMH.prototype.cachelookup=function(NodeType,s,k,a,fn,args){var cacheNode;if(this.cacheRoot===null){cacheNode=new NodeType(this,null,s,k,a,fn,args);this.cacheRoot=cacheNode}else if(this.nodeStack.length===0){if(a!==this.cacheRoot.address)throw new Error("Wrong address for cache root lookup");cacheNode=this.cacheRoot;cacheNode.registerInputChanges(s,k,fn,args)}else{var currNode=this.nodeStack[this.nodeStack.length-1];tabbedlog(3,currNode.depth,"lookup",NodeType.name,a);cacheNode=this.findNode(currNode,a);if(cacheNode){tabbedlog(3,currNode.depth,"found");cacheNode.registerInputChanges(s,k,fn,args)}else{if(DEBUG){var addrs=_.map(_.filter(currNode.children,function(node){return node instanceof NodeType}),function(node){return node.address});tabbedlog(3,currNode.depth,"*not* found");tabbedlog(4,currNode.depth,"options were",addrs)}cacheNode=new NodeType(this,currNode,s,k,a,fn,args);var insertidx=currNode.nextChildIdx;if(!hasSnapshotForProperty(currNode,"children"))updateProperty(currNode,"children",currNode.children.slice());currNode.children.splice(insertidx,0,cacheNode)}}return cacheNode};IncrementalMH.prototype.findNode=function(parentNode,address){if(!this.isInitialized())return undefined;var nodes=parentNode.children;var nexti=parentNode.nextChildIdx;for(var i=nexti;i<nodes.length;i++){if(nodes[i].address===address){if(i!==nexti){if(!hasSnapshotForProperty(parentNode,"children")){nodes=nodes.slice();updateProperty(parentNode,"children",nodes)}var tmp=nodes[i];nodes[i]=nodes[nexti];nodes[nexti]=tmp}return nodes[nexti]}}};IncrementalMH.prototype.addDist=function(node){tabbedlog(3,node.depth,"new distribution");this.distMasterList.addDist(node);this.fwdPropLP+=node.score};IncrementalMH.prototype.removeDist=function(node){tabbedlog(3,node.depth,"kill distribution",node.address);this.distMasterList.removeDist(node);this.rvsPropLP+=node.score;this.score-=node.score};IncrementalMH.prototype.restoreStackUpTo=function(node){this.nodeStack=[];while(node!==null){this.nodeStack.push(node);node=node.parent}this.nodeStack.reverse()};IncrementalMH.prototype.addressInCache=function(addr){var stack=[this.cacheRoot];while(stack.length>0){var node=stack.pop();if(node.address===addr)return true;if(node.children!==undefined)for(var i=0;i<node.children.length;i++)stack.push(node.children[i])}return false};IncrementalMH.prototype.checkReachabilityConsistency=function(){var stack=[this.cacheRoot];while(stack.length>0){var node=stack.pop();if(!node.reachable)throw new Error("WTF - found unreachable node in cache.");if(node.children!==undefined)for(var i=0;i<node.children.length;i++)stack.push(node.children[i])}return false};function imh(s,cc,a,wpplFn,opts){opts=opts||{};return new IncrementalMH(s,cc,a,wpplFn,opts).run()}return{IncrementalMH:imh}}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"../aggregation/CountAggregator":152,"../hashtable":190,"../query":229,"../util":246,"./driftKernel":198,assert:248,lodash:124}],206:[function(require,module,exports){"use strict";var _=require("lodash");var assert=require("assert");var Trace=require("../trace");var ad=require("../ad");module.exports=function(env){var warnAfter=[1e3,1e4,1e5,1e6];function Initialize(cont,wpplFn,s,k,a,options){this.cont=cont;this.wpplFn=wpplFn;this.s=s;this.k=k;this.a=a;this.ad=options.ad;this.failures=0;this.oldCoroutine=env.coroutine;env.coroutine=this}Initialize.prototype.run=function(){this.trace=new Trace(this.wpplFn,this.s,this.k,this.a);env.query.clear();return this.trace.continue()};Initialize.prototype.sample=function(s,k,a,dist,options){var _val=dist.sample();var val=this.ad&&dist.isContinuous?ad.lift(_val):_val;this.trace.addChoice(dist,val,a,s,k,options);return k(s,val)};Initialize.prototype.factor=function(s,k,a,score){if(ad.value(score)===-Infinity){return this.fail()}this.trace.score=ad.scalar.add(this.trace.score,score);return k(s)};Initialize.prototype.fail=function(){this.failures+=1;var ix=warnAfter.indexOf(this.failures);if(ix>=0){console.log(["Initialization warning [",ix+1,"/",warnAfter.length,"]: Trace not initialized after ",this.failures," attempts."].join(""))}return this.run()};Initialize.prototype.exit=function(s,val){assert.notStrictEqual(this.trace.score,-Infinity);this.trace.complete(val);if(this.trace.value===env.query){this.trace.value=env.query.getTable()}env.coroutine=this.oldCoroutine;return this.cont(this.trace)};Initialize.prototype.incrementalize=env.defaultCoroutine.incrementalize;return function(cont,wpplFn,s,k,a,options){return new Initialize(cont,wpplFn,s,k,a,options).run()}}},{"../ad":151,"../trace":232,assert:248,lodash:124}],207:[function(require,module,exports){"use strict";var assert=require("assert");var _=require("lodash");var util=require("../util");module.exports=function(env){var makeMHKernel=require("./mhkernel")(env);var makeHMCKernel=require("./hmckernel")(env);function makeHMCwithMHKernel(options){var hmc=makeHMCKernel(options);var mh=makeMHKernel({discreteOnly:true,adRequired:true});var kernel=function(cont,oldTrace,runOpts){return hmc(function(trace){return mh(cont,trace,runOpts)},oldTrace,runOpts)};kernel.adRequired=true;return kernel}var kernels={MH:makeMHKernel,HMC:makeHMCwithMHKernel,HMConly:makeHMCKernel};function parseOptions(obj){return util.getValAndOpts(obj,function(name,options){if(!_.has(kernels,name)){throw new Error(name+" is not a valid kernel. "+"The following kernels are available: "+_.keys(kernels).join(", ")+".")}return kernels[name](options)})}function tap(fn){return function(k,trace){fn(trace);return k(trace)}}function sequence(){var kernels=arguments;assert(kernels.length>1);if(kernels.length===2){return function(k,trace1){return kernels[0](function(trace2){return kernels[1](k,trace2)},trace1)}}else{return sequence(kernels[0],sequence.apply(null,_.rest(kernels)))}}function repeat(n,kernel){return function(k,trace){return util.cpsIterate(n,trace,kernel,k)}}return{parseOptions:parseOptions,tap:tap,sequence:sequence,repeat:repeat}}},{"../util":246,"./hmckernel":204,"./mhkernel":209,assert:248,lodash:124}],208:[function(require,module,exports){(function(process){"use strict";var _=require("lodash");var util=require("../util");var CountAggregator=require("../aggregation/CountAggregator");var ad=require("../ad");module.exports=function(env){var Initialize=require("./initialize")(env);var kernels=require("./kernels")(env);function MCMC(s,k,a,wpplFn,options){var options=util.mergeDefaults(options,{samples:100,kernel:"MH",lag:0,burn:0,verbose:false,onlyMAP:false,callbacks:[]},"MCMC");options.kernel=kernels.parseOptions(options.kernel);var callbacks=options.verbose?[makeVMCallbackForPlatform()].concat(options.callbacks):options.callbacks;_.invokeMap(callbacks,"setup",numIters(options));var aggregator=new CountAggregator(options.onlyMAP);var addToAggregator=options.kernel.adRequired?function(value,score){aggregator.add(ad.valueRec(value),ad.value(score))}:aggregator.add.bind(aggregator);var initialize,run,finish;initialize=function(){_.invokeMap(callbacks,"initialize");return Initialize(run,wpplFn,s,env.exit,a,{ad:options.kernel.adRequired})};run=function(initialTrace){initialTrace.info={accepted:0,total:0};var callback=kernels.tap(function(trace){_.invokeMap(callbacks,"iteration",trace)});var collectSample=makeExtractValue(addToAggregator);var kernel=kernels.sequence(options.kernel,callback);var chain=kernels.sequence(kernels.repeat(options.burn,kernel),kernels.repeat(options.samples,kernels.sequence(kernels.repeat(options.lag+1,kernel),collectSample)));return chain(finish,initialTrace)};finish=function(trace){_.invokeMap(callbacks,"finish",trace);return k(s,aggregator.toDist())};return initialize()}function makeExtractValue(fn){return kernels.tap(function(trace){fn(trace.value,trace.score)})}function numIters(opts){return opts.burn+(opts.lag+1)*opts.samples}function makeVMCallback(opts){var curIter=0;return{iteration:function(trace){opts.iteration(trace,curIter++)},finish:function(trace){opts.finish(trace,curIter-1)}}}function makeSimpleVMCallback(){return makeVMCallback({iteration:function(trace,i){console.log(formatOutput(trace,i))},finish:_.identity})}function makeOverwritingVMCallback(){var writeCurIter=function(trace,i){process.stdout.write("\r"+formatOutput(trace,i))};return makeVMCallback({iteration:_.throttle(writeCurIter,200,{trailing:false}),finish:function(trace,i){writeCurIter(trace,i);console.log()}})}function formatOutput(trace,i){var ratio=trace.info.total===0?0:trace.info.accepted/trace.info.total;return"Iteration: "+i+" | Acceptance ratio: "+ratio.toFixed(4)}function makeVMCallbackForPlatform(){return util.runningInBrowser()?makeSimpleVMCallback():makeOverwritingVMCallback()}return{MCMC:MCMC}}}).call(this,require("_process"))},{"../ad":151,"../aggregation/CountAggregator":152,"../util":246,"./initialize":206,"./kernels":207,_process:251,lodash:124}],209:[function(require,module,exports){"use strict";var _=require("lodash");var assert=require("assert");var util=require("../util");var numeric=require("../math/numeric");var ad=require("../ad");module.exports=function(env){var drift=require("./driftKernel")(env);function makeMHKernel(options){options=util.mergeDefaults(options,{adRequired:false,permissive:false,discreteOnly:false},"MH kernel");return function(cont,oldTrace,runOpts){return new MHKernel(cont,oldTrace,options,runOpts).run()}}function MHKernel(cont,oldTrace,options,runOpts){this.discreteOnly=options.discreteOnly;this.adRequired=options.adRequired;if(!options.permissive){assert.notStrictEqual(oldTrace.score,-Infinity)}runOpts=util.mergeDefaults(runOpts,{proposalBoundary:0,exitFactor:0});this.proposalBoundary=runOpts.proposalBoundary;this.exitFactor=runOpts.exitFactor;this.cont=cont;this.oldTrace=oldTrace;this.a=oldTrace.baseAddress;this.reused={};this.oldCoroutine=env.coroutine;env.coroutine=this}MHKernel.prototype.run=function(){this.regenFrom=this.sampleRegenChoice(this.oldTrace);if(this.regenFrom<0){return this.continue(this.oldTrace)}env.query.clear();this.trace=this.oldTrace.upto(this.regenFrom);var regen=this.oldTrace.choiceAtIndex(this.regenFrom);return this.resample(_.clone(regen.store),regen.k,regen.address,regen.dist,regen.options)};MHKernel.prototype.factor=function(s,k,a,score){if(ad.value(score)===-Infinity){return this.finish(this.oldTrace,false)}this.trace.numFactors+=1;this.trace.score=ad.scalar.add(this.trace.score,score);if(this.trace.numFactors===this.exitFactor){this.trace.saveContinuation(s,k);return this.exit(s,undefined,true)}return k(s)};MHKernel.prototype.sample=function(s,k,a,dist,options){var prevChoice=this.oldTrace.findChoice(a);var val;if(prevChoice){val=prevChoice.val;this.reused[a]=true}else{var _val=dist.sample();val=this.adRequired&&dist.isContinuous?ad.lift(_val):_val}return this.addChoiceToTrace(s,k,a,dist,options,val)};MHKernel.prototype.resample=function(s,k,a,dist,options){var prevChoice=this.oldTrace.findChoice(a);assert(prevChoice);return drift.getProposalDist(s,a,dist,options,prevChoice.val,function(s,fwdProposalDist){var _val=fwdProposalDist.sample();var val=this.adRequired&&fwdProposalDist.isContinuous?ad.lift(_val):_val;if(!fwdProposalDist.isContinuous&&prevChoice.val===val){return this.finish(this.oldTrace,true)}return drift.getProposalDist(s,a,dist,options,val,function(s,revProposalDist){this.fwdProposalDist=fwdProposalDist;this.revProposalDist=revProposalDist;return this.addChoiceToTrace(s,k,a,dist,options,val,true)}.bind(this))}.bind(this))};MHKernel.prototype.addChoiceToTrace=function(s,k,a,dist,options,val,atResample){this.trace.addChoice(dist,val,a,s,k,options);if(ad.value(this.trace.score)===-Infinity){if(atResample&&_.has(options,"driftKernel")){drift.proposalWarning(dist)}return this.finish(this.oldTrace,false)}return k(s,val)};MHKernel.prototype.exit=function(s,val,earlyExit){if(!earlyExit){this.trace.complete(val)}else{assert(this.trace.store);assert(this.trace.k);assert(!this.trace.isComplete())}var prob=this.acceptProb(this.trace,this.oldTrace);var accept=util.random()<prob;return this.finish(accept?this.trace:this.oldTrace,accept)};MHKernel.prototype.finish=function(trace,accepted){assert(_.isBoolean(accepted));if(accepted&&trace.value===env.query){trace.value=_.assign({},this.oldTrace.value,env.query.getTable())}if(this.oldTrace.info){var oldInfo=this.oldTrace.info;trace.info={accepted:oldInfo.accepted+accepted,total:oldInfo.total+1}}return this.continue(trace)};MHKernel.prototype.continue=function(trace){env.coroutine=this.oldCoroutine;return this.cont(trace)};MHKernel.prototype.incrementalize=env.defaultCoroutine.incrementalize;MHKernel.prototype.proposableDiscreteDistIndices=function(trace){return _.range(this.proposalBoundary,trace.length).filter(function(i){return!trace.choices[i].dist.isContinuous})};MHKernel.prototype.numRegenChoices=function(trace){if(this.discreteOnly){return this.proposableDiscreteDistIndices(trace).length}else{return trace.length-this.proposalBoundary}};MHKernel.prototype.sampleRegenChoice=function(trace){return this.discreteOnly?this.sampleRegenChoiceDiscrete(trace):this.sampleRegenChoiceAny(trace)};MHKernel.prototype.sampleRegenChoiceDiscrete=function(trace){var indices=this.proposableDiscreteDistIndices(trace);return indices.length>0?indices[Math.floor(util.random()*indices.length)]:-1};MHKernel.prototype.sampleRegenChoiceAny=function(trace){var numChoices=trace.length-this.proposalBoundary;return numChoices>0?this.proposalBoundary+Math.floor(util.random()*numChoices):-1};MHKernel.prototype.acceptProb=function(trace,oldTrace){var fw=this.transitionProb(oldTrace,trace,this.fwdProposalDist);var bw=this.transitionProb(trace,oldTrace,this.revProposalDist);var p=Math.exp(ad.value(trace.score)-ad.value(oldTrace.score)+bw-fw);assert(!isNaN(p));return Math.min(1,p)};MHKernel.prototype.transitionProb=function(fromTrace,toTrace,proposalDist){var regenChoice=toTrace.choiceAtIndex(this.regenFrom);var score=ad.value(proposalDist.score(regenChoice.val));score+=numeric._sum(toTrace.choices.slice(this.regenFrom+1).map(function(choice){return this.reused.hasOwnProperty(choice.address)?0:ad.value(choice.dist.score(choice.val))},this));score-=Math.log(this.numRegenChoices(fromTrace));assert(!isNaN(score));return score};return makeMHKernel}},{"../ad":151,"../math/numeric":218,"../util":246,"./driftKernel":198,assert:248,lodash:124}],210:[function(require,module,exports){"use strict";var _=require("lodash");var nodeutil=require("util");var present=require("present");var util=require("../util");var optMethods=require("adnn/opt");var paramStruct=require("../params/struct");var params=require("../params/params");var weightDecay=require("./weightDecay");var nodeUtil=require("util");module.exports=function(env){var applyd=require("../headerUtils")(env).applyd;var estimators={ELBO:require("./elbo")(env),EUBO:require("./eubo")(env),dream:require("./dream/estimator")(env)};function Optimize(s,k,a,fnOrOptions,maybeOptions){var wpplFn,options;if(_.isFunction(fnOrOptions)){wpplFn=fnOrOptions;options=maybeOptions}else if(util.isObject(fnOrOptions)){wpplFn=fnOrOptions.model;options=_.omit(fnOrOptions,"model");if(!_.isFunction(wpplFn)&&_.isFunction(maybeOptions)){throw new Error("Optimize: expected model to be included in options.")}}else{throw new Error("Optimize: expected first argument to be an options object or a function.")}if(!_.isFunction(wpplFn)){throw new Error("Optimize: a model was not specified.")}options=util.mergeDefaults(options,{optMethod:"adam",estimator:"ELBO",steps:1,clip:false,weightDecay:0,showGradNorm:false,checkGradients:true,verbose:false,onStep:function(s,k,a){return k(s)},onFinish:function(s,k,a){return k(s)},logProgress:false,logProgressFilename:"optimizeProgress.csv",logProgressThrottle:200},"Optimize");var state={};var estimator=util.getValAndOpts(options.estimator,function(name,opts){if(!_.has(estimators,name)){throw new Error("Optimize: "+name+" is not a valid estimator. "+"The following estimators are available: "+_.keys(estimators).join(", ")+".")}return _.partial(estimators[name](opts),wpplFn,s,a,state)});var optimizer=util.getValAndOpts(options.optMethod,function(name,opts){name=name==="gd"?"sgd":name;return optMethods[name](opts)});var showProgress=_.throttle(function(i,objective){console.log("Iteration "+i+": "+objective)},200,{trailing:false});var history=[];var logFile,logProgress;if(options.logProgress){logFile=fs.openSync(options.logProgressFilename,"w");fs.writeSync(logFile,"index,iter,time,objective\n");var ncalls=0;var starttime=present();logProgress=_.throttle(function(i,objective){var t=(present()-starttime)/1e3;fs.writeSync(logFile,nodeUtil.format("%d,%d,%d,%d\n",ncalls,i,t,objective));ncalls++},options.logProgressThrottle,{trailing:false})}var decayWeights=weightDecay.parseOptions(options.weightDecay,options.verbose);var onStep=function(i,objective,cont){return applyd(s,function(s,exitFlag){return exitFlag?finish():cont()},a,options.onStep,[i,objective],"callback")};var finish=function(){return options.onFinish(s,function(s){if(options.logProgress){fs.closeSync(logFile)}return k(s)},a,{history:history})};return util.cpsLoop(options.steps,function(i,next){return estimator(i,function(gradObj,objective){if(options.checkGradients){checkGradients(gradObj)}if(options.verbose){showProgress(i,objective)}if(options.logProgress){logProgress(i,objective)}history.push(objective);return params.sync(function(paramsObj){decayWeights(gradObj,paramsObj);if(options.clip||options.showGradNorm){var norm=paramStruct.norm(gradObj);if(options.showGradNorm){console.log("L2 norm of gradient: "+norm)}if(options.clip){paramStruct.clip(gradObj,options.clip,norm)}}optimizer(gradObj,paramsObj,i);return params.set(paramsObj,function(){return onStep(i,objective,next)})},{incremental:true})})},finish)}function allZero(tensor){return!tensor.anyreduce()}function allFinite(tensor){return _.every(tensor.data,isFinite)}function checkGradients(gradObj){_.each(gradObj,function(grad,name){if(allZero(grad)){logGradWarning(name,"zero")}if(!allFinite(grad)){logGradWarning(name,"not finite")}})}function logGradWarning(name,problem){util.warn("Gradient for param "+name+" is "+problem+".",true)}return{Optimize:Optimize}}},{"../headerUtils":192,"../params/params":223,"../params/struct":228,"../util":246,"./dream/estimator":195,"./elbo":199,"./eubo":202,"./weightDecay":214,"adnn/opt":26,lodash:124,present:126,util:254}],211:[function(require,module,exports){"use strict";var _=require("lodash");var discrete=require("../dists/discrete");var util=require("../util");var CountAggregator=require("../aggregation/CountAggregator");module.exports=function(env){function last(xs){return xs[xs.length-1]}function PMCMC(s,cc,a,wpplFn,options){this.oldCoroutine=env.coroutine;env.coroutine=this;this.k=cc;this.oldStore=s;this.particleIndex=0;this.retainedParticle=undefined;this.numSweeps=options.sweeps;this.sweep=0;this.wpplFn=wpplFn;this.address=a;this.numParticles=options.particles;this.resetParticles();this.hist=new CountAggregator}PMCMC.prototype.run=function(){return this.activeContinuationWithStore()};PMCMC.prototype.resetParticles=function(){var that=this;this.particles=[];var exitK=function(s){return that.wpplFn(s,env.exit,that.address)};for(var i=0;i<this.numParticles;i++){var particle={continuations:[exitK],stores:[that.oldStore],weights:[0],value:undefined};this.particles.push(_.clone(particle))}};PMCMC.prototype.activeParticle=function(){return this.particles[this.particleIndex]};PMCMC.prototype.activeContinuation=function(){return last(this.activeParticle().continuations)};PMCMC.prototype.activeContinuationWithStore=function(){var k=last(this.activeParticle().continuations);var s=_.clone(last(this.activeParticle().stores));return function(){return k(s)}};PMCMC.prototype.allParticlesAdvanced=function(){return this.particleIndex+1===this.particles.length};PMCMC.prototype.sample=function(s,cc,a,dist){return cc(s,dist.sample())};PMCMC.prototype.particleAtStep=function(particle,step){return{continuations:particle.continuations.slice(0,step+1),stores:particle.stores.slice(0,step+1),weights:particle.weights.slice(0,step+1),value:particle.value}};PMCMC.prototype.updateActiveParticle=function(weight,continuation,store){var particle=this.activeParticle();particle.continuations=particle.continuations.concat([continuation]);particle.stores=particle.stores.concat([_.clone(store)]);particle.weights=particle.weights.concat([weight])};PMCMC.prototype.copyParticle=function(particle){return{continuations:particle.continuations.slice(0),weights:particle.weights.slice(0),value:particle.value,stores:particle.stores.map(_.clone)}};PMCMC.prototype.resampleParticles=function(particles){var weights=particles.map(function(particle){return Math.exp(last(particle.weights))});var j;var newParticles=[];for(var i=0;i<particles.length;i++){j=discrete.sample(weights);newParticles.push(this.copyParticle(particles[j]))}return newParticles};PMCMC.prototype.factor=function(s,cc,a,score){this.updateActiveParticle(score,cc,s);if(this.allParticlesAdvanced()){if(this.sweep>0){var particles=this.particles;var step=this.particles[0].continuations.length-1;particles=particles.concat(this.particleAtStep(this.retainedParticle,step));this.particles=this.resampleParticles(particles).slice(1)}else{this.particles=this.resampleParticles(this.particles)}this.particleIndex=0}else{this.particleIndex+=1}return this.activeContinuationWithStore()};PMCMC.prototype.exit=function(s,retval){this.activeParticle().value=retval;if(!this.allParticlesAdvanced()){this.particleIndex+=1;return this.activeContinuationWithStore()}else{if(this.sweep>0){this.particles.concat(this.retainedParticle).forEach(function(particle){this.hist.add(particle.value)}.bind(this))}this.retainedParticle=this.particles[0];if(this.sweep<this.numSweeps){this.sweep+=1;this.particleIndex=0;this.resetParticles();return this.activeContinuationWithStore()}else{env.coroutine=this.oldCoroutine;return this.k(this.oldStore,this.hist.toDist())}}};PMCMC.prototype.incrementalize=env.defaultCoroutine.incrementalize;function pmc(s,cc,a,wpplFn,options){return new PMCMC(s,cc,a,wpplFn,options).run()}return{PMCMC:pmc}}},{"../aggregation/CountAggregator":152,"../dists/discrete":164,"../util":246,lodash:124}],212:[function(require,module,exports){"use strict";var _=require("lodash");var util=require("../util");var CountAggregator=require("../aggregation/CountAggregator");module.exports=function(env){function Rejection(s,k,a,wpplFn,options){options=util.mergeDefaults(options,{samples:100,maxScore:0,incremental:false,throwOnError:true,minSampleRate:0},"Rejection");this.throwOnError=options.throwOnError;this.minSampleRate=options.minSampleRate;this.numSamplesTotal=options.samples;this.startTime=Date.now();this.numSamples=options.samples;this.maxScore=options.maxScore;this.incremental=options.incremental;this.s=s;this.k=k;this.a=a;this.wpplFn=wpplFn;this.hist=new CountAggregator;this.oldCoroutine=env.coroutine;env.coroutine=this;if(this.incremental&&this.maxScore>0){util.warn("Rejection: Reduce maxScore to zero for better performance.")}}Rejection.prototype.run=function(){if(!_.isNumber(this.numSamples)||this.numSamples<=0){return this.error('"samples" should be a positive integer.')}var elapseSec=(Date.now()-this.startTime)/1e3;if(this.minSampleRate>0&&elapseSec>2){var sampleRate=(this.numSamplesTotal-this.numSamples)/elapseSec;if(sampleRate<this.minSampleRate){return this.error(sampleRate.toFixed(2)+" samples/sec is below threshold.")}this.minSampleRate=0}this.scoreSoFar=0;this.threshold=this.maxScore+Math.log(util.random());return this.wpplFn(_.clone(this.s),env.exit,this.a)};Rejection.prototype.error=function(errType){var err=new Error(errType);if(this.throwOnError){throw err}else{return this.k(this.s,err)}};Rejection.prototype.sample=function(s,k,a,dist){return k(s,dist.sample())};Rejection.prototype.factor=function(s,k,a,score){if(this.incremental){if(score>0){return this.error("Score must be <= 0 for incremental rejection.")}}this.scoreSoFar+=score;if(this.incremental&&this.scoreSoFar<=this.threshold||score===-Infinity){return this.run()}else{return k(s)}};Rejection.prototype.exit=function(s,retval){if(this.scoreSoFar>this.maxScore){return this.error("Score exceeded upper bound.")}if(this.scoreSoFar>this.threshold){this.hist.add(retval);this.numSamples-=1}if(this.numSamples===0){env.coroutine=this.oldCoroutine;return this.k(this.s,this.hist.toDist())}else{return this.run()}};Rejection.prototype.incrementalize=env.defaultCoroutine.incrementalize;function rej(s,k,a,wpplFn,options){return new Rejection(s,k,a,wpplFn,options).run()}return{Rejection:rej}}},{"../aggregation/CountAggregator":152,"../util":246,lodash:124}],213:[function(require,module,exports){"use strict";var _=require("lodash");var util=require("../util");var numeric=require("../math/numeric");var discrete=require("../dists/discrete");var Trace=require("../trace");var assert=require("assert");var CountAggregator=require("../aggregation/CountAggregator");var ad=require("../ad");var guide=require("../guide");module.exports=function(env){var kernels=require("./kernels")(env);var validImportanceOptVals=["default","ignoreGuide","autoGuide"];function SMC(s,k,a,wpplFn,options){var options=util.mergeDefaults(options,{particles:100,rejuvSteps:0,rejuvKernel:"MH",finalRejuv:true,saveTraces:false,importance:"default",onlyMAP:false,throwOnError:true},"SMC");if(!_.includes(validImportanceOptVals,options.importance)){var msg=options.importance+" is not a valid importance option. "+"Valid options are: "+validImportanceOptVals;throw new Error(msg)}this.throwOnError=options.throwOnError;this.rejuvKernel=kernels.parseOptions(options.rejuvKernel);this.rejuvSteps=options.rejuvSteps;this.performRejuv=this.rejuvSteps>0;this.adRequired=this.performRejuv&&this.rejuvKernel.adRequired;this.performFinalRejuv=this.performRejuv&&options.finalRejuv;this.numParticles=options.particles;this.debug=options.debug;this.saveTraces=options.saveTraces;this.importanceOpt=options.importance;this.guideRequired=options.importance!=="ignoreGuide";this.isParamBase=true;this.onlyMAP=options.onlyMAP;this.particles=[];this.completeParticles=[];this.particleIndex=0;this.step=0;for(var i=0;i<this.numParticles;i++){var trace=new Trace(wpplFn,s,env.exit,a);this.particles.push(new Particle(trace))}this.s=s;this.k=k;this.a=a;this.oldCoroutine=env.coroutine;env.coroutine=this}SMC.prototype.run=function(){return this.runCurrentParticle()};SMC.prototype.error=function(errType){var err=new Error(errType);if(this.throwOnError){throw err}else{return this.k(this.s,err)}};SMC.prototype.sample=function(s,k,a,dist,options){options=options||{};var thunk=this.importanceOpt==="ignoreGuide"?undefined:options.guide;var noAutoGuide=this.importanceOpt!=="autoGuide"||options.noAutoGuide;return guide.getDist(thunk,noAutoGuide,dist,env,s,a,function(s,importanceDist){var _val,choiceScore,importanceScore;if(importanceDist){_val=importanceDist.sample();choiceScore=dist.score(_val);importanceScore=importanceDist.score(_val)}else{_val=dist.sample();choiceScore=importanceScore=dist.score(_val)}var particle=this.currentParticle();particle.logWeight+=ad.value(choiceScore)-ad.value(importanceScore);var val=this.adRequired&&dist.isContinuous?ad.lift(_val):_val;if(this.performRejuv||this.saveTraces){particle.trace.addChoice(dist,val,a,s,k,options)}else{particle.trace.score=ad.scalar.add(particle.trace.score,choiceScore)}return k(s,val)}.bind(this))};SMC.prototype.factor=function(s,k,a,score){var particle=this.currentParticle();particle.trace.numFactors+=1;particle.trace.saveContinuation(s,k);particle.trace.score=ad.scalar.add(particle.trace.score,score);particle.logWeight+=ad.value(score);this.debugLog("("+this.particleIndex+") Factor: "+a);return this.sync()};SMC.prototype.atLastParticle=function(){return this.particleIndex===this.particles.length-1};SMC.prototype.currentParticle=function(){return this.particles[this.particleIndex]};SMC.prototype.runCurrentParticle=function(){return this.currentParticle().trace.continue()};SMC.prototype.advanceParticleIndex=function(){this.particleIndex+=1};SMC.prototype.allParticles=function(){return this.completeParticles.concat(this.particles)};function resampleParticles(particles,cont){if(particles.length===1){return cont(particles)}var m=particles.length;var logW=numeric._logsumexp(_.map(particles,"logWeight"));var logAvgW=logW-Math.log(m);if(logAvgW===-Infinity){return env.coroutine.error("All particles have zero weight.")}var retainedParticles=[];var newWeights=[];_.each(particles,function(particle){var w=Math.exp(particle.logWeight-logAvgW);var nRetained=Math.floor(w);newWeights.push(w-nRetained);for(var i=0;i<nRetained;i++){retainedParticles.push(particle.copy())}});var numNewParticles=m-retainedParticles.length;var newParticles=[];var j;for(var i=0;i<numNewParticles;i++){j=discrete.sample(newWeights);newParticles.push(particles[j].copy())}var allParticles=newParticles.concat(retainedParticles);_.each(allParticles,function(p){p.logWeight=logAvgW});return cont(allParticles)}SMC.prototype.rejuvenateParticles=function(particles,cont){if(!this.performRejuv){return cont(particles)}assert(!this.particlesAreWeighted(particles),"Cannot rejuvenate weighted particles.");return util.cpsForEach(function(p,i,ps,next){return this.rejuvenateParticle(next,p)}.bind(this),function(){return cont(particles)},particles)};SMC.prototype.rejuvenateParticle=function(cont,particle){var kernelOptions={proposalBoundary:particle.proposalBoundary};if(this.performRejuv){kernelOptions.exitFactor=this.step}var kernel=_.partial(this.rejuvKernel,_,_,kernelOptions);var chain=kernels.repeat(this.rejuvSteps,kernel);return chain(function(trace){particle.trace=trace;return cont()},particle.trace)};SMC.prototype.particlesAreWeighted=function(particles){var lw=_.head(particles).logWeight;return _.some(particles,function(p){return p.logWeight!==lw})};SMC.prototype.particlesAreInSync=function(particles){return _.every(particles,function(p){var trace=p.trace;return trace.isComplete()&&trace.numFactors<this.step||!trace.isComplete()&&trace.numFactors===this.step}.bind(this))};SMC.prototype.sync=function(){if(!this.atLastParticle()){this.advanceParticleIndex();return this.runCurrentParticle()}else{this.step+=1;this.debugLog("***** sync :: step = "+this.step+" *****");var allParticles=this.allParticles();assert(this.particlesAreInSync(allParticles));return resampleParticles(allParticles,function(resampledParticles){assert.strictEqual(resampledParticles.length,env.coroutine.numParticles);var numActiveParticles=_.reduce(resampledParticles,function(acc,p){return acc+(p.trace.isComplete()?0:1)},0);if(numActiveParticles>0){this.particleIndex=0;return this.rejuvenateParticles(resampledParticles,function(rejuvenatedParticles){assert(this.particlesAreInSync(rejuvenatedParticles));var p=_.partition(rejuvenatedParticles,function(p){return p.trace.isComplete()});this.completeParticles=p[0];this.particles=p[1];this.debugLog(p[1].length+" active particles after resample/rejuv.\n");if(this.particles.length>0){return this.runCurrentParticle()}else{return this.finish()}}.bind(this))}else{this.particles=[];this.completeParticles=resampledParticles;return this.finish()}}.bind(this))}};SMC.prototype.debugLog=function(s){if(this.debug){console.log(s)}};SMC.prototype.exit=function(s,val){this.currentParticle().trace.complete(val);this.debugLog("("+this.particleIndex+") Exit | Value: "+val);return this.sync()};SMC.prototype.finish=function(s,val){assert.strictEqual(this.completeParticles.length,this.numParticles);var hist=new CountAggregator(this.onlyMAP);var traces=[];var aggregate=function(trace){var value=this.adRequired?ad.valueRec(trace.value):trace.value;var score=this.adRequired?ad.valueRec(trace.score):trace.score;hist.add(value,score);if(this.saveTraces){traces.push(trace)}}.bind(this);var logAvgW=_.head(this.completeParticles).logWeight;return util.cpsForEach(function(particle,i,ps,k){if(this.performFinalRejuv){var chain=kernels.repeat(this.rejuvSteps,kernels.sequence(this.rejuvKernel,kernels.tap(aggregate)));return chain(k,particle.trace)}else{aggregate(particle.trace);return k()}}.bind(this),function(){var dist=hist.toDist();dist.normalizationConstant=logAvgW;if(this.saveTraces){dist.traces=traces}env.coroutine=this.oldCoroutine;return this.k(this.s,dist)}.bind(this),this.completeParticles)};SMC.prototype.incrementalize=env.defaultCoroutine.incrementalize;function setProposalBoundary(s,k,a){if(env.coroutine.currentParticle){var particle=env.coroutine.currentParticle();particle.proposalBoundary=particle.trace.length}return k(s)}var Particle=function(trace){this.trace=trace;this.logWeight=0;this.proposalBoundary=0};Particle.prototype.copy=function(){var p=new Particle(this.trace.copy());p.logWeight=this.logWeight;p.proposalBoundary=this.proposalBoundary;return p};return{SMC:function(s,k,a,wpplFn,options){return new SMC(s,k,a,wpplFn,options).run()},setProposalBoundary:setProposalBoundary}}},{"../ad":151,"../aggregation/CountAggregator":152,"../dists/discrete":164,"../guide":189,"../math/numeric":218,"../trace":232,"../util":246,"./kernels":207,assert:248,lodash:124}],214:[function(require,module,exports){"use strict";var assert=require("assert");var _=require("lodash");var util=require("../util");var paramStruct=require("../params/struct");function parseOptions(opts,verbose){if(_.isNumber(opts)){return parseOptions({l2:{strength:opts}},verbose)}else{return util.getValAndOpts(opts,function(penalty,opts){if(!_.has(penalties,penalty)){throw new Error("Optimize: Unknown weight decay penalty "+penalty+". Choose from "+_.keys(penalties)+".")}return penalties[penalty](opts,verbose)})}}var penalties={l2:function(opts,verbose){opts=util.mergeDefaults(opts,{strength:1});var strength=opts.strength;if(!_.isNumber(strength)||strength<0){throw new Error("Optimize: L2 strength should be a non-negative number.")}else if(strength===0){return _.noop}else{if(verbose){console.log("Optimize will apply L2 weight decay with strength="+strength+".")}return function(gradObj,paramsObj){var gradPenalty=paramStruct.select(paramsObj,gradObj);assert.strictEqual(_.size(gradObj),_.size(gradPenalty),"Expected grads to be the same size.");paramStruct.mulEq(gradPenalty,strength);paramStruct.addEq(gradObj,gradPenalty)}}}};module.exports={parseOptions:parseOptions}},{"../params/struct":228,"../util":246,assert:248,lodash:124}],215:[function(require,module,exports){(function(global){"use strict";var types=require("ast-types");var build=types.builders;var esprima=require("esprima");var escodegen=require("escodegen");var assert=require("assert");var _=require("lodash");var ad=require("./transforms/ad").ad;var cps=require("./transforms/cps").cps;var addFilename=require("./transforms/addFilename").addFilename;var optimize=require("./transforms/optimize").optimize;var naming=require("./transforms/naming").naming;var store=require("./transforms/store").store;var stack=require("./transforms/stack");var varargs=require("./transforms/varargs").varargs;var trampoline=require("./transforms/trampoline").trampoline;var freevars=require("./transforms/freevars").freevars;var caching=require("./transforms/caching");var thunkify=require("./syntax").thunkify;var util=require("./util");var errors=require("./errors/errors");var params=require("./params/params");var env={};function requireHeader(path){requireHeaderWrapper(require(path))}function requireHeaderWrapper(wrapper){makePropertiesGlobal(wrapper(env))}function makePropertiesGlobal(obj){for(var prop in obj){if(obj.hasOwnProperty(prop)){global[prop]=obj[prop]}}}requireHeaderWrapper(require("./header"));function concatPrograms(programs){assert.ok(_.isArray(programs));var concat=function(p0,p1){return build.program(p0.body.concat(p1.body))};var emptyProgram=esprima.parse("");return programs.reduce(concat,emptyProgram)}function parse(code,filename){var ast=esprima.parse(code,{loc:true});return addFilename(ast,filename)}function parseAll(bundles){return bundles.map(function(bundle){var ast=parse(bundle.code,bundle.filename);return _.assign({ast:ast},bundle)})}function headerPackage(){var dists="// This file was automatically generated by 'scripts/distHeader'.\n'no caching';\nvar Bernoulli = dists.makeBernoulli;\nvar bernoulli = function(arg0) {\n  var params = util.isObject(arg0) ? arg0 : {p: arg0};\n  return sample(Bernoulli(params));\n};\nvar Beta = dists.makeBeta;\nvar beta = function(arg0, arg1) {\n  var params = util.isObject(arg0) ? arg0 : {a: arg0, b: arg1};\n  return sample(Beta(params));\n};\nvar Binomial = dists.makeBinomial;\nvar binomial = function(arg0, arg1) {\n  var params = util.isObject(arg0) ? arg0 : {p: arg0, n: arg1};\n  return sample(Binomial(params));\n};\nvar Categorical = dists.makeCategorical;\nvar categorical = function(arg0, arg1) {\n  var params = util.isObject(arg0) ? arg0 : {ps: arg0, vs: arg1};\n  return sample(Categorical(params));\n};\nvar Cauchy = dists.makeCauchy;\nvar cauchy = function(arg0, arg1) {\n  var params = util.isObject(arg0) ? arg0 : {location: arg0, scale: arg1};\n  return sample(Cauchy(params));\n};\nvar Delta = dists.makeDelta;\nvar delta = function(arg0) {\n  var params = util.isObject(arg0) ? arg0 : {v: arg0};\n  return sample(Delta(params));\n};\nvar DiagCovGaussian = dists.makeDiagCovGaussian;\nvar diagCovGaussian = function(arg0, arg1) {\n  var params = util.isObject(arg0) ? arg0 : {mu: arg0, sigma: arg1};\n  return sample(DiagCovGaussian(params));\n};\nvar Dirichlet = dists.makeDirichlet;\nvar dirichlet = function(arg0) {\n  var params = util.isObject(arg0) ? arg0 : {alpha: arg0};\n  return sample(Dirichlet(params));\n};\nvar Discrete = dists.makeDiscrete;\nvar discrete = function(arg0) {\n  var params = util.isObject(arg0) ? arg0 : {ps: arg0};\n  return sample(Discrete(params));\n};\nvar Exponential = dists.makeExponential;\nvar exponential = function(arg0) {\n  var params = util.isObject(arg0) ? arg0 : {a: arg0};\n  return sample(Exponential(params));\n};\nvar Gamma = dists.makeGamma;\nvar gamma = function(arg0, arg1) {\n  var params = util.isObject(arg0) ? arg0 : {shape: arg0, scale: arg1};\n  return sample(Gamma(params));\n};\nvar Gaussian = dists.makeGaussian;\nvar gaussian = function(arg0, arg1) {\n  var params = util.isObject(arg0) ? arg0 : {mu: arg0, sigma: arg1};\n  return sample(Gaussian(params));\n};\nvar ImproperUniform = dists.makeImproperUniform;\nvar IspNormal = dists.makeIspNormal;\nvar ispNormal = function(arg0, arg1) {\n  var params = util.isObject(arg0) ? arg0 : {mu: arg0, sigma: arg1};\n  return sample(IspNormal(params));\n};\nvar KDE = dists.makeKDE;\nvar Laplace = dists.makeLaplace;\nvar laplace = function(arg0, arg1) {\n  var params = util.isObject(arg0) ? arg0 : {location: arg0, scale: arg1};\n  return sample(Laplace(params));\n};\nvar LogisticNormal = dists.makeLogisticNormal;\nvar logisticNormal = function(arg0, arg1) {\n  var params = util.isObject(arg0) ? arg0 : {mu: arg0, sigma: arg1};\n  return sample(LogisticNormal(params));\n};\nvar LogitNormal = dists.makeLogitNormal;\nvar logitNormal = function(arg0, arg1, arg2, arg3) {\n  var params = util.isObject(arg0) ? arg0 : {mu: arg0, sigma: arg1, a: arg2, b: arg3};\n  return sample(LogitNormal(params));\n};\nvar Marginal = dists.makeMarginal;\nvar Mixture = dists.makeMixture;\nvar mixture = function(arg0, arg1) {\n  var params = util.isObject(arg0) ? arg0 : {dists: arg0, ps: arg1};\n  return sample(Mixture(params));\n};\nvar Multinomial = dists.makeMultinomial;\nvar multinomial = function(arg0, arg1) {\n  var params = util.isObject(arg0) ? arg0 : {ps: arg0, n: arg1};\n  return sample(Multinomial(params));\n};\nvar MultivariateBernoulli = dists.makeMultivariateBernoulli;\nvar multivariateBernoulli = function(arg0) {\n  var params = util.isObject(arg0) ? arg0 : {ps: arg0};\n  return sample(MultivariateBernoulli(params));\n};\nvar MultivariateGaussian = dists.makeMultivariateGaussian;\nvar multivariateGaussian = function(arg0, arg1) {\n  var params = util.isObject(arg0) ? arg0 : {mu: arg0, cov: arg1};\n  return sample(MultivariateGaussian(params));\n};\nvar Poisson = dists.makePoisson;\nvar poisson = function(arg0) {\n  var params = util.isObject(arg0) ? arg0 : {mu: arg0};\n  return sample(Poisson(params));\n};\nvar RandomInteger = dists.makeRandomInteger;\nvar randomInteger = function(arg0) {\n  var params = util.isObject(arg0) ? arg0 : {n: arg0};\n  return sample(RandomInteger(params));\n};\nvar SampleBasedMarginal = dists.makeSampleBasedMarginal;\nvar TensorGaussian = dists.makeTensorGaussian;\nvar tensorGaussian = function(arg0, arg1, arg2) {\n  var params = util.isObject(arg0) ? arg0 : {mu: arg0, sigma: arg1, dims: arg2};\n  return sample(TensorGaussian(params));\n};\nvar TensorLaplace = dists.makeTensorLaplace;\nvar tensorLaplace = function(arg0, arg1, arg2) {\n  var params = util.isObject(arg0) ? arg0 : {location: arg0, scale: arg1, dims: arg2};\n  return sample(TensorLaplace(params));\n};\nvar Uniform = dists.makeUniform;\nvar uniform = function(arg0, arg1) {\n  var params = util.isObject(arg0) ? arg0 : {a: arg0, b: arg1};\n  return sample(Uniform(params));\n};";var header="'no caching';\n\n// Other distribution helpers\n\nvar flip = function(p) {\n  var params = {p: (p !== undefined) ? p : .5};\n  return sample(Bernoulli(params));\n};\n\nvar uniformDraw = function(arg) {\n  var vs = util.isObject(arg) ? arg.vs : arg;\n  if (vs.length == 0) {\n    return undefined;\n  } else {\n    return vs[sample(RandomInteger({n: vs.length}))];\n  }\n};\n\nvar serializeDist = function(d) {\n  return dists.serialize(d);\n};\n\nvar deserializeDist = function(JSONString) {\n  return dists.deserialize(JSONString);\n};\n\n// Drift kernel helpers\n\nvar gaussianDrift = function(params) {\n  return sample(Gaussian(_.omit(params, 'width')), {\n    driftKernel: function(prevVal) {\n      var width = _.has(params, 'width') ? params.width : params.sigma * 0.7;\n      return Gaussian({mu: prevVal, sigma: width});\n    }\n  });\n};\n\nvar dirichletDrift = function(params) {\n  return sample(Dirichlet(_.omit(params, 'concentration')), {\n    driftKernel: function(prevVal) {\n      var c = _.has(params, 'concentration') ? params.concentration : 10;\n      var alpha = T.mul(prevVal, c);\n      return Dirichlet({alpha: alpha});\n    }\n  });\n};\n\nvar uniformDrift = function(params) {\n  return sample(Uniform(_.omit(params, 'width')), {\n    driftKernel: function(prevVal) {\n      var width = _.has(params, 'width') ? params.width : 0.1;\n      var a = Math.max(params.a, prevVal - width);\n      var b = Math.min(params.b, prevVal + width);\n      return Uniform({a: a, b: b});\n    }\n  });\n};\n\n// XRPs\n\nvar makeBetaBernoulli = function(pseudocounts) {\n  globalStore.BBindex = 1 + (globalStore.BBindex || 0);\n  var bbname = 'BB' + globalStore.BBindex;\n  globalStore[bbname] = pseudocounts;\n  return function() {\n    var pc = globalStore[bbname];  // get current sufficient stats\n    var val = sample(Bernoulli({p: pc[0] / (pc[0] + pc[1])}));  // sample from predictive.\n    globalStore[bbname] = [pc[0] + val, pc[1] + !val];  // update sufficient stats\n    return val;\n  };\n};\n\nvar makeDirichletDiscrete = function(pseudocounts) {\n  var addCount = function(a, i, j) {\n    var j = j || 0;\n    if (a.length === 0) {\n      return [];\n    } else {\n      return [a[0] + (i === j)].concat(addCount(a.slice(1), i, j + 1));\n    }\n  };\n  globalStore.DDindex = 1 + (globalStore.DDindex || 0);\n  var ddname = 'DD' + globalStore.DDindex;\n  globalStore[ddname] = pseudocounts;\n  return function() {\n    var pc = globalStore[ddname];  // get current sufficient stats\n    var val = sample(Discrete({ps: pc}));  // sample from predictive. (doesn't need to be normalized.)\n    globalStore[ddname] = addCount(pc, val); // update sufficient stats\n    return val;\n  };\n};\n\nvar mem = function(f) {\n  globalStore.memIndex = 1 + (globalStore.memIndex || 0);\n  var key = 'mem' + globalStore.memIndex;\n  return function() {\n    var stringedArgs = key + util.serialize(arguments);\n    if (_.has(globalStore, stringedArgs)) {\n      return globalStore[stringedArgs];\n    } else {\n      var val = apply(f, arguments);\n      globalStore[stringedArgs] = val;\n      return val;\n    }\n  };\n};\n\nvar isEven = function(v) {\n  return v % 2 === 0;\n};\nvar isOdd = function(v) {\n  return v % 2 != 0;\n};\n\nvar idF = function(x) {\n  return x;\n};\nvar constF = function(f) {\n  return function() {\n    return f;\n  };\n};\nvar falseF = function() {\n  return false;\n};\nvar trueF = function() {\n  return true;\n};\n\n// Probability computations & calculations\n\nvar MAP = function(dist) {\n  return dist.MAP();\n};\n\nvar expectation = function(dist, func) {\n  var f = func || idF;\n  var supp = dist.support();\n  return reduce(function(s, acc) {\n    return acc + Math.exp(dist.score(s)) * f(s);\n  }, 0, supp);\n};\n\nvar entropy = function(dist) {\n  return dist.entropy();\n};\n\n// Data structures & higher-order functions\n\nvar append = function(a, b) {\n  return a.concat(b);\n};\nvar cons = function(a, b) {\n  return [a].concat(b);\n};\nvar snoc = function(a, b) {\n  return a.concat([b]);\n};\n\nvar first = function(xs) {\n  return xs[0];\n};\nvar second = function(xs) {\n  return xs[1];\n};\nvar third = function(xs) {\n  return xs[2];\n};\nvar fourth = function(xs) {\n  return xs[3];\n};\nvar secondLast = function(xs) {\n  return xs[xs.length - 2];\n};\nvar last = function(xs) {\n  return xs[xs.length - 1];\n};\n\nvar most = function(xs) {\n  return xs.slice(0, xs.length - 1);\n}\n\nvar rest = function(xs) {\n  return xs.slice(1);\n};\n\nvar map_helper = function(i, j, f) {\n  var n = j - i + 1;\n  if (n == 0) {\n    return []\n  } else if (n == 1) {\n    return [f(i)];\n  } else {\n    var n1 = Math.ceil(n / 2);\n    return map_helper(i, i + n1 - 1, f).concat(map_helper(i + n1, j, f));\n  }\n}\n\n// recursively split input array so that we only call\n// concat a logarithmic number of times\nvar map = function(fn, l) {\n  return map_helper(0, l.length - 1, function(i) { return fn(l[i]) })\n}\n\n// assumes that length l1 == length l2\nvar map2 = function(fn, l1, l2) {\n  return map_helper(0, l1.length - 1, function(i) { return fn(l1[i], l2[i]) })\n}\n\n// sugar for map(f, [0,1,...,n-1])\nvar mapN = function(fn, n) {\n  return map_helper(0, n - 1, function(i) { return fn(i) })\n}\n\nvar mapIndexed = function(fn, l) {\n  return map_helper(0, l.length - 1, function(i) { return fn(i, l[i]) })\n}\n\nvar mapObject = function(fn, obj) {\n  return _.fromPairs(\n      map(\n      function(kv) {\n        return [kv[0], fn(kv[0], kv[1])]\n      },\n      _.toPairs(obj))\n  );\n};\n\nvar extend = function() {\n  return _.assign.apply(_, [{}].concat(arguments));\n}\n\nvar reduce = function(fn, init, ar) {\n  var n = ar.length;\n  var helper = function(i) {\n    if (i === n) {\n      return init\n    } else {\n      return fn(ar[i], helper(i + 1))\n    }\n  }\n\n  return helper(0);\n};\n\nvar sum = function(l) {\n  return reduce(function(a, b) { return a + b; }, 0, l);\n};\nvar product = function(l) {\n  return reduce(function(a, b) { return a * b; }, 1, l);\n};\n\nvar listMean = function(l) {\n  return sum(l) / l.length;\n};\nvar listVar = function(l, mu) {\n  var mu = mu === undefined ? listMean(l) : mu;\n  return reduce(function(a, acc) {\n    return acc + (a - mu) * (a - mu);\n  }, 0, l) / l.length;\n\n};\nvar listStdev = function(l, mu) {\n  return Math.sqrt(listVar(l, mu));\n};\n\nvar normalize = function(xs) {\n  var Z = sum(xs);\n  return map(function(x) {\n    return x / Z;\n  }, xs);\n};\n\nvar all = function(p, l) {\n  return reduce(function(x, acc) {\n    return acc && p(x);\n  }, true, l);\n};\n\nvar any = function(p, l) {\n  return reduce(function(x, acc) {\n    return acc || p(x);\n  }, false, l);\n};\n\nvar zip = function(xs, ys) {\n  return map2(function(x, y) { return [x, y]},\n              xs,\n              ys)\n};\n\nvar filter = function(fn, ar) {\n  var helper = function(i, j) {\n    var n = j - i + 1;\n    if (n == 0) {\n      return [];\n    } else if (n == 1) {\n      return (fn(ar[i]) ? [ar[i]] : []);\n    } else {\n      var n1 = Math.ceil(n / 2);\n      return helper(i, i + n1 - 1).concat(helper(i + n1, j));\n    }\n  }\n\n  return helper(0, ar.length - 1)\n};\n\nvar find = function(f, ar) {\n  var n = ar.length;\n  var helper = function(i) {\n    if (i === n) {\n      return undefined;\n    } else if (f(ar[i])) {\n      return ar[i];\n    } else {\n      return helper(i + 1);\n    }\n  }\n  return helper(0);\n};\n\nvar remove = function(a, ar) {\n  return filter(function(e) {\n    return a != e;\n  }, ar);\n};\n\n\nvar minWith = function(f, ar) {\n  var fn = function(_ar, _best) {\n    if (_ar.length === 0) {\n      return _best;\n    } else if (_ar[0][1] < _best[1]) {\n      return fn(_ar.slice(1), _ar[0]);\n    } else {\n      return fn(_ar.slice(1), _best);\n    }\n  };\n  return fn(zip(ar, map(f, ar)), [Infinity, Infinity]);\n};\n\nvar maxWith = function(f, ar) {\n  var fn = function(_ar, _best) {\n    if (_ar.length === 0) {\n      return _best;\n    } else if (_ar[0][1] > _best[1]) {\n      return fn(_ar.slice(1), _ar[0]);\n    } else {\n      return fn(_ar.slice(1), _best);\n    }\n  };\n  return fn(zip(ar, map(f, ar)), [-Infinity, -Infinity]);\n};\n\n// bin array into items satisfying a predicate p and items not satifying it\nvar span = function(p, ar) {\n  var n = ar.length;\n  var helper = function(i, _ts, _fs) {\n    return (i === n ?\n            [_ts, _fs] :\n            (p(ar[i]) ?\n             helper(i + 1, snoc(_ts, ar[i]), _fs) :\n             helper(i + 1, _ts, snoc(_fs, ar[i]))));\n  };\n  return helper(0, [], []);\n};\n\n// group array items by a comparator\n// NB: there is still room for optimization here\nvar groupBy = function(cmp, ar) {\n  if (ar.length === 0) {\n    return [];\n  } else {\n    var x = ar[0];\n    var sp = span(function(b) { return cmp(x, b); }, ar.slice(1));\n    return [cons(x, sp[0])].concat(groupBy(cmp, sp[1]));\n  }\n};\n\nvar repeat = function(n, fn) {\n  var helper = function(m) {\n    if (m === 0) {\n      return [];\n    } else if (m === 1) {\n      return [fn()];\n    } else {\n      var m1 = Math.ceil(m / 2),\n          m2 = m - m1;\n      return helper(m1).concat(helper(m2));\n    }\n  }\n  if (!util.isInteger(n) || n < 0) {\n    error('Expected first argument to be a non-negative integer.');\n  }\n  if (!_.isFunction(fn)) {\n    error('Expected second argument to be a function.');\n  }\n  return helper(n);\n}\n\nvar compose = function(f, g) {\n  return function(x) {\n    return f(g(x));\n  };\n};\n\nvar everyOther = function(l) {\n  return l.length <= 1 ? l : [l[0]].concat(everyOther(l.slice(2)));\n};\n\nvar _merge = function(l1, l2, pred, key) {\n  return (l1.length === 0 ?\n          l2 :\n          (l2.length === 0 ?\n           l1 :\n           (pred(key(l1[0]), key(l2[0])) ?\n            [l1[0]].concat(_merge(l1.slice(1), l2, pred, key)) :\n            [l2[0]].concat(_merge(l1, l2.slice(1), pred, key)))));\n};\n\nvar _sort = function(l, pred, key) {\n  return ((l.length <= 1) ?\n          l :\n          _merge(_sort(everyOther(l), pred, key),\n                 _sort(everyOther(l.slice(1)), pred, key),\n                 pred,\n                 key));\n};\n\nvar lt = function(a, b) {\n  return a < b;\n};\n\nvar gt = function(a, b) {\n  return a > b;\n};\n\nvar sort = function(l, pred, key) {\n  return _sort(l, (pred || lt), (key || idF));\n};\n\nvar sortOn = function(l, key, pred) {\n  return _sort(l, (pred || lt), key);\n};\n\nvar condition = function(bool) {\n  factor(bool ? 0 : -Infinity);\n};\n\nvar error = function(msg) {\n  util.error(msg);\n};\n\nvar MH = function(wpplFn, samples, burn) {\n  return MCMC(wpplFn, { samples: samples, burn: burn });\n};\n\nvar ParticleFilter = function(wpplFn, particles) {\n  return SMC(wpplFn, { particles: particles, rejuvSteps: 0 });\n};\n\nvar ParticleFilterRejuv = function(wpplFn, particles, rejuvSteps) {\n  return SMC(wpplFn, { particles: particles, rejuvSteps: rejuvSteps });\n};\n\nvar SampleGuide = function(wpplFn, options) {\n  return ForwardSample(wpplFn, _.assign({guide: true}, _.omit(options, 'guide')));\n};\n\nvar OptimizeThenSample = function(wpplFn, options) {\n  Optimize(wpplFn, _.omit(options, 'samples', 'onlyMAP'));\n  var opts = _.pick(options, 'samples', 'onlyMAP', 'verbose');\n  return SampleGuide(wpplFn, opts);\n};\n\n/*\n * DefaultInfer() called when no options are specified\n * var maxEnumTreeSize: upper bound for enumeration tree size, enumeration ends when above threshold.\n * var minSampleRate: lower bound for #sample/sec, rejection ends when below threshold.\n * var samples: number of samples/particles used for default rejection/SMC/MCMC.\n * next step in the heuristics flowchart\n */\nvar DefaultInfer = function(wpplFn, options) {\n  util.mergeDefaults(options, {}, 'Infer');\n  var maxEnumTreeSize = 200000;\n  var minSampleRate = 250; //from 1 to samples\n  var samples = 1000;\n  var enumResult = Enumerate(wpplFn, {maxEnumTreeSize: maxEnumTreeSize, maxRuntimeInMS: 5000,\n    throwOnError: false, strategy: 'depthFirst'});\n  if (dists.isDist(enumResult)) {\n    return enumResult;\n  } else if (enumResult instanceof Error) {\n    console.log(enumResult.message + '..quit enumerate');\n  } else {\n    error('Invalid return value from enumerate');\n  }\n  console.log('Using \"rejection\"');\n  var rejResult = Rejection(wpplFn, {minSampleRate: minSampleRate, throwOnError: false, samples: samples});\n  if (rejResult instanceof Error) {\n    console.log(rejResult.message + '..quit rejection');\n    var hasSampleAfterFactor = CheckSampleAfterFactor(wpplFn);\n    if (hasSampleAfterFactor) {\n      console.log('Using \"SMC\" (interleaving samples and factors detected)');\n      var smcResult = SMC(wpplFn, {throwOnError: false, particles: samples});\n      if (dists.isDist(smcResult)) {\n        return smcResult;\n      } else if (smcResult instanceof Error) {\n        console.log(smcResult.message + '..quit SMC');\n      } else {\n        error('Invalid return value from SMC');\n      }\n    }\n    console.log('Using \"MCMC\"');\n    return MCMC(wpplFn, {samples: samples});\n  } else if (dists.isDist(rejResult)) {\n    return rejResult;\n  } else {\n    error('Invalid return value from rejection');\n  }\n};\n\nvar Infer = function(options, maybeFn) {\n  var wpplFn = !util.isObject(options) ? options : maybeFn || options.model;\n  if (!_.isFunction(wpplFn)) {\n    error('Infer: a model was not specified.');\n  }\n\n  // Map from camelCase options to PascalCase coroutine names. Also\n  // used to ensure the supplied method name is a valid inference\n  // routine.\n  var methodMap = {\n    SMC: SMC,\n    MCMC: MCMC,\n    PMCMC: PMCMC,\n    asyncPF: AsyncPF,\n    rejection: Rejection,\n    enumerate: Enumerate,\n    incrementalMH: IncrementalMH,\n    forward: ForwardSample,\n    optimize: OptimizeThenSample,\n    defaultInfer: DefaultInfer\n  };\n\n  var methodName = options.method || 'defaultInfer';\n  if (!_.has(methodMap, methodName)) {\n    var methodNames = _.keys(methodMap);\n    var msg = 'Infer: \\'' + methodName +\n        '\\' is not a valid method. The following methods are available: ' +\n        methodNames.join(', ') + '.';\n    error(msg);\n  }\n  var method = methodMap[methodName];\n  return method(wpplFn, _.omit(options, 'method', 'model'));\n};\n\n// Convenience function for creating maximum likelihood model\n// parameters.\nvar modelParam = function(options) {\n  return sample(ImproperUniform(), {guide() {\n    return Delta({v: param(options)});\n  }});\n};\n\n// Convenience functions for building tensors out of scalars\nvar Vector = function(arr) {\n  var n = arr.length;\n  var t = ad.tensor.fromScalars(arr);\n  return ad.tensor.reshape(t, [n, 1]);\n};\nvar Matrix = function(arr) {\n  var n = arr.length;\n  var m = arr[0].length;\n  var t = ad.tensor.fromScalars(_.flatten(arr));\n  return ad.tensor.reshape(t, [n, m]);\n};\nvar Tensor = function(dims, arr) {\n  var t = ad.tensor.fromScalars(arr);\n  return ad.tensor.reshape(t, dims);\n};\n\nvar dims = function(x) {\n  return ad.value(x).dims;\n};\n\nvar concat = function(arr) {\n  var t = T.concat(arr);\n  return T.reshape(t, [dims(t)[0], 1]);\n};\n\nvar idMatrix = function(n) {\n  return util.idMatrix(n);\n};\n\nvar oneHot = function(index, length) {\n  return util.oneHot(index, length);\n};\n\nvar marginalize = function(dist, project) {\n  if (_.isString(project)) {\n    return Infer({model: function() {\n      return sample(dist)[project]\n    }})\n  } else {\n    return Infer({model: function() {\n      return project(sample(dist));\n    }});\n  }\n};\n\nvar kde = function(marginal, width) {\n  if (!(dists.isDist(marginal) &&\n        marginal.meta.name === 'SampleBasedMarginal')) {\n    error('kde expects a sample based marginal as its first argument.');\n  }\n  var data = _.map(marginal.samples, 'value');\n  return KDE(width === undefined ? {data} : {data, width});\n};\n";var nn="'no caching';\n\nvar softplus = function(x) {\n  return T.log(T.add(T.exp(x), 1));\n};\n\nvar softmax = function(x) {\n  return T.softmax(x);\n};\n\nvar sigmoid = function(x) {\n  return T.sigmoid(x);\n};\n\nvar tanh = function(x) {\n  return T.tanh(x);\n};\n\nvar relu = function(x) {\n  return nn.relu.eval(x);\n};\n\nvar squishToProbSimplex = function(x) {\n  return numeric.squishToProbSimplex(x);\n};\n\nvar stack = function(arr) {\n  return reduce(compose, idF, arr);\n};\n\n// Nets created with \"linear\" default to using a weight initialization\n// based on \"Understanding the difficulty of training deep feedforward\n// neural networks\", often called Xavier initialization.\n\n// This initialization scheme may not be suitable for asymmetric\n// non-linearities.\n\nvar xavier = function(dims) {\n  if (dims.length !== 2) {\n    error('Xavier initialization is only defined for matrices.');\n  }\n  var nin = dims[0];\n  var nout = dims[1];\n  var sigma = Math.sqrt(2 / (nin + nout));\n  return tensorGaussian({mu: 0, sigma, dims});\n};\n\nvar checkNetName = function(name) {\n  if (!name) {\n    error('A network must be given a name.');\n  }\n};\n\nvar mergeObj = function(o1, o2) {\n  return _.assign({}, o1, o2);\n};\n\nvar linear = function(name, maybeArgs) {\n  checkNetName(name);\n  var args = maybeArgs || {};\n  var nin = args.in;\n  var nout = args.out;\n  if (!Number.isInteger(nin)) {\n    error('Argument \"in\" should be an integer.');\n  }\n  if (!Number.isInteger(nout)) {\n    error('Argument \"out\" should be an integer.');\n  }\n  var nnparam = args.param || param;\n  var init = args.init || xavier;\n  var w = nnparam({name, dims: [nout, nin], init});\n  return function(x) {\n    return T.dot(w, x);\n  };\n};\n\nvar bias = function(name, maybeArgs) {\n  checkNetName(name);\n  var args = maybeArgs || {};\n  var nnparam = args.param || param;\n  var initb = _.has(args, 'initb') ? args.initb : 0;\n  if (!_.isNumber(initb)) {\n    error('Initial bias should be a number.');\n  }\n  var nout = args.out;\n  if (!Number.isInteger(nout)) {\n    error('Argument \"out\" should be an integer.');\n  }\n  var b = nnparam({name, dims: [nout, 1], mu: initb, sigma: 0});\n  return function(x) {\n    if (dims(x)[0] !== nout) {\n      error('Input vector has unexpected dimension.');\n    }\n    return T.add(x, b);\n  };\n};\n\nvar affine = function(name, maybeArgs) {\n  checkNetName(name);\n  return compose(\n    bias(name + 'b', maybeArgs),\n    linear(name + 'w', maybeArgs));\n};\n\nvar rnn = function(name, maybeArgs) {\n  checkNetName(name);\n  var args = maybeArgs || {};\n  var hdim = args.hdim;\n  var xdim = args.xdim;\n  if (!Number.isInteger(hdim)) {\n    error('Argument \"hdim\" should be an integer.');\n  }\n  if (!Number.isInteger(xdim)) {\n    error('Argument \"xdim\" should be an integer.');\n  }\n  var ctor = args.ctor || affine;\n  var output = args.output || tanh;\n  var nargs = mergeObj(args, {in: hdim + xdim, out: hdim});\n  var net = stack([output, ctor(name, nargs), concat]);\n  return function(hprev, x) {\n    if (dims(hprev)[0] !== hdim) {\n      error('Previous hidden vector has unexpected dimension');\n    }\n    if (dims(x)[0] !== xdim) {\n      error('Input vector has unexpected dimension');\n    }\n    return net([hprev, x]);\n  };\n};\n\nvar gru = function(name, maybeArgs) {\n  checkNetName(name);\n  var args = maybeArgs || {};\n  var hdim = args.hdim;\n  var xdim = args.xdim;\n  if (!Number.isInteger(hdim)) {\n    error('Argument \"hdim\" should be an integer.');\n  }\n  if (!Number.isInteger(xdim)) {\n    error('Argument \"xdim\" should be an integer.');\n  }\n  var ctor = args.ctor || affine;\n  var nargs = mergeObj(args, {in: hdim + xdim, out: hdim});\n  var update = compose(sigmoid, ctor(name + 'update', nargs));\n  var reset = compose(sigmoid, ctor(name + 'reset', nargs));\n  var candidate = compose(tanh, ctor(name + 'candidate', nargs));\n  return function(hprev, x) {\n    if (dims(hprev)[0] !== hdim) {\n      error('Previous hidden vector has unexpected dimension');\n    }\n    if (dims(x)[0] !== xdim) {\n      error('Input vector has unexpected dimension');\n    }\n    var hprevx = concat([hprev, x]);\n    var r = reset(hprevx);\n    var z = update(hprevx);\n    var cand = candidate(concat([T.mul(hprev, r), x]));\n    var oneminusz = T.add(T.neg(z), 1);\n    return T.add(T.mul(oneminusz, hprev), T.mul(z, cand));\n  };\n};\n\n\nvar lstm = function(name, maybeArgs) {\n  checkNetName(name);\n  var args = maybeArgs || {};\n  var hdim = args.hdim;\n  var xdim = args.xdim;\n  // hdim is the total dimension of the state. i.e. memory + hidden\n  // state vectors. Setting things up this way makes it easy to swap\n  // between gru and lstm.\n  if (!(Number.isInteger(hdim) && (hdim % 2 === 0))) {\n    error('Argument \"hdim\" should be an even integer.');\n  }\n  if (!Number.isInteger(xdim)) {\n    error('Argument \"xdim\" should be an integer.');\n  }\n  var dim = hdim / 2; // Dimension of memory and hidden state.\n  var nargs = mergeObj(args, {in: dim + xdim, out: dim});\n  // It's said that initializing the biases of the forget gate to a\n  // value greater than 0 is a good idea. This is so that the output\n  // is close to one at the start of optimization, ensuring\n  // information is passed along. This is mentioned in e.g. \"An\n  // Empirical Exploration of Recurrent Network Architectures\".\n  var forget = compose(\n    sigmoid,\n    affine(name + 'forget', mergeObj(nargs, {initb: 1})));\n  var input = compose(sigmoid, affine(name + 'input', nargs));\n  var output = compose(sigmoid, affine(name + 'output', nargs));\n  var candidate = compose(tanh, affine(name + 'candidate', nargs));\n  return function(prev, x) {\n    // For compatibility with the interface of e.g. gru we combine the\n    // memory and hidden state into a single vector, prev.\n    if (dims(prev)[0] !== hdim) {\n      error('Previous state vector has unexpected dimension');\n    }\n    if (dims(x)[0] !== xdim) {\n      error('Input vector has unexpected dimension');\n    }\n    var cprev = T.reshape(T.range(prev, 0, dim), [dim, 1]);\n    var hprev = T.reshape(T.range(prev, dim, hdim), [dim, 1]);\n    var hprevx = concat([hprev, x]);\n    var f = forget(hprevx);\n    var i = input(hprevx);\n    var o = output(hprevx);\n    var cand = candidate(hprevx);\n    var c = T.add(T.mul(f, cprev), T.mul(i, cand));\n    var h = T.mul(o, tanh(c));\n    return concat([c, h]);\n  };\n};\n";return{wppl:[{code:dists,filename:"dists.wppl"},{code:header,filename:"header.wppl"},{code:nn,filename:"nn.wppl"}]}}function unpack(packages){return _.chain(packages).map(function(pkg){return pkg.wppl.map(function(wppl){return{code:wppl.code,filename:wppl.filename}})}).flatten().value()}function parsePackageCode(packages,verbose){function _parsePackageCode(){var allPackages=[headerPackage()].concat(packages);return _.flow([unpack,parseAll])(allPackages)}return util.timeif(verbose,"parsePackageCode",_parsePackageCode)}function applyCaching(asts){return asts.map(function(ast){return caching.hasNoCachingDirective(ast)?ast:caching.transform(ast)})}function copyAst(ast){var ret=_.isArray(ast)?[]:{};_.each(ast,function(val,key){ret[key]=_.isObject(val)?copyAst(val):val});return ret}function generateCodeAndSourceMap(code,filename,bundles,ast){var codeAndMap=escodegen.generate(ast,{sourceMap:true,sourceMapWithCode:true});var sourceMap=JSON.parse(codeAndMap.map);sourceMap.sourcesContent=sourceMap.sources.map(function(fn){return fn===filename?code:_.find(bundles,{filename:fn}).code});return{code:codeAndMap.code,sourceMap:sourceMap}}function compile(code,options){options=util.mergeDefaults(options,{verbose:false,filename:"webppl:program"});var bundles=options.bundles||parsePackageCode([],options.verbose);var addressMap;var saveAddressMap=function(obj){addressMap=obj.map;return obj.ast};var transforms=options.transforms||[ad,thunkify,naming,saveAddressMap,varargs,cps,store,optimize,options.debug?stack.transform:_.identity,trampoline,stack.wrapProgram];function _compile(){var programAst=parse(code,options.filename);var asts=_.map(bundles,"ast").map(copyAst).concat(programAst);assert.strictEqual(bundles[0].filename,"dists.wppl");assert.strictEqual(bundles[1].filename,"header.wppl");assert.strictEqual(bundles[2].filename,"nn.wppl");var doCaching=_.some(asts.slice(3),caching.transformRequired);if(options.verbose&&doCaching){console.log("Caching transform will be applied.")}var generateCodeAndAssets=function(ast){var obj=generateCodeAndSourceMap(code,options.filename,bundles,ast);obj.addressMap=addressMap;return obj};return _.flow([doCaching?applyCaching:_.identity,concatPrograms,doCaching?freevars:_.identity,_.flow(transforms),generateCodeAndAssets])(asts)}return util.timeif(options.verbose,"compile",_compile)}function wrapWithHandler(f,handler){return function(x,y){try{return f(x,y)}catch(e){handler(e)}}}function wrapRunner(baseRunner,handlers){var wrappedRunner=handlers.reduce(wrapWithHandler,baseRunner);var runner=function(t){return wrappedRunner(t,runner)};return runner}function prepare(codeAndAssets,k,options){options=util.mergeDefaults(options,{errorHandlers:[],initialStore:{}});var currentAddress={value:undefined};var defaultHandler=function(error){errors.extendError(error,codeAndAssets,currentAddress);runtimeTeardown(_.noop);throw error};var allErrorHandlers=[defaultHandler].concat(options.errorHandlers);var baseRunner=options.baseRunner||util.trampolineRunners[util.runningInBrowser()?"web":"cli"]();var runner=wrapRunner(baseRunner,allErrorHandlers);var run=function(){var main=eval.call(global,codeAndAssets.code);runEvaled(main,runner,currentAddress,options.initialStore,k,"")};return{run:run}}function run(code,k,options){options=options||{};var codeAndAssets=compile(code,options);util.timeif(options.verbose,"run",prepare(codeAndAssets,k,options).run)}function runEvaled(main,runner,addressCell,s,k,a){function finish(s,x){runtimeTeardown(function(){return k(s,x)})}runtimeSetup(runner,function(){main(addressCell)(runner)(s,finish,a)})}function runtimeSetup(runner,cont){global.resumeTrampoline=runner;env.reset();util.resetWarnings();params.init(cont)}function runtimeTeardown(cont){params.stop(cont)}global.webpplEval=function(s,k,a,code,runnerName){if(runnerName===undefined){runnerName=util.runningInBrowser()?"web":"cli"}var handler=function(error){throw"webpplEval error:\n"+error};var baseRunner=util.trampolineRunners[runnerName]();var runner=wrapRunner(baseRunner,[handler]);var compiledCode=compile(code,{filename:"webppl:eval"}).code;return eval.call(global,compiledCode)({})(runner)(s,k,a)};module.exports={requireHeader:requireHeader,requireHeaderWrapper:requireHeaderWrapper,parsePackageCode:parsePackageCode,prepare:prepare,run:run,runEvaled:runEvaled,compile:compile}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./errors/errors":187,"./header":191,"./params/params":223,"./syntax":230,"./transforms/ad":233,"./transforms/addFilename":234,"./transforms/caching":236,"./transforms/cps":237,"./transforms/freevars":238,"./transforms/naming":239,"./transforms/optimize":240,"./transforms/stack":241,"./transforms/store":242,"./transforms/trampoline":243,"./transforms/varargs":244,"./util":246,assert:248,"ast-types":52,escodegen:53,esprima:111,lodash:124}],216:[function(require,module,exports){"use strict";var Tensor=require("../tensor");function add(x,y){if(x instanceof Tensor){return x.add(y)}else if(typeof x==="number"){return x+y}else{throw new Error("add: unhandled types")}}function addEq(x,y){if(x instanceof Tensor){return x.addeq(y)}else if(typeof x==="number"){return x+y}else{throw new Error("addEq: unhandled types")}}function mul(x,y){if(x instanceof Tensor){return x.mul(y)}else if(typeof x==="number"){return x*y}else{throw new Error("mul: unhandled types")}}function sum(x){if(x instanceof Tensor){return x.sumreduce()}else if(typeof x==="number"){return x}else{throw new Error("sum: unhandled type")}}module.exports={add:add,addEq:addEq,mul:mul,sum:sum}},{"../tensor":231}],217:[function(require,module,exports){"use strict";var _=require("lodash");function Interval(low,high,lopen,ropen){this.low=low;this.high=high;this.lopen=lopen;this.ropen=ropen;this.isBounded=low!==-Infinity||high!==Infinity}Interval.prototype.toString=function(){return[this.lopen?"(":"[",this.low,", ",this.high,this.ropen?")":"]"].join("")};function isInterval(val){return val instanceof Interval}function parse(str){var endPoints=str.slice(1,-1).split(",").map(parseFloat);if(endPoints.length!==2||typeof endPoints[0]!=="number"||isNaN(endPoints[0])||typeof endPoints[1]!=="number"||isNaN(endPoints[1])||!_.includes(["[","("],str[0])||!_.includes(["]",")"],str.slice(-1)[0])){throw new Error('Failed to parse "'+str+'" as an interval.')}var low=endPoints[0];var high=endPoints[1];if(low>high){throw new Error('Invalid interval "'+str+'".')}return new Interval(low,high,str[0]==="(",str.slice(-1)[0]===")")}function check(interval){var low=interval.low;var high=interval.high;var lopen=interval.lopen;var ropen=interval.ropen;if(!lopen&&!ropen){return function(val){return low<=val&&val<=high}}else if(!lopen&&ropen){return function(val){return low<=val&&val<high}}else if(lopen&&!ropen){return function(val){return low<val&&val<=high}}else if(lopen&&ropen){return function(val){return low<val&&val<high}}else{throw new Error("Unreachable")}}module.exports={isInterval:isInterval,parse:parse,check:check}},{lodash:124}],218:[function(require,module,exports){"use strict";var ad=require("../ad");var _=require("lodash");var LOG_PI=1.1447298858494002;var LOG_2PI=1.8378770664093453;function sum(xs){return xs.reduce(function(a,b){return ad.scalar.add(a,b)},0)}function _sum(xs){if(xs.length===0){return 0}else{var total=_.reduce(xs,function(a,b){return a+b});return total}}function product(xs){var result=1;for(var i=0,n=xs.length;ad.scalar.lt(i,n);i++){result=ad.scalar.mul(result,xs[i])}return result}function fact(x){var t=1;while(ad.scalar.gt(x,1)){t=ad.scalar.mul(t,x);x=ad.scalar.sub(x,1)}return t}function lnfact(x){if(ad.scalar.lt(x,1)){x=1}if(ad.scalar.lt(x,12)){return ad.scalar.log(fact(ad.scalar.round(x)))}var invx=ad.scalar.div(1,x);var invx2=ad.scalar.mul(invx,invx);var invx3=ad.scalar.mul(invx2,invx);var invx5=ad.scalar.mul(invx3,invx2);var invx7=ad.scalar.mul(invx5,invx2);var sum=ad.scalar.sub(ad.scalar.mul(ad.scalar.add(x,.5),ad.scalar.log(x)),x);sum=ad.scalar.add(sum,ad.scalar.div(ad.scalar.log(ad.scalar.mul(2,ad.scalar.PI)),2));sum=ad.scalar.add(sum,ad.scalar.sub(ad.scalar.div(invx,12),ad.scalar.div(invx3,360)));sum=ad.scalar.add(sum,ad.scalar.sub(ad.scalar.div(invx5,1260),ad.scalar.div(invx7,1680)));return sum}function squishToProbSimplex(x){var d=ad.value(x).dims[0];var u=ad.tensor.reshape(ad.tensor.concat(x,ad.tensor.fromScalars(0)),[d+1,1]);return ad.tensor.softmax(u)}function logaddexp(a,b){if(ad.scalar.peq(a,ad.scalar.neg(Infinity))){return b}else if(ad.scalar.peq(b,ad.scalar.neg(Infinity))){return a}else if(ad.scalar.gt(a,b)){return ad.scalar.add(ad.scalar.log(ad.scalar.add(1,ad.scalar.exp(ad.scalar.sub(b,a)))),a)}else{return ad.scalar.add(ad.scalar.log(ad.scalar.add(1,ad.scalar.exp(ad.scalar.sub(a,b)))),b)}}function _logsumexp(a){var m=Math.max.apply(null,a);var sum=0;for(var i=0;i<a.length;++i){sum+=a[i]===-Infinity?0:Math.exp(a[i]-m)}return m+Math.log(sum)}module.exports={LOG_PI:LOG_PI,LOG_2PI:LOG_2PI,sum:sum,_sum:_sum,product:product,fact:fact,lnfact:lnfact,squishToProbSimplex:squishToProbSimplex,logaddexp:logaddexp,_logsumexp:_logsumexp}},{"../ad":151,lodash:124}],219:[function(require,module,exports){"use strict";var gammaCof=[76.18009172947146,-86.50532032941678,24.01409824083091,-1.231739572450155,.001208650973866179,-5395239384953e-18];function logGamma(xx){var x=xx-1;var tmp=x+5.5;tmp-=(x+.5)*Math.log(tmp);var ser=1.000000000190015;for(var j=0;j<=5;j++){x+=1;ser+=gammaCof[j]/x}return-tmp+Math.log(2.5066282746310007*ser)}function digamma(x){if(x<6){return digamma(x+1)-1/x}return Math.log(x)-1/(2*x)-1/(12*Math.pow(x,2))+1/(120*Math.pow(x,4))-1/(252*Math.pow(x,6))+1/(240*Math.pow(x,8))-5/(660*Math.pow(x,10))+691/(32760*Math.pow(x,12))-1/(12*Math.pow(x,14))}function trigamma(x){if(x<30){return trigamma(x+1)+1/(x*x)}return 1/x+1/(2*Math.pow(x,2))+1/(6*Math.pow(x,3))-1/(30*Math.pow(x,5))+1/(42*Math.pow(x,7))-1/(30*Math.pow(x,9))}function doubleFactorial(x){var parity=x%2;var product=1;for(var i=1;i<=x;i++){if(i%2==parity){product*=i}}return product}module.exports={logGamma:logGamma,digamma:digamma,trigamma:trigamma,doubleFactorial:doubleFactorial}},{}],220:[function(require,module,exports){"use strict";var _=require("lodash");var assert=require("assert");var util=require("../util");var abs=Math.abs,pow=Math.pow,sqrt=Math.sqrt,ln=Math.ln;function expectation(a,func){assert.ok(a.length>0);var f=func||_.identity;return _.reduce(a,function(acc,x){return acc+f(x)},0)/a.length}function mean(a){return expectation(a)}function variance(a){var m=expectation(a);return expectation(a,function(x){return pow(x-m,2)})}function sd(a){return sqrt(variance(a))}function skew(a){var m=mean(a);var s=sd(a);return expectation(a,function(x){return pow((x-m)/s,3)})}function kurtosis(a){var m=mean(a);return expectation(a,function(x){return pow(x-m,4)})/pow(expectation(a,function(x){return pow(x-m,2)}),2)}function kde(samps,kernel){if(kernel===undefined||typeof kernel!=="function"){kernel=function(u){return abs(u)<=1?.75*(1-u*u):0}}var n=samps.length;var s=sd(samps);var bandwidth=1.06*s*pow(n,-.2);var min=_.min(samps);var max=_.max(samps);var numBins=(max-min)/bandwidth;var results=[];for(var i=0;i<=numBins;i++){var x=min+bandwidth*i;var kernelSum=0;for(var j=0;j<samps.length;j++){kernelSum+=kernel((x-samps[j])/bandwidth)}results.push({item:x,density:kernelSum/(n*bandwidth)})}return results}function mode(samps){var tallied=_.sortBy(_.toPairs(_.countBy(samps)),"1");var last=_.last(tallied);if(tallied.length>1){var penultimate=tallied.slice(-2)[0];if(penultimate[1]===last[1]){util.warn("Samples have more than one mode.")}}return last[0]}function kdeMode(samps){var kdeResults=kde(samps);var maxDensity=-Infinity;var maxItem;for(var i=0,n=kdeResults.length;i<n;i++){var item=kdeResults[i].item,density=kdeResults[i].density;if(density>maxDensity){maxDensity=density;maxItem=item}}return maxItem}module.exports={mean:mean,variance:variance,sd:sd,skew:skew,kurtosis:kurtosis,kde:kde,kdeMode:kdeMode,mode:mode}},{"../util":246,assert:248,lodash:124}],221:[function(require,module,exports){"use strict";var _=require("lodash");var memoryStore=require("./store/memory");var mongoStore=require("./store/mongo");var fileStore=require("./store/file");var _id;var _isManualId=false;function setFreshId(){_id="params-"+Math.random().toString(36).substring(2,10);_isManualId=false;return _id}function setId(id){_id=id;_isManualId=true;return _id}function getId(){if(!_id){throw new Error("Expected _id to be defined!")}return _id}function isManualId(){return _isManualId}var stores={memory:memoryStore,mongo:mongoStore,file:fileStore};var _store=memoryStore;function setStore(name){if(_.has(stores,name)){_store=stores[name]}else{throw new Error('Parameter store "'+name+'" not found. '+"Valid options: "+_.keys(stores))}}function getStore(){if(!_store){throw new Error("Expected _store to be defined!")}return _store}module.exports={getId:getId,getStore:getStore,isManualId:isManualId,setFreshId:setFreshId,setId:setId,setStore:setStore}},{"./store/file":225,"./store/memory":226,"./store/mongo":227,lodash:124}],222:[function(require,module,exports){"use strict";var _=require("lodash");var ad=require("../ad");var Tensor=require("../tensor");var util=require("../util");var tensorGaussian=require("../dists/tensorGaussian");var config=require("./config");var params=require("./params");var serialize=require("./serialize");function getParams(s,k,a){return k(s,params.get())}function setParams(s,k,a,prms){return params.set(prms,function(){return k(s)})}function setParamsId(s,k,a,id){config.setId(id);return params.sync(function(){return k(s,id)})}function setFreshParamsId(s,k,a){var id=config.setFreshId();return params.sync(function(){return k(s,id)})}function getParamsId(s,k,a,id){return k(s,config.getId())}function serializeParams(s,k,a,paramsObj){return k(s,serialize.serializeParams(paramsObj))}function deserializeParams(s,k,a,str){return k(s,serialize.deserializeParams(str))}function defaultInit(mu,sigma){return function(s,k,a,dims){return k(s,tensorGaussian.sample(mu,sigma,dims))}}module.exports=function(env){var forward=require("../inference/forwardSample")(env).forward;var dimsForScalarParam=[1];var param=function(s,k,a,options){options=util.mergeDefaults(options,{mu:0,sigma:.1,dims:dimsForScalarParam});if(!env.coroutine._guide){util.warn("Warning: Parameter "+(_.has(options,"name")?'"'+options.name+'" ':"")+"created outside of the guide.",true)}var dims=options.dims;var name=_.has(options,"name")?options.name:util.relativizeAddress(params.baseAddress(env),a);if(params.exists(name)){return finish(s)}else{var init=_.has(options,"init")?options.init:defaultInit(options.mu,options.sigma);if(!_.isFunction(init)){throw new Error("Expected the init argument to be a function.")}var initThunk=function(s,k,a){return init(s,k,a,dims)};var next=function(k,initialVal){params.create(name,initialVal);if(!_.isEqual(dims,initialVal.dims)){var msg="The init function did not return a tensor with the expected shape.";throw new Error(msg)}return finish(s)};return forward(s,next,a,initThunk)}function finish(s){var val=params.fetch(name,env);var valDims=ad.value(val).dims;if(!_.isEqual(dims,valDims)){var msg="The dims specified here ("+JSON.stringify(dims)+") do not match the dims of the current parameter value ("+JSON.stringify(valDims)+"). This value may "+"come from an earlier call to param, or from a previous "+"execution when a persistent parameter store is used.";throw new Error(msg)}return k(s,dims===dimsForScalarParam?ad.tensor.get(val,0):val)}};return{getParams:getParams,getParamsId:getParamsId,param:param,setFreshParamsId:setFreshParamsId,setParams:setParams,setParamsId:setParamsId,serializeParams:serializeParams,deserializeParams:deserializeParams}}},{"../ad":151,"../dists/tensorGaussian":183,"../inference/forwardSample":203,"../tensor":231,"../util":246,"./config":221,"./params":223,"./serialize":224,lodash:124}],223:[function(require,module,exports){"use strict";var assert=require("assert");var _=require("lodash");var ad=require("../ad");var util=require("../util");var config=require("./config");var serializeParams=require("./serialize").serializeParams;var _params;function init(k){var store=config.getStore();if(!config.isManualId()){config.setFreshId()}return store.start(function(){return sync(k,{incremental:false})})}function stop(k){var store=config.getStore();return store.stop(k)}function sync(k,options){var store=config.getStore();var next=function(params){if(!params){throw new Error("Expected store to return params, got",params)}if(options&&options.incremental){_.assign(_params,params)}else{_params=params}return k(_params)};return store.getParams(config.getId(),next)}function get(){return _params}function exists(name){return _.has(_params,name)}function save(filename){var s=serializeParams(_params);fs.writeFileSync(filename,s)}function set(params,k){var id=config.getId();var store=config.getStore();var next=function(){_params=params;return k()};return store.setParams(id,params,next)}function create(name,initialVal){if(exists(name)){throw new Error('Parameter "'+name+'" already exists.')}if(!util.isTensor(initialVal)){throw new Error("Expected an (unlifted) tensor.")}var paramTable=get();paramTable[name]=initialVal}function fetch(name,env){if(!exists(name)){throw new Error('Parameter "'+name+'" does not exist.')}var paramTable=get();var paramsSeen=getParamsSeen(env);if(!paramsSeen){return paramTable[name]}if(_.has(paramsSeen,name)){return paramsSeen[name]}else{var _param=paramTable[name];var param=ad.lift(_param);paramsSeen[name]=param;return param}}function findCoroutine(predicate,coroutine){if(predicate(coroutine)){return coroutine}else if(_.has(coroutine,"oldCoroutine")){return findCoroutine(predicate,coroutine.oldCoroutine)}else{return null}}function getParamsSeen(env){var coroutine=findCoroutine(_.property("paramsSeen"),env.coroutine);return coroutine?coroutine.paramsSeen:null}function baseAddress(env){var baseCoroutine=findCoroutine(_.property("isParamBase"),env.coroutine);assert.ok(baseCoroutine,"Could not find base coroutine.");assert.ok(_.has(baseCoroutine,"a"),"Entry address not saved on coroutine.");return baseCoroutine.a}module.exports={get:get,set:set,init:init,stop:stop,save:save,sync:sync,exists:exists,create:create,fetch:fetch,baseAddress:baseAddress}},{"../ad":151,"../util":246,"./config":221,"./serialize":224,assert:248,lodash:124}],224:[function(require,module,exports){"use strict";var _=require("lodash");var Tensor=require("../tensor");function tensorToObject(tensor){return{dims:tensor.dims,data:tensor.toFlatArray()}}function tensorsToObjects(paramObj){return _.mapValues(paramObj,tensorToObject)}function objectsToTensors(paramObj){return _.mapValues(paramObj,function(tensor){return new Tensor(tensor.dims).fromFlatArray(tensor.data)})}function serializeParams(paramObj){return JSON.stringify(tensorsToObjects(paramObj))}function deserializeParams(str){return objectsToTensors(JSON.parse(str))}module.exports={tensorsToObjects:tensorsToObjects,objectsToTensors:objectsToTensors,serializeParams:serializeParams,deserializeParams:deserializeParams}},{"../tensor":231,lodash:124}],225:[function(require,module,exports){(function(process){"use strict";var assert=require("assert");var join=require("path").join;var _=require("lodash");var serialize=require("../serialize");var util=require("../../util");var path=_.get(process.env,"WEBPPL_PARAM_PATH",".");var interval=parseInt(_.get(process.env,"WEBPPL_PARAM_INTERVAL",1e4));var verbose=parseInt(_.get(process.env,"WEBPPL_PARAM_VERBOSE",0));var store={};function filename(id){assert.ok(_.isString(path),"Expected path to be defined.");return join(path,id+".json")}function read(id){try{var params=serialize.deserializeParams(fs.readFileSync(filename(id)));if(verbose){console.log("Read parameter set "+id+".")}return params}catch(e){if(verbose){console.log("No file found for parameter set "+id+". Using empty parameter set.")}return{}}}function write(params,id){try{fs.writeFileSync(filename(id),serialize.serializeParams(params));if(verbose){console.log("Wrote parameter set "+id+".")}}catch(e){util.warn("Error writing parameter set "+id+".")}}function start(k){fs.accessSync(path);return k()}function stop(k){_.forEach(store,function(obj,id){write(obj.params,id)});return k()}function getParams(id,k){if(!_.has(store,id)){store[id]={params:read(id),timestamp:Date.now()}}return k(store[id].params)}function setParams(id,params,k){store[id].params=params;var now=Date.now();if(now-store[id].timestamp>interval){write(params,id);store[id].timestamp=now}return k()}module.exports={start:start,stop:stop,getParams:getParams,setParams:setParams}}).call(this,require("_process"))},{"../../util":246,"../serialize":224,_process:251,assert:248,lodash:124,path:250}],226:[function(require,module,exports){"use strict";var _=require("lodash");var paramStruct=require("../struct");var SAFE_MODE=false;function copyIfSafeMode(params){return SAFE_MODE?paramStruct.deepCopy(params):params}var store={};function start(k){return k()}function stop(k){return k()}function getParams(id,k){if(_.has(store,id)){return k(copyIfSafeMode(store[id]))}else{return k({})}}function setParams(id,params,k){store[id]=copyIfSafeMode(params);return k()}module.exports={start:start,stop:stop,getParams:getParams,setParams:setParams}},{"../struct":228,lodash:124}],227:[function(require,module,exports){(function(process,global){"use strict";var _=require("lodash");var tensorsToObjects=require("../serialize").tensorsToObjects;var objectsToTensors=require("../serialize").objectsToTensors;try{var mongodb=require("mongodb")}catch(e){var mongodb=null}var mongoURL=process.env.WEBPPL_MONGO_URL||"mongodb://localhost:27017/webppl";var collectionName=process.env.WEBPPL_MONGO_COLLECTION||"parameters";var _collection=null;function resume(thunk){global.resumeTrampoline(thunk)}function assertInit(){if(!_collection){throw new Error('No db collection found - make sure to call "start" first!')}}function _loadParams(id,k){assertInit();_collection.findOne({_id:id},{},function(err,data){if(err){throw new Error("Failed to load params from MongoDB: "+JSON.stringify(err))}else{if(!data){return k({})}if(!data.params){throw new Error("Expected to find `params` property, got "+JSON.stringify(data))}return k(objectsToTensors(data.params))}})}function _storeParams(id,params,k){assertInit();_collection.update({_id:id},{params:tensorsToObjects(params)},{upsert:true},function(err,result){if(err){throw new Error("Failed to store params in MongoDB: "+JSON.stringify(err))}return k()})}function start(k){if(!mongodb){throw new Error("MongoDB module not found. Run `npm install mongodb` "+"in the webppl directory to use the MongoDB store.")}console.log("Connecting to MongoDB...");var client=mongodb.MongoClient;client.connect(mongoURL,function(err,db){if(err){throw new Error("Failed to connect to MongoDB: "+JSON.stringify(err))}console.log("Successfully connected to MongoDB.");_collection=db.collection(collectionName);resume(k)})}function stop(k){console.log("Disconnecting from MongoDB...");_collection.s.db.close(true,function(err,result){if(err){throw new Error("Failed to cleanly close MongoDB connection: "+JSON.stringify(err))}console.log("Successfully disconnected from MongoDB.");resume(k)})}function getParams(id,k){_loadParams(id,function(params){resume(function(){return k(params)})})}function setParams(id,params,k){_storeParams(id,params,function(){resume(function(){return k()})})}module.exports={start:start,stop:stop,getParams:getParams,setParams:setParams}}).call(this,require("_process"),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"../serialize":224,_process:251,lodash:124,mongodb:"mongodb"}],228:[function(require,module,exports){"use strict";var assert=require("assert");var _=require("lodash");function addEq(g,h){_.each(h,function(val,a){if(!_.has(g,a)){g[a]=val}else{g[a].addeq(val)}})}function mulEq(g,s){_.each(g,function(val){val.muleq(s)})}function divEq(g,s){_.each(g,function(val){val.diveq(s)})}function norm(g){var normsq=0;_.each(g,function(val){normsq+=val.mul(val).sumreduce()});return Math.sqrt(normsq)}function clip(g,threshold,normOfG){assert.ok(_.isNumber(threshold));if(normOfG>threshold){mulEq(g,threshold/normOfG)}}function deepCopy(g){return _.mapValues(g,function(val){return val.clone()})}function select(g,h){return _.mapValues(h,function(unused,key){return g[key].clone()})}module.exports={addEq:addEq,mulEq:mulEq,divEq:divEq,norm:norm,clip:clip,deepCopy:deepCopy,select:select}},{assert:248,lodash:124}],229:[function(require,module,exports){"use strict";function Query(){this.table={}}Query.prototype.add=function(key,val){this.table[key]=val};Query.prototype.addAll=function(other){for(var key in other.table)this.table[key]=other.table[key]};Query.prototype.clear=function(){this.table={}};Query.prototype.getTable=function(){var tbl={};for(var key in this.table)tbl[key]=this.table[key];return tbl};module.exports={Query:Query}},{}],230:[function(require,module,exports){"use strict";var types=require("ast-types").namedTypes;var build=require("ast-types").builders;var keys=require("estraverse").VisitorKeys;var Syntax=require("estraverse").Syntax;function makeGenvar(){var gensym=require("./util").makeGensym();return function(name){return build.identifier("_".concat(gensym(name)))}}function fail(message,node){return function(){console.log(node);console.log(message);throw new Error(message)}}function clause(type,destructor){return function(node,fail){if(types.hasOwnProperty(type)){if(types[type].check(node)){return destructor.apply(this,keys[type].map(function(key){return node[key]}))}else{return fail()}}else{throw new Error("no type "+type)}}}function match(node,clauses,fail){for(var i=0;i<clauses.length;i++){var failed=false;var value=clauses[i](node,function(){failed=true});if(!failed){return value}}return fail()}function failSafe(who,fail){if(typeof fail==="function"){return fail()}else{throw new Error(who+": fail is not a function")}}function inProgram(f,fail){return function(node){if(types.Program.check(node)&&node.body.length===1&&types.ExpressionStatement.check(node.body[0])){return build.program([build.expressionStatement(f(node.body[0].expression))])}else{return failSafe("inProgram",fail)}}}function inBody(f,fail){return inProgram(function(node){if(types.FunctionExpression.check(node)){return build.functionExpression(node.id,node.params,build.blockStatement(f(build.program(node.body.body)).body))}else{return failSafe("inBody",fail)}},fail)}function returnify(nodes){if(nodes.length===0){return nodes}else{var returnNode=match(nodes[nodes.length-1],[clause(Syntax.BlockStatement,function(body){return build.blockStatement(returnify(body))}),clause(Syntax.EmptyStatement,function(){return build.emptyStatement()}),clause(Syntax.ExpressionStatement,function(expression){return build.returnStatement(expression)}),clause(Syntax.IfStatement,function(test,consequent,alternate){return build.ifStatement(test,build.blockStatement(returnify(consequent.body)),alternate===null?null:build.blockStatement(returnify([alternate])))}),clause(Syntax.ReturnStatement,function(argument){return build.returnStatement(argument)})],function(){return});if(returnNode){nodes[nodes.length-1]=returnNode}else{nodes=nodes.concat(build.returnStatement(build.identifier("undefined")))}return nodes}}function isPrimitive(node){switch(node.type){case Syntax.FunctionExpression:case Syntax.Identifier:case Syntax.CallExpression:case Syntax.ConditionalExpression:return false;case Syntax.MemberExpression:return types.Identifier.check(node.object)||!node.computed&&types.Identifier.check(node.property);default:console.log(node);throw new Error("isPrimitive doesn't handle node")}}function thunkify(node,fail){if(types.Program.check(node)){return build.program([build.expressionStatement(build.functionExpression(null,[],build.blockStatement(returnify(node.body))))])}else{return failSafe("thunkify",fail)}}module.exports={makeGenvar:makeGenvar,fail:fail,clause:clause,match:match,thunkify:thunkify,inProgram:inProgram,inBody:inBody,isPrimitive:isPrimitive}},{"./util":246,"ast-types":52,estraverse:118}],231:[function(require,module,exports){"use strict";var Tensor=require("adnn/tensor");var special=require("./math/special");Tensor.prototype.logGamma=function(){var out=new Tensor(this.dims);var n=this.data.length;while(n--){out.data[n]=special.logGamma(this.data[n])}return out};module.exports=Tensor},{"./math/special":219,"adnn/tensor":31}],232:[function(require,module,exports){"use strict";var _=require("lodash");var assert=require("assert");var isDist=require("./dists").isDist;var ad=require("./ad");var Trace=function(wpplFn,s,k,a){this.wpplFn=wpplFn;this.initialStore=s;this.exitK=k;this.baseAddress=a;this.choices=[];this.addressMap={};this.length=0;this.score=0;this.numFactors=0};Trace.prototype.fresh=function(){return new Trace(this.wpplFn,this.initialStore,this.exitK,this.baseAddress)};Trace.prototype.choiceAtIndex=function(index){return this.choices[index]};Trace.prototype.findChoice=function(address){return this.addressMap[address]};Trace.prototype.saveContinuation=function(s,k){this.store=s;this.k=k};Trace.prototype.continue=function(){if(this.k&&this.store){return this.k(this.store)}else{return this.wpplFn(_.clone(this.initialStore),this.exitK,this.baseAddress)}};Trace.prototype.addChoice=function(dist,val,address,store,continuation,options){var choice={k:continuation,address:address,dist:dist,options:options,score:this.score,val:val,store:_.clone(store),numFactors:this.numFactors};this.choices.push(choice);this.addressMap[address]=choice;this.length+=1;this.score=ad.scalar.add(this.score,dist.score(val))};Trace.prototype.complete=function(value){assert.strictEqual(this.value,undefined);this.value=value;this.k=this.store=undefined};Trace.prototype.isComplete=function(){return this.k===undefined&&this.store===undefined};Trace.prototype.upto=function(i){assert(i<this.length);var t=this.fresh();t.choices=this.choices.slice(0,i);t.choices.forEach(function(choice){t.addressMap[choice.address]=choice});t.length=t.choices.length;t.score=this.choices[i].score;t.numFactors=this.choices[i].numFactors;return t};Trace.prototype.copy=function(){var t=this.fresh();t.choices=this.choices.slice(0);t.addressMap=_.clone(this.addressMap);t.length=this.length;t.score=this.score;t.k=this.k;t.store=_.clone(this.store);t.address=this.address;t.value=this.value;t.numFactors=this.numFactors;return t};Trace.prototype.checkConsistency=function(){assert(_.isFunction(this.wpplFn));assert(_.isFunction(this.exitK));assert(this.initialStore);assert(this.baseAddress);assert(this.k&&this.store||!this.k&&!this.store);assert(this.choices.length===this.length);assert(_.keys(this.addressMap).length===this.length);this.choices.forEach(function(choice){assert(_.has(this.addressMap,choice.address))},this);assert(this.value===undefined||this.k===undefined&&this.store===undefined)};module.exports=Trace},{"./ad":151,"./dists":169,assert:248,lodash:124}],233:[function(require,module,exports){"use strict";var estraverse=require("estraverse");var build=require("./builders");var rules=function(node){switch(node.type){case"UnaryExpression":switch(node.operator){case"+":return"ad.scalar.plus";case"-":return"ad.scalar.neg"}break;case"BinaryExpression":switch(node.operator){case"*":return"ad.scalar.mul";case"/":return"ad.scalar.div";case"+":return"ad.scalar.add";case"-":return"ad.scalar.sub";case"<":return"ad.scalar.lt";case"<=":return"ad.scalar.leq";case">":return"ad.scalar.gt";case">=":return"ad.scalar.geq";case"==":return"ad.scalar.eq";case"!=":return"ad.scalar.neq";case"===":return"ad.scalar.peq";case"!==":return"ad.scalar.pneq"}break}return false};function parse(dotted){return dotted.split(".").map(build.identifier).reduce(function(a,b){return build.memberExpression(a,b)})}function rewrite(node,fn){var callee=parse(fn);if(node.type==="UnaryExpression"){return build.callExpression(callee,[node.argument])}else if(node.type==="BinaryExpression"){return build.callExpression(callee,[node.left,node.right])}else{throw new Error("Unexpected node type")}}function isInplaceAssignmentOp(op){return op==="+="||op==="-="||op==="*="||op==="/="}function ad(ast){return estraverse.replace(ast,{enter:function(node,parent){var fn=rules(node);if(fn){return rewrite(node,fn)}if(node.type==="AssignmentExpression"&&isInplaceAssignmentOp(node.operator)){return build.assignmentExpression("=",node.left,build.binaryExpression(node.operator[0],node.left,node.right))}if(node.type==="MemberExpression"&&node.object.type==="Identifier"&&node.object.name==="Math"){return build.memberExpression(parse("ad.scalar"),node.property,node.computed)}}})}module.exports={ad:ad}},{"./builders":235,estraverse:118}],234:[function(require,module,exports){"use strict";var replace=require("estraverse").replace;function addFilenameMain(ast,filename){return replace(ast,{enter:function(node){node.loc.source=filename;return node}})}module.exports={addFilename:addFilenameMain}},{estraverse:118}],235:[function(require,module,exports){"use strict";var builders=require("ast-types").builders;var _=require("lodash");function isLocationNode(node){return _.has(node,"start")&&_.has(node,"end")}module.exports=_.mapValues(builders,function(builder){return function(){var args=_.toArray(arguments);if(args.length>0&&isLocationNode(_.last(args))){var node=builder.apply(null,args.slice(0,-1));node.loc=_.last(args);return node}else{return builder.apply(null,args)}}})},{"ast-types":52,lodash:124}],236:[function(require,module,exports){"use strict";var _=require("lodash");var estraverse=require("estraverse");var build=require("ast-types").builders;var types=require("ast-types").types;var isPrimitive=require("../syntax").isPrimitive;var Syntax=estraverse.Syntax;var cacheExempt=["flip","categorical","uniformDraw","bernoulli","beta","binomial","cauchy","delta","diagCovGaussian","dirichlet","discrete","exponential","gamma","gaussian","ispNormal","laplace","logisticNormal","logitNormal","multinomial","multivariateBernoulli","multivariateGaussian","poisson","randomInteger","tensorGaussian","tensorLaplace","uniform","factor","sample","observe","sampleWithFactor"];var cacheExemptTable={};_.each(cacheExempt,function(funcName){cacheExemptTable[funcName]=true});cacheExempt=cacheExemptTable;function shouldCache(callee){if(isPrimitive(callee))return false;if(callee.type===Syntax.Identifier&&cacheExempt[callee.name])return false;return true}function exit(node){if(node.type===Syntax.CallExpression&&shouldCache(node.callee)){return build.callExpression(build.identifier("incrementalize"),[node.callee,build.arrayExpression(node.arguments)])}}function cachingMain(node){return estraverse.replace(node,{leave:exit})}function isImhIdentifier(node){return node.type==="Identifier"&&node.name==="IncrementalMH"}function isImhInferMethodOption(node){return node.type==="Property"&&(node.key.type==="Identifier"&&node.key.name==="method"||node.key.type==="Literal"&&node.key.value==="method")&&(node.value.type==="Literal"&&node.value.value==="incrementalMH")}function transformRequired(programAST){var flag=false;estraverse.traverse(programAST,{enter:function(node){if(isImhIdentifier(node)||isImhInferMethodOption(node)){flag=true;this.break()}}});return flag}function hasNoCachingDirective(ast){return ast.body.length>0&&ast.body[0].type===Syntax.ExpressionStatement&&ast.body[0].expression.type===Syntax.Literal&&ast.body[0].expression.value==="no caching"}module.exports={transform:cachingMain,transformRequired:transformRequired,hasNoCachingDirective:hasNoCachingDirective}},{"../syntax":230,"ast-types":52,estraverse:118,lodash:124}],237:[function(require,module,exports){"use strict";var build=require("./builders");var types=require("ast-types").namedTypes;var Syntax=require("estraverse").Syntax;var match=require("../syntax").match;var clause=require("../syntax").clause;var fail=require("../syntax").fail;var inProgram=require("../syntax").inProgram;var isPrimitive=require("../syntax").isPrimitive;var makeGenvar=require("../syntax").makeGenvar;var genvar=null;function buildFunction(params,body,id){return build.functionExpression(id||null,params,build.blockStatement([build.expressionStatement(body)]))}function buildCall(callee,args){return build.callExpression(callee,args)}function buildContinuation(param,body){return buildFunction([param],body)}function buildContinuationCall(callee,arg){return buildCall(callee,[arg])}function cpsFunction(id,params,body){var k=genvar("k");return buildFunction([k].concat(params),cpsFinalStatement(body,k,k),id)}function bindContinuation(k,metaK){if(types.Identifier.check(k)){return metaK(k)}else{var k0=genvar("k");return buildCall(buildFunction([k0],metaK(k0)),[k])}}function atomize(node,metaK){return match(node,[clause(Syntax.ArrayExpression,function(elements){return atomizeStar(elements,function(elements){return metaK(build.arrayExpression(elements))})}),clause(Syntax.AssignmentExpression,function(left,right){var err=false,line,msg;if(left.type===Syntax.MemberExpression){if(!(left.object.name==="globalStore")){err=true;msg="You tried to assign to a field of "+left.object.name+", but you can only assign to fields of globalStore"}}else{err=true;if(left.name==="globalStore"){msg="You must assign to a field of globalStore, not globalStore itself"}else{msg="Did you mean var "+left.name+" = ?"}}if(err){line=left.loc.start.line;throw new Error("Line "+line+": "+msg)}return atomize(left,function(left){return atomize(right,function(right){return metaK(build.assignmentExpression(node.operator,left,right))})})}),clause(Syntax.BinaryExpression,function(left,right){return atomize(left,function(left){return atomize(right,function(right){return metaK(build.binaryExpression(node.operator,left,right))})})}),clause(Syntax.CallExpression,function(callee,args){if(isPrimitive(callee)){return atomize(callee,function(callee){return atomizeStar(args,function(args){return metaK(build.callExpression(callee,args))})})}else{var x=genvar("result");x.loc=node.loc;return cps(node,buildContinuation(x,metaK(x)))}}),clause(Syntax.ConditionalExpression,function(test,consequent,alternate){return atomize(test,function(test){var x=genvar("result");return bindContinuation(buildContinuation(x,metaK(x)),function(k){return build.conditionalExpression(test,cps(consequent,k),cps(alternate,k))})})}),clause(Syntax.FunctionExpression,function(id,params,body){return metaK(cpsFunction(id,params,body))}),clause(Syntax.Identifier,function(){return metaK(node)}),clause(Syntax.Literal,function(){return metaK(node)}),clause(Syntax.LogicalExpression,function(left,right){return atomize(left,function(left){var x=genvar("result");return bindContinuation(buildContinuation(x,metaK(x)),function(k){if(node.operator==="||"){return build.conditionalExpression(left,cps(left,k),cps(right,k))}else if(node.operator==="&&"){return build.conditionalExpression(left,cps(right,k),cps(left,k))}else{console.log(node.operator);throw new Error("cps: unhandled logical operator "+node.operator)}})})}),clause(Syntax.MemberExpression,function(object,property){return atomize(object,function(object){return atomize(property,function(property){return metaK(build.memberExpression(object,property,node.computed,node.loc))})})}),clause(Syntax.ObjectExpression,function(properties){return atomizeStar(properties,function(properties){return metaK(build.objectExpression(properties))})}),clause(Syntax.Property,function(key,value){return atomize(value,function(value){return metaK(build.property("init",key,value))})}),clause(Syntax.UnaryExpression,function(argument){return atomize(argument,function(argument){return metaK(build.unaryExpression(node.operator,argument))})}),clause(Syntax.DebuggerStatement,function(){var body=build.blockStatement([node]);return metaK(buildCall(build.functionExpression(null,[],body),[]))})],fail("atomize: unrecognized node",node))}function atomizeStar(es,metaK){es=es.concat();function loop(i){if(i===es.length){return metaK(es)}else{return atomize(es[i],function(e){es[i]=e;return loop(i+1)})}}return loop(0)}function cps(node,k){switch(node.type){case Syntax.ArrayExpression:case Syntax.AssignmentExpression:case Syntax.BinaryExpression:case Syntax.FunctionExpression:case Syntax.Identifier:case Syntax.Literal:case Syntax.MemberExpression:case Syntax.ObjectExpression:case Syntax.UnaryExpression:case Syntax.DebuggerStatement:return atomize(node,function(node){return buildContinuationCall(k,node)});default:return match(node,[clause(Syntax.CallExpression,function(callee,args){return atomize(callee,function(callee){return atomizeStar(args,function(args){if(isPrimitive(callee)){return buildContinuationCall(k,buildCall(callee,args))}else{return buildCall(callee,[k].concat(args))}})})}),clause(Syntax.ConditionalExpression,function(test,consequent,alternate){return atomize(test,function(test){return bindContinuation(k,function(k){return build.conditionalExpression(test,cps(consequent,k),cps(alternate,k))})})}),clause(Syntax.LogicalExpression,function(left,right){return atomize(left,function(left){return bindContinuation(k,function(k){if(node.operator==="||"){return build.conditionalExpression(left,cps(left,k),cps(right,k))}else if(node.operator==="&&"){return build.conditionalExpression(left,cps(right,k),cps(left,k))}else{console.log(node.operator);throw new Error("cps: unhandled logical operator "+node.operator)}})})})],fail("can't cps",node))}}function cpsDeclarations(declarations,i,metaK){return clause(Syntax.VariableDeclarator,function(id,init){if(types.FunctionExpression.check(init)){init.id=id}if(i+1===declarations.length){return cps(init,metaK(id))}else{return cps(init,buildContinuation(id,cpsDeclarations(declarations,i+1,metaK)))}})(declarations[i],fail("expected declarator",declarations[i]))}function cpsSequence(nodes,i,k,fk){if(i===nodes.length){return cps(build.identifier("undefined"),k)}else if(i+1===nodes.length){return cpsFinalStatement(nodes[i],k,fk)}else{return cpsInnerStatement(nodes[i],cpsSequence(nodes,i+1,k,fk),fk)}}function cpsInnerStatement(node,e,fk){return match(node,[clause(Syntax.BlockStatement,function(body){return cpsSequence(body,0,buildContinuation(genvar("dummy"),e),fk)}),clause(Syntax.EmptyStatement,function(){return e}),clause(Syntax.ExpressionStatement,function(expression){return cps(expression,buildContinuation(genvar("dummy"),e))}),clause(Syntax.IfStatement,function(test,consequent,alternate){if(!alternate){alternate=build.emptyStatement()}var k=buildContinuation(genvar("dummy"),e);return bindContinuation(k,function(k){return atomize(test,function(test){return build.conditionalExpression(test,cpsFinalStatement(consequent,k,fk),cpsFinalStatement(alternate,k,fk))})})}),clause(Syntax.ReturnStatement,function(argument){return cps(argument||build.identifier("undefined"),fk)}),clause(Syntax.VariableDeclaration,function(declarations){return cpsDeclarations(declarations,0,function(id){return buildContinuation(id,e)})}),clause(Syntax.DebuggerStatement,function(){return cps(node,buildContinuation(genvar("debugger"),e))})],fail("cpsInnerStatement",node))}function cpsFinalStatement(node,k,fk){return match(node,[clause(Syntax.BlockStatement,function(body){return cpsSequence(body,0,k,fk)}),clause(Syntax.EmptyStatement,function(){return cps(build.identifier("undefined"),k)}),clause(Syntax.ExpressionStatement,function(expression){return cps(expression,k)}),clause(Syntax.IfStatement,function(test,consequent,alternate){if(!alternate){alternate=build.emptyStatement()}return bindContinuation(k,function(k){return atomize(test,function(test){return build.conditionalExpression(test,cpsFinalStatement(consequent,k,fk),cpsFinalStatement(alternate,k,fk))})})}),clause(Syntax.ReturnStatement,function(argument){return cps(argument||build.identifier("undefined"),fk)}),clause(Syntax.VariableDeclaration,function(declarations){return cpsDeclarations(declarations,0,function(id){return buildContinuation(id,cps(build.identifier("undefined"),k))})}),clause(Syntax.DebuggerStatement,function(){return cps(node,k)})],fail("cpsFinalStatement",node))}function cpsMain(node){genvar=makeGenvar();return inProgram(function(expression){return clause(Syntax.FunctionExpression,function(id,params,body){return cpsFunction(id,params,body)})(expression,fail("cps: expected FunctionExpression",expression))})(node,fail("cps: inProgram",node))}module.exports={cps:cpsMain}},{"../syntax":230,"./builders":235,"ast-types":52,estraverse:118}],238:[function(require,module,exports){"use strict";var _=require("lodash");var Syntax=require("estraverse").Syntax;var replace=require("estraverse").replace;var build=require("ast-types").builders;var types=require("ast-types").types;var makeGensym=require("../util").makeGensym;var genid=null;var boundVarsStack=null;var freeVarsStack=null;var literalIdentifiers={undefined:true,NaN:true,Infinity:true};function identifierIsVar(node,parent){if(literalIdentifiers[node.name])return false;if(parent.type===Syntax.MemberExpression&&!parent.computed&&node===parent.property)return false;if(parent.type===Syntax.Property&&node===parent.key)return false;return true}function enter(node,parent){switch(node.type){case Syntax.FunctionExpression:var boundVars={};for(var i=0;i<node.params.length;i++)boundVars[node.params[i].name]=true;boundVarsStack.push(boundVars);freeVarsStack.push({});break;case Syntax.VariableDeclarator:if(boundVarsStack.length>0)boundVarsStack[boundVarsStack.length-1][node.id.name]=true;break;case Syntax.Identifier:if(boundVarsStack.length>0&&identifierIsVar(node,parent)){if(!boundVarsStack[boundVarsStack.length-1][node.name])freeVarsStack[freeVarsStack.length-1][node.name]=true}break;default:}}function exit(node){switch(node.type){case Syntax.FunctionExpression:var freeVars=freeVarsStack.pop();var freeVarNodes=[];for(var name in freeVars){freeVarNodes.push(build.identifier(name))}boundVarsStack.pop();var wrappedFn=build.callExpression(build.memberExpression(build.identifier("_Fn"),build.identifier("tag"),false),[node,build.literal(genid(0)),build.arrayExpression(freeVarNodes)]);if(freeVarsStack.length>0){var outerFreeVars=freeVarsStack[freeVarsStack.length-1];var outerBoundVars=boundVarsStack[boundVarsStack.length-1];for(var name in freeVars){if(outerBoundVars[name]===undefined)outerFreeVars[name]=true}}return wrappedFn;default:}}function freevarsMain(node){genid=makeGensym();boundVarsStack=[];freeVarsStack=[];return replace(node,{enter:enter,leave:exit})}module.exports={freevars:freevarsMain}},{"../util":246,"ast-types":52,estraverse:118,lodash:124}],239:[function(require,module,exports){"use strict";var _=require("lodash");var Syntax=require("estraverse").Syntax;var replace=require("estraverse").replace;var build=require("./builders");var makeGensym=require("../util").makeGensym;var makeGenvar=require("../syntax").makeGenvar;var inProgram=require("../syntax").inProgram;var fail=require("../syntax").fail;var isPrimitive=require("../syntax").isPrimitive;function makeGenlit(){var gensym=makeGensym();return function(){return build.literal(gensym("_"))}}var genlit=null;var genvar=null;var addresses=[];function makeAddressExtension(address,literal){return build.callExpression(build.memberExpression(address,build.identifier("concat"),false),[literal])}function generating(node){switch(node.type){case Syntax.FunctionExpression:addresses.unshift(genvar("address"));break;default:}}function naming(node,map){switch(node.type){case Syntax.FunctionExpression:return build.functionExpression(node.id,[addresses.shift()].concat(node.params),node.body);case Syntax.CallExpression:if(isPrimitive(node.callee)){return node}else{var lit=genlit();var name=node.callee.type===Syntax.Identifier?node.callee.name:null;map[lit.value]=_.assign({name:name},node.loc);return build.callExpression(node.callee,[makeAddressExtension(addresses[0],lit)].concat(node.arguments),node.loc)}default:}}function namingMain(node){genlit=makeGenlit();genvar=makeGenvar();var map={};var ast=inProgram(function(node){return replace(node,{enter:generating,leave:function(node){return naming(node,map)}})})(node,fail("naming: inProgram",node));return{ast:ast,map:map}}module.exports={naming:namingMain}},{"../syntax":230,"../util":246,"./builders":235,estraverse:118,lodash:124}],240:[function(require,module,exports){"use strict";var esmangle=require("esmangle");var estraverse=require("estraverse");var types=require("ast-types");var build=types.builders;var Syntax=estraverse.Syntax;var fail=require("../syntax").fail;var inProgram=require("../syntax").inProgram;function createPipeline(){var pipeline=["pass/transform-dynamic-to-static-property-access","pass/transform-dynamic-to-static-property-definition","pass/transform-immediate-function-call","pass/transform-logical-association","pass/reordering-function-declarations","pass/remove-unused-label","pass/remove-empty-statement","pass/remove-wasted-blocks","pass/transform-to-compound-assignment","pass/transform-branch-to-expression","pass/transform-typeof-undefined","pass/reduce-sequence-expression","pass/reduce-branch-jump","pass/reduce-multiple-if-statements","pass/dead-code-elimination","pass/remove-side-effect-free-expressions","pass/remove-context-sensitive-expressions","pass/tree-based-constant-folding","pass/drop-variable-definition","pass/eliminate-duplicate-function-declarations"];pipeline=[pipeline.map(esmangle.pass.require)];pipeline.push({once:true,pass:["post/transform-static-to-dynamic-property-access","post/transform-infinity","post/rewrite-boolean","post/rewrite-conditional-expression","post/omit-parens-in-void-context-iife"].map(esmangle.pass.require)});return pipeline}function identifiersEqual(x,y){return types.namedTypes.Identifier.check(x)&&types.namedTypes.Identifier.check(y)&&x.name===y.name}function optimize(node){switch(node.type){case Syntax.BlockStatement:for(var i=0;i<node.body.length;i++){var ithNode=node.body[i];if(types.namedTypes.VariableDeclaration.check(ithNode)){var declaration=ithNode.declarations[0];if(identifiersEqual(declaration.id,declaration.init)){node.body.splice(i,1)}}}return node;case Syntax.ExpressionStatement:if(types.namedTypes.CallExpression.check(node.expression)&&types.namedTypes.FunctionExpression.check(node.expression.callee)){var funcNode=node.expression.callee;var appNode=node.expression;var stmts=[];for(var i=0;i<appNode.arguments.length;i++){var stmt=build.variableDeclaration("var",[build.variableDeclarator(funcNode.params[i],appNode.arguments[i])]);stmts.push(stmt)}stmts.push(funcNode.body);return build.blockStatement(stmts)}else{return node}case Syntax.VariableDeclaration:if(node.declarations.length===1&&node.declarations[0].id.name.slice(0,9)==="_debugger"){return build.debuggerStatement()}else{return node}default:return node}}function optimizeMain(node){return inProgram(function(node){return esmangle.optimize(estraverse.replace(node,{enter:optimize,leave:optimize}),createPipeline(),{inStrictCode:true,legacy:false})})(node,fail("optimize: inBody",node))}module.exports={optimize:optimizeMain}},{"../syntax":230,"ast-types":52,esmangle:71,estraverse:118}],241:[function(require,module,exports){"use strict";var assert=require("assert");var Syntax=require("estraverse").Syntax;var replace=require("estraverse").replace;var build=require("ast-types").builders;var localVarName="_currentAddress";var globalVarName="_globalCurrentAddress";var saveAddressFn=["_addr","save"];function transformFnBody(node){var addressParam=node.params[2];var bindAddress=build.variableDeclaration("var",[build.variableDeclarator(build.identifier(localVarName),addressParam)]);var saveAddress=build.expressionStatement(build.callExpression(build.memberExpression(build.identifier(saveAddressFn[0]),build.identifier(saveAddressFn[1])),[build.identifier(globalVarName),addressParam]));var expr=build.functionExpression(node.id,node.params,build.blockStatement([bindAddress,saveAddress].concat(node.body.body)));expr.loc=node.loc;return expr}function transformContinuation(node){var saveAddress=build.expressionStatement(build.callExpression(build.memberExpression(build.identifier(saveAddressFn[0]),build.identifier(saveAddressFn[1])),[build.identifier(globalVarName),build.identifier(localVarName)]));var expr=build.functionExpression(node.id,node.params,build.blockStatement([saveAddress].concat(node.body.body)));expr.loc=node.loc;return expr}function isWpplFnExpr(node){return node.params.length>=3}function isContinuation(node){return node.params.length===2}function transform(node){switch(node.type){case Syntax.FunctionExpression:if(isContinuation(node)){return transformContinuation(node)}else if(isWpplFnExpr(node)){return transformFnBody(node)}else{throw"unreachable"}default:return node}}function wrapProgram(node){var expr=node.body[0].expression;assert.ok(expr.type===Syntax.CallExpression);return build.program([build.expressionStatement(build.functionExpression(null,[build.identifier(globalVarName)],build.blockStatement([build.returnStatement(expr)])))])}module.exports={transform:function(node){return replace(node,{leave:transform})},wrapProgram:wrapProgram}},{assert:248,"ast-types":52,estraverse:118}],242:[function(require,module,exports){"use strict";var estraverse=require("estraverse");var Syntax=estraverse.Syntax;var build=require("ast-types").builders;var isPrimitive=require("../syntax").isPrimitive;var storeIdNode=build.identifier("globalStore");function store(node){switch(node.type){case Syntax.FunctionExpression:return build.functionExpression(node.id,[storeIdNode].concat(node.params),node.body);case Syntax.CallExpression:if(isPrimitive(node.callee)){return node}else if(node.arguments.length>0&&node.arguments[0].type==="Identifier"&&node.arguments[0].name==="globalStore"){return node}else{return build.callExpression(node.callee,[storeIdNode].concat(node.arguments))}default:return node}}function storeMain(node){return estraverse.replace(node,{leave:store})}module.exports={store:storeMain}},{"../syntax":230,"ast-types":52,estraverse:118}],243:[function(require,module,exports){"use strict";var replace=require("estraverse").replace;var Syntax=require("estraverse").Syntax;var build=require("ast-types").builders;var types=require("ast-types").namedTypes;var parse=require("esprima").parse;var fail=require("../syntax").fail;var inProgram=require("../syntax").inProgram;var isPrimitive=require("../syntax").isPrimitive;var util=require("../util");var _=require("lodash");function thunkify(node){return build.functionExpression(null,[],build.blockStatement([build.returnStatement(node)]),false,false)}function skip(node){if(types.ReturnStatement.check(node)){this.skip()}}function trampoline(node){switch(node.type){case Syntax.ExpressionStatement:switch(node.expression.type){case Syntax.CallExpression:if(isPrimitive(node.expression.callee)){return node}else{return build.returnStatement(thunkify(node.expression))}default:return build.returnStatement(thunkify(node.expression))}default:return node}}var driverFn=function(p){return function(runTrampoline){return function(s,k,a){runTrampoline(function(){return p(s,k,a)})}}};var driver=parse("("+driverFn.toString()+")").body[0].expression;function trampolineMain(node){var r=inProgram(function(node){return build.callExpression(driver,[replace(node,{enter:skip,leave:trampoline})])})(node,fail("trampoline",node));return r}module.exports={trampoline:trampolineMain}},{"../syntax":230,"../util":246,"ast-types":52,esprima:111,estraverse:118,lodash:124}],244:[function(require,module,exports){"use strict";var assert=require("assert");var estraverse=require("estraverse");var types=require("ast-types");var esprima=require("esprima");var Syntax=estraverse.Syntax;var argumentsIdCounter=0;function makeArgumentsIdentifier(){argumentsIdCounter+=1;return"_arguments"+argumentsIdCounter}var fnStack=[];function pushFn(node){if(node.type===Syntax.FunctionExpression){fnStack.push(node)}}function popFn(node){if(node.type===Syntax.FunctionExpression){assert.strictEqual(node,fnStack[fnStack.length-1]);fnStack.pop()}}function getEnclosingFunctionNode(){if(fnStack.length===0){throw new Error('Used "arguments" outside of function context!')}return fnStack[fnStack.length-1]}function varargs(node){switch(node.type){case Syntax.Identifier:if(node.name!=="arguments"){return node}var functionNode=getEnclosingFunctionNode();var argumentsId=functionNode.argumentsId||makeArgumentsIdentifier();node.name=argumentsId;if(functionNode.argumentsId===undefined){functionNode.argumentsId=argumentsId;assert.equal(functionNode.body.type,"BlockStatement");var argsDeclaration=esprima.parse("var REPLACEME = Array.prototype.slice.call(arguments, 3);").body[0];argsDeclaration.declarations[0].id.name=argumentsId;functionNode.body.body=[argsDeclaration].concat(functionNode.body.body)}return node;default:return node}}function varargsMain(node){node=estraverse.replace(node,{enter:function(node){pushFn(node);return varargs(node)},leave:function(node){popFn(node)}});return node}module.exports={varargs:varargsMain}},{assert:248,"ast-types":52,esprima:111,estraverse:118}],245:[function(require,module,exports){"use strict";var _=require("lodash");var util=require("./util");var numeric=require("./math/numeric");var interval=require("./math/interval");var isInterval=interval.isInterval;var parseInterval=interval.parse;var checkInterval=interval.check;function errorIfNotInterval(arg){if(!isInterval(arg)){throw new Error("Interval expected.")}}function appendInterval(name,interval){return interval.isBounded?name+" "+interval:name}var any={name:"any",desc:"any",check:function(val){return true}};var int=function(low){if(!util.isInteger(low)&&low!==-Infinity){throw new Error("Lower bound expected.")}return{name:"int",desc:"int (>="+low+")",check:function(val){return util.isInteger(val)&&val>=low}}};var real=function(interval){errorIfNotInterval(interval);var checkBounds=checkInterval(interval);return{name:"real",desc:appendInterval("real",interval),bounds:interval,check:function(val){return typeof val==="number"&&checkBounds(val)}}};var array=function(elementType){return{name:"array",desc:elementType.desc+" array",elementType:elementType,check:function(val){return Array.isArray(val)&&(elementType===any||val.every(elementType.check))}}};var vector=function(interval,performBoundsCheck){errorIfNotInterval(interval);var checkBounds=checkInterval(interval);return{name:"vector",desc:appendInterval("vector",interval),bounds:interval,check:performBoundsCheck?function(val){return util.isVector(val)&&_.every(val.data,checkBounds)}:util.isVector}};var vectorOrRealArray=function(interval){errorIfNotInterval(interval);var vectorType=vector(interval,true);var realArrayType=array(real(interval));return{name:"vectorOrRealArray",desc:appendInterval("vector or real array",interval),bounds:interval,check:function(val){return vectorType.check(val)||realArrayType.check(val)}}};var posDefMatrix={name:"posDefMatrix",desc:"positive definite matrix",check:function(val){return util.isMatrix(val)&&val.dims[0]===val.dims[1]}};var tensor=function(interval,performBoundsCheck){errorIfNotInterval(interval);var checkBounds=checkInterval(interval);return{name:"tensor",desc:appendInterval("tensor",interval),bounds:interval,check:performBoundsCheck?function(val){return util.isTensor(val)&&_.every(val.data,checkBounds)}:util.isTensor}};var probabilityArray=function(){var tol=1e-8;var baseType=array(real(parseInterval("[0, Infinity)")));return{name:"probabilityArray",desc:"real array with elements that sum to one",check:function(val){return baseType.check(val)&&Math.abs(1-numeric._sum(val))<tol}}};module.exports={any:any,int:int,real:real,array:array,vector:vector,vectorOrRealArray:vectorOrRealArray,posDefMatrix:posDefMatrix,tensor:tensor,probabilityArray:probabilityArray(),unboundedInt:int(-Infinity),nonNegativeInt:int(0),positiveInt:int(1),unboundedReal:real(parseInterval("(-Infinity, Infinity)")),extendedReal:real(parseInterval("[-Infinity, Infinity]")),positiveReal:real(parseInterval("(0, Infinity)")),unitInterval:real(parseInterval("[0, 1]")),unboundedVector:vector(parseInterval("(-Infinity, Infinity)")),nonNegativeVector:vector(parseInterval("[0, Infinity)")),positiveVector:vector(parseInterval("(0, Infinity)")),positiveVectorCB:vector(parseInterval("(0, Infinity)"),true),unitIntervalVector:vector(parseInterval("[0, 1]")),unboundedVectorOrRealArray:vectorOrRealArray(parseInterval("(-Infinity, Infinity)")),nonNegativeVectorOrRealArray:vectorOrRealArray(parseInterval("[0, Infinity)")),unboundedTensor:tensor(parseInterval("(-Infinity, Infinity)")),positiveTensor:tensor(parseInterval("(0, Infinity)"))}},{"./math/interval":217,"./math/numeric":218,"./util":246,lodash:124}],246:[function(require,module,exports){(function(global){"use strict";var _=require("lodash");var assert=require("assert");var seedrandom=require("seedrandom");var ad=require("./ad");var Tensor=require("./tensor");var numeric=require("./math/numeric");var rng=Math.random;var sum=numeric._sum;var logsumexp=numeric._logsumexp;var trampolineRunners={web:function(yieldEvery){yieldEvery=yieldEvery||100;var f=function(t,wrappedF){var lastPauseTime=Date.now();if(f.__cancel__){f.__cancel__=false}else{while(t){var currTime=Date.now();if(currTime-lastPauseTime>yieldEvery){return setTimeout(function(){wrappedF(t,wrappedF)},0)}else{t=t()}}}};return f},cli:function(){return function(t){while(t){t=t()}}}};function random(){return rng()}function seedRNG(seed){rng=seedrandom(seed)}function resetRNG(){rng=Math.random}function assertValidRandomSeed(seed){var msg="Random seed should be a positive integer.";assert(_.isFinite(seed)&&seed>=0,msg)}function runningInBrowser(){return typeof window!=="undefined"}function makeGensym(){var seq=0;return function(prefix){var result=prefix+seq;seq+=1;return result}}var gensym=makeGensym();function prettyJSON(obj){console.log(JSON.stringify(obj,null,2))}function asArray(arg){return arg?[].concat(arg):[]}var deleteIndex=function(arr,i){return arr.slice(0,i).concat(arr.slice(i+1))};function cpsForEach(func,cont,xs,i){i=i===undefined?0:i;if(i===xs.length){return cont()}else{return func(xs[i],i,xs,function(){return function(){return cpsForEach(func,cont,xs,i+1)}})}}function cpsLoop(n,func,cont){function loop(i){if(i===n){return cont()}else{return func(i,function(){return function(){return loop(i+1)}})}}assert(_.isNumber(n),"Number expected.");return loop(0)}function cpsIterate(n,initial,func,cont){var val=initial;return cpsLoop(n,function(i,next){return func(function(nextVal){val=nextVal;return next()},val)},function(){return cont(val)})}function histExpectation(hist,func){var f=func||_.identity;return _.reduce(hist,function(acc,obj){return acc+obj.prob*f(obj.val)},0)}function histStd(hist){var m=histExpectation(hist);return Math.sqrt(histExpectation(hist,function(x){return Math.pow(x-m,2)}))}function sameKeys(obj1,obj2){return _.size(obj1)===_.size(obj2)&&_.every(_.keys(obj1),function(key){return _.has(obj2,key)})}function histsApproximatelyEqual(actualHist,expectedHist,tolerance,exactSupport){if(expectedHist===undefined||actualHist===undefined){return false}if(exactSupport&&!sameKeys(actualHist,expectedHist)){return false}return _.every(expectedHist,function(expectedValue,key){var value=actualHist[key]||0;return Math.abs(value-expectedValue)<=tolerance})}function mergeDefaults(options,defaults,callerName){if(callerName){if(options!==undefined&&!_.isObject(options)){var msg=callerName+" expected an options object but received: "+JSON.stringify(options);throw new Error(msg)}var extra=_.difference(_.keys(options),_.keys(defaults));extra.forEach(function(name){warn('Warning: Unused option "'+name+'" given to '+callerName+".")})}return _.defaults(options?_.clone(options):{},defaults)}function getValAndOpts(obj,cont){var args;if(_.isString(obj)){args=[obj,{}]}else{if(_.size(obj)!==1){throw"Expected an object with a single key but received: "+JSON.stringify(obj)}var key=_.keys(obj)[0];args=[key,obj[key]]}return cont.apply(null,args)}function InfToJSON(k,v){if(v===Infinity){return"Infinity"}else if(v===-Infinity){return"-Infinity"}else{return v}}function InfFromJSON(k,v){if(v==="Infinity"){return Infinity}else if(v==="-Infinity"){return-Infinity}else{return v}}function serialize(o){return JSON.stringify(o,InfToJSON)}function deserialize(o){return JSON.parse(o,InfFromJSON)}function time(name,thunk){if(console.time){console.time(name);var ret=thunk();console.timeEnd(name);return ret}else{return thunk()}}function timeif(bool,name,thunk){return bool?time(name,thunk):thunk()}var warningsIssued={};function resetWarnings(){warningsIssued={}}function warn(msg,onceOnly){if(!global.suppressWarnings&&(!onceOnly||!_.has(warningsIssued,msg))){console.warn(msg);if(onceOnly){warningsIssued[msg]=true}}}function error(msg){throw new Error(msg)}function jsthrow(obj){throw obj}function isInteger(x){return typeof x==="number"&&isFinite(x)&&Math.floor(x)===x}function isObject(x){return x!==undefined&&x!==null&&typeof x==="object"&&Object.getPrototypeOf(x)===Object.prototype}function isTensor(t){return t instanceof Tensor}function isMatrix(t){return t instanceof Tensor&&t.rank===2}function isVector(t){return t instanceof Tensor&&t.rank===2&&t.dims[1]===1}function tensorEqDim0(v,w){return v.dims[0]===w.dims[0]}function tensorEqDims(t1,t2){if(t1.dims.length!==t2.dims.length){return false}for(var i=0;i<t1.dims.length;i++){if(t1.dims[i]!==t2.dims[i]){return false}}return true}function idMatrix(n){if(n<=0){throw new Error("n should be > 0.")}var out=new Tensor([n,n]);for(var i=0;i<n;i++){out.data[i*(n+1)]=1}return out}function oneHot(index,length){if(length<=0){throw new Error("length should be > 0.")}if(index<0||index>=length){throw new Error("index out of bounds")}var out=new Tensor([length,1]);out.data[index]=1;return out}function relativizeAddress(baseAddress,address){assert.ok(address.slice(0,baseAddress.length)===baseAddress,"Address prefix mismatch.");return address.slice(baseAddress.length)}module.exports={trampolineRunners:trampolineRunners,random:random,seedRNG:seedRNG,resetRNG:resetRNG,assertValidRandomSeed:assertValidRandomSeed,cpsForEach:cpsForEach,cpsLoop:cpsLoop,cpsIterate:cpsIterate,histExpectation:histExpectation,histStd:histStd,histsApproximatelyEqual:histsApproximatelyEqual,gensym:gensym,deleteIndex:deleteIndex,makeGensym:makeGensym,prettyJSON:prettyJSON,runningInBrowser:runningInBrowser,mergeDefaults:mergeDefaults,getValAndOpts:getValAndOpts,sum:sum,logsumexp:logsumexp,asArray:asArray,serialize:serialize,deserialize:deserialize,timeif:timeif,warn:warn,resetWarnings:resetWarnings,error:error,jsthrow:jsthrow,isInteger:isInteger,isObject:isObject,isTensor:isTensor,isVector:isVector,isMatrix:isMatrix,tensorEqDim0:tensorEqDim0,tensorEqDims:tensorEqDims,idMatrix:idMatrix,oneHot:oneHot,relativizeAddress:relativizeAddress}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./ad":151,"./math/numeric":218,"./tensor":231,assert:248,lodash:124,seedrandom:130}],247:[function(require,module,exports){arguments[4][150][0].apply(exports,arguments)},{dup:150}],248:[function(require,module,exports){(function(global){"use strict";function compare(a,b){if(a===b){return 0}var x=a.length;var y=b.length;for(var i=0,len=Math.min(x,y);i<len;++i){if(a[i]!==b[i]){x=a[i];y=b[i];break}}if(x<y){return-1}if(y<x){return 1}return 0}function isBuffer(b){if(global.Buffer&&typeof global.Buffer.isBuffer==="function"){return global.Buffer.isBuffer(b)}return!!(b!=null&&b._isBuffer)}var util=require("util/");var hasOwn=Object.prototype.hasOwnProperty;var pSlice=Array.prototype.slice;var functionsHaveNames=function(){return function foo(){}.name==="foo"}();function pToString(obj){return Object.prototype.toString.call(obj)}function isView(arrbuf){if(isBuffer(arrbuf)){return false}if(typeof global.ArrayBuffer!=="function"){return false}if(typeof ArrayBuffer.isView==="function"){return ArrayBuffer.isView(arrbuf)}if(!arrbuf){return false}if(arrbuf instanceof DataView){return true}if(arrbuf.buffer&&arrbuf.buffer instanceof ArrayBuffer){return true}return false}var assert=module.exports=ok;var regex=/\s*function\s+([^\(\s]*)\s*/;function getName(func){if(!util.isFunction(func)){return}if(functionsHaveNames){return func.name}var str=func.toString();var match=str.match(regex);return match&&match[1]}assert.AssertionError=function AssertionError(options){this.name="AssertionError";this.actual=options.actual;this.expected=options.expected;this.operator=options.operator;if(options.message){this.message=options.message;this.generatedMessage=false}else{this.message=getMessage(this);this.generatedMessage=true}var stackStartFunction=options.stackStartFunction||fail;if(Error.captureStackTrace){Error.captureStackTrace(this,stackStartFunction)}else{var err=new Error;if(err.stack){var out=err.stack;var fn_name=getName(stackStartFunction);var idx=out.indexOf("\n"+fn_name);if(idx>=0){var next_line=out.indexOf("\n",idx+1);out=out.substring(next_line+1)}this.stack=out}}};util.inherits(assert.AssertionError,Error);function truncate(s,n){if(typeof s==="string"){return s.length<n?s:s.slice(0,n)}else{return s}}function inspect(something){if(functionsHaveNames||!util.isFunction(something)){return util.inspect(something)}var rawname=getName(something);var name=rawname?": "+rawname:"";return"[Function"+name+"]"}function getMessage(self){return truncate(inspect(self.actual),128)+" "+self.operator+" "+truncate(inspect(self.expected),128)}function fail(actual,expected,message,operator,stackStartFunction){throw new assert.AssertionError({message:message,actual:actual,expected:expected,operator:operator,stackStartFunction:stackStartFunction})}assert.fail=fail;function ok(value,message){if(!value)fail(value,true,message,"==",assert.ok)}assert.ok=ok;assert.equal=function equal(actual,expected,message){if(actual!=expected)fail(actual,expected,message,"==",assert.equal)};assert.notEqual=function notEqual(actual,expected,message){if(actual==expected){fail(actual,expected,message,"!=",assert.notEqual)}};assert.deepEqual=function deepEqual(actual,expected,message){if(!_deepEqual(actual,expected,false)){fail(actual,expected,message,"deepEqual",assert.deepEqual)}};assert.deepStrictEqual=function deepStrictEqual(actual,expected,message){if(!_deepEqual(actual,expected,true)){fail(actual,expected,message,"deepStrictEqual",assert.deepStrictEqual)}};function _deepEqual(actual,expected,strict,memos){if(actual===expected){return true}else if(isBuffer(actual)&&isBuffer(expected)){return compare(actual,expected)===0}else if(util.isDate(actual)&&util.isDate(expected)){return actual.getTime()===expected.getTime()}else if(util.isRegExp(actual)&&util.isRegExp(expected)){return actual.source===expected.source&&actual.global===expected.global&&actual.multiline===expected.multiline&&actual.lastIndex===expected.lastIndex&&actual.ignoreCase===expected.ignoreCase}else if((actual===null||typeof actual!=="object")&&(expected===null||typeof expected!=="object")){return strict?actual===expected:actual==expected}else if(isView(actual)&&isView(expected)&&pToString(actual)===pToString(expected)&&!(actual instanceof Float32Array||actual instanceof Float64Array)){return compare(new Uint8Array(actual.buffer),new Uint8Array(expected.buffer))===0}else if(isBuffer(actual)!==isBuffer(expected)){return false}else{memos=memos||{actual:[],expected:[]};var actualIndex=memos.actual.indexOf(actual);if(actualIndex!==-1){if(actualIndex===memos.expected.indexOf(expected)){return true}}memos.actual.push(actual);memos.expected.push(expected);return objEquiv(actual,expected,strict,memos)}}function isArguments(object){return Object.prototype.toString.call(object)=="[object Arguments]"}function objEquiv(a,b,strict,actualVisitedObjects){if(a===null||a===undefined||b===null||b===undefined)return false;if(util.isPrimitive(a)||util.isPrimitive(b))return a===b;if(strict&&Object.getPrototypeOf(a)!==Object.getPrototypeOf(b))return false;var aIsArgs=isArguments(a);var bIsArgs=isArguments(b);if(aIsArgs&&!bIsArgs||!aIsArgs&&bIsArgs)return false;if(aIsArgs){a=pSlice.call(a);b=pSlice.call(b);return _deepEqual(a,b,strict)}var ka=objectKeys(a);var kb=objectKeys(b);var key,i;if(ka.length!==kb.length)return false;ka.sort();kb.sort();for(i=ka.length-1;i>=0;i--){if(ka[i]!==kb[i])return false}for(i=ka.length-1;i>=0;i--){key=ka[i];if(!_deepEqual(a[key],b[key],strict,actualVisitedObjects))return false}return true}assert.notDeepEqual=function notDeepEqual(actual,expected,message){if(_deepEqual(actual,expected,false)){fail(actual,expected,message,"notDeepEqual",assert.notDeepEqual)}};assert.notDeepStrictEqual=notDeepStrictEqual;function notDeepStrictEqual(actual,expected,message){if(_deepEqual(actual,expected,true)){fail(actual,expected,message,"notDeepStrictEqual",notDeepStrictEqual)}}assert.strictEqual=function strictEqual(actual,expected,message){if(actual!==expected){fail(actual,expected,message,"===",assert.strictEqual)}};assert.notStrictEqual=function notStrictEqual(actual,expected,message){if(actual===expected){fail(actual,expected,message,"!==",assert.notStrictEqual)}};function expectedException(actual,expected){if(!actual||!expected){return false}if(Object.prototype.toString.call(expected)=="[object RegExp]"){return expected.test(actual)}try{if(actual instanceof expected){return true}}catch(e){}if(Error.isPrototypeOf(expected)){return false}return expected.call({},actual)===true}function _tryBlock(block){var error;try{block()}catch(e){error=e}return error}function _throws(shouldThrow,block,expected,message){var actual;if(typeof block!=="function"){throw new TypeError('"block" argument must be a function')}if(typeof expected==="string"){message=expected;expected=null}actual=_tryBlock(block);message=(expected&&expected.name?" ("+expected.name+").":".")+(message?" "+message:".");if(shouldThrow&&!actual){fail(actual,expected,"Missing expected exception"+message)}var userProvidedMessage=typeof message==="string";var isUnwantedException=!shouldThrow&&util.isError(actual);var isUnexpectedException=!shouldThrow&&actual&&!expected;if(isUnwantedException&&userProvidedMessage&&expectedException(actual,expected)||isUnexpectedException){fail(actual,expected,"Got unwanted exception"+message)}if(shouldThrow&&actual&&expected&&!expectedException(actual,expected)||!shouldThrow&&actual){throw actual}}assert.throws=function(block,error,message){_throws(true,block,error,message)};assert.doesNotThrow=function(block,error,message){_throws(false,block,error,message)};assert.ifError=function(err){if(err)throw err};var objectKeys=Object.keys||function(obj){var keys=[];for(var key in obj){if(hasOwn.call(obj,key))keys.push(key)}return keys}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"util/":254}],249:[function(require,module,exports){},{}],250:[function(require,module,exports){(function(process){function normalizeArray(parts,allowAboveRoot){var up=0;for(var i=parts.length-1;i>=0;i--){var last=parts[i];if(last==="."){parts.splice(i,1)}else if(last===".."){parts.splice(i,1);up++}else if(up){parts.splice(i,1);up--}}if(allowAboveRoot){for(;up--;up){parts.unshift("..")}}return parts}var splitPathRe=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/;var splitPath=function(filename){return splitPathRe.exec(filename).slice(1)};exports.resolve=function(){var resolvedPath="",resolvedAbsolute=false;for(var i=arguments.length-1;i>=-1&&!resolvedAbsolute;i--){var path=i>=0?arguments[i]:process.cwd();if(typeof path!=="string"){throw new TypeError("Arguments to path.resolve must be strings")}else if(!path){continue}resolvedPath=path+"/"+resolvedPath;resolvedAbsolute=path.charAt(0)==="/"}resolvedPath=normalizeArray(filter(resolvedPath.split("/"),function(p){return!!p}),!resolvedAbsolute).join("/");return(resolvedAbsolute?"/":"")+resolvedPath||"."};exports.normalize=function(path){var isAbsolute=exports.isAbsolute(path),trailingSlash=substr(path,-1)==="/";path=normalizeArray(filter(path.split("/"),function(p){return!!p}),!isAbsolute).join("/");if(!path&&!isAbsolute){path="."}if(path&&trailingSlash){path+="/"}return(isAbsolute?"/":"")+path};exports.isAbsolute=function(path){return path.charAt(0)==="/"};exports.join=function(){var paths=Array.prototype.slice.call(arguments,0);return exports.normalize(filter(paths,function(p,index){if(typeof p!=="string"){throw new TypeError("Arguments to path.join must be strings")}return p}).join("/"))};exports.relative=function(from,to){from=exports.resolve(from).substr(1);to=exports.resolve(to).substr(1);function trim(arr){var start=0;for(;start<arr.length;start++){if(arr[start]!=="")break}var end=arr.length-1;for(;end>=0;end--){if(arr[end]!=="")break}if(start>end)return[];return arr.slice(start,end-start+1)}var fromParts=trim(from.split("/"));var toParts=trim(to.split("/"));var length=Math.min(fromParts.length,toParts.length);var samePartsLength=length;for(var i=0;i<length;i++){if(fromParts[i]!==toParts[i]){samePartsLength=i;break}}var outputParts=[];for(var i=samePartsLength;i<fromParts.length;i++){outputParts.push("..")}outputParts=outputParts.concat(toParts.slice(samePartsLength));return outputParts.join("/")};exports.sep="/";exports.delimiter=":";exports.dirname=function(path){var result=splitPath(path),root=result[0],dir=result[1];if(!root&&!dir){return"."}if(dir){dir=dir.substr(0,dir.length-1)}return root+dir};exports.basename=function(path,ext){var f=splitPath(path)[2];if(ext&&f.substr(-1*ext.length)===ext){f=f.substr(0,f.length-ext.length)}return f};exports.extname=function(path){return splitPath(path)[3]};function filter(xs,f){if(xs.filter)return xs.filter(f);var res=[];for(var i=0;i<xs.length;i++){if(f(xs[i],i,xs))res.push(xs[i])}return res}var substr="ab".substr(-1)==="b"?function(str,start,len){return str.substr(start,len)}:function(str,start,len){if(start<0)start=str.length+start;return str.substr(start,len)}}).call(this,require("_process"))},{_process:251}],251:[function(require,module,exports){var process=module.exports={};var cachedSetTimeout;var cachedClearTimeout;function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}(function(){try{if(typeof setTimeout==="function"){cachedSetTimeout=setTimeout}else{cachedSetTimeout=defaultSetTimout}}catch(e){cachedSetTimeout=defaultSetTimout}try{if(typeof clearTimeout==="function"){cachedClearTimeout=clearTimeout}else{cachedClearTimeout=defaultClearTimeout}}catch(e){cachedClearTimeout=defaultClearTimeout}})();function runTimeout(fun){if(cachedSetTimeout===setTimeout){return setTimeout(fun,0)}if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout){cachedSetTimeout=setTimeout;return setTimeout(fun,0)}try{return cachedSetTimeout(fun,0)}catch(e){try{return cachedSetTimeout.call(null,fun,0)}catch(e){return cachedSetTimeout.call(this,fun,0)}}}function runClearTimeout(marker){if(cachedClearTimeout===clearTimeout){return clearTimeout(marker)}if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout){cachedClearTimeout=clearTimeout;return clearTimeout(marker)}try{return cachedClearTimeout(marker)}catch(e){try{return cachedClearTimeout.call(null,marker)}catch(e){return cachedClearTimeout.call(this,marker)}}}var queue=[];var draining=false;var currentQueue;var queueIndex=-1;function cleanUpNextTick(){if(!draining||!currentQueue){return}draining=false;if(currentQueue.length){queue=currentQueue.concat(queue)}else{queueIndex=-1}if(queue.length){drainQueue()}}function drainQueue(){if(draining){return}var timeout=runTimeout(cleanUpNextTick);draining=true;var len=queue.length;while(len){currentQueue=queue;queue=[];while(++queueIndex<len){if(currentQueue){currentQueue[queueIndex].run()}}queueIndex=-1;len=queue.length}currentQueue=null;draining=false;runClearTimeout(timeout)}process.nextTick=function(fun){var args=new Array(arguments.length-1);if(arguments.length>1){for(var i=1;i<arguments.length;i++){args[i-1]=arguments[i]}}queue.push(new Item(fun,args));if(queue.length===1&&!draining){runTimeout(drainQueue)}};function Item(fun,array){this.fun=fun;this.array=array}Item.prototype.run=function(){this.fun.apply(null,this.array)};process.title="browser";process.browser=true;process.env={};process.argv=[];process.version="";process.versions={};function noop(){}process.on=noop;process.addListener=noop;process.once=noop;process.off=noop;process.removeListener=noop;process.removeAllListeners=noop;process.emit=noop;process.prependListener=noop;process.prependOnceListener=noop;process.listeners=function(name){return[]};process.binding=function(name){throw new Error("process.binding is not supported")};process.cwd=function(){return"/"};process.chdir=function(dir){throw new Error("process.chdir is not supported")};process.umask=function(){return 0}},{}],252:[function(require,module,exports){if(typeof Object.create==="function"){module.exports=function inherits(ctor,superCtor){ctor.super_=superCtor;ctor.prototype=Object.create(superCtor.prototype,{constructor:{value:ctor,enumerable:false,writable:true,configurable:true}})}}else{module.exports=function inherits(ctor,superCtor){ctor.super_=superCtor;var TempCtor=function(){};TempCtor.prototype=superCtor.prototype;ctor.prototype=new TempCtor;ctor.prototype.constructor=ctor}}},{}],253:[function(require,module,exports){module.exports=function isBuffer(arg){return arg&&typeof arg==="object"&&typeof arg.copy==="function"&&typeof arg.fill==="function"&&typeof arg.readUInt8==="function"}},{}],254:[function(require,module,exports){(function(process,global){var formatRegExp=/%[sdj%]/g;exports.format=function(f){if(!isString(f)){var objects=[];for(var i=0;i<arguments.length;i++){objects.push(inspect(arguments[i]))}return objects.join(" ")}var i=1;var args=arguments;var len=args.length;var str=String(f).replace(formatRegExp,function(x){if(x==="%%")return"%";if(i>=len)return x;switch(x){case"%s":return String(args[i++]);case"%d":return Number(args[i++]);case"%j":try{return JSON.stringify(args[i++])}catch(_){return"[Circular]"}default:return x}});for(var x=args[i];i<len;x=args[++i]){if(isNull(x)||!isObject(x)){str+=" "+x}else{str+=" "+inspect(x)}}return str};exports.deprecate=function(fn,msg){if(isUndefined(global.process)){return function(){return exports.deprecate(fn,msg).apply(this,arguments)}}if(process.noDeprecation===true){return fn}var warned=false;function deprecated(){if(!warned){if(process.throwDeprecation){throw new Error(msg)}else if(process.traceDeprecation){console.trace(msg)}else{console.error(msg)}warned=true}return fn.apply(this,arguments)}return deprecated};var debugs={};var debugEnviron;exports.debuglog=function(set){if(isUndefined(debugEnviron))debugEnviron=process.env.NODE_DEBUG||"";set=set.toUpperCase();if(!debugs[set]){if(new RegExp("\\b"+set+"\\b","i").test(debugEnviron)){var pid=process.pid;debugs[set]=function(){var msg=exports.format.apply(exports,arguments);console.error("%s %d: %s",set,pid,msg)}}else{debugs[set]=function(){}}}return debugs[set]};function inspect(obj,opts){var ctx={seen:[],stylize:stylizeNoColor};if(arguments.length>=3)ctx.depth=arguments[2];if(arguments.length>=4)ctx.colors=arguments[3];if(isBoolean(opts)){ctx.showHidden=opts}else if(opts){exports._extend(ctx,opts)}if(isUndefined(ctx.showHidden))ctx.showHidden=false;if(isUndefined(ctx.depth))ctx.depth=2;if(isUndefined(ctx.colors))ctx.colors=false;if(isUndefined(ctx.customInspect))ctx.customInspect=true;if(ctx.colors)ctx.stylize=stylizeWithColor;return formatValue(ctx,obj,ctx.depth)}exports.inspect=inspect;inspect.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]};inspect.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"};function stylizeWithColor(str,styleType){var style=inspect.styles[styleType];if(style){return"\x1b["+inspect.colors[style][0]+"m"+str+"\x1b["+inspect.colors[style][1]+"m"}else{return str}}function stylizeNoColor(str,styleType){return str}function arrayToHash(array){var hash={};array.forEach(function(val,idx){hash[val]=true});return hash}function formatValue(ctx,value,recurseTimes){if(ctx.customInspect&&value&&isFunction(value.inspect)&&value.inspect!==exports.inspect&&!(value.constructor&&value.constructor.prototype===value)){var ret=value.inspect(recurseTimes,ctx);if(!isString(ret)){ret=formatValue(ctx,ret,recurseTimes)}return ret}var primitive=formatPrimitive(ctx,value);if(primitive){return primitive}var keys=Object.keys(value);var visibleKeys=arrayToHash(keys);if(ctx.showHidden){keys=Object.getOwnPropertyNames(value)}if(isError(value)&&(keys.indexOf("message")>=0||keys.indexOf("description")>=0)){return formatError(value)}if(keys.length===0){if(isFunction(value)){var name=value.name?": "+value.name:"";return ctx.stylize("[Function"+name+"]","special")}if(isRegExp(value)){return ctx.stylize(RegExp.prototype.toString.call(value),"regexp")}if(isDate(value)){return ctx.stylize(Date.prototype.toString.call(value),"date")}if(isError(value)){return formatError(value)}}var base="",array=false,braces=["{","}"];if(isArray(value)){array=true;braces=["[","]"]}if(isFunction(value)){var n=value.name?": "+value.name:"";base=" [Function"+n+"]"}if(isRegExp(value)){base=" "+RegExp.prototype.toString.call(value)}if(isDate(value)){base=" "+Date.prototype.toUTCString.call(value)}if(isError(value)){base=" "+formatError(value)}if(keys.length===0&&(!array||value.length==0)){return braces[0]+base+braces[1]}if(recurseTimes<0){if(isRegExp(value)){return ctx.stylize(RegExp.prototype.toString.call(value),"regexp")}else{return ctx.stylize("[Object]","special")}}ctx.seen.push(value);var output;if(array){output=formatArray(ctx,value,recurseTimes,visibleKeys,keys)}else{output=keys.map(function(key){return formatProperty(ctx,value,recurseTimes,visibleKeys,key,array)})}ctx.seen.pop();return reduceToSingleString(output,base,braces)}function formatPrimitive(ctx,value){if(isUndefined(value))return ctx.stylize("undefined","undefined");if(isString(value)){var simple="'"+JSON.stringify(value).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return ctx.stylize(simple,"string")}if(isNumber(value))return ctx.stylize(""+value,"number");if(isBoolean(value))return ctx.stylize(""+value,"boolean");if(isNull(value))return ctx.stylize("null","null")}function formatError(value){return"["+Error.prototype.toString.call(value)+"]"}function formatArray(ctx,value,recurseTimes,visibleKeys,keys){var output=[];for(var i=0,l=value.length;i<l;++i){if(hasOwnProperty(value,String(i))){output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,String(i),true))}else{output.push("")}}keys.forEach(function(key){if(!key.match(/^\d+$/)){output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,key,true))}});return output}function formatProperty(ctx,value,recurseTimes,visibleKeys,key,array){var name,str,desc;desc=Object.getOwnPropertyDescriptor(value,key)||{value:value[key]};if(desc.get){if(desc.set){str=ctx.stylize("[Getter/Setter]","special")}else{str=ctx.stylize("[Getter]","special")}}else{if(desc.set){str=ctx.stylize("[Setter]","special")}}if(!hasOwnProperty(visibleKeys,key)){name="["+key+"]"}if(!str){if(ctx.seen.indexOf(desc.value)<0){if(isNull(recurseTimes)){str=formatValue(ctx,desc.value,null)}else{str=formatValue(ctx,desc.value,recurseTimes-1)}if(str.indexOf("\n")>-1){if(array){str=str.split("\n").map(function(line){return"  "+line}).join("\n").substr(2)}else{str="\n"+str.split("\n").map(function(line){return"   "+line}).join("\n")}}}else{str=ctx.stylize("[Circular]","special")}}if(isUndefined(name)){if(array&&key.match(/^\d+$/)){return str}name=JSON.stringify(""+key);if(name.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)){name=name.substr(1,name.length-2);name=ctx.stylize(name,"name")}else{name=name.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'");name=ctx.stylize(name,"string")}}return name+": "+str}function reduceToSingleString(output,base,braces){var numLinesEst=0;var length=output.reduce(function(prev,cur){numLinesEst++;if(cur.indexOf("\n")>=0)numLinesEst++;return prev+cur.replace(/\u001b\[\d\d?m/g,"").length+1},0);if(length>60){return braces[0]+(base===""?"":base+"\n ")+" "+output.join(",\n  ")+" "+braces[1]}return braces[0]+base+" "+output.join(", ")+" "+braces[1]}function isArray(ar){return Array.isArray(ar)}exports.isArray=isArray;function isBoolean(arg){return typeof arg==="boolean"}exports.isBoolean=isBoolean;function isNull(arg){return arg===null}exports.isNull=isNull;function isNullOrUndefined(arg){return arg==null}exports.isNullOrUndefined=isNullOrUndefined;function isNumber(arg){return typeof arg==="number"}exports.isNumber=isNumber;function isString(arg){return typeof arg==="string"}exports.isString=isString;function isSymbol(arg){return typeof arg==="symbol"}exports.isSymbol=isSymbol;function isUndefined(arg){return arg===void 0}exports.isUndefined=isUndefined;function isRegExp(re){return isObject(re)&&objectToString(re)==="[object RegExp]"}exports.isRegExp=isRegExp;function isObject(arg){return typeof arg==="object"&&arg!==null}exports.isObject=isObject;function isDate(d){return isObject(d)&&objectToString(d)==="[object Date]"}exports.isDate=isDate;function isError(e){return isObject(e)&&(objectToString(e)==="[object Error]"||e instanceof Error)}exports.isError=isError;function isFunction(arg){return typeof arg==="function"}exports.isFunction=isFunction;function isPrimitive(arg){return arg===null||typeof arg==="boolean"||typeof arg==="number"||typeof arg==="string"||typeof arg==="symbol"||typeof arg==="undefined"}exports.isPrimitive=isPrimitive;exports.isBuffer=require("./support/isBuffer");function objectToString(o){return Object.prototype.toString.call(o)}function pad(n){return n<10?"0"+n.toString(10):n.toString(10)}var months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function timestamp(){var d=new Date;var time=[pad(d.getHours()),pad(d.getMinutes()),pad(d.getSeconds())].join(":");return[d.getDate(),months[d.getMonth()],time].join(" ")}exports.log=function(){console.log("%s - %s",timestamp(),exports.format.apply(exports,arguments))};exports.inherits=require("inherits");exports._extend=function(origin,add){if(!add||!isObject(add))return origin;var keys=Object.keys(add);var i=keys.length;while(i--){origin[keys[i]]=add[keys[i]]}return origin};function hasOwnProperty(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}}).call(this,require("_process"),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./support/isBuffer":253,_process:251,inherits:252}]},{},[154]);
